<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	 <meta name="description" content="">

    <meta name="author" content="dmey (forked from NREL)" >
    <link rel="icon" href="../favicon.png">

    <title>TarcogComplexFenestration.f90 &ndash; EnergyPlusFortran</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>


    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">EnergyPlusFortran <small>8.1.0.009</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">

            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">

            <li><a href="../lists/files.html">Source Files</a></li>


            <li><a href="../lists/modules.html">Modules</a></li>


            <li><a href="../lists/procedures.html">Procedures</a></li>


            <li><a href="../lists/types.html">Derived Types</a></li>


            <li><a href="../program/energyplus.html">Program</a></li>

            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/energyplus.html">Program</a></li>

          </ul>


        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">


  <div class="row">
    <h1>TarcogComplexFenestration.f90
    <small>Source File</small>

    </h1>

<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">


     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 1.1% of total for source files.">4040 statements</a>
     </li>


    <li><i class="fa fa-code"></i><a href="../src/TarcogComplexFenestration.f90"> Source File</a></li>

  </ul>
  <ol class="breadcrumb in-well text-right">

     <li class="active">TarcogComplexFenestration.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">

<div id="sidebar">


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../module/tarcoggassesparams.html">TARCOGGassesParams</a>

      <a class="list-group-item" href="../module/tarcoggasses90.html">TARCOGGasses90</a>

      <a class="list-group-item" href="../module/tarcogparams.html">TARCOGParams</a>

      <a class="list-group-item" href="../module/tarcogcommon.html">TARCOGCommon</a>

      <a class="list-group-item" href="../module/tarcogoutput.html">TARCOGOutput</a>

      <a class="list-group-item" href="../module/tarcogargs.html">TARCOGArgs</a>

      <a class="list-group-item" href="../module/tarcogdeflection.html">TARCOGDeflection</a>

      <a class="list-group-item" href="../module/tarcogshading.html">TarcogShading</a>

      <a class="list-group-item" href="../module/thermalen673calc.html">ThermalEN673Calc</a>

      <a class="list-group-item" href="../module/thermaliso15099calc.html">ThermalISO15099Calc</a>

      <a class="list-group-item" href="../module/tarcogmain.html">TARCOGMain</a>

    </div>
  </div>
</div>


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html#src">TarcogComplexFenestration.f90</a>
  </div>
</div>


  <hr>


<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../sourcefile/airflownetworkbalancemanager.f90.html">AirflowNetworkBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html">AirflowNetworkSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiator.f90.html">BaseboardRadiator.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorelectric.f90.html">BaseboardRadiatorElectric.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorsteam.f90.html">BaseboardRadiatorSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorwater.f90.html">BaseboardRadiatorWater.f90</a>

      <a class="list-group-item" href="../sourcefile/branchinputmanager.f90.html">BranchInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/branchnodeconnections.f90.html">BranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/conductiontransferfunctioncalc.f90.html">ConductionTransferFunctionCalc.f90</a>

      <a class="list-group-item" href="../sourcefile/cooltower.f90.html">CoolTower.f90</a>

      <a class="list-group-item" href="../sourcefile/costestimatemanager.f90.html">CostEstimateManager.f90</a>

      <a class="list-group-item" href="../sourcefile/curvemanager.f90.html">CurveManager.f90</a>

      <a class="list-group-item" href="../sourcefile/cvfonlyroutines.f90.html">CVFOnlyRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairflownetwork.f90.html">DataAirflowNetwork.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairloop.f90.html">DataAirLoop.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairsystems.f90.html">DataAirSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchairloopplant.f90.html">DataBranchAirLoopPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchnodeconnections.f90.html">DataBranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/databsdfwindow.f90.html">DataBSDFWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/datacomplexfenestration.f90.html">DataComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/datacontaminantbalance.f90.html">DataContaminantBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconvergparams.f90.html">DataConvergParams.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconversions.f90.html">DataConversions.f90</a>

      <a class="list-group-item" href="../sourcefile/datacostestimate.f90.html">DataCostEstimate.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylighting.f90.html">DataDaylighting.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylightingdevices.f90.html">DataDaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/datadefineequip.f90.html">Datadefineequip.f90</a>

      <a class="list-group-item" href="../sourcefile/datadelight.f90.html">DataDElight.f90</a>

      <a class="list-group-item" href="../sourcefile/dataenvironment.f90.html">DataEnvironment.f90</a>

      <a class="list-group-item" href="../sourcefile/dataequivalentlayerwindow.f90.html">DataEquivalentLayerWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/dataerrortracking.f90.html">DataErrorTracking.f90</a>

      <a class="list-group-item" href="../sourcefile/datagenerators.f90.html">DataGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobalconstants.f90.html">DataGlobalConstants.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobals.f90.html">DataGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalance.f90.html">DataHeatBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalfansys.f90.html">DataHeatBalFanSys.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalsurface.f90.html">DataHeatBalSurface.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvaccontrollers.f90.html">DataHVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvacglobals.f90.html">DataHVACGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datainterfaces.f90.html">DataInterfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/dataipshortcuts.f90.html">DataIPShortCuts.f90</a>

      <a class="list-group-item" href="../sourcefile/dataloopnode.f90.html">DataLoopNode.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalance.f90.html">DataMoistureBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalanceempd.f90.html">DataMoistureBalanceEMPD.f90</a>

      <a class="list-group-item" href="../sourcefile/dataoutputs.f90.html">DataOutputs.f90</a>

      <a class="list-group-item" href="../sourcefile/dataphotovoltaics.f90.html">DataPhotovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplant.f90.html">DataPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplantpipingsystems.f90.html">DataPlantPipingSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/dataprecisionglobals.f90.html">DataPrecisionGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datareportingflags.f90.html">DataReportingFlags.f90</a>

      <a class="list-group-item" href="../sourcefile/dataroomair.f90.html">DataRoomAir.f90</a>

      <a class="list-group-item" href="../sourcefile/datarootfinder.f90.html">DataRootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/dataruntimelanguage.f90.html">DataRuntimeLanguage.f90</a>

      <a class="list-group-item" href="../sourcefile/datashadowingcombinations.f90.html">DataShadowingCombinations.f90</a>

      <a class="list-group-item" href="../sourcefile/datasizing.f90.html">DataSizing.f90</a>

      <a class="list-group-item" href="../sourcefile/datastringglobals.f90.html">DataStringGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacecolors.f90.html">DataSurfaceColors.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacelists.f90.html">DataSurfaceLists.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfaces.f90.html">DataSurfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/datasystemvariables.f90.html">DataSystemVariables.f90</a>

      <a class="list-group-item" href="../sourcefile/datatimings.f90.html">DataTimings.f90</a>

      <a class="list-group-item" href="../sourcefile/dataucsdshareddata.f90.html">DataUCSDSharedData.f90</a>

      <a class="list-group-item" href="../sourcefile/datavectortypes.f90.html">DataVectorTypes.f90</a>

      <a class="list-group-item" href="../sourcefile/dataviewfactorinformation.f90.html">DataViewFactorInformation.f90</a>

      <a class="list-group-item" href="../sourcefile/datawater.f90.html">DataWater.f90</a>

      <a class="list-group-item" href="../sourcefile/datazonecontrols.f90.html">DataZoneControls.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneenergydemands.f90.html">DataZoneEnergyDemands.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneequipment.f90.html">DataZoneEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingdevices.f90.html">DaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingmanager.f90.html">DaylightingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf.f90.html">DElightManagerF.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf_no.f90.html">DElightManagerF_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/demandmanager.f90.html">DemandManager.f90</a>

      <a class="list-group-item" href="../sourcefile/desiccantdehumidifiers.f90.html">DesiccantDehumidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/directair.f90.html">DirectAir.f90</a>

      <a class="list-group-item" href="../sourcefile/displayroutines.f90.html">DisplayRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dxcoil.f90.html">DXCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/earthtube.f90.html">EarthTube.f90</a>

      <a class="list-group-item" href="../sourcefile/economiclifecyclecost.f90.html">EconomicLifeCycleCost.f90</a>

      <a class="list-group-item" href="../sourcefile/economictariff.f90.html">EconomicTariff.f90</a>

      <a class="list-group-item" href="../sourcefile/ecoroof.f90.html">EcoRoof.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowergenerators.f90.html">ElectricPowerGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowermanager.f90.html">ElectricPowerManager.f90</a>

      <a class="list-group-item" href="../sourcefile/emsmanager.f90.html">EMSManager.f90</a>

      <a class="list-group-item" href="../sourcefile/energyplus.f90.html">EnergyPlus.f90</a>

      <a class="list-group-item" href="../sourcefile/exteriorenergyusemanager.f90.html">ExteriorEnergyUseManager.f90</a>

      <a class="list-group-item" href="../sourcefile/externalinterface_no.f90.html">ExternalInterface_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/fancoilunits.f90.html">FanCoilUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/faultsmanager.f90.html">FaultsManager.f90</a>

      <a class="list-group-item" href="../sourcefile/fluidproperties.f90.html">FluidProperties.f90</a>

      <a class="list-group-item" href="../sourcefile/general.f90.html">General.f90</a>

      <a class="list-group-item" href="../sourcefile/generalroutines.f90.html">GeneralRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/globalnames.f90.html">GlobalNames.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceairmanager.f90.html">HeatBalanceAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceconvectioncoeffs.f90.html">HeatBalanceConvectionCoeffs.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancehamtmanager.f90.html">HeatBalanceHAMTManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceinternalheatgains.f90.html">HeatBalanceInternalHeatGains.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceintradexchange.f90.html">HeatBalanceIntRadExchange.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemanager.f90.html">HeatBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemovableinsulation.f90.html">HeatBalanceMovableInsulation.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancesurfacemanager.f90.html">HeatBalanceSurfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalfinitedifferencemanager.f90.html">HeatBalFiniteDifferenceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatrecovery.f90.html">HeatRecovery.f90</a>

      <a class="list-group-item" href="../sourcefile/humidifiers.f90.html">Humidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccontrollers.f90.html">HVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccooledbeam.f90.html">HVACCooledBeam.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdualductsystem.f90.html">HVACDualDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacduct.f90.html">HVACDuct.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdxsystem.f90.html">HVACDXSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacevapcomponent.f90.html">HVACEvapComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfancomponent.f90.html">HVACFanComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfurnace.f90.html">HVACFurnace.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacheatingcoils.f90.html">HVACHeatingCoils.f90</a>

      <a class="list-group-item" href="../sourcefile/hvachxassistedcoolingcoil.f90.html">HVACHXAssistedCoolingCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacinterfacemanager.f90.html">HVACInterfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmanager.f90.html">HVACManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmixercomponent.f90.html">HVACMixerComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmultispeedheatpump.f90.html">HVACMultiSpeedHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductinduc.f90.html">HVACSingleDuctInduc.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductsystem.f90.html">HVACSingleDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsplittercomponent.f90.html">HVACSplitterComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacstandaloneerv.f90.html">HVACStandAloneERV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsteamcoilcomponent.f90.html">HVACSteamCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvactranspiredcollector.f90.html">HVACTranspiredCollector.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarybypassvav.f90.html">HVACUnitaryBypassVAV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarysystem.f90.html">HVACUnitarySystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacvariablerefrigerantflow.f90.html">HVACVariableRefrigerantFlow.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatercoilcomponent.f90.html">HVACWaterCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoair.f90.html">HVACWatertoAir.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoairmultispeedhp.f90.html">HVACWatertoAirMultiSpeedHP.f90</a>

      <a class="list-group-item" href="../sourcefile/inputprocessor.f90.html">InputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/matrixdatamanager.f90.html">MatrixDataManager.f90</a>

      <a class="list-group-item" href="../sourcefile/mixedair.f90.html">MixedAir.f90</a>

      <a class="list-group-item" href="../sourcefile/moisturebalanceempdmanager.f90.html">MoistureBalanceEMPDManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nodeinputmanager.f90.html">NodeInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nonzoneequipmentmanager.f90.html">NonZoneEquipmentManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outairnodemanager.f90.html">OutAirNodeManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outdoorairunit.f90.html">OutdoorAirUnit.f90</a>

      <a class="list-group-item" href="../sourcefile/outputprocessor.f90.html">OutputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreportpredefined.f90.html">OutputReportPredefined.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreports.f90.html">OutputReports.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreporttabular.f90.html">OutputReportTabular.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedterminalheatpump.f90.html">PackagedTerminalHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedthermalstoragecoil.f90.html">PackagedThermalStorageCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaics.f90.html">Photovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaicthermalcollectors.f90.html">PhotovoltaicThermalCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantabsorptionchillers.f90.html">PlantAbsorptionChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilers.f90.html">PlantBoilers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilerssteam.f90.html">PlantBoilersSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcentralgshp.f90.html">PlantCentralGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantchillers.f90.html">PlantChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondloopoperation.f90.html">PlantCondLoopOperation.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondlooptowers.f90.html">PlantCondLoopTowers.f90</a>

      <a class="list-group-item" href="../sourcefile/planteirchillers.f90.html">PlantEIRChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantevapfluidcoolers.f90.html">PlantEvapFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantexhaustabsorptionchiller.f90.html">PlantExhaustAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantfluidcoolers.f90.html">PlantFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgasabsorptionchiller.f90.html">PlantGasAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgroundheatexchangers.f90.html">PlantGroundHeatExchangers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantheatexchanger.f90.html">PlantHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/planticethermalstorage.f90.html">PlantIceThermalStorage.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloadprofile.f90.html">PlantLoadProfile.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopequipment.f90.html">PlantLoopEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopsolver.f90.html">PlantLoopSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/plantmanager.f90.html">PlantManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantoutsideenergysources.f90.html">PlantOutsideEnergySources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipeheattransfer.f90.html">PlantPipeHeatTransfer.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipes.f90.html">PlantPipes.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipingsystemmanager.f90.html">PlantPipingSystemManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpondgroundheatexchanger.f90.html">PlantPondGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpressuresystem.f90.html">PlantPressureSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpumps.f90.html">PlantPumps.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsolarcollectors.f90.html">PlantSolarCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsurfacegroundheatexchanger.f90.html">PlantSurfaceGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantutilities.f90.html">PlantUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/plantvalves.f90.html">PlantValves.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatersources.f90.html">PlantWaterSources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwaterthermaltank.f90.html">PlantWaterThermalTank.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatertowatergshp.f90.html">PlantWatertoWaterGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwateruse.f90.html">PlantWaterUse.f90</a>

      <a class="list-group-item" href="../sourcefile/pollutionanalysismodule.f90.html">PollutionAnalysisModule.f90</a>

      <a class="list-group-item" href="../sourcefile/poweredinductionunits.f90.html">PoweredInductionUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/psychroutines.f90.html">PsychRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/purchasedairmanager.f90.html">Purchasedairmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemhightemp.f90.html">RadiantSystemHighTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemlowtemp.f90.html">RadiantSystemLowTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/refrigeratedcase.f90.html">RefrigeratedCase.f90</a>

      <a class="list-group-item" href="../sourcefile/reportsizingmanager.f90.html">ReportSizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/returnairpath.f90.html">ReturnAirPath.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmanager.f90.html">RoomAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelcrossvent.f90.html">RoomAirModelCrossVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodeldisplacementvent.f90.html">RoomAirModelDisplacementVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelmundt.f90.html">RoomAirModelMundt.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelufad.f90.html">RoomAirModelUFAD.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelusertemppattern.f90.html">RoomAirModelUserTempPattern.f90</a>

      <a class="list-group-item" href="../sourcefile/rootfinder.f90.html">RootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/runtimelanguageprocessor.f90.html">RuntimeLanguageProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/schedulemanager.f90.html">ScheduleManager.f90</a>

      <a class="list-group-item" href="../sourcefile/setpointmanager.f90.html">SetPointManager.f90</a>

      <a class="list-group-item" href="../sourcefile/simairservingzones.f90.html">SimAirServingZones.f90</a>

      <a class="list-group-item" href="../sourcefile/simulationmanager.f90.html">SimulationManager.f90</a>

      <a class="list-group-item" href="../sourcefile/sizingmanager.f90.html">SizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarreflectionmanager.f90.html">SolarReflectionManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarshading.f90.html">SolarShading.f90</a>

      <a class="list-group-item" href="../sourcefile/sortandstringutilities.f90.html">SortAndStringUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlite3.c.html">sqlite3.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitecroutines.c.html">SQLiteCRoutines.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines.f90.html">SQLiteFortranRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines_no.f90.html">SQLiteFortranRoutines_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/standardratings.f90.html">StandardRatings.f90</a>

      <a class="list-group-item" href="../sourcefile/surfacegeometry.f90.html">SurfaceGeometry.f90</a>

      <a class="list-group-item" href="../sourcefile/systemavailabilitymanager.f90.html">SystemAvailabilityManager.f90</a>

      <a class="list-group-item" href="../sourcefile/systemreports.f90.html">SystemReports.f90</a>

      <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html">TarcogComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalchimney.f90.html">ThermalChimney.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalcomfort.f90.html">ThermalComfort.f90</a>

      <a class="list-group-item" href="../sourcefile/unitheater.f90.html">UnitHeater.f90</a>

      <a class="list-group-item" href="../sourcefile/unitventilator.f90.html">UnitVentilator.f90</a>

      <a class="list-group-item" href="../sourcefile/userdefinedcomponents.f90.html">UserDefinedComponents.f90</a>

      <a class="list-group-item" href="../sourcefile/utilityroutines.f90.html">UtilityRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/vectorutilities.f90.html">VectorUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/ventilatedslab.f90.html">VentilatedSlab.f90</a>

      <a class="list-group-item" href="../sourcefile/watermanager.f90.html">WaterManager.f90</a>

      <a class="list-group-item" href="../sourcefile/weathermanager.f90.html">WeatherManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowac.f90.html">WindowAC.f90</a>

      <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html">WindowComplexManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowequivalentlayer.f90.html">WindowEquivalentLayer.f90</a>

      <a class="list-group-item" href="../sourcefile/windowmanager.f90.html">WindowManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windturbine.f90.html">WindTurbine.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneairloopequipmentmanager.f90.html">Zoneairloopequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zonecontaminantpredictorcorrector.f90.html">ZoneContaminantPredictorCorrector.f90</a>

      <a class="list-group-item" href="../sourcefile/zonedehumidifier.f90.html">ZoneDehumidifier.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneequipmentmanager.f90.html">Zoneequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneplenumcomponent.f90.html">ZonePlenumComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/zonetemppredictorcorrector.f90.html">ZoneTempPredictorCorrector.f90</a>

    </div>
  </div>
</div>


</div>

    </div>
    <div class="col-md-9" id='text'>


    <h3>This File Depends On</h3>

                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefiletarcogcomplexfenestrationf90EfferentGraph" width="459pt" height="50pt"
 viewBox="0.00 0.00 458.60 49.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 45.5)">
<title>sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-45.5 454.5984,-45.5 454.5984,4 -4,4"/>
<!-- sourcefile~tarcogcomplexfenestration.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~tarcogcomplexfenestration.f90</title>
<polygon fill="none" stroke="#000000" points="450.5111,-41.2554 289.8605,-41.2554 289.8605,-19.2446 450.5111,-19.2446 450.5111,-41.2554"/>
<text text-anchor="middle" x="370.1858" y="-27.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">TarcogComplexFenestration.f90</text>
</g>
<!-- sourcefile~dataglobals.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~dataglobals.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/dataglobals.f90.html" xlink:title="DataGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="253.9209,-22.2554 166.331,-22.2554 166.331,-.2446 253.9209,-.2446 253.9209,-22.2554"/>
<text text-anchor="middle" x="210.126" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M253.863,-16.4418C261.9331,-17.3998 270.6278,-18.4319 279.5005,-19.4851"/>
<polygon fill="#ff0000" stroke="#ff0000" points="279.2268,-22.9772 289.5697,-20.6804 280.0521,-16.026 279.2268,-22.9772"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~dataprecisionglobals.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/dataprecisionglobals.f90.html" xlink:title="DataPrecisionGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="130.719,-41.2554 -.2403,-41.2554 -.2403,-19.2446 130.719,-19.2446 130.719,-41.2554"/>
<text text-anchor="middle" x="65.2394" y="-27.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataPrecisionGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M130.5906,-30.9902C142.5298,-31.0985 154.878,-31.1927 166.4788,-31.25 205.2758,-31.4416 214.976,-31.4166 253.7732,-31.25 262.1261,-31.2141 270.8159,-31.1638 279.5164,-31.1045"/>
<polygon fill="#ff0000" stroke="#ff0000" points="279.7406,-34.6031 289.7152,-31.0313 279.6902,-27.6033 279.7406,-34.6031"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataglobals.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataglobals.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M130.9,-21.6395C139.3232,-20.5349 147.8699,-19.4141 156.079,-18.3376"/>
<polygon fill="#ff0000" stroke="#ff0000" points="156.802,-21.7728 166.262,-17.0022 155.8918,-14.8322 156.802,-21.7728"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">

    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="186pt" height="31pt"
 viewBox="0.00 0.00 186.41 30.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 26.5)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-26.5 182.4064,-26.5 182.4064,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65.1576,-22.2554 -.0526,-22.2554 -.0526,-.2446 65.1576,-.2446 65.1576,-22.2554"/>
<text text-anchor="middle" x="32.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="178.2607,-22.2554 82.8443,-22.2554 82.8443,-.2446 178.2607,-.2446 178.2607,-22.2554"/>
<text text-anchor="middle" x="130.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>


    <p>Solid arrows point from a file to a file which depends upon it. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>

                      </div>
                    </div>
                  </div>
                </div>


      <h3>Files Dependent On This One</h3>

                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefiletarcogcomplexfenestrationf90AfferentGraph" width="641pt" height="98pt"
 viewBox="0.00 0.00 641.00 97.74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph" class="graph" transform="scale(.3803 .3803) rotate(0) translate(4 252.9927)">
<title>sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-252.9927 1681.3655,-252.9927 1681.3655,4 -4,4"/>
<!-- sourcefile~tarcogcomplexfenestration.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~tarcogcomplexfenestration.f90</title>
<polygon fill="none" stroke="#000000" points="160.7379,-119.2554 .0873,-119.2554 .0873,-97.2446 160.7379,-97.2446 160.7379,-119.2554"/>
<text text-anchor="middle" x="80.4126" y="-105.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">TarcogComplexFenestration.f90</text>
</g>
<!-- sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~windowcomplexmanager.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/windowcomplexmanager.f90.html" xlink:title="WindowComplexManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="346.0597,-119.2554 196.747,-119.2554 196.747,-97.2446 346.0597,-97.2446 346.0597,-119.2554"/>
<text text-anchor="middle" x="271.4033" y="-105.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">WindowComplexManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~tarcogcomplexfenestration.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge28" class="edge">
<title>sourcefile~tarcogcomplexfenestration.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M160.8563,-108.25C169.2637,-108.25 177.8307,-108.25 186.2879,-108.25"/>
<polygon fill="#ff0000" stroke="#ff0000" points="186.5311,-111.7501 196.5311,-108.25 186.5311,-104.7501 186.5311,-111.7501"/>
</g>
<!-- sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~heatbalancemanager.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/heatbalancemanager.f90.html" xlink:title="HeatBalanceManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1254.115,-138.2554 1124.1043,-138.2554 1124.1043,-116.2446 1254.115,-116.2446 1254.115,-138.2554"/>
<text text-anchor="middle" x="1189.1096" y="-124.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M611.1002,-245.25C786.4884,-255.8264 832.4136,-241.6754 1004.5122,-206.25"/>
</g>
<!-- sourcefile~windowmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~windowmanager.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node4"><a xlink:href="../sourcefile/windowmanager.f90.html" xlink:title="WindowManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="855.2552,-217.2554 747.8038,-217.2554 747.8038,-195.2446 855.2552,-195.2446 855.2552,-217.2554"/>
<text text-anchor="middle" x="801.5295" y="-203.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">WindowManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~windowmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~windowmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M285.8049,-119.3696C331.1755,-153.195 476.1458,-252.1417 611.1002,-245.25"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M611.1002,-245.25C637.6188,-246.8491 703.5498,-231.7291 750.3828,-219.8506"/>
<polygon fill="#ff0000" stroke="#ff0000" points="751.5409,-223.167 760.3604,-217.296 749.8047,-216.3857 751.5409,-223.167"/>
</g>
<!-- sourcefile~daylightingmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~daylightingmanager.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node5"><a xlink:href="../sourcefile/daylightingmanager.f90.html" xlink:title="DaylightingManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="504.4722,-119.2554 381.8176,-119.2554 381.8176,-97.2446 504.4722,-97.2446 504.4722,-119.2554"/>
<text text-anchor="middle" x="443.1449" y="-105.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DaylightingManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~daylightingmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~daylightingmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M346.2321,-108.25C354.7148,-108.25 363.3437,-108.25 371.7803,-108.25"/>
<polygon fill="#ff0000" stroke="#ff0000" points="371.9529,-111.7501 381.9528,-108.25 371.9528,-104.7501 371.9529,-111.7501"/>
</g>
<!-- sourcefile~solarshading.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~solarshading.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node6"><a xlink:href="../sourcefile/solarshading.f90.html" xlink:title="SolarShading.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="847.5904,-61.2554 755.4687,-61.2554 755.4687,-39.2446 847.5904,-39.2446 847.5904,-61.2554"/>
<text text-anchor="middle" x="801.5295" y="-47.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SolarShading.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~solarshading.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~solarshading.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M326.9374,-97.2125C344.4926,-93.9906 364.0022,-90.6853 381.9814,-88.25 511.3386,-70.7286 664.2614,-59.1675 745.0081,-53.7727"/>
<polygon fill="#ff0000" stroke="#ff0000" points="745.6917,-57.2353 755.4391,-53.0834 745.23,-50.2505 745.6917,-57.2353"/>
</g>
<!-- sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~sizingmanager.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node7"><a xlink:href="../sourcefile/sizingmanager.f90.html" xlink:title="SizingManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1389.33,-138.2554 1290.3724,-138.2554 1290.3724,-116.2446 1389.33,-116.2446 1389.33,-138.2554"/>
<text text-anchor="middle" x="1339.8512" y="-124.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SizingManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~sizingmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1254.3503,-127.25C1262.8357,-127.25 1271.4955,-127.25 1279.889,-127.25"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1279.9656,-130.7501 1289.9655,-127.25 1279.9655,-123.7501 1279.9656,-130.7501"/>
</g>
<!-- sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~simulationmanager.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node8"><a xlink:href="../sourcefile/simulationmanager.f90.html" xlink:title="SimulationManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1544.9481,-61.2554 1425.1376,-61.2554 1425.1376,-39.2446 1544.9481,-39.2446 1544.9481,-61.2554"/>
<text text-anchor="middle" x="1485.0428" y="-47.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SimulationManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1226.6085,-116.1906C1256.9327,-107.577 1300.8466,-95.845 1339.8512,-88.25"/>
</g>
<!-- sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M855.5448,-212.1015C896.7893,-215.1666 954.8002,-216.4403 1004.5122,-206.25"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~heatbalancesurfacemanager.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node11"><a xlink:href="../sourcefile/heatbalancesurfacemanager.f90.html" xlink:title="HeatBalanceSurfaceManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1087.7029,-119.2554 921.3215,-119.2554 921.3215,-97.2446 1087.7029,-97.2446 1087.7029,-119.2554"/>
<text text-anchor="middle" x="1004.5122" y="-105.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceSurfaceManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M824.4197,-195.1987C860.683,-177.6907 931.4421,-143.5282 972.6454,-123.6353"/>
<polygon fill="#7fff00" stroke="#7fff00" points="974.2221,-126.7607 981.7057,-119.261 971.1786,-120.4569 974.2221,-126.7607"/>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~solarshading.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~solarshading.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M611.1002,-88.25C656.4859,-81.0308 707.5326,-70.7251 745.3422,-62.6669"/>
<polygon fill="#00ffff" stroke="#00ffff" points="746.1039,-66.0833 755.1478,-60.5643 744.6362,-59.2388 746.1039,-66.0833"/>
</g>
<!-- sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~utilityroutines.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node10"><a xlink:href="../sourcefile/utilityroutines.f90.html" xlink:title="UtilityRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1677.1764,-22.2554 1580.9342,-22.2554 1580.9342,-.2446 1677.1764,-.2446 1677.1764,-22.2554"/>
<text text-anchor="middle" x="1629.0553" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">UtilityRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1485.0428,-11.25C1513.1223,-9.3728 1544.3502,-9.1464 1570.5296,-9.4819"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1570.6147,-12.9836 1580.669,-9.6427 1570.7258,-5.9845 1570.6147,-12.9836"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M611.1002,-88.25C664.4411,-79.7654 666.0121,-45.2732 717.8921,-30.25 840.5204,5.2602 876.8459,-11.25 1004.5122,-11.25 1004.5122,-11.25 1004.5122,-11.25 1189.1096,-11.25 1320.6355,-11.25 1353.8099,-20.0233 1485.0428,-11.25"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M504.6987,-101.8893C536.53,-98.3549 575.9729,-93.5946 611.1002,-88.25"/>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M801.5295,-89.25C838.5758,-89.1849 879.2604,-92.3492 914.4153,-96.113"/>
<polygon fill="#00ffff" stroke="#00ffff" points="914.3321,-99.625 924.6556,-97.2426 915.0997,-92.6672 914.3321,-99.625"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M611.1002,-88.25C694.6858,-74.9546 716.8933,-89.3987 801.5295,-89.25"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~windowequivalentlayer.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node12"><a xlink:href="../sourcefile/windowequivalentlayer.f90.html" xlink:title="WindowEquivalentLayer.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="681.6846,-138.2554 540.5159,-138.2554 540.5159,-116.2446 681.6846,-116.2446 681.6846,-138.2554"/>
<text text-anchor="middle" x="611.1002" y="-124.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">WindowEquivalentLayer.f90</text>
</a>
</g>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~windowequivalentlayer.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~windowequivalentlayer.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M504.7316,-115.217C513.0756,-116.1609 521.7378,-117.1408 530.3546,-118.1156"/>
<polygon fill="#00ffff" stroke="#00ffff" points="530.0972,-121.6087 540.4272,-119.2551 530.8841,-114.6531 530.0972,-121.6087"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1004.5122,-50.25C1064.8162,-56.4716 1128.7231,-90.0193 1163.2719,-110.728"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="1161.8534,-113.9631 1172.2105,-116.195 1165.5058,-107.9915 1161.8534,-113.9631"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1339.8512,-50.25C1364.3889,-48.6096 1391.3114,-48.2195 1415.2372,-48.365"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="1415.2599,-51.8653 1425.2919,-48.4581 1415.3247,-44.8656 1415.2599,-51.8653"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M847.619,-47.5628C888.8507,-45.7974 950.8796,-44.7167 1004.5122,-50.25"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1004.5122,-50.25C1152.7648,-65.5454 1191.1436,-60.1915 1339.8512,-50.25"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1339.8512,-50.25C1406.3779,-44.0274 1418.3746,-15.7069 1485.0428,-11.25"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M840.1868,-61.2959C873.0961,-70.6993 920.5368,-84.255 955.9931,-94.3862"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="955.0769,-97.7644 965.6537,-97.1466 957.0001,-91.0338 955.0769,-97.7644"/>
</g>
<!-- sourcefile~sizingmanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~sizingmanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1362.0959,-116.1906C1370.6434,-111.8946 1380.4736,-106.8972 1389.3406,-102.25 1411.835,-90.4605 1437.0684,-76.7286 1455.9753,-66.3374"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1457.9017,-69.2722 1464.9727,-61.3822 1454.5248,-63.1406 1457.9017,-69.2722"/>
</g>
<!-- sourcefile~energyplus.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~energyplus.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node9"><a xlink:href="../sourcefile/energyplus.f90.html" xlink:title="EnergyPlus.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1670.7638,-63.2554 1587.3468,-63.2554 1587.3468,-41.2446 1670.7638,-41.2446 1670.7638,-63.2554"/>
<text text-anchor="middle" x="1629.0553" y="-49.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">EnergyPlus.f90</text>
</a>
</g>
</g>
<!-- sourcefile~simulationmanager.f90&#45;&gt;sourcefile~energyplus.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~simulationmanager.f90&#45;&gt;sourcefile~energyplus.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1544.866,-51.0808C1555.5306,-51.2289 1566.5624,-51.3821 1576.9888,-51.5269"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1577.1296,-55.0291 1587.1772,-51.6684 1577.2268,-48.0298 1577.1296,-55.0291"/>
</g>
<!-- sourcefile~simulationmanager.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~simulationmanager.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1525.9258,-39.1785C1542.1921,-34.7734 1561.0823,-29.6578 1578.2172,-25.0174"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1579.3327,-28.3415 1588.0701,-22.3492 1577.5029,-21.5849 1579.3327,-28.3415"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1087.8999,-116.8328C1096.6215,-117.7305 1105.4502,-118.6392 1114.0706,-119.5265"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1113.7698,-123.0139 1124.0757,-120.5563 1114.4866,-116.0507 1113.7698,-123.0139"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1339.8512,-88.25C1373.1389,-81.7682 1410.1087,-72.0548 1438.412,-64.0713"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1439.3834,-67.4339 1448.0416,-61.3277 1437.4653,-60.7018 1439.3834,-67.4339"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1087.8059,-105.8062C1171.1346,-102.9071 1293.4097,-97.2931 1339.8512,-88.25"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1004.5122,-206.25C1063.04,-194.2525 1125.9385,-162.9112 1161.1233,-143.5039"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1163.271,-146.3126 1170.2856,-138.3725 1159.8505,-140.2052 1163.271,-146.3126"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M660.7029,-138.2816C762.658,-160.8086 987.6642,-209.7036 1004.5122,-206.25"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~windowmanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~windowmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M630.3007,-138.2715C651.3159,-150.0205 686.2417,-168.6338 717.8921,-181.25 728.0238,-185.2886 739.069,-189.0323 749.7134,-192.3278"/>
<polygon fill="#ff0000" stroke="#ff0000" points="748.754,-195.694 759.3384,-195.2237 750.7709,-188.9909 748.754,-195.694"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~solarshading.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~solarshading.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M649.1159,-116.2032C659.9925,-112.4144 671.6648,-107.7247 681.8921,-102.25 699.5247,-92.8112 700.0334,-84.2538 717.8921,-75.25 726.5297,-70.8952 736.0594,-67.1578 745.4994,-64.0007"/>
<polygon fill="#ff0000" stroke="#ff0000" points="746.7803,-67.2667 755.2632,-60.9192 744.6734,-60.5913 746.7803,-67.2667"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M645.4383,-116.194C683.257,-105.0101 746.0726,-89.3474 801.5295,-89.25"/>
</g>
<!-- sourcefile~heatbalanceintradexchange.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~heatbalanceintradexchange.f90</title>
<g id="a_sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_node13"><a xlink:href="../sourcefile/heatbalanceintradexchange.f90.html" xlink:title="HeatBalanceIntRadExchange.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="885.3047,-139.2554 717.7544,-139.2554 717.7544,-117.2446 885.3047,-117.2446 885.3047,-139.2554"/>
<text text-anchor="middle" x="801.5295" y="-125.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceIntRadExchange.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalanceintradexchange.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalanceintradexchange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M681.7385,-127.6209C690.1832,-127.6653 698.9047,-127.7111 707.6118,-127.7568"/>
<polygon fill="#ff0000" stroke="#ff0000" points="707.7908,-131.2577 717.8091,-127.8104 707.8276,-124.2578 707.7908,-131.2577"/>
</g>
<!-- sourcefile~heatbalanceintradexchange.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~tarcogcomplexfenestration.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~heatbalanceintradexchange.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M885.2623,-119.9998C893.8179,-119.1568 902.5474,-118.2967 911.1971,-117.4444"/>
<polygon fill="#ff0000" stroke="#ff0000" points="911.6908,-120.9128 921.2993,-116.449 911.0043,-113.9465 911.6908,-120.9128"/>
</g>
</g>
</svg>
</div>
                <script>var pansourcefiletarcogcomplexfenestrationf90AfferentGraph = svgPanZoom('#sourcefiletarcogcomplexfenestrationf90AfferentGraph', {
                    zoomEnabled: true,
                    controlIconsEnabled: true,
                    fit: true,
                    center: true,});
                    </script>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">

    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="186pt" height="31pt"
 viewBox="0.00 0.00 186.41 30.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 26.5)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-26.5 182.4064,-26.5 182.4064,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65.1576,-22.2554 -.0526,-22.2554 -.0526,-.2446 65.1576,-.2446 65.1576,-22.2554"/>
<text text-anchor="middle" x="32.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="178.2607,-22.2554 82.8443,-22.2554 82.8443,-.2446 178.2607,-.2446 178.2607,-22.2554"/>
<text text-anchor="middle" x="130.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>


    <p>Solid arrows point from a file to a file which depends upon it. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>

                      </div>
                    </div>
                  </div>
                </div>


      <br>

    <section class="visible-xs visible-sm hidden-md">


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../module/tarcoggassesparams.html">TARCOGGassesParams</a>

      <a class="list-group-item" href="../module/tarcoggasses90.html">TARCOGGasses90</a>

      <a class="list-group-item" href="../module/tarcogparams.html">TARCOGParams</a>

      <a class="list-group-item" href="../module/tarcogcommon.html">TARCOGCommon</a>

      <a class="list-group-item" href="../module/tarcogoutput.html">TARCOGOutput</a>

      <a class="list-group-item" href="../module/tarcogargs.html">TARCOGArgs</a>

      <a class="list-group-item" href="../module/tarcogdeflection.html">TARCOGDeflection</a>

      <a class="list-group-item" href="../module/tarcogshading.html">TarcogShading</a>

      <a class="list-group-item" href="../module/thermalen673calc.html">ThermalEN673Calc</a>

      <a class="list-group-item" href="../module/thermaliso15099calc.html">ThermalISO15099Calc</a>

      <a class="list-group-item" href="../module/tarcogmain.html">TARCOGMain</a>

    </div>
  </div>
</div>


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html#src">TarcogComplexFenestration.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="k">module </span><span class="n">TARCOGGassesParams</span>
<a name="ln-2"></a>
<a name="ln-3"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-4"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-5"></a>          <span class="c">!       DATE WRITTEN   August/2011</span>
<a name="ln-6"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-7"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-8"></a>
<a name="ln-9"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-10"></a>          <span class="c">! Keeps common data used by gasses and tarcog routines</span>
<a name="ln-11"></a>
<a name="ln-12"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-13"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-14"></a>
<a name="ln-15"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-16"></a>          <span class="c">! na</span>
<a name="ln-17"></a>
<a name="ln-18"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-19"></a>          <span class="c">! na</span>
<a name="ln-20"></a>
<a name="ln-21"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-22"></a>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-24"></a>
<a name="ln-25"></a>  <span class="k">implicit none</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="k">  public</span>
<a name="ln-28"></a>
<a name="ln-29"></a>  <span class="c">!Max number of gasses</span>
<a name="ln-30"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxgas</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-31"></a>
<a name="ln-32"></a>  <span class="c">!Standards:</span>
<a name="ln-33"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">ISO15099</span>    <span class="o">=</span> <span class="mi">1</span>     <span class="c">! standard = ISO15099</span>
<a name="ln-34"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">EN673</span>       <span class="o">=</span> <span class="mi">2</span>     <span class="c">! standard = EN 673 / ISO 10292 Declared</span>
<a name="ln-35"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">EN673Design</span> <span class="o">=</span> <span class="mi">3</span>     <span class="c">! standard = EN 673 / ISO 10292 Design</span>
<a name="ln-36"></a>
<a name="ln-37"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MinStandard</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c">! minimum index for standard</span>
<a name="ln-38"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MaxStandard</span> <span class="o">=</span> <span class="mi">3</span>     <span class="c">! maximum index for standard</span>
<a name="ln-39"></a>
<a name="ln-40"></a>  <span class="c">!real(r64), parameter :: pi       = 3.14159265358979323846d0</span>
<a name="ln-41"></a>  <span class="c">!real(r64), parameter :: UniversalGasConst = 8314.462175d0 !(J/mol*K)</span>
<a name="ln-42"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">alpha1</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="c">!accomodation coefficient for low pressure gas calculations</span>
<a name="ln-43"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">alpha2</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="c">!accomodation coefficient for low pressure gas calculations</span>
<a name="ln-44"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">InputDataTolerance</span> <span class="o">=</span> <span class="mf">1.0d-7</span> <span class="c">!coefficient used for input data tolerance in case for displaying error message</span>
<a name="ln-45"></a>
<a name="ln-46"></a>  <span class="c">!real(r64) :: gcon(maxgas,3), gvis(maxgas,3), gcp(maxgas,3), grho(maxgas,3), wght(maxgas)</span>
<a name="ln-47"></a>
<a name="ln-48"></a>  <span class="c">! Gas properties (ISO 15099 - Regression constants from Annex B):</span>
<a name="ln-49"></a>  <span class="c">!DATA gcon / 2.873e-3,   2.285e-3,  9.443e-4,  4.538e-4,  0,0,0,0,0,0, &amp;</span>
<a name="ln-50"></a>  <span class="c">!          &amp; 7.760e-5,   5.149e-5,  2.826e-5,  1.723e-5,  0,0,0,0,0,0, &amp;</span>
<a name="ln-51"></a>  <span class="c">!          &amp; 0.0,        0.0,       0.0,       0.0,       0,0,0,0,0,0/</span>
<a name="ln-52"></a>  <span class="c">!DATA gvis / 3.723e-6,   3.379e-6,  2.213e-6,  1.069e-6,  0,0,0,0,0,0, &amp;</span>
<a name="ln-53"></a>  <span class="c">!          &amp; 4.940e-8,   6.451e-8,  7.777e-8,  7.414e-8,  0,0,0,0,0,0, &amp;</span>
<a name="ln-54"></a>  <span class="c">!          &amp;  0.0,        0.0,       0.0,       0.0,       0,0,0,0,0,0/</span>
<a name="ln-55"></a>  <span class="c">!DATA gcp  / 1.002737e3, 0.521929e3,0.248091e3,0.158340e3,0,0,0,0,0,0, &amp;</span>
<a name="ln-56"></a>  <span class="c">!          &amp; 1.2324e-2,  0,         0,         0,         0,0,0,0,0,0, &amp;</span>
<a name="ln-57"></a>  <span class="c">!          &amp; 0,          0,         0,         0,         0,0,0,0,0,0/</span>
<a name="ln-58"></a>
<a name="ln-59"></a>  <span class="c">!  Mollecular weights (ISO 15099 - from Annex B):</span>
<a name="ln-60"></a>  <span class="c">!DATA wght / 28.97,      39.948,    83.8,      131.3,     0,0,0,0,0,0/</span>
<a name="ln-61"></a>
<a name="ln-62"></a>  <span class="c">!SAVE gcon, gvis, gcp, grho, wght</span>
<a name="ln-63"></a>
<a name="ln-64"></a><span class="c">!contains</span>
<a name="ln-65"></a>
<a name="ln-66"></a>  <span class="c">! GetGasIndex - returns index of a gas (from ISO15099 gas properties list) based on its molecular weight</span>
<a name="ln-67"></a>  <span class="c">!integer function GetGasIndex (molweight)</span>
<a name="ln-68"></a>
<a name="ln-69"></a>  <span class="c">!  real(r64) :: molweight</span>
<a name="ln-70"></a>  <span class="c">!  integer :: i</span>
<a name="ln-71"></a>
<a name="ln-72"></a>  <span class="c">!  GetGasIndex = 0  ! unknown gas</span>
<a name="ln-73"></a>
<a name="ln-74"></a>  <span class="c">!  do i = 1, maxgas</span>
<a name="ln-75"></a>  <span class="c">!    if (ABS(molweight-wght(i)).lt.1e-5) then</span>
<a name="ln-76"></a>  <span class="c">!      GetGasIndex = i</span>
<a name="ln-77"></a>  <span class="c">!      EXIT  ! exit loop</span>
<a name="ln-78"></a>  <span class="c">!    end if</span>
<a name="ln-79"></a>  <span class="c">!  end do</span>
<a name="ln-80"></a>
<a name="ln-81"></a>
<a name="ln-82"></a>  <span class="c">!  return</span>
<a name="ln-83"></a>
<a name="ln-84"></a>  <span class="c">!end function GetGasIndex</span>
<a name="ln-85"></a>
<a name="ln-86"></a><span class="c">!     NOTICE</span>
<a name="ln-87"></a><span class="c">!</span>
<a name="ln-88"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-89"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-90"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-91"></a><span class="c">!</span>
<a name="ln-92"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-93"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-94"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-95"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-96"></a><span class="c">!</span>
<a name="ln-97"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-98"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-99"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-100"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-101"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-102"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-103"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-104"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-105"></a><span class="c">!     permit others to do so.</span>
<a name="ln-106"></a><span class="c">!</span>
<a name="ln-107"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-108"></a><span class="c">!</span>
<a name="ln-109"></a>
<a name="ln-110"></a><span class="k">end module </span><span class="n">TARCOGGassesParams</span>
<a name="ln-111"></a>
<a name="ln-112"></a><span class="k">module </span><span class="n">TARCOGGasses90</span>
<a name="ln-113"></a>
<a name="ln-114"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-115"></a>          <span class="c">!       AUTHOR         D. Charlie Curcija</span>
<a name="ln-116"></a>          <span class="c">!       DATE WRITTEN   June/2000</span>
<a name="ln-117"></a>          <span class="c">!       MODIFIED       (see revision history bellow)</span>
<a name="ln-118"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-119"></a>          <span class="c">!</span>
<a name="ln-120"></a>          <span class="c">!  Revision: 7.0.02  (November/8/2011), Simon Vidanovic</span>
<a name="ln-121"></a>          <span class="c">!   - feature: Error message (string) return from gasses</span>
<a name="ln-122"></a>          <span class="c">!</span>
<a name="ln-123"></a>          <span class="c">!  Revision: 7.0.00  (September/6/2011), Simon Vidanovic</span>
<a name="ln-124"></a>          <span class="c">!   - Introduction of vacuum coefficients and routine to calculate low gas pressure conductance</span>
<a name="ln-125"></a>          <span class="c">!</span>
<a name="ln-126"></a>          <span class="c">!  Revision: 6.3.09  (August/23/2011), Simon Vidanovic</span>
<a name="ln-127"></a>          <span class="c">!   - Removed GetGasIndex function which could cause a double usage of gas coefficients</span>
<a name="ln-128"></a>          <span class="c">!     and therefore introducing new bugs.</span>
<a name="ln-129"></a>
<a name="ln-130"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-131"></a>          <span class="c">! A module containing functions for gas properties calculation</span>
<a name="ln-132"></a>
<a name="ln-133"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-134"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-135"></a>
<a name="ln-136"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-137"></a>          <span class="c">! ISO15099, EN673</span>
<a name="ln-138"></a>
<a name="ln-139"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-140"></a>          <span class="c">! na</span>
<a name="ln-141"></a>
<a name="ln-142"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-143"></a>
<a name="ln-144"></a>  <span class="k">use </span><span class="n">DataGlobals</span>
<a name="ln-145"></a>  <span class="k">use </span><span class="n">TARCOGGassesParams</span>
<a name="ln-146"></a>
<a name="ln-147"></a>  <span class="k">implicit none</span>
<a name="ln-148"></a>
<a name="ln-149"></a><span class="k">  public </span><span class="n">GASSES90</span>
<a name="ln-150"></a>  <span class="k">public </span><span class="n">GassesLow</span>
<a name="ln-151"></a>  <span class="c">!private doe2gas90</span>
<a name="ln-152"></a>
<a name="ln-153"></a>  <span class="k">contains</span>
<a name="ln-154"></a>
<a name="ln-155"></a><span class="k">  subroutine </span><span class="n">GASSES90</span><span class="p">(</span><span class="n">tmean</span><span class="p">,</span><span class="n">iprop</span><span class="p">,</span><span class="n">frct</span><span class="p">,</span><span class="n">pres</span><span class="p">,</span><span class="n">nmix</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span><span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">con</span><span class="p">,</span><span class="n">visc</span><span class="p">,</span><span class="n">dens</span><span class="p">,</span><span class="n">cp</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">standard</span><span class="p">,</span><span class="n">nperr</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-156"></a>
<a name="ln-157"></a>    <span class="c">! Variables</span>
<a name="ln-158"></a>
<a name="ln-159"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">standard</span><span class="p">,</span> <span class="n">nmix</span>
<a name="ln-160"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-161"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-162"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xgvis</span>
<a name="ln-163"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tmean</span><span class="p">,</span> <span class="n">pres</span>
<a name="ln-164"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-165"></a>
<a name="ln-166"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-167"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-168"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span>
<a name="ln-169"></a>
<a name="ln-170"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
<a name="ln-171"></a>
<a name="ln-172"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fvis</span><span class="p">,</span> <span class="n">fcon</span><span class="p">,</span> <span class="n">fdens</span><span class="p">,</span> <span class="n">fcp</span>
<a name="ln-173"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">kprime</span><span class="p">,</span> <span class="n">kdblprm</span><span class="p">,</span> <span class="n">mukpdwn</span><span class="p">,</span> <span class="n">kpdown</span><span class="p">,</span> <span class="n">kdpdown</span>
<a name="ln-174"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">molmix</span><span class="p">,</span> <span class="n">cpmixm</span><span class="p">,</span> <span class="n">kpmix</span><span class="p">,</span> <span class="n">kdpmix</span><span class="p">,</span> <span class="n">kmix</span><span class="p">,</span> <span class="n">mumix</span>
<a name="ln-175"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">phimup</span><span class="p">,</span> <span class="n">downer</span><span class="p">,</span> <span class="n">psiup</span><span class="p">,</span> <span class="n">psiterm</span><span class="p">,</span> <span class="n">phikup</span><span class="p">,</span> <span class="n">rhomix</span>
<a name="ln-176"></a>
<a name="ln-177"></a>    <span class="c">!Simon: TODO: this is used for EN673 calculations and it is not assigned properly. Check this</span>
<a name="ln-178"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgrho</span>
<a name="ln-179"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">grho</span>
<a name="ln-180"></a>
<a name="ln-181"></a>    <span class="c">!real(r64) gaslaw</span>
<a name="ln-182"></a>    <span class="c">!DATA gaslaw /8314.51/   ! Molar gas constant in Joules/(kmol*K)</span>
<a name="ln-183"></a>
<a name="ln-184"></a>    <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-185"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span>          <span class="kd">::</span> <span class="n">ENpressure</span> <span class="o">=</span> <span class="mf">1.0d5</span>    <span class="c">! Gap gas pressure (Pa)</span>
<a name="ln-186"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span>          <span class="kd">::</span> <span class="n">gaslaw</span> <span class="o">=</span> <span class="mi">831</span><span class="mf">4.51d0</span>    <span class="c">! Molar gas constant (J/kMol-K)</span>
<a name="ln-187"></a>
<a name="ln-188"></a>    <span class="c">!!! Body of GASSES90</span>
<a name="ln-189"></a>
<a name="ln-190"></a>    <span class="n">con</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-191"></a>    <span class="n">visc</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-192"></a>    <span class="n">dens</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-193"></a>    <span class="n">cp</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-194"></a>
<a name="ln-195"></a>    <span class="c">!Simon: remove this when assigned properly</span>
<a name="ln-196"></a><span class="c">!EPTeam???    xgrho = 0.0d0 !Objexx:Uninit Line added to protect against use uninitialized: Assuming this is incomplete/unused functionality</span>
<a name="ln-197"></a>    <span class="n">grho</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-198"></a>
<a name="ln-199"></a>    <span class="n">fcon</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span> <span class="o">+</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-200"></a>    <span class="n">fvis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span> <span class="o">+</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-201"></a>    <span class="n">fcp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="o">=</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>  <span class="o">+</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span>  <span class="o">+</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-202"></a>    <span class="c">! Density using ideal gas law: rho=(presure*mol. weight)/(gas const*Tmean)</span>
<a name="ln-203"></a>    <span class="n">fdens</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">pres</span> <span class="o">*</span> <span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">UniversalGasConst</span> <span class="o">*</span> <span class="n">tmean</span><span class="p">)</span>
<a name="ln-204"></a>                <span class="c">! Mollecular weights in kg/kmol</span>
<a name="ln-205"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673Design</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-206"></a>       <span class="c">!fdens(1) = xgrho(iprop(1),1) + xgrho(iprop(1),2)*tmean + xgrho(iprop(1),3)*tmean**2 !Objexx:Uninit xgrho is uninitialized</span>
<a name="ln-207"></a>      <span class="n">fdens</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ENpressure</span><span class="o">*</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">gaslaw</span><span class="o">*</span><span class="n">tmean</span><span class="p">)</span>
<a name="ln-208"></a>    <span class="k">end if</span>
<a name="ln-209"></a>
<a name="ln-210"></a><span class="k">    if</span> <span class="p">(</span><span class="n">frct</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">)</span> <span class="k">then</span>   <span class="c">! Single gas properties</span>
<a name="ln-211"></a>      <span class="n">visc</span><span class="o">=</span><span class="n">fvis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>      <span class="c">! viscosity in kg/(m*s)</span>
<a name="ln-212"></a>      <span class="n">con</span><span class="o">=</span><span class="n">fcon</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c">! conductivity in W/(m*K)</span>
<a name="ln-213"></a>      <span class="n">cp</span><span class="o">=</span><span class="n">fcp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c">! SpecIFic heat in J/(kg*K)</span>
<a name="ln-214"></a>      <span class="n">dens</span><span class="o">=</span><span class="n">fdens</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="c">! density in kg/m^3</span>
<a name="ln-215"></a>    <span class="k">else</span>        <span class="c">! Mixture properties</span>
<a name="ln-216"></a>      <span class="n">molmix</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>       <span class="c">! initialize equation 56</span>
<a name="ln-217"></a>      <span class="n">cpmixm</span> <span class="o">=</span> <span class="n">molmix</span><span class="o">*</span><span class="n">fcp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="c">! initialize equation 58</span>
<a name="ln-218"></a>      <span class="n">kprime</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="mf">3.75d0</span> <span class="o">*</span> <span class="n">UniversalGasConst</span> <span class="o">/</span> <span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">fvis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c">! equation 67</span>
<a name="ln-219"></a>      <span class="n">kdblprm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fcon</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">kprime</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>        <span class="c">! equation 67</span>
<a name="ln-220"></a>      <span class="c">! initialize sumations for eqns 60-66:</span>
<a name="ln-221"></a>      <span class="n">mumix</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-222"></a>      <span class="n">kpmix</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-223"></a>      <span class="n">kdpmix</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-224"></a>      <span class="n">mukpdwn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-225"></a>      <span class="n">kpdown</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-226"></a>      <span class="n">kdpdown</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-227"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nmix</span>
<a name="ln-228"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-229"></a><span class="k">          </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">2011</span>              <span class="c">! error 2011: component fraction in a mixture is 0%</span>
<a name="ln-230"></a>          <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Component fraction in mixture is 0%&#39;</span>
<a name="ln-231"></a>          <span class="k">return</span>
<a name="ln-232"></a><span class="k">        end if</span>
<a name="ln-233"></a>        <span class="c">! calculate properties of mixture constituents:</span>
<a name="ln-234"></a>        <span class="n">fcon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span> <span class="o">+</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span><span class="o">**</span><span class="mf">2.0d0</span>
<a name="ln-235"></a>        <span class="n">fvis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span> <span class="o">+</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span><span class="o">**</span><span class="mf">2.0d0</span>
<a name="ln-236"></a>        <span class="n">fcp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>  <span class="o">+</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span>  <span class="o">+</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">tmean</span><span class="o">**</span><span class="mf">2.0d0</span>
<a name="ln-237"></a>        <span class="n">fdens</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">pres</span> <span class="o">*</span> <span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">UniversalGasConst</span> <span class="o">*</span> <span class="n">tmean</span><span class="p">)</span>
<a name="ln-238"></a>        <span class="k">if</span> <span class="p">((</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673Design</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-239"></a>          <span class="c">!fdens(i) = grho(iprop(i),1) + grho(iprop(i),2)*tmean + grho(iprop(i),3)*tmean**2.0d0</span>
<a name="ln-240"></a>          <span class="n">fdens</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ENpressure</span><span class="o">*</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">gaslaw</span><span class="o">*</span><span class="n">tmean</span><span class="p">)</span>  <span class="c">! Density using ideal gas law: rho=(presure*mol. weight)/(gas const*Tmean)</span>
<a name="ln-241"></a>        <span class="k">end if</span>
<a name="ln-242"></a><span class="k">        </span><span class="n">molmix</span> <span class="o">=</span> <span class="n">molmix</span><span class="o">+</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>      <span class="c">! equation 56</span>
<a name="ln-243"></a>        <span class="n">cpmixm</span> <span class="o">=</span> <span class="n">cpmixm</span><span class="o">+</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">fcp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>   <span class="c">! equation 58-59</span>
<a name="ln-244"></a>        <span class="n">kprime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="mf">3.75d0</span> <span class="o">*</span> <span class="n">UniversalGasConst</span> <span class="o">/</span> <span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">*</span> <span class="n">fvis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">! equation 67</span>
<a name="ln-245"></a>        <span class="n">kdblprm</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">fcon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">kprime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>      <span class="c">! equation 68</span>
<a name="ln-246"></a>        <span class="n">mukpdwn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>            <span class="c">! initialize denominator of equation 60</span>
<a name="ln-247"></a>        <span class="n">kpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="mf">1.0d0</span>            <span class="c">! initialize denominator of equation 63</span>
<a name="ln-248"></a>        <span class="n">kdpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>            <span class="c">! initialize denominator of equation 65</span>
<a name="ln-249"></a>      <span class="k">end do</span>
<a name="ln-250"></a>
<a name="ln-251"></a><span class="k">      select case</span> <span class="p">(</span><span class="n">standard</span><span class="p">)</span>
<a name="ln-252"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">ISO15099</span><span class="p">)</span>
<a name="ln-253"></a>          <span class="k">do  </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span>
<a name="ln-254"></a>            <span class="k">do  </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span>
<a name="ln-255"></a>              <span class="c">! numerator of equation 61</span>
<a name="ln-256"></a>              <span class="n">phimup</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">fvis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">fvis</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5d0</span><span class="o">*</span><span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">/</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.25d0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0d0</span>
<a name="ln-257"></a>
<a name="ln-258"></a>              <span class="c">! denominator of equation 61, 64 and 66</span>
<a name="ln-259"></a>              <span class="n">downer</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="nb">sqrt</span><span class="p">(</span><span class="mf">2.0d0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">j</span><span class="p">))))</span><span class="o">**</span><span class="mf">0.5d0</span>
<a name="ln-260"></a>
<a name="ln-261"></a>              <span class="c">! calculate the denominator of equation 60</span>
<a name="ln-262"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">j</span><span class="p">)</span> <span class="n">mukpdwn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">mukpdwn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">phimup</span><span class="o">/</span><span class="n">downer</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-263"></a>
<a name="ln-264"></a>              <span class="c">! numerator of equation 64, psiterm is the multiplied term in backets</span>
<a name="ln-265"></a>              <span class="n">psiup</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">kprime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">kprime</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5d0</span><span class="o">*</span><span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.25d0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0d0</span>
<a name="ln-266"></a>
<a name="ln-267"></a>              <span class="n">psiterm</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">2.41d0</span><span class="o">*</span><span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">-</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">-</span><span class="mf">0.142d0</span><span class="o">*</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span> <span class="p">&amp;</span>
<a name="ln-268"></a>                                    <span class="o">/</span> <span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span><span class="o">**</span><span class="mf">2.0d0</span>
<a name="ln-269"></a>
<a name="ln-270"></a>              <span class="c">! using the common denominator downer calculate the denominator for equation 63</span>
<a name="ln-271"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">j</span><span class="p">)</span> <span class="n">kpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">kpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">psiup</span><span class="o">*</span><span class="n">psiterm</span><span class="o">/</span><span class="n">downer</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-272"></a>
<a name="ln-273"></a>              <span class="c">! calculate the numerator of equation 66</span>
<a name="ln-274"></a>              <span class="n">phikup</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="p">(</span><span class="n">kprime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">kprime</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span><span class="o">**</span><span class="mf">0.25d0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0d0</span>
<a name="ln-275"></a>
<a name="ln-276"></a>              <span class="c">! using the common denominator downer calculat the denominator for equation 65</span>
<a name="ln-277"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">j</span><span class="p">)</span> <span class="n">kdpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">kdpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">phikup</span><span class="o">/</span><span class="n">downer</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-278"></a>            <span class="k">end do</span>
<a name="ln-279"></a><span class="k">            </span><span class="n">mumix</span> <span class="o">=</span> <span class="n">mumix</span> <span class="o">+</span> <span class="n">fvis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">mukpdwn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>            <span class="c">! equation 60</span>
<a name="ln-280"></a>            <span class="n">kpmix</span> <span class="o">=</span> <span class="n">kpmix</span> <span class="o">+</span> <span class="n">kprime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">kpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>           <span class="c">! equation 63</span>
<a name="ln-281"></a>            <span class="n">kdpmix</span> <span class="o">=</span> <span class="n">kdpmix</span> <span class="o">+</span> <span class="n">kdblprm</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">kdpdown</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>       <span class="c">! equation 65</span>
<a name="ln-282"></a>          <span class="k">end do</span>
<a name="ln-283"></a>
<a name="ln-284"></a>          <span class="c">! calculate the density of the mixture assuming an ideal gas:</span>
<a name="ln-285"></a>          <span class="n">rhomix</span> <span class="o">=</span> <span class="n">pres</span> <span class="o">*</span> <span class="n">molmix</span> <span class="o">/</span> <span class="p">(</span><span class="n">UniversalGasConst</span> <span class="o">*</span> <span class="n">tmean</span><span class="p">)</span>      <span class="c">! equation 57</span>
<a name="ln-286"></a>          <span class="n">kmix</span> <span class="o">=</span> <span class="n">kpmix</span> <span class="o">+</span> <span class="n">kdpmix</span>                          <span class="c">! equation 68-a</span>
<a name="ln-287"></a>
<a name="ln-288"></a>          <span class="c">! final mixture properties:</span>
<a name="ln-289"></a>          <span class="n">visc</span><span class="o">=</span><span class="n">mumix</span>
<a name="ln-290"></a>          <span class="n">con</span><span class="o">=</span><span class="n">kmix</span>
<a name="ln-291"></a>          <span class="n">dens</span><span class="o">=</span><span class="n">rhomix</span>
<a name="ln-292"></a>          <span class="n">cp</span><span class="o">=</span><span class="n">cpmixm</span><span class="o">/</span><span class="n">molmix</span>
<a name="ln-293"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">EN673</span><span class="p">,</span> <span class="n">EN673Design</span><span class="p">)</span>
<a name="ln-294"></a>          <span class="k">do  </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nmix</span>
<a name="ln-295"></a>            <span class="n">con</span> <span class="o">=</span> <span class="n">con</span> <span class="o">+</span> <span class="n">fcon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-296"></a>            <span class="n">visc</span> <span class="o">=</span> <span class="n">visc</span> <span class="o">+</span> <span class="n">fvis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-297"></a>            <span class="n">dens</span> <span class="o">=</span> <span class="n">dens</span> <span class="o">+</span> <span class="n">fdens</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-298"></a>            <span class="n">cp</span> <span class="o">=</span> <span class="n">cp</span> <span class="o">+</span> <span class="n">fcp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-299"></a>          <span class="k">end do</span>
<a name="ln-300"></a><span class="k">        case </span><span class="n">DEFAULT</span>
<a name="ln-301"></a>          <span class="c">! should never come here - unsupported standard</span>
<a name="ln-302"></a>      <span class="k">end select</span>
<a name="ln-303"></a>
<a name="ln-304"></a><span class="k">    end if</span>
<a name="ln-305"></a>
<a name="ln-306"></a><span class="k">    </span><span class="n">pr</span> <span class="o">=</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">visc</span> <span class="o">/</span> <span class="n">con</span>    <span class="c">! calculate the Prandtl number</span>
<a name="ln-307"></a>
<a name="ln-308"></a>  <span class="k">end subroutine </span><span class="n">GASSES90</span>
<a name="ln-309"></a>
<a name="ln-310"></a>  <span class="k">subroutine </span><span class="n">GassesLow</span><span class="p">(</span><span class="n">tmean</span><span class="p">,</span> <span class="n">mwght</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-311"></a>
<a name="ln-312"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tmean</span><span class="p">,</span> <span class="n">mwght</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">gama</span>
<a name="ln-313"></a>
<a name="ln-314"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-315"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-316"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cond</span>
<a name="ln-317"></a>
<a name="ln-318"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-319"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">B</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-320"></a>
<a name="ln-321"></a>    <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha1</span> <span class="o">*</span> <span class="n">alpha2</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha2</span> <span class="o">+</span> <span class="n">alpha1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha2</span><span class="p">))</span>
<a name="ln-322"></a>
<a name="ln-323"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">gama</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-324"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">40</span> <span class="c">!supplied gamma coefficient is incorrect</span>
<a name="ln-325"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Supplied gamma coefficient is incorrect.&#39;</span>
<a name="ln-326"></a>      <span class="k">return</span>
<a name="ln-327"></a><span class="k">    end if</span>
<a name="ln-328"></a>
<a name="ln-329"></a><span class="k">    </span><span class="n">B</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">gama</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gama</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">UniversalGasConst</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">mwght</span> <span class="o">*</span> <span class="n">tmean</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5d0</span>
<a name="ln-330"></a>
<a name="ln-331"></a>    <span class="n">cond</span> <span class="o">=</span> <span class="n">B</span> <span class="o">*</span> <span class="n">pressure</span>
<a name="ln-332"></a>
<a name="ln-333"></a>  <span class="k">end subroutine </span><span class="n">GassesLow</span>
<a name="ln-334"></a>
<a name="ln-335"></a><span class="c">!  subroutine doe2gas90 (standard, iprop, frct, pres, nmix, con0, dcon, visc0, dvisc, dens0, ddens, pr0, dpr)</span>
<a name="ln-336"></a><span class="c">!    !~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~!</span>
<a name="ln-337"></a><span class="c">!    !  calculate gas properties using old doe2 format                              !</span>
<a name="ln-338"></a><span class="c">!    !------------------------------------------------------------------------------!</span>
<a name="ln-339"></a><span class="c">!    !  iprop(i)  vector of gas identifiers (for max of w5cog.fi::maxgas gasses)</span>
<a name="ln-340"></a><span class="c">!    !  frct(i)   vector of fraction of gasses in a mixture (for max of w5cog.fi::maxgas gasses)</span>
<a name="ln-341"></a><span class="c">!    !  pres(i)   pressure (default: pres = 1e5)[N/m^2]</span>
<a name="ln-342"></a><span class="c">!    !  nmix(i)   number of gasses in a mixture</span>
<a name="ln-343"></a><span class="c">!    !  con0(o)   thermal conductivity @ mean temperature of 0 C[W/m-K]</span>
<a name="ln-344"></a><span class="c">!    !  dcon(o)   derivative of thermal conductivity wrt temperature x 10^5 [W/m-K^2 x 10^5]</span>
<a name="ln-345"></a><span class="c">!    !  visc0(o)  dynamic viscosity @ mean temperature of 0 C x 10^5 [kg/m-s x 10^5]</span>
<a name="ln-346"></a><span class="c">!    !  dvisc(o)  derivative of dynamic viscosity wrt temperature x 10^8 [kg/m-s-K x 10^8]</span>
<a name="ln-347"></a><span class="c">!    !  dens0(o)  density @ mean temperature of 0 C [kg/m^3]</span>
<a name="ln-348"></a><span class="c">!    !  ddens(o)  derivative of density wrt temperature [kg/m^3-K]</span>
<a name="ln-349"></a><span class="c">!    !  pr0(o)    Prandl number @ mean temperature of 0 C [ - ]</span>
<a name="ln-350"></a><span class="c">!    !  dpr(o)    derivative of Prandl number wrt temperature [ 1/K ]</span>
<a name="ln-351"></a><span class="c">!    !  nperr(o)  error flag (if component fraction in a mixture is 0%)</span>
<a name="ln-352"></a><span class="c">!    !</span>
<a name="ln-353"></a><span class="c">!    !**import:</span>
<a name="ln-354"></a><span class="c">!    !  w5cog.fi::maxgas</span>
<a name="ln-355"></a><span class="c">!    !</span>
<a name="ln-356"></a><span class="c">!    !~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~!</span>
<a name="ln-357"></a><span class="c">!</span>
<a name="ln-358"></a><span class="c">!    ! Variables</span>
<a name="ln-359"></a><span class="c">!</span>
<a name="ln-360"></a><span class="c">!    integer, intent(in) :: nmix, iprop(maxgas)</span>
<a name="ln-361"></a><span class="c">!    real(r64), intent(in) :: pres, frct(maxgas)</span>
<a name="ln-362"></a><span class="c">!</span>
<a name="ln-363"></a><span class="c">!    real(r64), intent(out) :: con0, dcon, visc0, dvisc, dens0, ddens, pr0, dpr</span>
<a name="ln-364"></a><span class="c">!</span>
<a name="ln-365"></a><span class="c">!    real(r64) :: con, visc, dens, cp, pr</span>
<a name="ln-366"></a><span class="c">!    integer :: standard, nperr</span>
<a name="ln-367"></a><span class="c">!    character*(2000) :: ErrMsg</span>
<a name="ln-368"></a><span class="c">!</span>
<a name="ln-369"></a><span class="c">!    call GASSES90(273.15d0, iprop, frct, pres,nmix, wght, gcon, gvis, gcp, con, visc, dens, cp, pr, standard, nperr, ErrMsg)</span>
<a name="ln-370"></a><span class="c">!</span>
<a name="ln-371"></a><span class="c">!    con0=con</span>
<a name="ln-372"></a><span class="c">!    visc0=visc*10**5</span>
<a name="ln-373"></a><span class="c">!    dens0=dens</span>
<a name="ln-374"></a><span class="c">!    pr0=pr</span>
<a name="ln-375"></a><span class="c">!</span>
<a name="ln-376"></a><span class="c">!    call GASSES90(283.15d0,iprop, frct, pres, nmix, wght, gcon, gvis, gcp, con, visc, dens, cp, pr, standard, nperr, ErrMsg)</span>
<a name="ln-377"></a><span class="c">!</span>
<a name="ln-378"></a><span class="c">!    dcon=(con-con0)/10*10**5</span>
<a name="ln-379"></a><span class="c">!    dvisc=(visc*10**5-visc0)/10*10**3</span>
<a name="ln-380"></a><span class="c">!    ddens=(dens-dens0)/10</span>
<a name="ln-381"></a><span class="c">!    dpr=(pr-pr0)/10</span>
<a name="ln-382"></a><span class="c">!</span>
<a name="ln-383"></a><span class="c">!  end subroutine doe2gas90</span>
<a name="ln-384"></a>
<a name="ln-385"></a><span class="c">!     NOTICE</span>
<a name="ln-386"></a><span class="c">!</span>
<a name="ln-387"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-388"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-389"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-390"></a><span class="c">!</span>
<a name="ln-391"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-392"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-393"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-394"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-395"></a><span class="c">!</span>
<a name="ln-396"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-397"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-398"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-399"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-400"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-401"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-402"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-403"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-404"></a><span class="c">!     permit others to do so.</span>
<a name="ln-405"></a><span class="c">!</span>
<a name="ln-406"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-407"></a><span class="c">!</span>
<a name="ln-408"></a>
<a name="ln-409"></a><span class="k">end module </span><span class="n">TARCOGGasses90</span>
<a name="ln-410"></a>
<a name="ln-411"></a><span class="k">module </span><span class="n">TARCOGParams</span>
<a name="ln-412"></a>
<a name="ln-413"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-414"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-415"></a>          <span class="c">!       DATE WRITTEN   June/22/2010</span>
<a name="ln-416"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-417"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-418"></a>
<a name="ln-419"></a>          <span class="c">!  Revision: 6.0.36  (June/22/2010)</span>
<a name="ln-420"></a>          <span class="c">!   - Initial setup, extracted from TARCOG.fi</span>
<a name="ln-421"></a>          <span class="c">!   - Moved Standards and MaxGas into GasParams module (gasses project)</span>
<a name="ln-422"></a>
<a name="ln-423"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-424"></a>          <span class="c">! Module which contains common TARCOG parameters and constants</span>
<a name="ln-425"></a>
<a name="ln-426"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-427"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-428"></a>
<a name="ln-429"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-430"></a>          <span class="c">! na</span>
<a name="ln-431"></a>
<a name="ln-432"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-433"></a>          <span class="c">! na</span>
<a name="ln-434"></a>
<a name="ln-435"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-436"></a>
<a name="ln-437"></a>  <span class="k">use </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-438"></a>
<a name="ln-439"></a>  <span class="k">implicit none</span>
<a name="ln-440"></a>
<a name="ln-441"></a><span class="k">  public</span>
<a name="ln-442"></a>
<a name="ln-443"></a>  <span class="c">!real(r64), parameter :: StefanBoltzmannConst    = 5.6697e-8     ! Stefan-Boltzman constant (5.6697e-8 [W/m^2K^4])</span>
<a name="ln-444"></a>  <span class="c">!real(r64), parameter :: GravityConstant = 9.807d0</span>
<a name="ln-445"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">2.718281828459d0</span>
<a name="ln-446"></a>  <span class="c">!real(r64), parameter :: MaxHr = 100  ! used in iterations in case temperatures on surfaces reaches identical values</span>
<a name="ln-447"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DeflectionRelaxation</span> <span class="o">=</span> <span class="mf">0.005d0</span> <span class="c">! Deflection relaxation parameter</span>
<a name="ln-448"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DeflectionMaxIterations</span> <span class="o">=</span> <span class="mi">400</span> <span class="c">!maximum number of deflection iterations</span>
<a name="ln-449"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DeflectionErrorMargin</span> <span class="o">=</span> <span class="mf">0.01d0</span> <span class="c">!maximum temperature difference on layers for deflection iterations</span>
<a name="ln-450"></a>  <span class="c">!pi is moved to gasses since it is used there now</span>
<a name="ln-451"></a>  <span class="c">!real(r64), parameter :: pi       = 3.14159265358979323846</span>
<a name="ln-452"></a>
<a name="ln-453"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxpan</span>   <span class="o">=</span> <span class="mi">100</span>          <span class="c">! maximum number of monolithic glazing layers (100)</span>
<a name="ln-454"></a>  <span class="c">!integer, parameter :: maxlay   = 1000         ! maximum number of layers (including laminates) (1000)</span>
<a name="ln-455"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxlay</span>   <span class="o">=</span> <span class="mi">100</span>          <span class="c">! maximum number of layers (including laminates) (100)</span>
<a name="ln-456"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MaxGap</span>   <span class="o">=</span> <span class="n">maxlay</span><span class="o">-</span><span class="mi">1</span>     <span class="c">!maximum number of gaps (between layers)</span>
<a name="ln-457"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxlay1</span>  <span class="o">=</span> <span class="n">maxlay</span><span class="o">+</span><span class="mi">1</span>     <span class="c">! maximum number of &#39;gaps&#39;, including in and out (maxlay+1)</span>
<a name="ln-458"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxlay2</span>  <span class="o">=</span> <span class="n">maxlay</span><span class="o">*</span><span class="mi">2</span>     <span class="c">! maximum number of glass surfaces (maxlay*2)</span>
<a name="ln-459"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxlay3</span>  <span class="o">=</span> <span class="n">maxlay2</span><span class="o">+</span><span class="mi">1</span>    <span class="c">! maximum number of ? (maxlay2+1)</span>
<a name="ln-460"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxlay4</span>  <span class="o">=</span> <span class="n">maxlay</span><span class="o">*</span><span class="mi">4</span>     <span class="c">! maximum number of ? (maxlay*4)</span>
<a name="ln-461"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxslice</span> <span class="o">=</span> <span class="mi">100</span>          <span class="c">! maximum nuber of slices (100)</span>
<a name="ln-462"></a>
<a name="ln-463"></a>  <span class="c">!integer, parameter :: MaxThetaArray = 200     ! maximum number for theta array</span>
<a name="ln-464"></a>
<a name="ln-465"></a>  <span class="c">! Debug flags</span>
<a name="ln-466"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">noDebug</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-467"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">appendResultsToFile</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-468"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">resultsToNewFile</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-469"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">saveIntermediateResults</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!this will create new file</span>
<a name="ln-470"></a>
<a name="ln-471"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">minDebugFlag</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-472"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">maxDebugFlag</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-473"></a>
<a name="ln-474"></a>  <span class="c">! to keep info that certain file is not open for writing</span>
<a name="ln-475"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">statusClosed</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-476"></a>
<a name="ln-477"></a>  <span class="c">!  Layer types:</span>
<a name="ln-478"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">SPECULAR</span>   <span class="o">=</span> <span class="mi">0</span>
<a name="ln-479"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">VENETBLIND</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-480"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">WOVSHADE</span>   <span class="o">=</span> <span class="mi">2</span>
<a name="ln-481"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">PERFORATED</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-482"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DIFFSHADE</span>  <span class="o">=</span> <span class="mi">4</span>
<a name="ln-483"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">BSDF</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-484"></a>
<a name="ln-485"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MinLayType</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-486"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MaxLayType</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-487"></a>
<a name="ln-488"></a>  <span class="c">!  Thermal models:</span>
<a name="ln-489"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">THERM_MOD_ISO15099</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-490"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">THERM_MOD_SCW</span>      <span class="o">=</span> <span class="mi">1</span>
<a name="ln-491"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">THERM_MOD_CSM</span>      <span class="o">=</span> <span class="mi">2</span>
<a name="ln-492"></a>
<a name="ln-493"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MinThermalMode</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-494"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">MaxThermalMode</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-495"></a>
<a name="ln-496"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">NO_SupportPillar</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-497"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">YES_SupportPillar</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-498"></a>
<a name="ln-499"></a>  <span class="c">!Deflection parameters</span>
<a name="ln-500"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">NO_DEFLECTION_CALCULATION</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-501"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DEFLECTION_CALC_TEMPERATURE</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-502"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">DEFLECTION_CALC_GAP_WIDTHS</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-503"></a>
<a name="ln-504"></a>  <span class="c">!definition of parameters for deflection sum.  These parameters define maximum number of loop to which sum</span>
<a name="ln-505"></a>  <span class="c">!will perform. By equation, these numbers will go to infinite and some test showed that going to nmax and mmax</span>
<a name="ln-506"></a>  <span class="c">!values would produce enough precision</span>
<a name="ln-507"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">mmax</span> <span class="o">=</span> <span class="mi">5</span> <span class="c">! top m value for which &quot;deflection sum&quot; will be calculated</span>
<a name="ln-508"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">nmax</span> <span class="o">=</span> <span class="mi">5</span> <span class="c">! top n value for which &quot;deflection sum&quot; will be calculated</span>
<a name="ln-509"></a>
<a name="ln-510"></a>  <span class="c">!  CalcForcedVentilation flag:</span>
<a name="ln-511"></a>  <span class="c">!  0 = Skip forced ventilation calc</span>
<a name="ln-512"></a>  <span class="c">!  1 = Allow forced ventilation calc</span>
<a name="ln-513"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">CalcForcedVentilation</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-514"></a>
<a name="ln-515"></a>  <span class="c">!  Calculation outcome</span>
<a name="ln-516"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">CALC_UNKNOWN</span>      <span class="o">=</span> <span class="mi">0</span>
<a name="ln-517"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">CALC_OK</span>           <span class="o">=</span> <span class="mi">1</span>
<a name="ln-518"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">CALC_DIVERGE</span>      <span class="o">=</span> <span class="mi">2</span>
<a name="ln-519"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">CALC_OSC_OK</span>       <span class="o">=</span> <span class="mi">3</span>
<a name="ln-520"></a>
<a name="ln-521"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">NumOfIterations</span> <span class="o">=</span> <span class="mi">100</span>
<a name="ln-522"></a>
<a name="ln-523"></a>  <span class="c">! Program will examine convergence parameter in each iteration.  That convergence parameter should decrease each time.</span>
<a name="ln-524"></a>  <span class="c">! In case that is not happening program will tolerate certain number of tries before declare convergence</span>
<a name="ln-525"></a>  <span class="c">! (or decrease relaxation parameter)</span>
<a name="ln-526"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">NumOfTries</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-527"></a>  <span class="c">!integer, parameter :: NewtonIterations = 75 ! shows when to swith to Newton</span>
<a name="ln-528"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">RelaxationStart</span> <span class="o">=</span> <span class="mf">0.6d0</span> <span class="c">! Has to be between 0 and 1</span>
<a name="ln-529"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">RelaxationDecrease</span> <span class="o">=</span> <span class="mf">0.1d0</span> <span class="c">! Step for which relaxation parameter will decrease</span>
<a name="ln-530"></a>
<a name="ln-531"></a>  <span class="c">! Convergence parameters</span>
<a name="ln-532"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">tempCorrection</span> <span class="o">=</span> <span class="mi">1</span><span class="n">d</span><span class="o">-</span><span class="mi">10</span> <span class="c">!used in case outside or inside temperature approaches tamb or troom</span>
<a name="ln-533"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">ConvergenceTolerance</span> <span class="o">=</span> <span class="mi">1</span><span class="n">d</span><span class="o">-</span><span class="mi">2</span> <span class="c">! tolerance used within iterations</span>
<a name="ln-534"></a>
<a name="ln-535"></a>  <span class="c">! Airflow iterations</span>
<a name="ln-536"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">AirflowConvergenceTolerance</span> <span class="o">=</span> <span class="mi">1</span><span class="n">d</span><span class="o">-</span><span class="mi">2</span>
<a name="ln-537"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">AirflowRelaxationParameter</span> <span class="o">=</span> <span class="mf">0.9d0</span>
<a name="ln-538"></a>
<a name="ln-539"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">TemperatureQuessDiff</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="c">! in case outside and inside temperatures are identical</span>
<a name="ln-540"></a>
<a name="ln-541"></a><span class="c">!     NOTICE</span>
<a name="ln-542"></a><span class="c">!</span>
<a name="ln-543"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-544"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-545"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-546"></a><span class="c">!</span>
<a name="ln-547"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-548"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-549"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-550"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-551"></a><span class="c">!</span>
<a name="ln-552"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-553"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-554"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-555"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-556"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-557"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-558"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-559"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-560"></a><span class="c">!     permit others to do so.</span>
<a name="ln-561"></a><span class="c">!</span>
<a name="ln-562"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-563"></a><span class="c">!</span>
<a name="ln-564"></a>
<a name="ln-565"></a><span class="k">end module </span><span class="n">TARCOGParams</span>
<a name="ln-566"></a>
<a name="ln-567"></a><span class="k">module </span><span class="n">TARCOGCommon</span>
<a name="ln-568"></a>
<a name="ln-569"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-570"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-571"></a>          <span class="c">!       DATE WRITTEN   June/22/2010</span>
<a name="ln-572"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-573"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-574"></a>          <span class="c">!</span>
<a name="ln-575"></a>          <span class="c">!  Revision: 6.0.36  (June/22/2010)</span>
<a name="ln-576"></a>          <span class="c">!   - Initial setup, extracted from TARCOG.for</span>
<a name="ln-577"></a>
<a name="ln-578"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-579"></a>          <span class="c">! A module which contains common TARCOG functions and subroutines</span>
<a name="ln-580"></a>
<a name="ln-581"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-582"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-583"></a>
<a name="ln-584"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-585"></a>          <span class="c">! na</span>
<a name="ln-586"></a>
<a name="ln-587"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-588"></a>          <span class="c">! na</span>
<a name="ln-589"></a>
<a name="ln-590"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-591"></a>
<a name="ln-592"></a>  <span class="k">use </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-593"></a>
<a name="ln-594"></a>  <span class="k">implicit none</span>
<a name="ln-595"></a>
<a name="ln-596"></a><span class="k">  public  </span><span class="n">IsShadingLayer</span>
<a name="ln-597"></a>  <span class="k">public  </span><span class="n">LDSumMax</span>
<a name="ln-598"></a>  <span class="k">public  </span><span class="n">LDSumMean</span>
<a name="ln-599"></a>  <span class="k">public  </span><span class="n">MatrixQBalance</span>
<a name="ln-600"></a>  <span class="k">public  </span><span class="n">pos</span>
<a name="ln-601"></a>  <span class="k">public  </span><span class="n">EquationsSolver</span>
<a name="ln-602"></a>  <span class="k">private </span><span class="n">ludcmp</span>
<a name="ln-603"></a>  <span class="k">private </span><span class="n">lubksb</span>
<a name="ln-604"></a>
<a name="ln-605"></a>  <span class="k">contains</span>
<a name="ln-606"></a>
<a name="ln-607"></a><span class="k">  </span><span class="kt">logical </span><span class="k">function </span><span class="n">IsShadingLayer</span> <span class="p">(</span><span class="n">layertype</span><span class="p">)</span>
<a name="ln-608"></a>
<a name="ln-609"></a>    <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-610"></a>
<a name="ln-611"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">layertype</span>
<a name="ln-612"></a>
<a name="ln-613"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">layertype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">layertype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">WOVSHADE</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">layertype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">PERFORATED</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">layertype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">BSDF</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-614"></a><span class="k">      </span><span class="n">IsShadingLayer</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-615"></a>    <span class="k">else</span>
<a name="ln-616"></a><span class="k">      </span><span class="n">IsShadingLayer</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-617"></a>    <span class="k">end if</span>
<a name="ln-618"></a><span class="k">    return</span>
<a name="ln-619"></a>
<a name="ln-620"></a><span class="k">  end function </span><span class="n">IsShadingLayer</span>
<a name="ln-621"></a>
<a name="ln-622"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="k">function </span><span class="n">LDSumMax</span><span class="p">(</span><span class="n">Width</span><span class="p">,</span> <span class="n">Height</span><span class="p">)</span>
<a name="ln-623"></a>    <span class="c">! LDSumMax function calculates sum part of equation for maximum deflection</span>
<a name="ln-624"></a>    <span class="c">! Width - glazing system width</span>
<a name="ln-625"></a>    <span class="c">! Height - glazing system height</span>
<a name="ln-626"></a>
<a name="ln-627"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Pi</span>
<a name="ln-628"></a>    <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-629"></a>    <span class="c">!use TARCOGGassesParams</span>
<a name="ln-630"></a>
<a name="ln-631"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Width</span>
<a name="ln-632"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Height</span>
<a name="ln-633"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-634"></a>
<a name="ln-635"></a>    <span class="n">LDSumMax</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-636"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-637"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmax</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-638"></a>        <span class="n">LDSumMax</span> <span class="o">=</span> <span class="n">LDSumMax</span> <span class="o">+</span> <span class="p">(</span><span class="nb">Sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">Pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Sin</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">Pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="p">((</span><span class="n">i</span><span class="o">/</span><span class="n">Width</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">/</span><span class="n">Height</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-639"></a>      <span class="k">end do</span> <span class="c">!do j = 1, nmax, 2</span>
<a name="ln-640"></a>    <span class="k">end do</span> <span class="c">!do i = 1, mmax, 2</span>
<a name="ln-641"></a>
<a name="ln-642"></a>    <span class="k">return</span>
<a name="ln-643"></a><span class="k">  end function </span><span class="n">LDSumMax</span>
<a name="ln-644"></a>
<a name="ln-645"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="k">function </span><span class="n">LDSumMean</span><span class="p">(</span><span class="n">Width</span><span class="p">,</span> <span class="n">Height</span><span class="p">)</span>
<a name="ln-646"></a>    <span class="c">! LDSumMean function calculates sum part of equation for mean deflection</span>
<a name="ln-647"></a>    <span class="c">! Width - glazing system width</span>
<a name="ln-648"></a>    <span class="c">! Height - glazing system height</span>
<a name="ln-649"></a>
<a name="ln-650"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Pi</span>
<a name="ln-651"></a>    <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-652"></a>    <span class="c">!use TARCOGGassesParams</span>
<a name="ln-653"></a>
<a name="ln-654"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Width</span>
<a name="ln-655"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Height</span>
<a name="ln-656"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-657"></a>
<a name="ln-658"></a>    <span class="n">LDSumMean</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-659"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-660"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmax</span><span class="p">,</span> <span class="mi">2</span>
<a name="ln-661"></a>        <span class="n">LDSumMean</span> <span class="o">=</span> <span class="n">LDSumMean</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">i</span> <span class="o">/</span> <span class="n">Width</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="n">Height</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-662"></a>      <span class="k">end do</span> <span class="c">!do j = 1, nmax, 2</span>
<a name="ln-663"></a>    <span class="k">end do</span> <span class="c">!do i = 1, mmax, 2</span>
<a name="ln-664"></a>
<a name="ln-665"></a>    <span class="k">return</span>
<a name="ln-666"></a><span class="k">  end function </span><span class="n">LDSumMean</span>
<a name="ln-667"></a>
<a name="ln-668"></a>  <span class="k">subroutine </span><span class="n">matrixQBalance</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-669"></a>        <span class="n">Tin</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">)</span>
<a name="ln-670"></a>
<a name="ln-671"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">StefanBoltzmann</span>
<a name="ln-672"></a>    <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-673"></a>
<a name="ln-674"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-675"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span><span class="p">,</span> <span class="n">thick</span>
<a name="ln-676"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgas</span>
<a name="ln-677"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">Gout</span>
<a name="ln-678"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tir</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">theta</span>
<a name="ln-679"></a>
<a name="ln-680"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">asol</span>
<a name="ln-681"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qv</span>
<a name="ln-682"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tin</span><span class="p">,</span> <span class="n">Tout</span>
<a name="ln-683"></a>
<a name="ln-684"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-685"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b</span>
<a name="ln-686"></a>
<a name="ln-687"></a>    <span class="c">! local variables</span>
<a name="ln-688"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">front</span><span class="p">,</span> <span class="n">back</span>
<a name="ln-689"></a>
<a name="ln-690"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-691"></a>      <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-692"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-693"></a>        <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-694"></a>      <span class="k">end do</span>
<a name="ln-695"></a><span class="k">    end do</span>
<a name="ln-696"></a>
<a name="ln-697"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-698"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!  build matrix a   !!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-699"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-700"></a>
<a name="ln-701"></a>    <span class="c">! Because of build matrix optimization all environmental heat transfer</span>
<a name="ln-702"></a>    <span class="c">! coefficients were stored in hgas array.  This means that hgas(1) is actually</span>
<a name="ln-703"></a>    <span class="c">! hout, while hgas(nlayer+1) is actually hin.  Same is valid for hcgas and</span>
<a name="ln-704"></a>    <span class="c">! hrgas arrays</span>
<a name="ln-705"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-706"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span>
<a name="ln-707"></a>      <span class="n">front</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-708"></a>      <span class="n">back</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-709"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-710"></a><span class="k">        if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-711"></a><span class="k">          </span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>   <span class="o">=</span> <span class="o">-</span><span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-712"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">1.0d0</span>
<a name="ln-713"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-714"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0d0</span>
<a name="ln-715"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rir</span><span class="p">(</span><span class="n">front</span><span class="p">)</span>
<a name="ln-716"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tir</span><span class="p">(</span><span class="n">front</span><span class="p">)</span>
<a name="ln-717"></a>        <span class="k">end if</span>
<a name="ln-718"></a><span class="k">        if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-719"></a><span class="k">          </span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>   <span class="o">=</span> <span class="o">-</span><span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-720"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">1.0d0</span>
<a name="ln-721"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">tir</span><span class="p">(</span><span class="n">back</span><span class="p">)</span>
<a name="ln-722"></a>          <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">rir</span><span class="p">(</span><span class="n">back</span><span class="p">)</span>
<a name="ln-723"></a>        <span class="k">end if</span>
<a name="ln-724"></a><span class="k">      end if</span>
<a name="ln-725"></a><span class="k">      </span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>     <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-726"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>   <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-727"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-728"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-729"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-730"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-731"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-732"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">emis</span><span class="p">(</span><span class="n">front</span><span class="p">)</span> <span class="o">*</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="n">theta</span><span class="p">(</span><span class="n">front</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0d0</span>
<a name="ln-733"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0d0</span>
<a name="ln-734"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">emis</span><span class="p">(</span><span class="n">back</span><span class="p">)</span> <span class="o">*</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="n">theta</span><span class="p">(</span><span class="n">back</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0d0</span>
<a name="ln-735"></a>      <span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0d0</span>
<a name="ln-736"></a>    <span class="k">end do</span>
<a name="ln-737"></a>
<a name="ln-738"></a>    <span class="c">!build matrix b</span>
<a name="ln-739"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-740"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span>
<a name="ln-741"></a>      <span class="n">front</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-742"></a>      <span class="n">back</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-743"></a>      <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">asol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">qv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">qv</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-744"></a>      <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">asol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">qv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-745"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-746"></a><span class="k">        </span><span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">hcout</span><span class="o">*</span><span class="n">Tout</span> <span class="o">+</span> <span class="n">Gout</span>
<a name="ln-747"></a>        <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">hcout</span><span class="o">*</span><span class="n">Tout</span> <span class="o">+</span> <span class="n">Gout</span>
<a name="ln-748"></a>        <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rir</span><span class="p">(</span><span class="n">front</span><span class="p">)</span><span class="o">*</span><span class="n">Gout</span>
<a name="ln-749"></a>        <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">tir</span><span class="p">(</span><span class="n">front</span><span class="p">)</span><span class="o">*</span><span class="n">Gout</span>
<a name="ln-750"></a>      <span class="k">end if</span>
<a name="ln-751"></a><span class="k">      if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-752"></a><span class="k">        </span><span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">hcin</span><span class="o">*</span><span class="n">Tin</span> <span class="o">+</span> <span class="n">Gin</span>
<a name="ln-753"></a>        <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">tir</span><span class="p">(</span><span class="n">back</span><span class="p">)</span><span class="o">*</span><span class="n">Gin</span>
<a name="ln-754"></a>        <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rir</span><span class="p">(</span><span class="n">back</span><span class="p">)</span><span class="o">*</span><span class="n">Gin</span>
<a name="ln-755"></a>      <span class="k">end if</span>
<a name="ln-756"></a><span class="k">    end do</span>
<a name="ln-757"></a>
<a name="ln-758"></a><span class="k">  end subroutine </span><span class="n">matrixQBalance</span>
<a name="ln-759"></a>
<a name="ln-760"></a>  <span class="k">subroutine </span><span class="n">EquationsSolver</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">nperr</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-761"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-762"></a>    <span class="c">! Purpose: solves the main system of energy balance equations</span>
<a name="ln-763"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-764"></a>    <span class="c">! Input:</span>
<a name="ln-765"></a>    <span class="c">!   a - matrix, radiositied</span>
<a name="ln-766"></a>    <span class="c">!   b - vector of known quantities</span>
<a name="ln-767"></a>    <span class="c">!   n - ???</span>
<a name="ln-768"></a>    <span class="c">! Output:</span>
<a name="ln-769"></a>    <span class="c">!   b - solutions</span>
<a name="ln-770"></a>    <span class="c">!   nperr - error code</span>
<a name="ln-771"></a>
<a name="ln-772"></a>    <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-773"></a>
<a name="ln-774"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>
<a name="ln-775"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-776"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b</span>
<a name="ln-777"></a>
<a name="ln-778"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-779"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-780"></a>
<a name="ln-781"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">indx</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-782"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d</span>
<a name="ln-783"></a>
<a name="ln-784"></a>    <span class="k">call </span><span class="n">ludcmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">indx</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-785"></a>
<a name="ln-786"></a>    <span class="c">! Exit on error</span>
<a name="ln-787"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span> <span class="k">return</span>
<a name="ln-788"></a>
<a name="ln-789"></a><span class="k">    call </span><span class="n">lubksb</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<a name="ln-790"></a>
<a name="ln-791"></a>  <span class="k">end subroutine </span><span class="n">EquationsSolver</span>
<a name="ln-792"></a>
<a name="ln-793"></a>  <span class="k">subroutine </span><span class="n">ludcmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">nperr</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-794"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>
<a name="ln-795"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d</span>
<a name="ln-796"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-797"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">indx</span>
<a name="ln-798"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-799"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-800"></a>
<a name="ln-801"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">NMAX</span> <span class="o">=</span> <span class="mi">500</span>
<a name="ln-802"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="nb">TINY</span> <span class="o">=</span> <span class="mf">1.0d-20</span>
<a name="ln-803"></a>
<a name="ln-804"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">imax</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-805"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">aamax</span><span class="p">,</span> <span class="n">dum</span><span class="p">,</span> <span class="nb">sum</span>
<a name="ln-806"></a><span class="nb">    </span><span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">NMAX</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vv</span>
<a name="ln-807"></a>
<a name="ln-808"></a>    <span class="n">d</span><span class="o">=</span><span class="mf">1.0d0</span>
<a name="ln-809"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-810"></a>      <span class="n">aamax</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-811"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-812"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)).</span><span class="n">gt</span><span class="p">.</span><span class="n">aamax</span><span class="p">)</span> <span class="n">aamax</span><span class="o">=</span><span class="nb">ABS</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
<a name="ln-813"></a>      <span class="k">end do</span>  <span class="c">! j</span>
<a name="ln-814"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">aamax</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-815"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">13</span>
<a name="ln-816"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Singular matrix in ludcmp.&#39;</span>
<a name="ln-817"></a>        <span class="k">return</span>
<a name="ln-818"></a><span class="k">      end if</span>
<a name="ln-819"></a><span class="k">      </span><span class="n">vv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">aamax</span>
<a name="ln-820"></a>    <span class="k">end do</span>  <span class="c">! i</span>
<a name="ln-821"></a>
<a name="ln-822"></a>    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-823"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-824"></a>        <span class="nb">sum</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-825"></a>        <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-826"></a>          <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">-</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-827"></a>        <span class="k">end do</span>  <span class="c">! k</span>
<a name="ln-828"></a>        <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span>
<a name="ln-829"></a><span class="nb">      </span><span class="k">end do</span>  <span class="c">! i</span>
<a name="ln-830"></a>      <span class="n">aamax</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-831"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-832"></a>        <span class="nb">sum</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-833"></a>        <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-834"></a>          <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">-</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-835"></a>        <span class="k">end do</span>  <span class="c">! k</span>
<a name="ln-836"></a>        <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span>
<a name="ln-837"></a><span class="nb">        </span><span class="n">dum</span> <span class="o">=</span> <span class="n">vv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
<a name="ln-838"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">dum</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="n">aamax</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-839"></a><span class="k">          </span><span class="n">imax</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-840"></a>          <span class="n">aamax</span> <span class="o">=</span> <span class="n">dum</span>
<a name="ln-841"></a>        <span class="k">end if</span>
<a name="ln-842"></a><span class="k">      end do</span>  <span class="c">! i</span>
<a name="ln-843"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">imax</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-844"></a><span class="k">        do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-845"></a>          <span class="n">dum</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">imax</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-846"></a>          <span class="n">a</span><span class="p">(</span><span class="n">imax</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-847"></a>          <span class="n">a</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>    <span class="o">=</span> <span class="n">dum</span>
<a name="ln-848"></a>        <span class="k">end do</span>  <span class="c">! k</span>
<a name="ln-849"></a>        <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span>
<a name="ln-850"></a>        <span class="n">vv</span><span class="p">(</span><span class="n">imax</span><span class="p">)</span> <span class="o">=</span> <span class="n">vv</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-851"></a>      <span class="k">end if</span>
<a name="ln-852"></a><span class="k">      </span><span class="n">indx</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">imax</span>
<a name="ln-853"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="n">a</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">TINY</span>
<a name="ln-854"></a><span class="nb">      </span><span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-855"></a><span class="k">        </span><span class="n">dum</span><span class="o">=</span><span class="mf">1.0d0</span><span class="o">/</span><span class="n">a</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-856"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-857"></a>          <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dum</span>
<a name="ln-858"></a>        <span class="k">end do</span>  <span class="c">! i</span>
<a name="ln-859"></a>      <span class="k">end if</span>
<a name="ln-860"></a><span class="k">    end do</span>  <span class="c">! j</span>
<a name="ln-861"></a>
<a name="ln-862"></a>  <span class="k">end subroutine </span><span class="n">ludcmp</span>
<a name="ln-863"></a>
<a name="ln-864"></a>  <span class="k">subroutine </span><span class="n">lubksb</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<a name="ln-865"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-866"></a>    <span class="c">!</span>
<a name="ln-867"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-868"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>
<a name="ln-869"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">indx</span>
<a name="ln-870"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-871"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b</span>
<a name="ln-872"></a>
<a name="ln-873"></a>    <span class="kt">integer</span> <span class="kd">::</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ll</span>
<a name="ln-874"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span><span class="nb">sum</span>
<a name="ln-875"></a>
<a name="ln-876"></a><span class="nb">    </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-877"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-878"></a>      <span class="n">ll</span> <span class="o">=</span> <span class="n">indx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-879"></a>      <span class="nb">sum</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>
<a name="ln-880"></a>      <span class="n">b</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-881"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ii</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-882"></a><span class="k">        do </span><span class="n">j</span> <span class="o">=</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-883"></a>          <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">-</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-884"></a>        <span class="k">end do</span>  <span class="c">! j</span>
<a name="ln-885"></a>      <span class="k">else if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-886"></a><span class="k">        </span><span class="n">ii</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-887"></a>      <span class="k">end if</span>
<a name="ln-888"></a><span class="k">      </span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span>
<a name="ln-889"></a><span class="nb">    </span><span class="k">end do</span>  <span class="c">! i</span>
<a name="ln-890"></a>
<a name="ln-891"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-892"></a>      <span class="nb">sum</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-893"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-894"></a>        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">-</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-895"></a>      <span class="k">end do</span>  <span class="c">! j</span>
<a name="ln-896"></a>      <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="o">/</span><span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-897"></a>    <span class="k">end do</span>  <span class="c">! i</span>
<a name="ln-898"></a>
<a name="ln-899"></a>  <span class="k">end subroutine </span><span class="n">lubksb</span>
<a name="ln-900"></a>
<a name="ln-901"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="k">function </span><span class="n">pos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="ln-902"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-903"></a>    <span class="c">!</span>
<a name="ln-904"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-905"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-906"></a>
<a name="ln-907"></a>    <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-908"></a>
<a name="ln-909"></a>  <span class="k">end function </span><span class="n">pos</span>
<a name="ln-910"></a>
<a name="ln-911"></a><span class="c">!     NOTICE</span>
<a name="ln-912"></a><span class="c">!</span>
<a name="ln-913"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-914"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-915"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-916"></a><span class="c">!</span>
<a name="ln-917"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-918"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-919"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-920"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-921"></a><span class="c">!</span>
<a name="ln-922"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-923"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-924"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-925"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-926"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-927"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-928"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-929"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-930"></a><span class="c">!     permit others to do so.</span>
<a name="ln-931"></a><span class="c">!</span>
<a name="ln-932"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-933"></a><span class="c">!</span>
<a name="ln-934"></a>
<a name="ln-935"></a><span class="k">end module </span><span class="n">TARCOGCommon</span>
<a name="ln-936"></a>
<a name="ln-937"></a><span class="k">module </span><span class="n">TARCOGOutput</span>
<a name="ln-938"></a>
<a name="ln-939"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-940"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-941"></a>          <span class="c">!       DATE WRITTEN   June/22/2010</span>
<a name="ln-942"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-943"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-944"></a>
<a name="ln-945"></a>          <span class="c">!  Revision: 6.0.36  (June/22/2010)</span>
<a name="ln-946"></a>          <span class="c">!   - Initial setup, extracted from TARCOG.for</span>
<a name="ln-947"></a>
<a name="ln-948"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-949"></a>          <span class="c">! A module which contains debug dump subroutines</span>
<a name="ln-950"></a>
<a name="ln-951"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-952"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-953"></a>
<a name="ln-954"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-955"></a>          <span class="c">! na</span>
<a name="ln-956"></a>
<a name="ln-957"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-958"></a>          <span class="c">! na</span>
<a name="ln-959"></a>
<a name="ln-960"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-961"></a>
<a name="ln-962"></a>  <span class="k">use </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-963"></a>  <span class="k">use </span><span class="n">TarcogCommon</span>
<a name="ln-964"></a>  <span class="k">use </span><span class="n">TARCOGGassesParams</span>
<a name="ln-965"></a>  <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-966"></a>
<a name="ln-967"></a>  <span class="k">implicit none</span>
<a name="ln-968"></a>
<a name="ln-969"></a><span class="k">  public </span><span class="n">WriteInputArguments</span>
<a name="ln-970"></a>  <span class="k">public </span><span class="n">WriteModifiedArguments</span>
<a name="ln-971"></a>  <span class="k">public </span><span class="n">WriteOutputArguments</span>
<a name="ln-972"></a>  <span class="k">public </span><span class="n">WriteOutputEN673</span>
<a name="ln-973"></a>  <span class="k">public </span><span class="n">WriteTARCOGInputFile</span>
<a name="ln-974"></a>  <span class="k">public </span><span class="n">FinishDebugOutputFiles</span>
<a name="ln-975"></a>  <span class="k">public </span><span class="n">PrepDebugFilesAndVariables</span>
<a name="ln-976"></a>
<a name="ln-977"></a>  <span class="k">public</span>
<a name="ln-978"></a>
<a name="ln-979"></a>  <span class="c">! variables:</span>
<a name="ln-980"></a>  <span class="c">!bi...Debug files handles:</span>
<a name="ln-981"></a>  <span class="c">!character(len=1000) :: DebugDir</span>
<a name="ln-982"></a>  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DBGD</span>
<a name="ln-983"></a>  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">FileMode</span>
<a name="ln-984"></a>  <span class="kt">logical</span> <span class="kd">::</span> <span class="n">WriteDebugOutput</span>
<a name="ln-985"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">DebugMode</span>
<a name="ln-986"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">winID</span><span class="p">,</span> <span class="n">iguID</span>
<a name="ln-987"></a>
<a name="ln-988"></a>  <span class="kt">integer</span><span class="p">,</span> <span class="k">external</span> <span class="kd">::</span> <span class="n">GetNewUnitNumber</span>
<a name="ln-989"></a>
<a name="ln-990"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">InArgumentsFile</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-991"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">OutArgumentsFile</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-992"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">WINCOGFile</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-993"></a>
<a name="ln-994"></a>  <span class="c">!Intermediate debug files</span>
<a name="ln-995"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IterationCSVFileNumber</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-996"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">TarcogIterationsFileNumber</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-997"></a>
<a name="ln-998"></a>  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">IterationCSVName</span> <span class="o">=</span> <span class="s1">&#39;IterationResults.csv&#39;</span>
<a name="ln-999"></a>
<a name="ln-1000"></a>  <span class="c">!integer, parameter :: IterationHHAT = 102</span>
<a name="ln-1001"></a>  <span class="c">!character*(1000)    :: IterationHHATName = &#39;IterationHHAT.csv&#39;</span>
<a name="ln-1002"></a>
<a name="ln-1003"></a>  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">WinCogFileName</span> <span class="o">=</span> <span class="s1">&#39;test.w7&#39;</span>
<a name="ln-1004"></a>  <span class="c">!character*(1000)    :: SHGCFileName = &#39;test.w7&#39;</span>
<a name="ln-1005"></a>  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DebugOutputFileName</span> <span class="o">=</span> <span class="s1">&#39;Tarcog.dbg&#39;</span>
<a name="ln-1006"></a>
<a name="ln-1007"></a>  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">VersionNumber</span> <span class="o">=</span> <span class="s1">&#39; 7.0.15.00 &#39;</span>
<a name="ln-1008"></a>  <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">VersionCompileDateCC</span> <span class="o">=</span> <span class="s1">&#39; August 02, 2012&#39;</span>
<a name="ln-1009"></a>
<a name="ln-1010"></a>  <span class="k">contains</span>
<a name="ln-1011"></a>
<a name="ln-1012"></a><span class="k">  subroutine </span><span class="n">WriteInputArguments</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1013"></a>                <span class="p">&amp;</span>  <span class="n">wso</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1014"></a>                <span class="p">&amp;</span>  <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1015"></a>                <span class="p">&amp;</span>  <span class="n">nlayer</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1016"></a>                <span class="p">&amp;</span>  <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1017"></a>                <span class="p">&amp;</span>  <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="n">sumsol</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1018"></a>                <span class="p">&amp;</span>  <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">)</span>
<a name="ln-1019"></a>
<a name="ln-1020"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">KelvinConv</span>
<a name="ln-1021"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">isky</span>
<a name="ln-1022"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span>
<a name="ln-1023"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span>
<a name="ln-1024"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span>
<a name="ln-1025"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-1028"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">SDscalar</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span>
<a name="ln-1029"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">trmin</span>
<a name="ln-1030"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span>
<a name="ln-1031"></a>
<a name="ln-1032"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">asol</span>
<a name="ln-1033"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span>
<a name="ln-1034"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-1035"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-1036"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-1037"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-1038"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-1039"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-1040"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-1041"></a>
<a name="ln-1042"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="n">sumsol</span>
<a name="ln-1043"></a>
<a name="ln-1044"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nslice</span>
<a name="ln-1045"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span>
<a name="ln-1046"></a>
<a name="ln-1047"></a>
<a name="ln-1048"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DATE_TIME</span>
<a name="ln-1049"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">LEN</span> <span class="o">=</span> <span class="mi">12</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">real_CLOCK</span>
<a name="ln-1050"></a>
<a name="ln-1051"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">nperr</span>
<a name="ln-1052"></a>
<a name="ln-1053"></a>  <span class="c">!bi...Create debug file w/ Tarcog&#39;s input arguments:</span>
<a name="ln-1054"></a>
<a name="ln-1055"></a>  <span class="c">! File is not open and nothing cannot be written</span>
<a name="ln-1056"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">InArgumentsFile</span> <span class="o">==</span> <span class="n">statusClosed</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-1057"></a>
<a name="ln-1058"></a><span class="k">    call </span><span class="nb">DATE_AND_TIME</span> <span class="p">(</span><span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">)</span>
<a name="ln-1059"></a>
<a name="ln-1060"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1061"></a>  <span class="c">!  write(InArgumentsFile, 10001) VersionNumber, VersionCompileDateCC</span>
<a name="ln-1062"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1063"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1064"></a>
<a name="ln-1065"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">winID</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1066"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1002</span><span class="p">)</span> <span class="n">winID</span>
<a name="ln-1067"></a>    <span class="k">else</span>
<a name="ln-1068"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1003</span><span class="p">)</span> <span class="n">winID</span>
<a name="ln-1069"></a>    <span class="k">end if</span>
<a name="ln-1070"></a>
<a name="ln-1071"></a><span class="k">    if</span> <span class="p">(</span><span class="n">iguID</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1072"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1006</span><span class="p">)</span> <span class="n">iguID</span>
<a name="ln-1073"></a>    <span class="k">else</span>
<a name="ln-1074"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1007</span><span class="p">)</span> <span class="n">iguID</span>
<a name="ln-1075"></a>    <span class="k">end if</span>
<a name="ln-1076"></a>
<a name="ln-1077"></a><span class="k">    write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;    Debug dir:     &#39;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">DBGD</span><span class="p">)</span>
<a name="ln-1078"></a>
<a name="ln-1079"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1080"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a name="ln-1081"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1082"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1005</span><span class="p">)</span>
<a name="ln-1083"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1010</span><span class="p">)</span> <span class="n">tout</span><span class="p">,</span>  <span class="n">tout</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1084"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1015</span><span class="p">)</span> <span class="n">tind</span><span class="p">,</span>  <span class="n">tind</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1085"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1020</span><span class="p">)</span> <span class="n">trmin</span><span class="p">,</span>  <span class="n">trmin</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1086"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1030</span><span class="p">)</span> <span class="n">wso</span>
<a name="ln-1087"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">iwd</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1032</span><span class="p">)</span>    <span class="c">! windward</span>
<a name="ln-1088"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">iwd</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1033</span><span class="p">)</span>    <span class="c">! leeward</span>
<a name="ln-1089"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1035</span><span class="p">)</span> <span class="n">wsi</span>
<a name="ln-1090"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1040</span><span class="p">)</span> <span class="n">dir</span>
<a name="ln-1091"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1041</span><span class="p">)</span> <span class="n">outir</span>
<a name="ln-1092"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1045</span><span class="p">)</span> <span class="n">isky</span>
<a name="ln-1093"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1050</span><span class="p">)</span> <span class="n">tsky</span><span class="p">,</span>  <span class="n">tsky</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1094"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1055</span><span class="p">)</span> <span class="n">esky</span>
<a name="ln-1095"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1060</span><span class="p">)</span> <span class="n">fclr</span>
<a name="ln-1096"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1061</span><span class="p">)</span> <span class="n">VacuumPressure</span>
<a name="ln-1097"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1062</span><span class="p">)</span> <span class="n">VacuumMaxGapThickness</span>
<a name="ln-1098"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1063</span><span class="p">)</span> <span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1099"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1065</span><span class="p">)</span> <span class="n">hout</span>
<a name="ln-1100"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1066</span><span class="p">)</span> <span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1101"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1068</span><span class="p">)</span> <span class="n">hin</span>
<a name="ln-1102"></a>
<a name="ln-1103"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">ISO15099</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1070</span><span class="p">)</span> <span class="n">standard</span>
<a name="ln-1104"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1071</span><span class="p">)</span> <span class="n">standard</span>
<a name="ln-1105"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673Design</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1072</span><span class="p">)</span> <span class="n">standard</span>
<a name="ln-1106"></a>
<a name="ln-1107"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_ISO15099</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1108"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10731</span><span class="p">)</span> <span class="n">ThermalMod</span>
<a name="ln-1109"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10740</span><span class="p">)</span> <span class="n">SDScalar</span>
<a name="ln-1110"></a>    <span class="k">end if</span>
<a name="ln-1111"></a>
<a name="ln-1112"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_SCW</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1113"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10732</span><span class="p">)</span> <span class="n">ThermalMod</span>
<a name="ln-1114"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10740</span><span class="p">)</span> <span class="n">SDScalar</span>
<a name="ln-1115"></a>    <span class="k">end if</span>
<a name="ln-1116"></a>
<a name="ln-1117"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_CSM</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1118"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10733</span><span class="p">)</span> <span class="n">ThermalMod</span>
<a name="ln-1119"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10740</span><span class="p">)</span> <span class="n">SDScalar</span>
<a name="ln-1120"></a>    <span class="k">end if</span>
<a name="ln-1121"></a>
<a name="ln-1122"></a>  <span class="c">!    if (ThermalMod.eq.THERM_MOD_CSM)</span>
<a name="ln-1123"></a>  <span class="c">!        write(InArgumentsFile, 10740) SDScalar</span>
<a name="ln-1124"></a>
<a name="ln-1125"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1126"></a>
<a name="ln-1127"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1075</span><span class="p">)</span>
<a name="ln-1128"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1076</span><span class="p">)</span> <span class="n">height</span>
<a name="ln-1129"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1077</span><span class="p">)</span> <span class="n">heightt</span>
<a name="ln-1130"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1078</span><span class="p">)</span> <span class="n">width</span>
<a name="ln-1131"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1079</span><span class="p">)</span> <span class="n">tilt</span>
<a name="ln-1132"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1080</span><span class="p">)</span> <span class="n">totsol</span>
<a name="ln-1133"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1081</span><span class="p">)</span> <span class="n">nlayer</span>
<a name="ln-1134"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1135"></a>
<a name="ln-1136"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1089</span><span class="p">)</span>
<a name="ln-1137"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-1138"></a>      <span class="k">select case</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1139"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">DIFFSHADE</span><span class="p">)</span>                           <span class="c">! Diffuse Shade</span>
<a name="ln-1140"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10806</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1141"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">WOVSHADE</span><span class="p">)</span>                             <span class="c">! Woven Shade</span>
<a name="ln-1142"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10805</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1143"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">VENETBLIND</span><span class="p">)</span>                           <span class="c">! Venetian blind</span>
<a name="ln-1144"></a>         <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10804</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1145"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">SPECULAR</span><span class="p">)</span>                             <span class="c">! Specular layer</span>
<a name="ln-1146"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">nslice</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1147"></a><span class="k">            write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10802</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">! Monolithic glass</span>
<a name="ln-1148"></a>          <span class="k">else</span>
<a name="ln-1149"></a><span class="k">            write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10803</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">! Laminated layer</span>
<a name="ln-1150"></a>          <span class="k">end if</span>
<a name="ln-1151"></a><span class="k">        case </span><span class="n">DEFAULT</span>
<a name="ln-1152"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10809</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1153"></a>      <span class="k">end select</span>
<a name="ln-1154"></a>
<a name="ln-1155"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1090</span><span class="p">)</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1156"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1091</span><span class="p">)</span> <span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1157"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1092</span><span class="p">)</span> <span class="n">asol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1158"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1093</span><span class="p">)</span> <span class="n">tir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1159"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1094</span><span class="p">)</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1160"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1095</span><span class="p">)</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1161"></a>
<a name="ln-1162"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">)</span> <span class="k">then</span> <span class="c">! SD layer</span>
<a name="ln-1163"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1100</span><span class="p">)</span> <span class="n">Atop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1164"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1101</span><span class="p">)</span> <span class="n">Abot</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1165"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1102</span><span class="p">)</span> <span class="n">Al</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1166"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1103</span><span class="p">)</span> <span class="n">Ar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1167"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1105</span><span class="p">)</span> <span class="n">Ah</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1168"></a>
<a name="ln-1169"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11051</span><span class="p">)</span> <span class="n">SlatThick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1170"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11052</span><span class="p">)</span> <span class="n">SlatWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1171"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11053</span><span class="p">)</span> <span class="n">SlatAngle</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1172"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11054</span><span class="p">)</span> <span class="n">SlatCond</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1173"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11055</span><span class="p">)</span> <span class="n">SlatSpacing</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1174"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11056</span><span class="p">)</span> <span class="n">SlatCurve</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1175"></a>
<a name="ln-1176"></a>  <span class="c">!bi...Input arguments correction patch:</span>
<a name="ln-1177"></a>
<a name="ln-1178"></a>  <span class="c">!     if (ApplyVenetianPatch.eq..TRUE.) then</span>
<a name="ln-1179"></a>  <span class="c">!      SlatThick(i) = Thick(i)</span>
<a name="ln-1180"></a>  <span class="c">!      SlatWidth(i) = SlatWidth(i) / 1000.0</span>
<a name="ln-1181"></a>  <span class="c">!      SlatCurve(i) = SlatCurve(i) / 1000.0</span>
<a name="ln-1182"></a>  <span class="c">!      SlatSpacing(i) = SlatSpacing(i) / 1000.0</span>
<a name="ln-1183"></a>  <span class="c">!      write(InArgumentsFile, *) &#39;After applying the patch:&#39;</span>
<a name="ln-1184"></a>  <span class="c">!        write(InArgumentsFile, 11051) SlatThick(i)</span>
<a name="ln-1185"></a>  <span class="c">!        write(InArgumentsFile, 11052) SlatWidth(i)</span>
<a name="ln-1186"></a>  <span class="c">!        write(InArgumentsFile, 11053) SlatAngle(i)</span>
<a name="ln-1187"></a>  <span class="c">!        write(InArgumentsFile, 11054) SlatCond(i)</span>
<a name="ln-1188"></a>  <span class="c">!        write(InArgumentsFile, 11055) SlatSpacing(i)</span>
<a name="ln-1189"></a>  <span class="c">!        write(InArgumentsFile, 11056) SlatCurve(i)</span>
<a name="ln-1190"></a>  <span class="c">!     end if</span>
<a name="ln-1191"></a>
<a name="ln-1192"></a>  <span class="c">!bi...end Input arguments correction patch</span>
<a name="ln-1193"></a>
<a name="ln-1194"></a>      <span class="k">end if</span>
<a name="ln-1195"></a>
<a name="ln-1196"></a><span class="k">      if</span> <span class="p">(</span><span class="n">nslice</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="c">! SD layer</span>
<a name="ln-1197"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1085</span><span class="p">)</span> <span class="n">nslice</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1198"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1085</span><span class="p">)</span> <span class="n">LaminateA</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1199"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1085</span><span class="p">)</span> <span class="n">LaminateB</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1200"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1085</span><span class="p">)</span> <span class="n">sumsol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1201"></a>      <span class="k">end if</span>
<a name="ln-1202"></a><span class="k">    end do</span>  <span class="c">! i - layers</span>
<a name="ln-1203"></a>
<a name="ln-1204"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1205"></a>
<a name="ln-1206"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1110</span><span class="p">)</span>
<a name="ln-1207"></a>
<a name="ln-1208"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span> <span class="c">! loop through gaps:</span>
<a name="ln-1209"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span>   <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1111</span><span class="p">)</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1210"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>  <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11110</span><span class="p">)</span>
<a name="ln-1211"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11111</span><span class="p">)</span>
<a name="ln-1212"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span>   <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1112</span><span class="p">)</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1213"></a>      <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1113</span><span class="p">)</span> <span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1214"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1215"></a><span class="k">        write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1120</span><span class="p">)</span> <span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1216"></a>      <span class="k">end if</span>
<a name="ln-1217"></a><span class="k">      if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1218"></a><span class="k">        write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1121</span><span class="p">)</span> <span class="n">tvent</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1219"></a>      <span class="k">end if</span>
<a name="ln-1220"></a><span class="k">      write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1114</span><span class="p">)</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1221"></a>
<a name="ln-1222"></a>      <span class="c">!if (mgas.eq.1) then ! call gasses by names:</span>
<a name="ln-1223"></a>      <span class="c">!  do  j = 1, nmix(i)</span>
<a name="ln-1224"></a>      <span class="c">!    if (iprop(i, j).eq.1) write(InArgumentsFile, 1115) iprop(i, j), &#39;Air,     &#39;, 100*frct(i, j) ! Air</span>
<a name="ln-1225"></a>      <span class="c">!    if (iprop(i, j).eq.2) write(InArgumentsFile, 1115) iprop(i, j), &#39;Argon,   &#39;, 100*frct(i, j) ! Argon</span>
<a name="ln-1226"></a>      <span class="c">!    if (iprop(i, j).eq.3) write(InArgumentsFile, 1115) iprop(i, j), &#39;Krypton, &#39;, 100*frct(i, j) ! Krypton</span>
<a name="ln-1227"></a>      <span class="c">!    if (iprop(i, j).eq.4) write(InArgumentsFile, 1115) iprop(i, j), &#39;Xenon,   &#39;, 100*frct(i, j) ! Xenon</span>
<a name="ln-1228"></a>      <span class="c">!  end do  ! j - mix loop</span>
<a name="ln-1229"></a>      <span class="c">!end if</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a>      <span class="c">!if (mgas.eq.0) then ! show received gass properties:</span>
<a name="ln-1232"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1233"></a>          <span class="c">!if (iprop(i, j).eq.1) write(InArgumentsFile, 1115) iprop(i, j), &#39; &#39; 100*frct(i, j) ! Air</span>
<a name="ln-1234"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1115</span><span class="p">)</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="c">! gas</span>
<a name="ln-1235"></a>          <span class="c">!if (iprop(i, j).eq.2) write(InArgumentsFile, 1116) iprop(i, j), 100*frct(i, j) ! Argon</span>
<a name="ln-1236"></a>          <span class="c">!if (iprop(i, j).eq.3) write(InArgumentsFile, 1117) iprop(i, j), 100*frct(i, j) ! Krypton</span>
<a name="ln-1237"></a>          <span class="c">!if (iprop(i, j).eq.4) write(InArgumentsFile, 1118) iprop(i, j), 100*frct(i, j) ! Xenon</span>
<a name="ln-1238"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1130</span><span class="p">)</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">100</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-1239"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1131</span><span class="p">)</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-1240"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1132</span><span class="p">)</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-1241"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1133</span><span class="p">)</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-1242"></a>          <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1134</span><span class="p">)</span> <span class="n">xwght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
<a name="ln-1243"></a>        <span class="k">end do</span>  <span class="c">! - j - one mix</span>
<a name="ln-1244"></a>      <span class="c">!end if  ! MGAS = 1 - &quot;table&quot; gasses</span>
<a name="ln-1245"></a>    <span class="k">end do</span> <span class="c">! i - gas loop</span>
<a name="ln-1246"></a>
<a name="ln-1247"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1248"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1198</span><span class="p">)</span>
<a name="ln-1249"></a>
<a name="ln-1250"></a>    <span class="c">!close(InArgumentsFile)</span>
<a name="ln-1251"></a>
<a name="ln-1252"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1253"></a>    <span class="c">!!!</span>
<a name="ln-1254"></a>    <span class="c">!!! Formats:</span>
<a name="ln-1255"></a>    <span class="c">!!!</span>
<a name="ln-1256"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1257"></a>
<a name="ln-1258"></a>    <span class="mi">10001</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG v.&#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="s1">&#39;compiled &#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
<a name="ln-1259"></a>    <span class="c">!1000  format(&#39;TARCOG input arguments list - &#39;,I4,&#39;-&#39;,I2.2,&#39;-&#39;,I2.2, &#39;, &#39;, I2.2,&#39;:&#39;,I2.2,&#39;:&#39;,I2.2)</span>
<a name="ln-1260"></a>    <span class="mi">1000</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG input arguments:&#39;</span><span class="p">)</span>
<a name="ln-1261"></a>    <span class="mi">1001</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG debug output, &#39;</span><span class="p">,</span><span class="n">I4</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1262"></a>    <span class="mi">1002</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;     WindowID:&#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39;  - Not specified&#39;</span><span class="p">)</span>
<a name="ln-1263"></a>    <span class="mi">1003</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;     WindowID:&#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1264"></a>    <span class="mi">1006</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;     IGUID:   &#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39;  - Not specified&#39;</span><span class="p">)</span>
<a name="ln-1265"></a>    <span class="mi">1007</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;     IGUID:   &#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1266"></a>
<a name="ln-1267"></a>    <span class="mi">1005</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Simulation parameters:&#39;</span><span class="p">)</span>
<a name="ln-1268"></a>    <span class="c">!1010  format(&#39;  Tout       =  &#39;, F10.6,  &#39; - Outdoor temperature [K]&#39;)</span>
<a name="ln-1269"></a>    <span class="mi">1010</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Tout       =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C) - Outdoor temperature&#39;</span><span class="p">)</span>
<a name="ln-1270"></a>    <span class="c">!1015  format(&#39;  Tin        =  &#39;, F10.6,  &#39; - Indoor temperature [K]&#39;)</span>
<a name="ln-1271"></a>    <span class="mi">1015</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Tint       =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C) - Indoor temperature&#39;</span><span class="p">)</span>
<a name="ln-1272"></a>
<a name="ln-1273"></a>    <span class="mi">1014</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Adjusted input arguments:&#39;</span><span class="p">)</span>
<a name="ln-1274"></a>    <span class="mi">1013</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Gass coefficients:&#39;</span><span class="p">)</span>
<a name="ln-1275"></a>    <span class="c">!1016  format(&#39;  Trmout     =  &#39;, F10.6,  &#39; - Outdoor mean radiant temperature [K]&#39;)</span>
<a name="ln-1276"></a>    <span class="mi">1016</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Trmout     =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C) - Outdoor mean radiant temp.&#39;</span><span class="p">)</span>
<a name="ln-1277"></a>
<a name="ln-1278"></a>    <span class="mi">1017</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Gout       =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1279"></a>    <span class="mi">1018</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Gin        =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1280"></a>    <span class="mi">1019</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ebsky      =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1281"></a>    <span class="mi">10191</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ebroom     =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1282"></a>
<a name="ln-1283"></a>    <span class="c">!1020  format(&#39;  Trmin      =  &#39;, F10.6,  &#39; - Indoor mean radiant temperature [K]&#39;)</span>
<a name="ln-1284"></a>    <span class="mi">1020</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Trmin      =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C) - Indoor mean radiant temp.&#39;</span><span class="p">)</span>
<a name="ln-1285"></a>    <span class="mi">1030</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  wso        =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - Outdoor wind speed [m/s]&#39;</span><span class="p">)</span>
<a name="ln-1286"></a>    <span class="mi">1032</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  iwd        =    0        - Wind direction - windward&#39;</span><span class="p">)</span>
<a name="ln-1287"></a>    <span class="mi">1033</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  iwd        =    1        - Wind direction - leeward&#39;</span><span class="p">)</span>
<a name="ln-1288"></a>    <span class="mi">1035</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  wsi        =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - Indoor forced air speed [m/s]&#39;</span><span class="p">)</span>
<a name="ln-1289"></a>    <span class="mi">1040</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  dir        = &#39;</span><span class="p">,</span> <span class="n">F8</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - Direct solar radiation [W/m^2]&#39;</span><span class="p">)</span>
<a name="ln-1290"></a>    <span class="mi">1041</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  outir       = &#39;</span><span class="p">,</span> <span class="n">F8</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - IR radiation [W/m^2]&#39;</span><span class="p">)</span>
<a name="ln-1291"></a>    <span class="mi">1045</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  isky       =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - Flag for handling tsky, esky&#39;</span><span class="p">)</span>
<a name="ln-1292"></a>    <span class="c">!1050  format(&#39;  tsky       =  &#39;, F10.6,  &#39; - Night sky temperature [K]&#39;)</span>
<a name="ln-1293"></a>    <span class="mi">1050</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  tsky           =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C) - Night sky temperature&#39;</span><span class="p">)</span>
<a name="ln-1294"></a>    <span class="mi">1055</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  esky           =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - Effective night sky emmitance&#39;</span><span class="p">)</span>
<a name="ln-1295"></a>    <span class="mi">1060</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  fclr           =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - Fraction of sky that is clear&#39;</span><span class="p">)</span>
<a name="ln-1296"></a>    <span class="mi">1061</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  VacuumPressure =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - maximum allowed gas pressure to be considered as vacuum&#39;</span><span class="p">)</span>
<a name="ln-1297"></a>    <span class="mi">1062</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  VacuumMaxGapThickness =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - maximum allowed vacuum gap thickness with support pillar&#39;</span><span class="p">)</span>
<a name="ln-1298"></a>    <span class="mi">1063</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ibc(1)         =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - Outdoor BC switch&#39;</span><span class="p">)</span>
<a name="ln-1299"></a>    <span class="mi">1065</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hout           =  &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="s1">&#39;  - Outdoor film coeff. [W/m^2-K]&#39;</span><span class="p">)</span>
<a name="ln-1300"></a>    <span class="mi">1066</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ibc(2)         =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - Indoor BC switch&#39;</span><span class="p">)</span>
<a name="ln-1301"></a>    <span class="mi">1068</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hin            =  &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="s1">&#39;  - Indoor film coeff. [W/m^2-K]&#39;</span><span class="p">)</span>
<a name="ln-1302"></a>
<a name="ln-1303"></a>    <span class="mi">1070</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  standard   =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - ISO 15099 calc. standard&#39;</span><span class="p">)</span>
<a name="ln-1304"></a>    <span class="mi">1071</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  standard   =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - EN 673/ISO 10292 Declared calc. standard&#39;</span><span class="p">)</span>
<a name="ln-1305"></a>    <span class="mi">1072</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  standard   =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - EN 673/ISO 10292 Design calc. standard&#39;</span><span class="p">)</span>
<a name="ln-1306"></a>
<a name="ln-1307"></a>    <span class="mi">10731</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ThermalMod =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - ISO15099 thermal model&#39;</span><span class="p">)</span>
<a name="ln-1308"></a>    <span class="mi">10732</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ThermalMod =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - Scaled Cavity Width (SCW) thermal model&#39;</span><span class="p">)</span>
<a name="ln-1309"></a>    <span class="mi">10733</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ThermalMod =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - Convective Scalar Model (CSM) thermal model&#39;</span><span class="p">)</span>
<a name="ln-1310"></a>
<a name="ln-1311"></a>    <span class="mi">10740</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  SDScalar =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="s1">&#39;      - Factor of Venetian SD layer contribution to convection&#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-1312"></a>                      <span class="s1">&#39; (only if ThermalModel = 2, otherwise ignored)&#39;</span><span class="p">)</span>
<a name="ln-1313"></a>
<a name="ln-1314"></a>    <span class="mi">1075</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;IGU parameters:&#39;</span><span class="p">)</span>
<a name="ln-1315"></a>    <span class="mi">1076</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  height     =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - IGU cavity height [m]&#39;</span><span class="p">)</span>
<a name="ln-1316"></a>    <span class="mi">1077</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  heightt    =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Total window height [m]&#39;</span><span class="p">)</span>
<a name="ln-1317"></a>    <span class="mi">1078</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  width      =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Window width [m]&#39;</span><span class="p">)</span>
<a name="ln-1318"></a>    <span class="mi">1079</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  tilt       =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - Window tilt [deg]&#39;</span><span class="p">)</span>
<a name="ln-1319"></a>    <span class="mi">1080</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  totsol     =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Total solar transmittance of IGU&#39;</span><span class="p">)</span>
<a name="ln-1320"></a>    <span class="mi">1081</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  nlayer     =  &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>  <span class="s1">&#39;        - Number of glazing layers&#39;</span><span class="p">)</span>
<a name="ln-1321"></a>
<a name="ln-1322"></a>    <span class="mi">1089</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;IGU layers list:&#39;</span><span class="p">)</span>
<a name="ln-1323"></a>
<a name="ln-1324"></a>    <span class="mi">10802</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Layer&#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; : &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;              - Specular layer - Monolyhtic Glass&#39;</span><span class="p">)</span>
<a name="ln-1325"></a>    <span class="mi">10803</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Layer&#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; : &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;              - Laminated Glass&#39;</span><span class="p">)</span>
<a name="ln-1326"></a>    <span class="mi">10804</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Layer&#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; : &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;              - Venetian Blind&#39;</span><span class="p">)</span>
<a name="ln-1327"></a>    <span class="mi">10805</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Layer&#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; : &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;              - Woven Shade&#39;</span><span class="p">)</span>
<a name="ln-1328"></a>    <span class="mi">10806</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Layer&#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; : &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;              - Diffuse Shade&#39;</span><span class="p">)</span>
<a name="ln-1329"></a>    <span class="mi">10809</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Layer&#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; : &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;              - UNKNOWN TYPE!&#39;</span><span class="p">)</span>
<a name="ln-1330"></a>
<a name="ln-1331"></a>    <span class="mi">1085</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    nslice     = &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span>    <span class="s1">&#39;          - Number of slices&#39;</span><span class="p">)</span>
<a name="ln-1332"></a>    <span class="mi">1086</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    LaminateA  = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span>  <span class="s1">&#39; - A coeff.&#39;</span><span class="p">)</span>
<a name="ln-1333"></a>    <span class="mi">1087</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    LaminateB  = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span>  <span class="s1">&#39; - B coeff.&#39;</span><span class="p">)</span>
<a name="ln-1334"></a>    <span class="mi">1088</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    sumsol     = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span>  <span class="s1">&#39; - Absorbed solar energy [W/m^2]&#39;</span><span class="p">)</span>
<a name="ln-1335"></a>
<a name="ln-1336"></a>    <span class="mi">1090</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    thick   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Thickness [m]&#39;</span><span class="p">)</span>
<a name="ln-1337"></a>    <span class="mi">1091</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    scon    = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Thermal conductivity [W/m-K]&#39;</span><span class="p">)</span>
<a name="ln-1338"></a>    <span class="mi">1092</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    asol    = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span>  <span class="s1">&#39; - Absorbed solar energy [W/m^2]&#39;</span><span class="p">)</span>
<a name="ln-1339"></a>    <span class="mi">1093</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    tir     = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span>  <span class="s1">&#39; - IR transmittance&#39;</span><span class="p">)</span>
<a name="ln-1340"></a>    <span class="mi">1094</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    emis1   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - IR outdoor emissivity&#39;</span><span class="p">)</span>
<a name="ln-1341"></a>    <span class="mi">1095</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    emis2   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - IR indoor emissivity&#39;</span><span class="p">)</span>
<a name="ln-1342"></a>    <span class="mi">1100</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    Atop    = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Top opening area [m^2]&#39;</span><span class="p">)</span>
<a name="ln-1343"></a>    <span class="mi">1101</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    Abot    = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Bottom opening area [m^2]&#39;</span><span class="p">)</span>
<a name="ln-1344"></a>    <span class="mi">1102</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    Al      = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Left opening area [m^2]&#39;</span><span class="p">)</span>
<a name="ln-1345"></a>    <span class="mi">1103</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    Ar      = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Right opening area [m^2]&#39;</span><span class="p">)</span>
<a name="ln-1346"></a>    <span class="mi">1105</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    Ah      = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Total area of holes [m^2]&#39;</span><span class="p">)</span>
<a name="ln-1347"></a>
<a name="ln-1348"></a>    <span class="mi">11051</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    SlatThick   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Slat thickness [m]&#39;</span><span class="p">)</span>
<a name="ln-1349"></a>    <span class="mi">11052</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    SlatWidth   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Slat width [m]&#39;</span><span class="p">)</span>
<a name="ln-1350"></a>    <span class="mi">11053</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    SlatAngle   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Slat tilt angle [deg]&#39;</span><span class="p">)</span>
<a name="ln-1351"></a>    <span class="mi">11054</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    SlatCond    = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Conductivity of the slat material [W/m.K]&#39;</span><span class="p">)</span>
<a name="ln-1352"></a>    <span class="mi">11055</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    SlatSpacing = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Distance between slats [m]&#39;</span><span class="p">)</span>
<a name="ln-1353"></a>    <span class="mi">11056</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    SlatCurve   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Curvature radius of the slat [m]&#39;</span><span class="p">)</span>
<a name="ln-1354"></a>
<a name="ln-1355"></a>    <span class="mi">1110</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;IGU Gaps:&#39;</span><span class="p">)</span>
<a name="ln-1356"></a>    <span class="mi">1111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Gap &#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span>  <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<a name="ln-1357"></a>    <span class="mi">11110</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Outdoor space:&#39;</span><span class="p">)</span>
<a name="ln-1358"></a>    <span class="mi">11111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Indoor space:&#39;</span><span class="p">)</span>
<a name="ln-1359"></a>
<a name="ln-1360"></a>    <span class="mi">1112</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    gap        = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="s1">&#39; - Gap width [m]&#39;</span><span class="p">)</span>
<a name="ln-1361"></a>    <span class="mi">1113</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    presure    = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="s1">&#39; - Gas pressure [N/m^2]&#39;</span><span class="p">)</span>
<a name="ln-1362"></a>    <span class="mi">1114</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    nmix       = &#39;</span><span class="p">,</span> <span class="n">I6</span><span class="p">,</span>  <span class="s1">&#39;       - Num. of gasses in a gas mix&#39;</span><span class="p">)</span>
<a name="ln-1363"></a>    <span class="mi">1115</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;      Gas &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;:     &#39;</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="s1">&#39;     &#39;</span><span class="p">,</span> <span class="n">F6</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39; %&#39;</span><span class="p">)</span>
<a name="ln-1364"></a>
<a name="ln-1365"></a>    <span class="c">!1115  format(&#39;      Gas &#39;, I1, &#39;:     Air,     &#39;, F6.2,&#39; %&#39;)</span>
<a name="ln-1366"></a>    <span class="c">!1116  format(&#39;      Gas &#39;, I1, &#39;:     Argon,   &#39;, F6.2,&#39; %&#39;)</span>
<a name="ln-1367"></a>    <span class="c">!1117  format(&#39;      Gas &#39;, I1, &#39;:     Krypron, &#39;, F6.2,&#39; %&#39;)</span>
<a name="ln-1368"></a>    <span class="c">!1118  format(&#39;      Gas &#39;, I1, &#39;:     Xenon,   &#39;, F6.2,&#39; %&#39;)</span>
<a name="ln-1369"></a>
<a name="ln-1370"></a>    <span class="mi">1120</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    vvent      = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="s1">&#39; - Forced ventilation speed [m/s]&#39;</span><span class="p">)</span>
<a name="ln-1371"></a>    <span class="mi">1121</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    tvent      = &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>  <span class="s1">&#39; - Temperature in connected gap [K]&#39;</span><span class="p">)</span>
<a name="ln-1372"></a>
<a name="ln-1373"></a>    <span class="mi">1130</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;      Gas mix coefficients - gas &#39;</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F6</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39; %&#39;</span><span class="p">)</span>
<a name="ln-1374"></a>    <span class="mi">1131</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        gcon   = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Conductivity&#39;</span><span class="p">)</span>
<a name="ln-1375"></a>    <span class="mi">1132</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        gvis   = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Dynamic viscosity&#39;</span><span class="p">)</span>
<a name="ln-1376"></a>    <span class="mi">1133</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        gcp    = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Spec.heat @ const.P&#39;</span><span class="p">)</span>
<a name="ln-1377"></a>    <span class="mi">1134</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        wght   = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;                           - Molecular weight&#39;</span><span class="p">)</span>
<a name="ln-1378"></a>
<a name="ln-1379"></a>    <span class="mi">1198</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;=====  =====  =====  =====  =====  =====  =====  =====  =====  =====  =====&#39;</span><span class="p">)</span>
<a name="ln-1380"></a>    <span class="c">!1199  format(&#39;-----  *****  -----  *****  -----  *****  -----  *****  -----  *****  -----&#39;)</span>
<a name="ln-1381"></a>
<a name="ln-1382"></a>  <span class="k">end subroutine</span>
<a name="ln-1383"></a>
<a name="ln-1384"></a><span class="k">  subroutine </span><span class="n">WriteModifiedArguments</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="n">DBGD</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">trmout</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">ebsky</span><span class="p">,</span> <span class="n">ebroom</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1385"></a>                                    <span class="p">&amp;</span>  <span class="n">nlayer</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">)</span>
<a name="ln-1386"></a>
<a name="ln-1387"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">KelvinConv</span>
<a name="ln-1388"></a>
<a name="ln-1389"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">InArgumentsFile</span>
<a name="ln-1390"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-1391"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-1392"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">esky</span><span class="p">,</span> <span class="n">trmout</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">ebsky</span><span class="p">,</span> <span class="n">ebroom</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Gin</span>
<a name="ln-1393"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span>
<a name="ln-1394"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-1395"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-1396"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-1397"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-1398"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-1399"></a>
<a name="ln-1400"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DBGD</span>
<a name="ln-1401"></a>
<a name="ln-1402"></a>    <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">nperr</span>
<a name="ln-1403"></a>
<a name="ln-1404"></a>
<a name="ln-1405"></a>    <span class="c">!open(unit=InArgumentsFile,  file=TRIM(DBGD)//DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1406"></a>    <span class="c">!        &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1407"></a>    <span class="c">!if (nperr.ne.0)  open(unit=InArgumentsFile,  file=DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1408"></a>    <span class="c">!        &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1409"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1410"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1014</span><span class="p">)</span>
<a name="ln-1411"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1412"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1055</span><span class="p">)</span> <span class="n">esky</span>
<a name="ln-1413"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1016</span><span class="p">)</span> <span class="n">trmout</span><span class="p">,</span>  <span class="n">trmout</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1414"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1020</span><span class="p">)</span> <span class="n">trmin</span><span class="p">,</span>    <span class="n">trmin</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1415"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1019</span><span class="p">)</span> <span class="n">ebsky</span>
<a name="ln-1416"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">10191</span><span class="p">)</span> <span class="n">ebroom</span>
<a name="ln-1417"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1017</span><span class="p">)</span> <span class="n">Gout</span>
<a name="ln-1418"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1018</span><span class="p">)</span> <span class="n">Gin</span>
<a name="ln-1419"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1420"></a>
<a name="ln-1421"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-1422"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">)</span> <span class="k">then</span> <span class="c">! SD layer</span>
<a name="ln-1423"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1084</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1424"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1090</span><span class="p">)</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1425"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1091</span><span class="p">)</span> <span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1426"></a>      <span class="k">end if</span>
<a name="ln-1427"></a><span class="k">    end do</span>
<a name="ln-1428"></a><span class="k">    write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1429"></a>
<a name="ln-1430"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1013</span><span class="p">)</span>
<a name="ln-1431"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span> <span class="c">! loop through gaps:</span>
<a name="ln-1432"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span>  <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1111</span><span class="p">)</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1433"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span>  <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1112</span><span class="p">)</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1434"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>   <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11110</span><span class="p">)</span>
<a name="ln-1435"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">11111</span><span class="p">)</span>
<a name="ln-1436"></a>  <span class="c">!    write(InArgumentsFile, 1111) i-1</span>
<a name="ln-1437"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1438"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1130</span><span class="p">)</span> <span class="n">j</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-1439"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1131</span><span class="p">)</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">xgcon</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-1440"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1132</span><span class="p">)</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">xgvis</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-1441"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1133</span><span class="p">)</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">xgcp</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-1442"></a>        <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1134</span><span class="p">)</span> <span class="n">xwght</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1443"></a>      <span class="k">end do</span>  <span class="c">! j - gas mix</span>
<a name="ln-1444"></a>    <span class="k">end do</span> <span class="c">! i - gaps</span>
<a name="ln-1445"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1446"></a>    <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="mi">1198</span><span class="p">)</span>
<a name="ln-1447"></a>    <span class="c">!close(InArgumentsFile)</span>
<a name="ln-1448"></a>
<a name="ln-1449"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1450"></a>    <span class="c">!!!</span>
<a name="ln-1451"></a>    <span class="c">!!! Formats:</span>
<a name="ln-1452"></a>    <span class="c">!!!</span>
<a name="ln-1453"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1454"></a>
<a name="ln-1455"></a>    <span class="mi">1014</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Adjusted input arguments:&#39;</span><span class="p">)</span>
<a name="ln-1456"></a>    <span class="mi">1013</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Gass coefficients:&#39;</span><span class="p">)</span>
<a name="ln-1457"></a>    <span class="mi">1016</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Trmout     =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C) - Outdoor mean radiant temp.&#39;</span><span class="p">)</span>
<a name="ln-1458"></a>    <span class="mi">1017</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Gout       =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1459"></a>    <span class="mi">1018</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Gin        =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1460"></a>    <span class="mi">1019</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ebsky      =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1461"></a>    <span class="mi">10191</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ebroom     =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-1462"></a>
<a name="ln-1463"></a>    <span class="mi">1020</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Trmin      =  &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C) - Indoor mean radiant temp.&#39;</span><span class="p">)</span>
<a name="ln-1464"></a>    <span class="mi">1055</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  esky       =  &#39;</span><span class="p">,</span> <span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span>  <span class="s1">&#39;    - Effective night sky emmitance&#39;</span><span class="p">)</span>
<a name="ln-1465"></a>
<a name="ln-1466"></a>    <span class="mi">1084</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Layer&#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; : &#39;</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;              - Venetian Blind&#39;</span><span class="p">)</span>
<a name="ln-1467"></a>    <span class="mi">1090</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    thick   = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Thickness [m]&#39;</span><span class="p">)</span>
<a name="ln-1468"></a>    <span class="mi">1091</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    scon    = &#39;</span><span class="p">,</span> <span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;   - Thermal conductivity [W/m-K]&#39;</span><span class="p">)</span>
<a name="ln-1469"></a>
<a name="ln-1470"></a>    <span class="mi">1130</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;      Gas mix coefficients - gas &#39;</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F6</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39; %&#39;</span><span class="p">)</span>
<a name="ln-1471"></a>    <span class="mi">1131</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        gcon   = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Conductivity&#39;</span><span class="p">)</span>
<a name="ln-1472"></a>    <span class="mi">1132</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        gvis   = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Dynamic viscosity&#39;</span><span class="p">)</span>
<a name="ln-1473"></a>    <span class="mi">1133</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        gcp    = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39; - Spec.heat @ const.P&#39;</span><span class="p">)</span>
<a name="ln-1474"></a>    <span class="mi">1134</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        wght   = &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span>  <span class="s1">&#39;                           - Molecular weight&#39;</span><span class="p">)</span>
<a name="ln-1475"></a>
<a name="ln-1476"></a>    <span class="mi">1110</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;IGU Gaps:&#39;</span><span class="p">)</span>
<a name="ln-1477"></a>    <span class="mi">1111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Gap &#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span>  <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<a name="ln-1478"></a>    <span class="mi">1112</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Gap width: &#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">8</span><span class="p">)</span>
<a name="ln-1479"></a>    <span class="mi">11110</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Outdoor space:&#39;</span><span class="p">)</span>
<a name="ln-1480"></a>    <span class="mi">11111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; Indoor space:&#39;</span><span class="p">)</span>
<a name="ln-1481"></a>    <span class="mi">1198</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;=====  =====  =====  =====  =====  =====  =====  =====  =====  =====  =====&#39;</span><span class="p">)</span>
<a name="ln-1482"></a>
<a name="ln-1483"></a>  <span class="k">end subroutine</span>
<a name="ln-1484"></a>
<a name="ln-1485"></a><span class="k">  subroutine </span><span class="n">WriteOutputArguments</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="n">DBGD</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1486"></a>                                    <span class="p">&amp;</span>   <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">hflux</span><span class="p">,</span> <span class="n">shgct</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1487"></a>                                    <span class="p">&amp;</span>   <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1488"></a>                                    <span class="p">&amp;</span>   <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1489"></a>                                    <span class="p">&amp;</span>   <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1490"></a>                                    <span class="p">&amp;</span>   <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">AchievedErrorTolerance</span><span class="p">,</span> <span class="n">NumOfIter</span><span class="p">)</span>
<a name="ln-1491"></a>
<a name="ln-1492"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">KelvinConv</span>
<a name="ln-1493"></a>
<a name="ln-1494"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">OutArgumentsFile</span>
<a name="ln-1495"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-1496"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">shgct</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span><span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span>
<a name="ln-1497"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">q</span>
<a name="ln-1498"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qv</span>
<a name="ln-1499"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qcgas</span>
<a name="ln-1500"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qrgas</span>
<a name="ln-1501"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-1502"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NumOfIter</span>
<a name="ln-1503"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span><span class="p">,</span><span class="n">sc</span><span class="p">,</span><span class="n">hflux</span><span class="p">,</span><span class="n">shgc</span>
<a name="ln-1504"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-1505"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span>
<a name="ln-1506"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vfreevent</span>
<a name="ln-1507"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vvent</span>
<a name="ln-1508"></a>
<a name="ln-1509"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span>
<a name="ln-1510"></a>
<a name="ln-1511"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span>
<a name="ln-1512"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">HcUnshadedIn</span>
<a name="ln-1513"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Keff</span>
<a name="ln-1514"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeGapKeffConv</span>
<a name="ln-1515"></a>
<a name="ln-1516"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span>
<a name="ln-1517"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Rf</span>
<a name="ln-1518"></a>
<a name="ln-1519"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AchievedErrorTolerance</span>
<a name="ln-1520"></a>
<a name="ln-1521"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DBGD</span>
<a name="ln-1522"></a>
<a name="ln-1523"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DATE_TIME</span>
<a name="ln-1524"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span> <span class="mi">12</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">real_CLOCK</span>
<a name="ln-1525"></a>
<a name="ln-1526"></a>
<a name="ln-1527"></a>    <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">nperr</span>
<a name="ln-1528"></a>
<a name="ln-1529"></a>    <span class="c">!open(unit=OutArgumentsFile,  file=TRIM(DBGD)//DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1530"></a>    <span class="c">!      &amp; form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1531"></a>    <span class="c">!if (nperr.ne.0)  open(unit=OutArgumentsFile,  file=DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1532"></a>    <span class="c">!      &amp; form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1533"></a>    <span class="k">call </span><span class="nb">DATE_AND_TIME</span> <span class="p">(</span><span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">)</span>
<a name="ln-1534"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1535"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1536"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1537"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2350</span><span class="p">)</span>
<a name="ln-1538"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1539"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2105</span><span class="p">)</span> <span class="n">tamb</span><span class="p">,</span>    <span class="n">tamb</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1540"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2180</span><span class="p">)</span> <span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1541"></a>
<a name="ln-1542"></a>    <span class="c">!bi  Write out layer properties:</span>
<a name="ln-1543"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-1544"></a>      <span class="c">!        write(OutArgumentsFile, 2110) 2*i-1, theta(2*i-1), theta(2*i-1)-273.15</span>
<a name="ln-1545"></a>      <span class="k">select case</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1546"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">SPECULAR</span><span class="p">)</span>                             <span class="c">! Specular layer</span>
<a name="ln-1547"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2110</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1548"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2190</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1549"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2110</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1550"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">VENETBLIND</span><span class="p">)</span>                             <span class="c">! Venetian blind</span>
<a name="ln-1551"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2111</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1552"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2195</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1553"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2111</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1554"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">WOVSHADE</span><span class="p">)</span>                             <span class="c">! Venetian blind</span>
<a name="ln-1555"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2112</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1556"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2195</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1557"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2112</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1558"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">DIFFSHADE</span><span class="p">)</span>                             <span class="c">! Venetian blind</span>
<a name="ln-1559"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2110</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1560"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2190</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1561"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2110</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1562"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1563"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2110</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1564"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2199</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1565"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2110</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1566"></a>      <span class="k">end select</span>
<a name="ln-1567"></a>
<a name="ln-1568"></a>  <span class="c">!    write(OutArgumentsFile, 2110) 2*i, theta(2*i), theta(2*i)-273.15</span>
<a name="ln-1569"></a>
<a name="ln-1570"></a>      <span class="c">!bi  Write out gap properties:</span>
<a name="ln-1571"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1572"></a><span class="k">        write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2300</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1573"></a>        <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2320</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">qv</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1574"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1575"></a><span class="k">          write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2321</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1576"></a>        <span class="k">else</span>
<a name="ln-1577"></a><span class="k">          if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1578"></a><span class="k">            write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2321</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation Keff(i-1) @ i=1</span>
<a name="ln-1579"></a>          <span class="k">end if</span>
<a name="ln-1580"></a><span class="k">        end if</span>
<a name="ln-1581"></a><span class="k">        write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2322</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1582"></a>  <span class="c">!      write(OutArgumentsFile, 2323) i, Keff(i)</span>
<a name="ln-1583"></a>        <span class="c">!write(OutArgumentsFile, 2310) i, qprim(2*i + 1)</span>
<a name="ln-1584"></a>      <span class="k">else</span>
<a name="ln-1585"></a><span class="k">        write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2210</span><span class="p">)</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1586"></a>      <span class="k">end if</span>
<a name="ln-1587"></a><span class="k">    end do</span>  <span class="c">! i - layers</span>
<a name="ln-1588"></a>
<a name="ln-1589"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2115</span><span class="p">)</span> <span class="n">troom</span><span class="p">,</span>    <span class="n">troom</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-1590"></a>
<a name="ln-1591"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1592"></a>
<a name="ln-1593"></a>    <span class="c">!Simon: Write energy balances on layer surfaces</span>
<a name="ln-1594"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4350</span><span class="p">)</span>
<a name="ln-1595"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1596"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">4205</span><span class="p">)</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span>
<a name="ln-1597"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1598"></a>
<a name="ln-1599"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-1600"></a>      <span class="k">select case</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1601"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">SPECULAR</span><span class="p">)</span>                             <span class="c">! Specular layer</span>
<a name="ln-1602"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4110</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1603"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4111</span><span class="p">)</span>
<a name="ln-1604"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4190</span><span class="p">)</span>
<a name="ln-1605"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4121</span><span class="p">)</span>
<a name="ln-1606"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4120</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1607"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">VENETBLIND</span><span class="p">)</span>                             <span class="c">! Venetian blind</span>
<a name="ln-1608"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4112</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1609"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4113</span><span class="p">)</span>
<a name="ln-1610"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4190</span><span class="p">)</span>
<a name="ln-1611"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4123</span><span class="p">)</span>
<a name="ln-1612"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4122</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1613"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">WOVSHADE</span><span class="p">)</span>                             <span class="c">! Venetian blind</span>
<a name="ln-1614"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4114</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1615"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4115</span><span class="p">)</span>
<a name="ln-1616"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4190</span><span class="p">)</span>
<a name="ln-1617"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4125</span><span class="p">)</span>
<a name="ln-1618"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4124</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1619"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">DIFFSHADE</span><span class="p">)</span>
<a name="ln-1620"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4116</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1621"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4117</span><span class="p">)</span>
<a name="ln-1622"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4190</span><span class="p">)</span>
<a name="ln-1623"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4127</span><span class="p">)</span>
<a name="ln-1624"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4126</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1625"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1626"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4110</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1627"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4111</span><span class="p">)</span>
<a name="ln-1628"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4190</span><span class="p">)</span>
<a name="ln-1629"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4121</span><span class="p">)</span>
<a name="ln-1630"></a>          <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">4120</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1631"></a>        <span class="k">end select</span>
<a name="ln-1632"></a><span class="k">        write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1633"></a>    <span class="k">end do</span>
<a name="ln-1634"></a>
<a name="ln-1635"></a><span class="k">    write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">4215</span><span class="p">)</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span>
<a name="ln-1636"></a>
<a name="ln-1637"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1638"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2351</span><span class="p">)</span>
<a name="ln-1639"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1640"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2120</span><span class="p">)</span> <span class="n">ufactor</span>
<a name="ln-1641"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2130</span><span class="p">)</span> <span class="n">shgc</span>
<a name="ln-1642"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1643"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2132</span><span class="p">)</span> <span class="n">sc</span>
<a name="ln-1644"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2170</span><span class="p">)</span> <span class="n">hflux</span>
<a name="ln-1645"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1646"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2131</span><span class="p">)</span> <span class="n">shgct</span>
<a name="ln-1647"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1648"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2140</span><span class="p">)</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hcin</span><span class="o">+</span><span class="n">hrin</span>
<a name="ln-1649"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2150</span><span class="p">)</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hcout</span><span class="o">+</span><span class="n">hrout</span>
<a name="ln-1650"></a>
<a name="ln-1651"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1652"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1653"></a>      <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2155</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span><span class="n">Ra</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">,</span><span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1654"></a>    <span class="k">end do</span>
<a name="ln-1655"></a><span class="k">    write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1656"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2330</span><span class="p">)</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeEmisRatioOut</span>
<a name="ln-1657"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2331</span><span class="p">)</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span>
<a name="ln-1658"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2332</span><span class="p">)</span> <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">HcUnshadedOut</span>
<a name="ln-1659"></a>
<a name="ln-1660"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1661"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">nlayer</span>
<a name="ln-1662"></a>      <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">2160</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1663"></a>    <span class="k">end do</span>
<a name="ln-1664"></a>
<a name="ln-1665"></a><span class="k">    write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1666"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="s1">&#39;(&quot;  Error Tolerance = &quot;, e12.6)&#39;</span><span class="p">)</span> <span class="n">AchievedErrorTolerance</span>
<a name="ln-1667"></a>
<a name="ln-1668"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-1669"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="s1">&#39;(&quot;  Number of Iterations = &quot;, i6)&#39;</span><span class="p">)</span> <span class="n">NumOfIter</span>
<a name="ln-1670"></a>
<a name="ln-1671"></a>    <span class="c">!  write(OutArgumentsFile, *)</span>
<a name="ln-1672"></a>    <span class="c">!  write(OutArgumentsFile, 3333) flux_nonsolar, qeff</span>
<a name="ln-1673"></a>
<a name="ln-1674"></a>    <span class="c">!close(OutArgumentsFile)</span>
<a name="ln-1675"></a>
<a name="ln-1676"></a>
<a name="ln-1677"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1678"></a>    <span class="c">!!!</span>
<a name="ln-1679"></a>    <span class="c">!!! Formats:</span>
<a name="ln-1680"></a>    <span class="c">!!!</span>
<a name="ln-1681"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1682"></a>
<a name="ln-1683"></a>    <span class="mi">2000</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG calculation results - &#39;</span><span class="p">,</span><span class="n">I4</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1684"></a>    <span class="c">!2101  format(&#39; SHGC =   &#39;,F8.6,6x,&#39; SHGC_OLD = &#39;,F8.6,2x,&#39; SC = &#39;,F8.6)</span>
<a name="ln-1685"></a>    <span class="c">!2110  format(&#39; Theta(&#39;,I3,&#39;) = &#39;,F12.6)</span>
<a name="ln-1686"></a>    <span class="c">!2111  format(/&#39;Pane #:&#39;, I3/)</span>
<a name="ln-1687"></a>    <span class="c">!2112  format(&#39;Number of panes: &#39;,I2)</span>
<a name="ln-1688"></a>    <span class="c">!2113  format(&#39;    Thetaslice(&#39;,I3,&#39;,&#39;,I3&#39;) = &#39;,F12.6)</span>
<a name="ln-1689"></a>    <span class="mi">2120</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ufactor  = &#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1690"></a>    <span class="mi">2130</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  SHGC     = &#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1691"></a>    <span class="mi">2131</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  SHGC_OLD = &#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1692"></a>    <span class="mi">2132</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  SC       = &#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1693"></a>
<a name="ln-1694"></a>
<a name="ln-1695"></a>    <span class="mi">2140</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hcin  = &#39;</span><span class="p">,</span><span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;hrin  = &#39;</span><span class="p">,</span><span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;hin  = &#39;</span><span class="p">,</span><span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1696"></a>    <span class="mi">2150</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hcout = &#39;</span><span class="p">,</span><span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;hrout = &#39;</span><span class="p">,</span><span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;hout = &#39;</span><span class="p">,</span><span class="n">F10</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1697"></a>    <span class="mi">2155</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ra(&#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">F15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;        Nu(&#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1698"></a>    <span class="mi">2160</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hcgas(&#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">F15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;      hrgas(&#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1699"></a>
<a name="ln-1700"></a>    <span class="mi">2165</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  rhum  =&#39;</span><span class="p">,</span><span class="n">F15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;        rhout =&#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1701"></a>    <span class="mi">2170</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hflux    = &#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1702"></a>
<a name="ln-1703"></a>
<a name="ln-1704"></a>    <span class="c">!2105  format(&#39;                                            Tamb =&#39;,F11.6)</span>
<a name="ln-1705"></a>    <span class="mi">2105</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;                                            Tamb =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C)&#39;</span><span class="p">)</span>
<a name="ln-1706"></a>    <span class="c">!2110  format(&#39;  ----------------- ------------------   Theta&#39;,I2,&#39; =&#39;,F11.6)</span>
<a name="ln-1707"></a>    <span class="mi">2110</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ----------------- ------------------   Theta&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C)&#39;</span><span class="p">)</span>
<a name="ln-1708"></a>    <span class="mi">2111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  \\\\\\\\\\\\\\\\\ \\\\\\\\\\\\\\\\\\   Theta&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C)&#39;</span><span class="p">)</span>
<a name="ln-1709"></a>    <span class="mi">2112</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  +++++++++++++++++ ++++++++++++++++++   Theta&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C)&#39;</span><span class="p">)</span>
<a name="ln-1710"></a>    <span class="mi">2113</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ooooooooooooooooo oooooooooooooooooo   Theta&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C)&#39;</span><span class="p">)</span>
<a name="ln-1711"></a>    <span class="c">!2115  format(&#39;                                           Troom =&#39;,F11.6)</span>
<a name="ln-1712"></a>    <span class="mi">2115</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;                                           Troom =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; K ( &#39;</span><span class="p">,</span><span class="n">F7</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39; deg C)&#39;</span><span class="p">)</span>
<a name="ln-1713"></a>
<a name="ln-1714"></a>    <span class="mi">2180</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;           qout =&#39;</span><span class="p">,</span>    <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-1715"></a>    <span class="mi">2190</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  |     qpane&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;        |&#39;</span><span class="p">)</span>
<a name="ln-1716"></a>    <span class="c">!2190  format(&#39;  |       qpane&#39;, i2,&#39; =&#39;,  F11.6,&#39;       |         keffc&#39;, i2,&#39; =&#39;,  F11.6)</span>
<a name="ln-1717"></a>    <span class="c">!2195  format(&#39;  |////   qpane&#39;, i2,&#39; =&#39;,  F11.6,&#39;   ////|&#39;)</span>
<a name="ln-1718"></a>    <span class="mi">2195</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  |     qpane&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;        |         keffc&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1719"></a>    <span class="mi">2199</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  |      qlayer&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;       |&#39;</span><span class="p">)</span>
<a name="ln-1720"></a>    <span class="mi">2210</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;            qin =&#39;</span><span class="p">,</span>    <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1721"></a>    <span class="mi">2300</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;            q&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-1722"></a>    <span class="mi">2310</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;        qprim&#39;</span><span class="p">,</span>  <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-1723"></a>    <span class="mi">2320</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;           qv&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="c">!,  &#39;  ( airspeed = &#39;, F12.6, &#39; )&#39;)</span>
<a name="ln-1724"></a>    <span class="mi">2321</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;       airspd&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;    keff&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-1725"></a>    <span class="mi">2322</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;           qc&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span>  <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;      qr&#39;</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-1726"></a>
<a name="ln-1727"></a>    <span class="c">!2323  format(&#39;         keff&#39;, i2,&#39; =&#39;,  F12.5)</span>
<a name="ln-1728"></a>
<a name="ln-1729"></a>    <span class="mi">2330</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ShadeEmisRatioIn  =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;        ShadeEmisRatioOut =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1730"></a>    <span class="mi">2331</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ShadeHcRatioIn    =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;        ShadeHcRatioOut   =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1731"></a>    <span class="mi">2332</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  HcUnshadedIn      =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;        HcUnshadedOut     =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1732"></a>
<a name="ln-1733"></a>    <span class="mi">2340</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)</span>
<a name="ln-1734"></a>    <span class="mi">2350</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Heat Flux Flow and Temperatures of Layer Surfaces:&#39;</span><span class="p">)</span>
<a name="ln-1735"></a>    <span class="mi">2351</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Basic IGU properties:&#39;</span><span class="p">)</span>
<a name="ln-1736"></a>
<a name="ln-1737"></a>    <span class="mi">2220</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  he = &#39;</span><span class="p">,</span><span class="n">F8</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="mi">3</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;hi = &#39;</span><span class="p">,</span><span class="n">F8</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1738"></a>    <span class="mi">2230</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hg&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">E15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;      hr&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">E15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;      hs&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">E15</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1739"></a>
<a name="ln-1740"></a>    <span class="mi">3333</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Flux (non-solar pass): &#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; ; Flux per W7: &#39;</span><span class="p">,</span> <span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1741"></a>
<a name="ln-1742"></a>    <span class="mi">4205</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ebsky =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Gout =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1743"></a>    <span class="mi">4215</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ebroom =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Gin  =&#39;</span><span class="p">,</span><span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1744"></a>
<a name="ln-1745"></a>    <span class="mi">4110</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ef&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rf&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1746"></a>    <span class="mi">4111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ----------------- ------------------&#39;</span><span class="p">)</span>
<a name="ln-1747"></a>    <span class="mi">4112</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ef&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rf&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1748"></a>    <span class="mi">4113</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  \\\\\\\\\\\\\\\\\ \\\\\\\\\\\\\\\\\\&#39;</span><span class="p">)</span>
<a name="ln-1749"></a>    <span class="mi">4114</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ef&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rf&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1750"></a>    <span class="mi">4115</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  +++++++++++++++++ ++++++++++++++++++&#39;</span><span class="p">)</span>
<a name="ln-1751"></a>    <span class="mi">4116</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ef&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rf&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1752"></a>    <span class="mi">4117</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ooooooooooooooooo oooooooooooooooooo&#39;</span><span class="p">)</span>
<a name="ln-1753"></a>
<a name="ln-1754"></a>    <span class="mi">4120</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Eb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1755"></a>    <span class="mi">4121</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ----------------- ------------------&#39;</span><span class="p">)</span>
<a name="ln-1756"></a>    <span class="mi">4122</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Eb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1757"></a>    <span class="mi">4123</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  \\\\\\\\\\\\\\\\\ \\\\\\\\\\\\\\\\\\&#39;</span><span class="p">)</span>
<a name="ln-1758"></a>    <span class="mi">4124</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Eb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1759"></a>    <span class="mi">4125</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  +++++++++++++++++ ++++++++++++++++++&#39;</span><span class="p">)</span>
<a name="ln-1760"></a>    <span class="mi">4126</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Eb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2], Rb&#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span> <span class="n">F11</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; [W/m2]&#39;</span><span class="p">)</span>
<a name="ln-1761"></a>    <span class="mi">4127</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  ooooooooooooooooo oooooooooooooooooo&#39;</span><span class="p">)</span>
<a name="ln-1762"></a>
<a name="ln-1763"></a>    <span class="mi">4190</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  |                     |&#39;</span><span class="p">)</span>
<a name="ln-1764"></a>
<a name="ln-1765"></a>    <span class="mi">4350</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Energy balances on Layer Surfaces:&#39;</span><span class="p">)</span>
<a name="ln-1766"></a>
<a name="ln-1767"></a>
<a name="ln-1768"></a>  <span class="k">end subroutine</span>
<a name="ln-1769"></a>
<a name="ln-1770"></a><span class="k">  subroutine </span><span class="n">WriteOutputEN673</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="n">DBGD</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">nperr</span><span class="p">)</span>
<a name="ln-1771"></a>
<a name="ln-1772"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">OutArgumentsFile</span>
<a name="ln-1773"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-1774"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DBGD</span>
<a name="ln-1775"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span>
<a name="ln-1776"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span>
<a name="ln-1777"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span>
<a name="ln-1778"></a>
<a name="ln-1779"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-1780"></a>    <span class="c">!character*(*), intent (inout) :: ErrorMessage</span>
<a name="ln-1781"></a>
<a name="ln-1782"></a>
<a name="ln-1783"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DATE_TIME</span>
<a name="ln-1784"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span> <span class="o">=</span> <span class="mi">12</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">real_CLOCK</span>
<a name="ln-1785"></a>
<a name="ln-1786"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1787"></a>
<a name="ln-1788"></a>    <span class="c">!open(unit=OutArgumentsFile,  file=TRIM(DBGD)//DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode,  &amp;</span>
<a name="ln-1789"></a>    <span class="c">!      &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1790"></a>    <span class="c">!if (nperr.ne.0)  open(unit=OutArgumentsFile,  file=DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode,  &amp;</span>
<a name="ln-1791"></a>    <span class="c">!      &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1792"></a>    <span class="k">call </span><span class="nb">DATE_AND_TIME</span> <span class="p">(</span><span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">)</span>
<a name="ln-1793"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1794"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1795"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1796"></a>
<a name="ln-1797"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1798"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2351</span><span class="p">)</span>
<a name="ln-1799"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1800"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2120</span><span class="p">)</span> <span class="n">ufactor</span>
<a name="ln-1801"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1802"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2220</span><span class="p">)</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span>
<a name="ln-1803"></a>    <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1804"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1805"></a>      <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2155</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span><span class="n">Ra</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="p">,</span><span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1806"></a>    <span class="k">end do</span>
<a name="ln-1807"></a><span class="k">    write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-1808"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1809"></a>      <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2230</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="n">hg</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">hr</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1810"></a>    <span class="k">end do</span>
<a name="ln-1811"></a>    <span class="c">!close(OutArgumentsFile)</span>
<a name="ln-1812"></a>
<a name="ln-1813"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1814"></a>    <span class="c">!!!</span>
<a name="ln-1815"></a>    <span class="c">!!! Formats:</span>
<a name="ln-1816"></a>    <span class="c">!!!</span>
<a name="ln-1817"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-1818"></a>
<a name="ln-1819"></a>    <span class="mi">2000</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG calculation results - &#39;</span><span class="p">,</span><span class="n">I4</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1820"></a>    <span class="mi">2351</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Basic IGU properties:&#39;</span><span class="p">)</span>
<a name="ln-1821"></a>    <span class="mi">2120</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ufactor  = &#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1822"></a>    <span class="mi">2220</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  he = &#39;</span><span class="p">,</span><span class="n">F8</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="mi">3</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;hi = &#39;</span><span class="p">,</span><span class="n">F8</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1823"></a>    <span class="mi">2155</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  Ra(&#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">F15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;        Nu(&#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1824"></a>    <span class="mi">2230</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;  hg&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">E15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;      hr&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">E15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;      hs&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; =&#39;</span><span class="p">,</span><span class="n">E15</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1825"></a>
<a name="ln-1826"></a>  <span class="k">end subroutine</span>
<a name="ln-1827"></a>
<a name="ln-1828"></a><span class="k">  subroutine </span><span class="n">WriteTARCOGInputFile</span><span class="p">(</span> <span class="n">VerNum</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1829"></a>                                  <span class="p">&amp;</span>  <span class="n">wso</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1830"></a>                                  <span class="p">&amp;</span>  <span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span> <span class="p">,</span><span class="n">ibc</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1831"></a>                                  <span class="p">&amp;</span>  <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1832"></a>                                  <span class="p">&amp;</span>  <span class="n">nlayer</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1833"></a>                                  <span class="p">&amp;</span>  <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1834"></a>                                  <span class="p">&amp;</span>  <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1835"></a>                                  <span class="p">&amp;</span>  <span class="n">nslice</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">GapDef</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1836"></a>                                  <span class="p">&amp;</span>  <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">gama</span><span class="p">)</span>
<a name="ln-1837"></a>
<a name="ln-1838"></a>    <span class="k">use </span><span class="n">TARCOGGassesParams</span>
<a name="ln-1839"></a>
<a name="ln-1840"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iwd</span>
<a name="ln-1841"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">isky</span><span class="p">,</span> <span class="n">CalcDeflection</span>
<a name="ln-1842"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span>
<a name="ln-1843"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span>
<a name="ln-1844"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span>
<a name="ln-1845"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span>
<a name="ln-1846"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-1847"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">width</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span>
<a name="ln-1848"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span><span class="n">trmin</span>
<a name="ln-1849"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span>
<a name="ln-1850"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span>
<a name="ln-1851"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">GapDef</span>
<a name="ln-1852"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span>
<a name="ln-1853"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-1854"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-1855"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-1856"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-1857"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span>
<a name="ln-1858"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgvis</span>
<a name="ln-1859"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcp</span>
<a name="ln-1860"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-1861"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gama</span>
<a name="ln-1862"></a>
<a name="ln-1863"></a>    <span class="c">!Support Pillars</span>
<a name="ln-1864"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPillar</span>     <span class="c">! Shows whether or not gap have support pillar</span>
<a name="ln-1865"></a>                                                                <span class="c">!   0 - does not have support pillar</span>
<a name="ln-1866"></a>                                                                <span class="c">!   1 - have support pillar</span>
<a name="ln-1867"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span>   <span class="c">! Pillar spacing for each gap (used in case there is support pillar)</span>
<a name="ln-1868"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarRadius</span>    <span class="c">! Pillar radius for each gap (used in case there is support pillar)</span>
<a name="ln-1869"></a>
<a name="ln-1870"></a>
<a name="ln-1871"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-1872"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-1873"></a>
<a name="ln-1874"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nslice</span>
<a name="ln-1875"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span>
<a name="ln-1876"></a>
<a name="ln-1877"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-1878"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">NumOfProvGasses</span>
<a name="ln-1879"></a>
<a name="ln-1880"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">VerNum</span>
<a name="ln-1881"></a>
<a name="ln-1882"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DATE_TIME</span>
<a name="ln-1883"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">real_CLOCK</span>
<a name="ln-1884"></a>
<a name="ln-1885"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-1886"></a>
<a name="ln-1887"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-1888"></a>
<a name="ln-1889"></a>      <span class="c">!open(unit=WINCogFile,  file=TRIM(DBGD)//TRIM(WinCogFileName),  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1890"></a>      <span class="c">!       &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1891"></a>      <span class="c">!if (nperr.ne.0) open(unit=WINCogFile,  file=TRIM(WinCogFileName),  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1892"></a>      <span class="c">!                      &amp; form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1893"></a>    <span class="c">!else</span>
<a name="ln-1894"></a>    <span class="c">!  open(unit=WINCogFile,  file=TRIM(DBGD)//TRIM(SHGCFileName),  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1895"></a>    <span class="c">!         &amp; form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1896"></a>    <span class="c">!  if (nperr.ne.0) open(unit=WINCogFile,  file=TRIM(SHGCFileName),  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-1897"></a>    <span class="c">!                        &amp; form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-1898"></a>    <span class="c">!end if</span>
<a name="ln-1899"></a>
<a name="ln-1900"></a>  <span class="c">!bi...Create WINCOG input file using Tarcog&#39;s input arguments:</span>
<a name="ln-1901"></a>
<a name="ln-1902"></a>  <span class="c">!bi...Write the header:</span>
<a name="ln-1903"></a>
<a name="ln-1904"></a>    <span class="k">call </span><span class="nb">DATE_AND_TIME</span> <span class="p">(</span><span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">real_CLOCK</span> <span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">)</span>
<a name="ln-1905"></a>
<a name="ln-1906"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">112</span><span class="p">)</span>
<a name="ln-1907"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">111</span><span class="p">)</span>
<a name="ln-1908"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">DATE_TIME</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1909"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">10001</span><span class="p">)</span> <span class="n">VerNum</span>   <span class="c">!, VerDat</span>
<a name="ln-1910"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">111</span><span class="p">)</span>
<a name="ln-1911"></a>
<a name="ln-1912"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">winID</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1913"></a><span class="k">      write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1002</span><span class="p">)</span> <span class="n">winID</span>
<a name="ln-1914"></a>    <span class="k">else</span>
<a name="ln-1915"></a><span class="k">      write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1003</span><span class="p">)</span> <span class="n">winID</span>
<a name="ln-1916"></a>    <span class="k">end if</span>
<a name="ln-1917"></a><span class="k">    if</span> <span class="p">(</span><span class="n">iguID</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1918"></a><span class="k">      write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1006</span><span class="p">)</span> <span class="n">iguID</span>
<a name="ln-1919"></a>    <span class="k">else</span>
<a name="ln-1920"></a><span class="k">      write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1007</span><span class="p">)</span> <span class="n">iguID</span>
<a name="ln-1921"></a>    <span class="k">end if</span>
<a name="ln-1922"></a>
<a name="ln-1923"></a><span class="k">    write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1008</span><span class="p">)</span> <span class="n">nlayer</span>
<a name="ln-1924"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">111</span><span class="p">)</span>
<a name="ln-1925"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">112</span><span class="p">)</span>
<a name="ln-1926"></a>
<a name="ln-1927"></a>  <span class="c">!bi...Write main body:</span>
<a name="ln-1928"></a>
<a name="ln-1929"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1930"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<a name="ln-1931"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1932"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">210</span><span class="p">)</span>
<a name="ln-1933"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1010</span><span class="p">)</span> <span class="n">nlayer</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span>
<a name="ln-1934"></a>
<a name="ln-1935"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1936"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>
<a name="ln-1937"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1938"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">310</span><span class="p">)</span>
<a name="ln-1939"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1020</span><span class="p">)</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span>
<a name="ln-1940"></a>
<a name="ln-1941"></a>    <span class="c">!if (mgas.eq.0) then</span>
<a name="ln-1942"></a>      <span class="n">NumOfProvGasses</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1943"></a>      <span class="k">do while</span> <span class="p">(</span><span class="n">xwght</span><span class="p">(</span><span class="n">NumOfProvGasses</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-1944"></a>        <span class="n">NumOfProvGasses</span> <span class="o">=</span> <span class="n">NumOfProvGasses</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1945"></a>      <span class="k">end do</span>
<a name="ln-1946"></a><span class="k">      write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1947"></a>      <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<a name="ln-1948"></a>      <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1949"></a>      <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2011</span><span class="p">)</span>
<a name="ln-1950"></a>      <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2010</span><span class="p">)</span> <span class="n">NumOfProvGasses</span>
<a name="ln-1951"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumOfProvGasses</span>
<a name="ln-1952"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2021</span><span class="p">)</span>
<a name="ln-1953"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2020</span><span class="p">)</span> <span class="n">xwght</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1954"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2031</span><span class="p">)</span>
<a name="ln-1955"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2030</span><span class="p">)</span> <span class="p">(</span><span class="n">xgcon</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1956"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2032</span><span class="p">)</span>
<a name="ln-1957"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2030</span><span class="p">)</span> <span class="p">(</span><span class="n">xgvis</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1958"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2033</span><span class="p">)</span>
<a name="ln-1959"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2030</span><span class="p">)</span> <span class="p">(</span><span class="n">xgcp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1960"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2034</span><span class="p">)</span>
<a name="ln-1961"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">2020</span><span class="p">)</span> <span class="n">gama</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1962"></a>      <span class="k">end do</span> <span class="c">!i = 1, NumProvGasses</span>
<a name="ln-1963"></a>    <span class="c">!end if</span>
<a name="ln-1964"></a>
<a name="ln-1965"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1966"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">400</span><span class="p">)</span>
<a name="ln-1967"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1968"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCOGFile</span><span class="p">,</span><span class="mi">410</span><span class="p">)</span>
<a name="ln-1969"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1030</span><span class="p">)</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span>
<a name="ln-1970"></a>
<a name="ln-1971"></a>    <span class="c">!write(WINCogFile,500)</span>
<a name="ln-1972"></a>    <span class="c">!write(WINCogFile,*) SlatLength, SlatSpacing, SlatAngle, &amp;</span>
<a name="ln-1973"></a>    <span class="c">!    CurvatureRadius, SubdivisionNumber, Rf, Rb, T, Ef_IR, Eb_IR, T_IR, &amp;</span>
<a name="ln-1974"></a>    <span class="c">!    NumThetas, SOLMethod, FIRMethod, SOLhemCalc, SOLdifCalc</span>
<a name="ln-1975"></a>    <span class="c">!write(WINCogFile,*) &#39;    0.016, 0.012, 45, 0.0, 5, 0, 0.70, 0.40, 0.00, 0.90, 0.90, 0.00, 1, 1, 1, 1&#39;</span>
<a name="ln-1976"></a>    <span class="c">!write(WINCogFile,117)</span>
<a name="ln-1977"></a>    <span class="c">!write(WINCogFile,*) &#39;    0.003, 0.01, 0.8, 0.6, 1, 1, 1&#39;</span>
<a name="ln-1978"></a>    <span class="c">!write(WINCogFile,118)</span>
<a name="ln-1979"></a>    <span class="c">!write(WINCogFile,*) &#39;    1&#39;</span>
<a name="ln-1980"></a>    <span class="c">!write(WINCogFile,*) &#39;    0&#39;</span>
<a name="ln-1981"></a>    <span class="c">!write(WINCogFile,*) &#39;    1&#39;</span>
<a name="ln-1982"></a>    <span class="c">!write(WINCogFile,*) &#39;    0&#39;</span>
<a name="ln-1983"></a>
<a name="ln-1984"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1985"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">600</span><span class="p">)</span>
<a name="ln-1986"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1987"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">610</span><span class="p">)</span>
<a name="ln-1988"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1040</span><span class="p">)</span> <span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">hout</span><span class="p">,</span> <span class="n">presure</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">vvent</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">tvent</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1989"></a>
<a name="ln-1990"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">700</span><span class="p">)</span>
<a name="ln-1991"></a>
<a name="ln-1992"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-1993"></a>      <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-1994"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">SPECULAR</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1995"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1060</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-1996"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1997"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1061</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-1998"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">WOVSHADE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1999"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1062</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2000"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">DIFFSHADE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2001"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1063</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2002"></a>      <span class="k">else</span>
<a name="ln-2003"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1064</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2004"></a>      <span class="k">end if</span>
<a name="ln-2005"></a><span class="k">      write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-2006"></a>
<a name="ln-2007"></a>      <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1050</span><span class="p">)</span>
<a name="ln-2008"></a>      <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1051</span><span class="p">)</span> <span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">asol</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="n">tir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">YoungsMod</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-2009"></a>                                <span class="n">PoissonsRat</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">nslice</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2010"></a>
<a name="ln-2011"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-2012"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1052</span><span class="p">)</span>
<a name="ln-2013"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1053</span><span class="p">)</span> <span class="n">Atop</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Abot</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Al</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Ar</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Ah</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2014"></a>      <span class="k">end if</span>
<a name="ln-2015"></a>
<a name="ln-2016"></a><span class="k">      if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2017"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1054</span><span class="p">)</span>
<a name="ln-2018"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1055</span><span class="p">)</span> <span class="n">SlatThick</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">SlatWidth</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">SlatAngle</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">SlatCond</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">SlatSpacing</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">SlatCurve</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2019"></a>      <span class="k">end if</span>
<a name="ln-2020"></a>
<a name="ln-2021"></a><span class="k">      if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2022"></a><span class="k">        write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-2023"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1049</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2024"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-2025"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1048</span><span class="p">)</span>
<a name="ln-2026"></a>        <span class="c">!build dynamic formating for various gas line possibilities</span>
<a name="ln-2027"></a>        <span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(&quot;    &quot;, F24.12, &quot;, &quot;, F24.12, &quot;, &quot;, f24.12, &quot;, &quot;, i1, &quot;, &quot;&#39;</span>
<a name="ln-2028"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2029"></a>          <span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;, i1, &quot;, &quot;&#39;</span>
<a name="ln-2030"></a>        <span class="k">end do</span> <span class="c">!j = 1, nmix(i+1)</span>
<a name="ln-2031"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2032"></a>          <span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;, f24.12, &quot;, &quot;&#39;</span>
<a name="ln-2033"></a>        <span class="k">end do</span> <span class="c">!j = 1, nmix(i+1)</span>
<a name="ln-2034"></a>        <span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;, f24.12, &quot;, &quot;, f24.12, &quot;, &quot;, i1)&#39;</span>
<a name="ln-2035"></a>        <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">GapDef</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="p">&amp;</span>
<a name="ln-2036"></a>          <span class="p">(</span><span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">tvent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">SupportPillar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2037"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">SupportPillar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">YES_SupportPillar</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2038"></a><span class="k">          write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1034</span><span class="p">)</span>
<a name="ln-2039"></a>          <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1035</span><span class="p">)</span> <span class="n">PillarSpacing</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">PillarRadius</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2040"></a>        <span class="k">end if</span> <span class="c">!if (SupportPillar(i).eq.YES_SupportPillar) then</span>
<a name="ln-2041"></a>      <span class="k">end if</span>
<a name="ln-2042"></a><span class="k">    end do</span>  <span class="c">!  i - layers</span>
<a name="ln-2043"></a>
<a name="ln-2044"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-2045"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">800</span><span class="p">)</span>
<a name="ln-2046"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-2047"></a>
<a name="ln-2048"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">810</span><span class="p">)</span>
<a name="ln-2049"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span> <span class="mi">1040</span><span class="p">)</span> <span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">hin</span><span class="p">,</span> <span class="n">presure</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">vvent</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">tvent</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2050"></a>
<a name="ln-2051"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-2052"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span>
<a name="ln-2053"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="mi">113</span><span class="p">)</span>
<a name="ln-2054"></a>    <span class="c">!  write(WINCogFile, 1198)</span>
<a name="ln-2055"></a>    <span class="k">write</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-2056"></a>
<a name="ln-2057"></a>    <span class="c">!close(WINCogFile)</span>
<a name="ln-2058"></a>
<a name="ln-2059"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-2060"></a>    <span class="c">!!!</span>
<a name="ln-2061"></a>    <span class="c">!!! Formats:</span>
<a name="ln-2062"></a>    <span class="c">!!!</span>
<a name="ln-2063"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-2064"></a>
<a name="ln-2065"></a>    <span class="mi">111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<a name="ln-2066"></a>    <span class="mi">112</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *&#39;</span><span class="p">)</span>
<a name="ln-2067"></a>    <span class="mi">113</span> <span class="k">format</span><span class="p">(</span><span class="s1">&#39;*------------------------------------------------------------&#39;</span><span class="p">)</span>
<a name="ln-2068"></a>    <span class="mi">200</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* General options:&#39;</span><span class="p">)</span>
<a name="ln-2069"></a>    <span class="mi">210</span> <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;nlayer, debug, standard, ThermalMod, CalcDeflection, SDScalar, VacuumPressure, VacuumMaxGapThickness&gt;&#39;</span><span class="p">)</span>
<a name="ln-2070"></a>    <span class="mi">300</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Environmental settings:&#39;</span><span class="p">)</span>
<a name="ln-2071"></a>    <span class="mi">310</span> <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;tout, tind, wso, iwd, wsi, dir, outir, isky, tsky, esky, fclr, trmin, Pa, Pini, Tini&gt;&#39;</span><span class="p">)</span>
<a name="ln-2072"></a>    <span class="mi">400</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Overall IGU properties:&#39;</span><span class="p">)</span>
<a name="ln-2073"></a>    <span class="mi">410</span> <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;totsol, tilt, height, heightt, width&gt;&#39;</span><span class="p">)</span>
<a name="ln-2074"></a>    <span class="mi">600</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Outdoor environment:&#39;</span><span class="p">)</span>
<a name="ln-2075"></a>    <span class="mi">610</span> <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;ibc(1), hout, presure(1), 1, 1, 1.0, vvent(1), tvent(1)&gt;&#39;</span><span class="p">)</span>
<a name="ln-2076"></a>    <span class="mi">700</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* IGU definition:&#39;</span><span class="p">)</span>
<a name="ln-2077"></a>    <span class="mi">800</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Indoor environment:&#39;</span><span class="p">)</span>
<a name="ln-2078"></a>    <span class="mi">810</span> <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;ibc(2), hin, presure(nlayer+1), 1, 1, 1.0, vvent(nlayer+1), tvent(nlayer+1)&gt;&#39;</span><span class="p">)</span>
<a name="ln-2079"></a>    <span class="mi">900</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* End file&#39;</span><span class="p">)</span>
<a name="ln-2080"></a>
<a name="ln-2081"></a>    <span class="mi">10001</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* created by TARCOG v. &#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span> <span class="c">! , &#39;compiled &#39;, A)</span>
<a name="ln-2082"></a>    <span class="mi">1001</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* TARCOG debug output for WinCOG, &#39;</span><span class="p">,</span><span class="n">I4</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2083"></a>    <span class="mi">1002</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;*     WindowID:   &#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39;  - Not specified&#39;</span><span class="p">)</span>
<a name="ln-2084"></a>    <span class="mi">1003</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;*     WindowID:   &#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-2085"></a>    <span class="mi">1006</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;*     IGUID:      &#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39;  - Not specified&#39;</span><span class="p">)</span>
<a name="ln-2086"></a>    <span class="mi">1007</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;*     IGUID:      &#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-2087"></a>    <span class="mi">1008</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;*     Num Layers: &#39;</span><span class="p">,</span> <span class="n">I8</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-2088"></a>
<a name="ln-2089"></a>    <span class="c">!  General:</span>
<a name="ln-2090"></a>    <span class="mi">1010</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2091"></a>    <span class="mi">1020</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2092"></a>                        <span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2093"></a>    <span class="mi">1030</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2094"></a>    <span class="mi">1031</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2095"></a>                        <span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">)</span>
<a name="ln-2096"></a>    <span class="mi">1034</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;PillarSpacing(i), PillarRadius(i)&#39;</span><span class="p">)</span>
<a name="ln-2097"></a>    <span class="mi">1035</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2098"></a>
<a name="ln-2099"></a>    <span class="c">!  Gaps/environment:</span>
<a name="ln-2100"></a>    <span class="mi">1040</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2101"></a>    <span class="mi">1048</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;gap(i), GapDef(i), presure(i+1), nmix(i+1), (iprop(i+1, j), j=1,nmix(i+1)), (frct(i+1, j), &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2102"></a>                  <span class="s1">&#39;j=1,nmix(i+1)), vvent(i), tvent(i), SupportPillar(i)&gt;&#39;</span><span class="p">)</span>
<a name="ln-2103"></a>    <span class="mi">1049</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Gap &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<a name="ln-2104"></a>    <span class="mi">1041</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2105"></a>    <span class="mi">1042</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2106"></a>    <span class="mi">1043</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2107"></a>                        <span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2108"></a>
<a name="ln-2109"></a>    <span class="c">!  Layers:</span>
<a name="ln-2110"></a>    <span class="mi">1050</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;scon(i), asol(i), thick(i), emis(2*i-1), emis(2*i), tir(2*i-1), YoungsMod(i),&#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-2111"></a>                  <span class="s1">&#39; PoissonsRat(i), LayerType(i), nslice(i)&gt;&#39;</span><span class="p">)</span>
<a name="ln-2112"></a>    <span class="mi">1051</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">)</span>
<a name="ln-2113"></a>    <span class="mi">1052</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;Atop(i), Abot(i), Al(i), Ar(i), Ah(i)&gt;&#39;</span><span class="p">)</span>
<a name="ln-2114"></a>    <span class="mi">1053</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2115"></a>    <span class="mi">1054</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;SlatThick(i), SlatWidth(i), SlatAngle(i), SlatCond(i), SlatSpacing(i), SlatCurve(i)&gt;&#39;</span><span class="p">)</span>
<a name="ln-2116"></a>    <span class="mi">1055</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span>
<a name="ln-2117"></a>
<a name="ln-2118"></a>    <span class="mi">1060</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Layer &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39; - specular-glass:&#39;</span><span class="p">)</span>
<a name="ln-2119"></a>    <span class="mi">1061</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Layer &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39; - venetian blind:&#39;</span><span class="p">)</span>
<a name="ln-2120"></a>    <span class="mi">1062</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Layer &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39; - woven shade:&#39;</span><span class="p">)</span>
<a name="ln-2121"></a>    <span class="mi">1063</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Layer &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39; - diffuse shade:&#39;</span><span class="p">)</span>
<a name="ln-2122"></a>    <span class="mi">1064</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Layer &#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39; - ???:&#39;</span><span class="p">)</span>
<a name="ln-2123"></a>
<a name="ln-2124"></a>    <span class="mi">2000</span> <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* Gas coefficients information&#39;</span><span class="p">)</span>
<a name="ln-2125"></a>    <span class="mi">2010</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">)</span>
<a name="ln-2126"></a>    <span class="mi">2011</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;NumberOfGasses&gt;&#39;</span><span class="p">)</span>
<a name="ln-2127"></a>    <span class="c">!2020  format(&#39;    &#39;,F12.6)</span>
<a name="ln-2128"></a>    <span class="mi">2020</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">ES12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2129"></a>    <span class="mi">2021</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;MolecularWeight&gt;&#39;</span><span class="p">)</span>
<a name="ln-2130"></a>    <span class="mi">2030</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;    &#39;</span><span class="p">,</span><span class="n">ES12</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">ES12</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;, &#39;</span><span class="p">,</span><span class="n">ES12</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2131"></a>    <span class="mi">2031</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;gconA, gconB, gconC&gt;&#39;</span><span class="p">)</span>
<a name="ln-2132"></a>    <span class="mi">2032</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;gvisA, gvisB, gvisC&gt;&#39;</span><span class="p">)</span>
<a name="ln-2133"></a>    <span class="mi">2033</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;gcpA, gcpB, gcpC&gt;&#39;</span><span class="p">)</span>
<a name="ln-2134"></a>    <span class="mi">2034</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;* &lt;Gamma&gt;&#39;</span><span class="p">)</span>
<a name="ln-2135"></a>
<a name="ln-2136"></a>
<a name="ln-2137"></a>    <span class="mi">1198</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39; *************************************************&#39;</span><span class="p">)</span>
<a name="ln-2138"></a>
<a name="ln-2139"></a>  <span class="k">end subroutine</span>
<a name="ln-2140"></a>
<a name="ln-2141"></a><span class="k">  subroutine </span><span class="n">FinishDebugOutputFiles</span><span class="p">(</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2142"></a>
<a name="ln-2143"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-2144"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ferr</span>
<a name="ln-2145"></a>
<a name="ln-2146"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">WriteDebugOutput</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2147"></a>      <span class="c">!open(unit=OutArgumentsFile,  file=TRIM(DBGD)//DebugOutputFileName,  status=&#39;unknown&#39;, access=&#39;append&#39;,  &amp;</span>
<a name="ln-2148"></a>      <span class="c">!      &amp;  form=&#39;formatted&#39;, iostat=ferr)</span>
<a name="ln-2149"></a>      <span class="c">!if (ferr.ne.0) open(unit=OutArgumentsFile,  file=DebugOutputFileName,  status=&#39;unknown&#39;, access=&#39;append&#39;,  &amp;</span>
<a name="ln-2150"></a>      <span class="c">!      &amp;  form=&#39;formatted&#39;, iostat=ferr)</span>
<a name="ln-2151"></a>
<a name="ln-2152"></a>      <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-2153"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2154"></a><span class="k">        write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2362</span><span class="p">)</span> <span class="n">nperr</span>
<a name="ln-2155"></a>      <span class="k">else if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2156"></a><span class="k">          write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2361</span><span class="p">)</span> <span class="n">nperr</span>
<a name="ln-2157"></a>        <span class="k">else</span>
<a name="ln-2158"></a><span class="k">          write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="mi">2360</span><span class="p">)</span> <span class="n">nperr</span>
<a name="ln-2159"></a>      <span class="k">end if</span>
<a name="ln-2160"></a>
<a name="ln-2161"></a><span class="k">      write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<a name="ln-2162"></a>      <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">1199</span><span class="p">)</span>
<a name="ln-2163"></a>      <span class="k">write</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span><span class="mi">1199</span><span class="p">)</span>
<a name="ln-2164"></a>
<a name="ln-2165"></a>      <span class="c">!close(OutArgumentsFile)</span>
<a name="ln-2166"></a>    <span class="k">end if</span> <span class="c">! debug</span>
<a name="ln-2167"></a>
<a name="ln-2168"></a>    <span class="c">! Close debug files</span>
<a name="ln-2169"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">InArgumentsFile</span> <span class="o">/=</span> <span class="n">statusClosed</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2170"></a><span class="k">      close</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">)</span>
<a name="ln-2171"></a>      <span class="n">InArgumentsFile</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-2172"></a>      <span class="n">OutArgumentsFile</span> <span class="o">=</span> <span class="n">statusClosed</span> <span class="c">! This is same is InArgumentsFile</span>
<a name="ln-2173"></a>    <span class="k">end if</span>
<a name="ln-2174"></a>
<a name="ln-2175"></a><span class="k">    if</span> <span class="p">(</span><span class="n">WINCOGFile</span> <span class="o">/=</span> <span class="n">statusClosed</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2176"></a><span class="k">      close</span><span class="p">(</span><span class="n">WINCOGFile</span><span class="p">)</span>
<a name="ln-2177"></a>      <span class="n">WINCOGFile</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-2178"></a>    <span class="k">end if</span>
<a name="ln-2179"></a>
<a name="ln-2180"></a><span class="k">    if</span> <span class="p">(</span><span class="n">IterationCSVFileNumber</span> <span class="o">/=</span> <span class="n">statusClosed</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2181"></a><span class="k">      close</span><span class="p">(</span><span class="n">IterationCSVFileNumber</span><span class="p">)</span>
<a name="ln-2182"></a>      <span class="n">IterationCSVFileNumber</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-2183"></a>    <span class="k">end if</span>
<a name="ln-2184"></a>
<a name="ln-2185"></a><span class="k">    if</span> <span class="p">(</span><span class="n">TarcogIterationsFileNumber</span> <span class="o">/=</span> <span class="n">statusClosed</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2186"></a><span class="k">      close</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">)</span>
<a name="ln-2187"></a>      <span class="n">TarcogIterationsFileNumber</span> <span class="o">=</span> <span class="n">statusClosed</span>
<a name="ln-2188"></a>    <span class="k">end if</span>
<a name="ln-2189"></a>
<a name="ln-2190"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-2191"></a>    <span class="c">!!!</span>
<a name="ln-2192"></a>    <span class="c">!!! Formats:</span>
<a name="ln-2193"></a>    <span class="c">!!!</span>
<a name="ln-2194"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-2195"></a>
<a name="ln-2196"></a>    <span class="mi">2360</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG status: &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; - Normal termination.&#39;</span><span class="p">)</span>
<a name="ln-2197"></a>    <span class="mi">2361</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG status: &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; - Warning!&#39;</span><span class="p">)</span>
<a name="ln-2198"></a>    <span class="mi">2362</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;TARCOG status: &#39;</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="s1">&#39; - Error!&#39;</span><span class="p">)</span>
<a name="ln-2199"></a>
<a name="ln-2200"></a>    <span class="mi">1199</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;#####  #####  #####  #####  #####  #####  #####  #####  #####  #####  #####&#39;</span><span class="p">)</span>
<a name="ln-2201"></a>
<a name="ln-2202"></a>  <span class="k">end subroutine </span><span class="n">FinishDebugOutputFiles</span>
<a name="ln-2203"></a>
<a name="ln-2204"></a>  <span class="k">subroutine </span><span class="n">PrepDebugFilesAndVariables</span><span class="p">(</span><span class="n">Debug_dir</span><span class="p">,</span> <span class="n">Debug_file</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="n">win_ID</span><span class="p">,</span> <span class="n">igu_ID</span><span class="p">,</span> <span class="n">nperr</span><span class="p">)</span>
<a name="ln-2205"></a>
<a name="ln-2206"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_mode</span>
<a name="ln-2207"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_dir</span>
<a name="ln-2208"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_file</span>
<a name="ln-2209"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">win_ID</span><span class="p">,</span> <span class="n">igu_ID</span>
<a name="ln-2210"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-2211"></a>
<a name="ln-2212"></a>    <span class="kt">character</span> <span class="kd">::</span> <span class="n">LastPathChar</span>
<a name="ln-2213"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">LastPathCharIndex</span>
<a name="ln-2214"></a>
<a name="ln-2215"></a>    <span class="n">DBGD</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">Debug_dir</span><span class="p">)</span>
<a name="ln-2216"></a>
<a name="ln-2217"></a>    <span class="n">LastPathCharIndex</span> <span class="o">=</span> <span class="nb">LEN_TRIM</span><span class="p">(</span><span class="n">Debug_dir</span><span class="p">)</span>
<a name="ln-2218"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">LastPathCharIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2219"></a><span class="k">      </span><span class="n">LastPathChar</span> <span class="o">=</span> <span class="n">Debug_Dir</span><span class="p">(</span><span class="n">LastPathCharIndex</span><span class="p">:</span><span class="n">LastPathCharIndex</span><span class="p">)</span>
<a name="ln-2220"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">LastPathChar</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="n">DBGD</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">Debug_dir</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;/&#39;</span>
<a name="ln-2221"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">LastPathChar</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LastPathCharIndex</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="n">DBGD</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a name="ln-2222"></a>    <span class="k">end if</span>
<a name="ln-2223"></a>
<a name="ln-2224"></a>    <span class="c">!DebugDir = Debug_dir</span>
<a name="ln-2225"></a>    <span class="n">DebugMode</span> <span class="o">=</span> <span class="n">Debug_mode</span>
<a name="ln-2226"></a>    <span class="n">winID</span> <span class="o">=</span> <span class="n">win_ID</span>
<a name="ln-2227"></a>    <span class="n">iguID</span> <span class="o">=</span> <span class="n">igu_ID</span>
<a name="ln-2228"></a>
<a name="ln-2229"></a>    <span class="c">!setup file names if file name is provided, otherwise keep default</span>
<a name="ln-2230"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">Trim</span><span class="p">(</span><span class="n">Debug_file</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2231"></a><span class="k">      </span><span class="n">WinCogFileName</span> <span class="o">=</span> <span class="nb">Trim</span><span class="p">(</span><span class="n">Debug_file</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.w7&#39;</span>
<a name="ln-2232"></a>      <span class="c">!SHGCFileName = Trim(Debug_file)//&#39;_SHGC.w7&#39;</span>
<a name="ln-2233"></a>      <span class="n">DebugOutputFileName</span> <span class="o">=</span> <span class="nb">Trim</span><span class="p">(</span><span class="n">Debug_file</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.dbg&#39;</span>
<a name="ln-2234"></a>    <span class="k">end if</span>
<a name="ln-2235"></a>
<a name="ln-2236"></a>    <span class="c">!bi...Write debug output files - if debug flag &gt; 0:</span>
<a name="ln-2237"></a>
<a name="ln-2238"></a>    <span class="n">WriteDebugOutput</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2239"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">Debug_mode</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">minDebugFlag</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">Debug_mode</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">maxDebugFlag</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2240"></a>
<a name="ln-2241"></a><span class="k">      </span><span class="n">WriteDebugOutput</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2242"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">Debug_mode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">appendResultsToFile</span><span class="p">)</span> <span class="n">FileMode</span> <span class="o">=</span> <span class="s1">&#39;APPEND&#39;</span>
<a name="ln-2243"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">Debug_mode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">resultsToNewFile</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">Debug_mode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">saveIntermediateResults</span><span class="p">))</span> <span class="n">FileMode</span> <span class="o">=</span> <span class="s1">&#39;SEQUENTIAL&#39;</span>
<a name="ln-2244"></a>
<a name="ln-2245"></a>      <span class="n">InArgumentsFile</span> <span class="o">=</span> <span class="n">GetNewUnitNumber</span><span class="p">()</span>
<a name="ln-2246"></a><span class="c">!      open(newunit=InArgumentsFile,  file=TRIM(DBGD)//DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode,  &amp;</span>
<a name="ln-2247"></a><span class="c">!              &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2248"></a>      <span class="k">open</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">DBGD</span><span class="p">)</span><span class="o">//</span><span class="n">DebugOutputFileName</span><span class="p">,</span>  <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="n">FileMode</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2249"></a>              <span class="p">&amp;</span>  <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2250"></a>
<a name="ln-2251"></a><span class="c">!      if (nperr.ne.0)  open(newunit=InArgumentsFile,  file=DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode,  &amp;</span>
<a name="ln-2252"></a><span class="c">!              &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2253"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nperr</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>  <span class="k">open</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="n">DebugOutputFileName</span><span class="p">,</span>  <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="n">FileMode</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2254"></a>              <span class="p">&amp;</span>  <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2255"></a>
<a name="ln-2256"></a>      <span class="n">OutArgumentsFile</span> <span class="o">=</span> <span class="n">InArgumentsFile</span>
<a name="ln-2257"></a>
<a name="ln-2258"></a>      <span class="n">WINCOGFile</span> <span class="o">=</span> <span class="n">GetNewUnitNumber</span><span class="p">()</span>
<a name="ln-2259"></a><span class="c">!      open(newunit=WINCogFile,  file=TRIM(DBGD)//TRIM(WinCogFileName),  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-2260"></a><span class="c">!             &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2261"></a>      <span class="k">open</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">DBGD</span><span class="p">)</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">WinCogFileName</span><span class="p">),</span>  <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="n">FileMode</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2262"></a>             <span class="p">&amp;</span>  <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2263"></a><span class="c">!      if (nperr.ne.0) open(newunit=WINCogFile,  file=TRIM(WinCogFileName),  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-2264"></a><span class="c">!                            &amp; form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2265"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nperr</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">open</span><span class="p">(</span><span class="n">WINCogFile</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">WinCogFileName</span><span class="p">),</span>  <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="n">FileMode</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2266"></a>                            <span class="p">&amp;</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2267"></a>
<a name="ln-2268"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">Debug_mode</span> <span class="o">==</span> <span class="n">saveIntermediateResults</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2269"></a><span class="k">        </span><span class="n">TarcogIterationsFileNumber</span> <span class="o">=</span> <span class="n">GetNewUnitNumber</span><span class="p">()</span>
<a name="ln-2270"></a><span class="c">!        open(newunit=TarcogIterationsFileNumber,  file=TRIM(DBGD)//&#39;TarcogIterations.dbg&#39;,  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-2271"></a><span class="c">!              &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2272"></a>        <span class="k">open</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">DBGD</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;TarcogIterations.dbg&#39;</span><span class="p">,</span>  <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;APPEND&#39;</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2273"></a>              <span class="p">&amp;</span>  <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2274"></a>
<a name="ln-2275"></a><span class="c">!        if (nperr.ne.0)  open(newunit=TarcogIterationsFileNumber, file=&#39;TarcogIterations.dbg&#39;,status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-2276"></a><span class="c">!              &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2277"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">nperr</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>  <span class="k">open</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;TarcogIterations.dbg&#39;</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;APPEND&#39;</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2278"></a>              <span class="p">&amp;</span>  <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2279"></a>
<a name="ln-2280"></a>        <span class="n">IterationCSVFileNumber</span> <span class="o">=</span> <span class="n">GetNewUnitNumber</span><span class="p">()</span>
<a name="ln-2281"></a><span class="c">!        open(newunit=IterationCSVFileNumber,  file=TRIM(DBGD)//Trim(IterationCSVName),  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-2282"></a><span class="c">!              &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2283"></a>        <span class="k">open</span><span class="p">(</span><span class="n">IterationCSVFileNumber</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">DBGD</span><span class="p">)</span><span class="o">//</span><span class="nb">Trim</span><span class="p">(</span><span class="n">IterationCSVName</span><span class="p">),</span>  <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;APPEND&#39;</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2284"></a>              <span class="p">&amp;</span>  <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2285"></a>
<a name="ln-2286"></a><span class="c">!        if (nperr.ne.0)  open(newunit=IterationCSVFileNumber,  file=Trim(IterationCSVName),  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-2287"></a><span class="c">!              &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2288"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">nperr</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>  <span class="k">open</span><span class="p">(</span><span class="n">IterationCSVFileNumber</span><span class="p">,</span>  <span class="k">file</span><span class="o">=</span><span class="nb">Trim</span><span class="p">(</span><span class="n">IterationCSVName</span><span class="p">),</span>  <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;APPEND&#39;</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2289"></a>              <span class="p">&amp;</span>  <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2290"></a>      <span class="k">end if</span>
<a name="ln-2291"></a><span class="k">   end if</span>
<a name="ln-2292"></a>
<a name="ln-2293"></a><span class="k">  end subroutine</span>
<a name="ln-2294"></a>
<a name="ln-2295"></a><span class="c">!     NOTICE</span>
<a name="ln-2296"></a><span class="c">!</span>
<a name="ln-2297"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-2298"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-2299"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-2300"></a><span class="c">!</span>
<a name="ln-2301"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-2302"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-2303"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-2304"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-2305"></a><span class="c">!</span>
<a name="ln-2306"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-2307"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-2308"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-2309"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-2310"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-2311"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-2312"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-2313"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-2314"></a><span class="c">!     permit others to do so.</span>
<a name="ln-2315"></a><span class="c">!</span>
<a name="ln-2316"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-2317"></a><span class="c">!</span>
<a name="ln-2318"></a>
<a name="ln-2319"></a><span class="k">end module </span><span class="n">TARCOGOutput</span>
<a name="ln-2320"></a>
<a name="ln-2321"></a><span class="k">module </span><span class="n">TARCOGArgs</span>
<a name="ln-2322"></a>
<a name="ln-2323"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-2324"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-2325"></a>          <span class="c">!       DATE WRITTEN   June/22/2010</span>
<a name="ln-2326"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2327"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2328"></a>          <span class="c">!</span>
<a name="ln-2329"></a>          <span class="c">!  Revision: 6.0.36  (June/22/2010)</span>
<a name="ln-2330"></a>          <span class="c">!   - Initial setup, extracted from TARCOG.for</span>
<a name="ln-2331"></a>
<a name="ln-2332"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-2333"></a>          <span class="c">! A module which contains common functions for error checking and</span>
<a name="ln-2334"></a>          <span class="c">!    preparation of arguments and intermediate variables</span>
<a name="ln-2335"></a>
<a name="ln-2336"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2337"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-2338"></a>
<a name="ln-2339"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2340"></a>          <span class="c">! na</span>
<a name="ln-2341"></a>
<a name="ln-2342"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-2343"></a>          <span class="c">! na</span>
<a name="ln-2344"></a>
<a name="ln-2345"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2346"></a>
<a name="ln-2347"></a>  <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Pi</span><span class="p">,</span> <span class="n">StefanBoltzmann</span>
<a name="ln-2348"></a>  <span class="k">use </span><span class="n">TARCOGOutput</span>
<a name="ln-2349"></a>  <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-2350"></a>
<a name="ln-2351"></a>  <span class="k">implicit none</span>
<a name="ln-2352"></a>
<a name="ln-2353"></a><span class="k">  public </span><span class="n">ArgCheck</span>
<a name="ln-2354"></a>  <span class="k">public </span><span class="n">GoAhead</span>
<a name="ln-2355"></a>  <span class="k">public </span><span class="n">PrepVariablesISO15099</span>
<a name="ln-2356"></a>
<a name="ln-2357"></a>  <span class="k">contains</span>
<a name="ln-2358"></a>
<a name="ln-2359"></a><span class="k">  </span><span class="kt">integer </span><span class="k">function </span><span class="n">ArgCheck</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">tind</span><span class="p">,</span><span class="n">trmin</span><span class="p">,</span><span class="n">wso</span><span class="p">,</span><span class="n">wsi</span><span class="p">,</span><span class="n">dir</span><span class="p">,</span><span class="n">outir</span><span class="p">,</span><span class="n">isky</span><span class="p">,</span><span class="n">tsky</span><span class="p">,</span><span class="n">esky</span><span class="p">,</span><span class="n">fclr</span><span class="p">,</span><span class="n">VacuumPressure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2360"></a>            <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2361"></a>            <span class="n">gap</span><span class="p">,</span><span class="n">GapDef</span><span class="p">,</span><span class="n">thick</span><span class="p">,</span><span class="n">scon</span><span class="p">,</span><span class="n">YoungsMod</span><span class="p">,</span><span class="n">PoissonsRat</span><span class="p">,</span><span class="n">tir</span><span class="p">,</span><span class="n">emis</span><span class="p">,</span><span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2362"></a>            <span class="n">tilt</span><span class="p">,</span><span class="n">asol</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">heightt</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">presure</span><span class="p">,</span><span class="n">iprop</span><span class="p">,</span><span class="n">frct</span><span class="p">,</span><span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span><span class="n">gama</span><span class="p">,</span><span class="n">nmix</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2363"></a>            <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2364"></a>            <span class="n">hin</span><span class="p">,</span><span class="n">hout</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span><span class="n">Atop</span><span class="p">,</span><span class="n">Abot</span><span class="p">,</span><span class="n">Al</span><span class="p">,</span><span class="n">Ar</span><span class="p">,</span><span class="n">Ah</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2365"></a>            <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span><span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2366"></a>            <span class="n">sumsol</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-2367"></a>
<a name="ln-2368"></a>
<a name="ln-2369"></a>    <span class="c">!!! INPUTS:</span>
<a name="ln-2370"></a>
<a name="ln-2371"></a>    <span class="c">!!! General:</span>
<a name="ln-2372"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-2373"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span>
<a name="ln-2374"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">standard</span>
<a name="ln-2375"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ThermalMod</span>
<a name="ln-2376"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-2377"></a>
<a name="ln-2378"></a>    <span class="c">!!! Environment related:</span>
<a name="ln-2379"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tout</span><span class="p">,</span><span class="n">tind</span><span class="p">,</span><span class="n">trmin</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span>
<a name="ln-2380"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span>
<a name="ln-2381"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">CalcDeflection</span>
<a name="ln-2382"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-2383"></a>
<a name="ln-2384"></a>      <span class="c">!!! Layers:</span>
<a name="ln-2385"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-2386"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">asol</span>
<a name="ln-2387"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span>
<a name="ln-2388"></a>    <span class="c">!!! Venetians:</span>
<a name="ln-2389"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span>
<a name="ln-2390"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span>
<a name="ln-2391"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span>
<a name="ln-2392"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span>
<a name="ln-2393"></a>
<a name="ln-2394"></a>    <span class="c">!!! Laminates:</span>
<a name="ln-2395"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nslice</span>
<a name="ln-2396"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="n">sumsol</span>
<a name="ln-2397"></a>
<a name="ln-2398"></a>    <span class="c">!!! Gaps:</span>
<a name="ln-2399"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-2400"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-2401"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">frct</span>
<a name="ln-2402"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">presure</span>
<a name="ln-2403"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-2404"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">xwght</span><span class="p">,</span> <span class="n">gama</span>
<a name="ln-2405"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SDScalar</span>
<a name="ln-2406"></a>
<a name="ln-2407"></a>    <span class="c">!Deflection</span>
<a name="ln-2408"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pa</span>
<a name="ln-2409"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pini</span>
<a name="ln-2410"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tini</span>
<a name="ln-2411"></a>
<a name="ln-2412"></a>    <span class="c">!Support Pillars</span>
<a name="ln-2413"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPillar</span>    <span class="c">! Shows whether or not gap have support pillar</span>
<a name="ln-2414"></a>                                                               <span class="c">!   0 - does not have support pillar</span>
<a name="ln-2415"></a>                                                               <span class="c">!   1 - have support pillar</span>
<a name="ln-2416"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span>  <span class="c">! Pillar spacing for each gap (used in case there is support pillar)</span>
<a name="ln-2417"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarRadius</span>   <span class="c">! Pillar radius for each gap (used in case there is support pillar)</span>
<a name="ln-2418"></a>
<a name="ln-2419"></a>
<a name="ln-2420"></a>    <span class="c">!!!! INPUTS/OUTPUTS:</span>
<a name="ln-2421"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="n">YoungsMod</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="n">PoissonsRat</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span>
<a name="ln-2422"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span><span class="p">,</span> <span class="n">gap</span>
<a name="ln-2423"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">GapDef</span>
<a name="ln-2424"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span>
<a name="ln-2425"></a>
<a name="ln-2426"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-2427"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-2428"></a>
<a name="ln-2429"></a>  <span class="c">!bi...Write debug output files - if debug flag = 1:</span>
<a name="ln-2430"></a>
<a name="ln-2431"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">WriteDebugOutput</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2432"></a>
<a name="ln-2433"></a><span class="k">      call </span><span class="n">WriteInputArguments</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span>  <span class="n">wso</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2434"></a>                            <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2435"></a>                            <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2436"></a>                            <span class="n">LayerType</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2437"></a>                            <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2438"></a>                            <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="n">sumsol</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2439"></a>                            <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">)</span>
<a name="ln-2440"></a>
<a name="ln-2441"></a>      <span class="k">call </span><span class="n">WriteTARCOGInputFile</span><span class="p">(</span><span class="n">VersionNumber</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2442"></a>                            <span class="p">&amp;</span>   <span class="n">wso</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2443"></a>                            <span class="p">&amp;</span>   <span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-2444"></a>                            <span class="p">&amp;</span>   <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2445"></a>                            <span class="p">&amp;</span>   <span class="n">LayerType</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2446"></a>                            <span class="p">&amp;</span>   <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2447"></a>                            <span class="p">&amp;</span>   <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2448"></a>                            <span class="p">&amp;</span>   <span class="n">nslice</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">GapDef</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2449"></a>                            <span class="p">&amp;</span>   <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">gama</span><span class="p">)</span>
<a name="ln-2450"></a>
<a name="ln-2451"></a>    <span class="k">end if</span> <span class="c">! if debug=1 - write dbg output file</span>
<a name="ln-2452"></a>
<a name="ln-2453"></a>
<a name="ln-2454"></a>    <span class="c">!bi...assume All OK</span>
<a name="ln-2455"></a>    <span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2456"></a>
<a name="ln-2457"></a>    <span class="c">!dr...check for error messages</span>
<a name="ln-2458"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2459"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">17</span>
<a name="ln-2460"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Number of layers must be &gt;0.&#39;</span>
<a name="ln-2461"></a>      <span class="k">return</span>
<a name="ln-2462"></a><span class="k">    end if</span>
<a name="ln-2463"></a>
<a name="ln-2464"></a><span class="k">    if</span> <span class="p">((</span><span class="n">standard</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">MinStandard</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">standard</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">MaxStandard</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2465"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">28</span>
<a name="ln-2466"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid code for standard.&#39;</span>
<a name="ln-2467"></a>      <span class="k">return</span>
<a name="ln-2468"></a><span class="k">    end if</span>
<a name="ln-2469"></a>
<a name="ln-2470"></a><span class="k">    if</span> <span class="p">((</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">MinThermalMode</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">MaxThermalMode</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2471"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">29</span>
<a name="ln-2472"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid code for thermal mode.&#39;</span>
<a name="ln-2473"></a>      <span class="k">return</span>
<a name="ln-2474"></a><span class="k">    end if</span>
<a name="ln-2475"></a>
<a name="ln-2476"></a><span class="k">    if</span> <span class="p">((</span><span class="n">iwd</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">iwd</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2477"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">18</span>
<a name="ln-2478"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Wind direction can be windward (=0) or leeward (=1).&#39;</span>
<a name="ln-2479"></a>      <span class="k">return</span>
<a name="ln-2480"></a><span class="k">    end if</span>
<a name="ln-2481"></a>
<a name="ln-2482"></a><span class="k">    if</span> <span class="p">((</span><span class="n">fclr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">fclr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2483"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">19</span>
<a name="ln-2484"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Fraction of sky that is clear can be in range between 0 and 1.&#39;</span>
<a name="ln-2485"></a>      <span class="k">return</span>
<a name="ln-2486"></a><span class="k">    end if</span>
<a name="ln-2487"></a>
<a name="ln-2488"></a><span class="k">    do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2489"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2490"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">20</span>
<a name="ln-2491"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2492"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Gap width is less than (or equal to) zero. Gap #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2493"></a>        <span class="k">return</span>
<a name="ln-2494"></a><span class="k">      end if</span>
<a name="ln-2495"></a><span class="k">    end do</span>
<a name="ln-2496"></a>
<a name="ln-2497"></a><span class="k">    do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-2498"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2499"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">21</span>
<a name="ln-2500"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2501"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Layer width is less than (or equal to) zero. Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2502"></a>        <span class="k">return</span>
<a name="ln-2503"></a><span class="k">      end if</span>
<a name="ln-2504"></a><span class="k">      if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">nlayer</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2505"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">37</span>
<a name="ln-2506"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Cannot handle two consecutive venetian blinds.&#39;</span>
<a name="ln-2507"></a>        <span class="k">return</span>
<a name="ln-2508"></a><span class="k">      end if</span>
<a name="ln-2509"></a><span class="k">      if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">nlayer</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">WOVSHADE</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">WOVSHADE</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2510"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">43</span>
<a name="ln-2511"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Cannot handle two consecutive woven shades.&#39;</span>
<a name="ln-2512"></a>        <span class="k">return</span>
<a name="ln-2513"></a><span class="k">      end if</span>
<a name="ln-2514"></a><span class="k">      if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">nlayer</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">WOVSHADE</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2515"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">44</span>
<a name="ln-2516"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Cannot handle consecutive venetian blind and woven shade.&#39;</span>
<a name="ln-2517"></a>        <span class="k">return</span>
<a name="ln-2518"></a><span class="k">      end if</span>
<a name="ln-2519"></a><span class="k">      if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">nlayer</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">WOVSHADE</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2520"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">44</span>
<a name="ln-2521"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Cannot handle consecutive venetian blind and woven shade.&#39;</span>
<a name="ln-2522"></a>        <span class="k">return</span>
<a name="ln-2523"></a><span class="k">      end if</span>
<a name="ln-2524"></a>      <span class="c">!Deflection cannot be calculated with IGU containing shading layer. This error check is to be</span>
<a name="ln-2525"></a>      <span class="c">!removed once that extension is programmed</span>
<a name="ln-2526"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">CalcDeflection</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">SPECULAR</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2527"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">42</span>
<a name="ln-2528"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Cannot calculate deflection with IGU containing shading devices.&#39;</span>
<a name="ln-2529"></a>        <span class="k">return</span>
<a name="ln-2530"></a><span class="k">      end if</span>
<a name="ln-2531"></a><span class="k">    end do</span>
<a name="ln-2532"></a>
<a name="ln-2533"></a><span class="k">    if</span> <span class="p">(</span><span class="n">height</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2534"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">23</span>
<a name="ln-2535"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;IGU cavity height must be greater than zero.&#39;</span>
<a name="ln-2536"></a>      <span class="k">return</span>
<a name="ln-2537"></a><span class="k">    end if</span>
<a name="ln-2538"></a>
<a name="ln-2539"></a><span class="k">    if</span> <span class="p">(</span><span class="n">heightt</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2540"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">24</span>
<a name="ln-2541"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Total window height must be greater than zero.&#39;</span>
<a name="ln-2542"></a>      <span class="k">return</span>
<a name="ln-2543"></a><span class="k">    end if</span>
<a name="ln-2544"></a>
<a name="ln-2545"></a><span class="k">    if</span> <span class="p">(</span><span class="n">width</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2546"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">25</span>
<a name="ln-2547"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Window width must be greater than zero.&#39;</span>
<a name="ln-2548"></a>      <span class="k">return</span>
<a name="ln-2549"></a><span class="k">    end if</span>
<a name="ln-2550"></a>
<a name="ln-2551"></a><span class="k">    if</span> <span class="p">((</span><span class="n">SDScalar</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">SDScalar</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2552"></a><span class="k">      </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">30</span>
<a name="ln-2553"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;SDscalar is out of range (&lt;0.0 or &gt;1.0).&#39;</span>
<a name="ln-2554"></a>      <span class="k">return</span>
<a name="ln-2555"></a><span class="k">    end if</span>
<a name="ln-2556"></a>
<a name="ln-2557"></a>  <span class="c">!bi...Check layers and update Venetian blinds properties:</span>
<a name="ln-2558"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-2559"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2560"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">26</span>
<a name="ln-2561"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2562"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Layer &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; has conductivity whcih is less or equal to zero.&#39;</span>
<a name="ln-2563"></a>        <span class="k">return</span>
<a name="ln-2564"></a><span class="k">      end if</span>
<a name="ln-2565"></a>
<a name="ln-2566"></a><span class="k">      if</span> <span class="p">((</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="n">MinLayType</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="n">MaxLayType</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2567"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">22</span>
<a name="ln-2568"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2569"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Incorrect layer type for layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.  Layer type can either be 0 (glazing layer),&#39;</span> <span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-2570"></a>              <span class="s1">&#39;1 (Venetian blind), 2 (woven shade), 3 (perforated), 4 (diffuse shade) or 5 (bsdf).&#39;</span>
<a name="ln-2571"></a>        <span class="k">return</span>
<a name="ln-2572"></a><span class="k">      end if</span>
<a name="ln-2573"></a>
<a name="ln-2574"></a>  <span class="c">!bi...TEMPORARY! Don&#39;t allow CSW and CSM method for outdoor and indoor SD layers</span>
<a name="ln-2575"></a>      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="mi">1</span><span class="p">))).</span><span class="nb">and</span><span class="p">.((</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_SCW</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_CSM</span><span class="p">))</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-2576"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">39</span>
<a name="ln-2577"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;CSM and SCW thermal models cannot be used for outdoor and indoor SD layers.&#39;</span>
<a name="ln-2578"></a>        <span class="k">return</span>
<a name="ln-2579"></a><span class="k">      end if</span>
<a name="ln-2580"></a><span class="k">      if</span> <span class="p">(</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">nlayer</span><span class="p">))).</span><span class="nb">and</span><span class="p">.((</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_SCW</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-2581"></a>            <span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_CSM</span><span class="p">))</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-2582"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">39</span>
<a name="ln-2583"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;CSM and SCW thermal models cannot be used for outdoor and indoor SD layers.&#39;</span>
<a name="ln-2584"></a>        <span class="k">return</span>
<a name="ln-2585"></a><span class="k">      end if</span>
<a name="ln-2586"></a>
<a name="ln-2587"></a><span class="k">      if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">)</span> <span class="k">then</span>   <span class="c">! Venetian blind specific:</span>
<a name="ln-2588"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">SlatThick</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2589"></a><span class="k">          </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">31</span>
<a name="ln-2590"></a>          <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2591"></a>          <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid slat thickness (must be &gt;0). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2592"></a>          <span class="k">return</span>
<a name="ln-2593"></a><span class="k">        end if</span>
<a name="ln-2594"></a><span class="k">        if</span> <span class="p">(</span><span class="n">SlatWidth</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2595"></a><span class="k">          </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">32</span>
<a name="ln-2596"></a>          <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2597"></a>          <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid slat width (must be &gt;0). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2598"></a>          <span class="k">return</span>
<a name="ln-2599"></a><span class="k">        end if</span>
<a name="ln-2600"></a><span class="k">        if</span> <span class="p">((</span><span class="n">SlatAngle</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="o">-</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">SlatAngle</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2601"></a><span class="k">          </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">33</span>
<a name="ln-2602"></a>          <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2603"></a>          <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid slat angle (must be between -90 and 90). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2604"></a>          <span class="k">return</span>
<a name="ln-2605"></a><span class="k">        end if</span>
<a name="ln-2606"></a><span class="k">        if</span> <span class="p">(</span><span class="n">SlatCond</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2607"></a><span class="k">          </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">34</span>
<a name="ln-2608"></a>          <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2609"></a>          <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid conductivity of slat material (must be &gt;0). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2610"></a>          <span class="k">return</span>
<a name="ln-2611"></a><span class="k">        end if</span>
<a name="ln-2612"></a><span class="k">        if</span> <span class="p">(</span><span class="n">SlatSpacing</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2613"></a><span class="k">          </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">35</span>
<a name="ln-2614"></a>          <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2615"></a>          <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid slat spacing (must be &gt;0). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2616"></a>          <span class="k">return</span>
<a name="ln-2617"></a><span class="k">        end if</span>
<a name="ln-2618"></a><span class="k">        if</span> <span class="p">(</span> <span class="p">(</span><span class="n">SlatCurve</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="nb">abs</span><span class="p">(</span><span class="n">SlatCurve</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">le</span><span class="p">.(</span><span class="n">SlatWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0d0</span><span class="p">))</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-2619"></a><span class="k">          </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">36</span>
<a name="ln-2620"></a>          <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2621"></a>          <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid curvature radius (absolute value must be &gt;SlatWidth/2, or 0 for flat slats). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2622"></a>          <span class="k">return</span>
<a name="ln-2623"></a><span class="k">        end if</span>
<a name="ln-2624"></a>
<a name="ln-2625"></a><span class="k">      end if</span>  <span class="c">!  LayerType is Venetian</span>
<a name="ln-2626"></a>
<a name="ln-2627"></a>    <span class="k">end do</span>  <span class="c">! Layers...</span>
<a name="ln-2628"></a>
<a name="ln-2629"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-2630"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2631"></a><span class="k">        </span><span class="n">ArgCheck</span> <span class="o">=</span> <span class="mi">27</span>
<a name="ln-2632"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-2633"></a>        <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-2634"></a><span class="k">          </span><span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;One of enviroments (inside or outside) has pressure which is less than zero.&#39;</span>
<a name="ln-2635"></a>        <span class="k">else</span>
<a name="ln-2636"></a><span class="k">          </span><span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;One of gaps has pressure which is less than zero. Gap #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2637"></a>        <span class="k">end if</span>
<a name="ln-2638"></a><span class="k">        return</span>
<a name="ln-2639"></a><span class="k">      end if</span>
<a name="ln-2640"></a><span class="k">    end do</span>
<a name="ln-2641"></a>
<a name="ln-2642"></a><span class="k">    return</span>
<a name="ln-2643"></a>
<a name="ln-2644"></a>  <span class="c">!bi...Debug output:</span>
<a name="ln-2645"></a>  <span class="c">!      open(unit=18,  file=&#39;iprop.dbg&#39;,  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,</span>
<a name="ln-2646"></a>  <span class="c">!  2            form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-2647"></a>  <span class="c">!    write(18,5555) &#39;Iprop1:&#39;, iprop(1, 1), iprop(1, 2), iprop (1, 3)</span>
<a name="ln-2648"></a>  <span class="c">!    write(18,5555) &#39;Iprop2:&#39;, iprop(2, 1), iprop(2, 2), iprop (2, 3)</span>
<a name="ln-2649"></a>  <span class="c">!    write(18,5555) &#39;Iprop3:&#39;, iprop(3, 1), iprop(3, 2), iprop (3, 3)</span>
<a name="ln-2650"></a>  <span class="c">!5555  format(A, I3, I3, I3)</span>
<a name="ln-2651"></a>  <span class="c">!    close(18)</span>
<a name="ln-2652"></a>
<a name="ln-2653"></a>  <span class="k">end function</span>
<a name="ln-2654"></a>
<a name="ln-2655"></a><span class="k">  subroutine </span><span class="n">PrepVariablesISO15099</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2656"></a>          <span class="p">&amp;</span>  <span class="n">tilt</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-2657"></a>          <span class="p">&amp;</span>  <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2658"></a>          <span class="p">&amp;</span> <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">LaminateAU</span><span class="p">,</span> <span class="n">sumsolU</span><span class="p">,</span> <span class="n">sol0</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-2659"></a>          <span class="p">&amp;</span> <span class="n">hint</span><span class="p">,</span> <span class="n">houtt</span><span class="p">,</span> <span class="n">trmout</span><span class="p">,</span> <span class="n">ebsky</span><span class="p">,</span> <span class="n">ebroom</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-2660"></a>
<a name="ln-2661"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-2662"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ThermalMod</span>
<a name="ln-2663"></a>
<a name="ln-2664"></a>    <span class="c">!!! Environment related:</span>
<a name="ln-2665"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tout</span><span class="p">,</span><span class="n">tind</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">tilt</span>
<a name="ln-2666"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">isky</span>
<a name="ln-2667"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-2668"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">outir</span> <span class="c">!IR radiance of window&#39;s exterior/interior surround (W/m2)</span>
<a name="ln-2669"></a>
<a name="ln-2670"></a>      <span class="c">!!! Layers:</span>
<a name="ln-2671"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-2672"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span>
<a name="ln-2673"></a>
<a name="ln-2674"></a>    <span class="c">!!! Venetians:</span>
<a name="ln-2675"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="n">SlatCond</span>
<a name="ln-2676"></a>
<a name="ln-2677"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SDScalar</span>
<a name="ln-2678"></a>
<a name="ln-2679"></a>    <span class="c">!!!! INPUTS/OUTPUTS:</span>
<a name="ln-2680"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">esky</span>
<a name="ln-2681"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span><span class="p">,</span> <span class="n">thick</span>
<a name="ln-2682"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-2683"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span>
<a name="ln-2684"></a>
<a name="ln-2685"></a>    <span class="c">!!! OUTPUTS:</span>
<a name="ln-2686"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-2687"></a>    <span class="kt">character</span> <span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-2688"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rir</span>
<a name="ln-2689"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span>
<a name="ln-2690"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">flux</span>
<a name="ln-2691"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vfreevent</span>
<a name="ln-2692"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateAU</span><span class="p">,</span> <span class="n">sumsolU</span><span class="p">,</span> <span class="n">sol0</span>
<a name="ln-2693"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hint</span><span class="p">,</span> <span class="n">houtt</span><span class="p">,</span> <span class="n">trmout</span><span class="p">,</span> <span class="n">ebsky</span><span class="p">,</span> <span class="n">ebroom</span>
<a name="ln-2694"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Keff</span>
<a name="ln-2695"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeGapKeffConv</span>
<a name="ln-2696"></a>
<a name="ln-2697"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">k1</span>
<a name="ln-2698"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tiltr</span><span class="p">,</span> <span class="n">Rsky</span><span class="p">,</span> <span class="n">Fsky</span><span class="p">,</span> <span class="n">Fground</span><span class="p">,</span> <span class="n">e0</span>
<a name="ln-2699"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-2700"></a>
<a name="ln-2701"></a>    <span class="c">!! Initialize variables:</span>
<a name="ln-2702"></a>
<a name="ln-2703"></a>    <span class="c">!! Scalars:</span>
<a name="ln-2704"></a>    <span class="n">ShadeEmisRatioOut</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-2705"></a>    <span class="n">ShadeEmisRatioIn</span>  <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-2706"></a>    <span class="n">ShadeHcRatioOut</span>   <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-2707"></a>    <span class="n">ShadeHcRatioIn</span>    <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-2708"></a>
<a name="ln-2709"></a>    <span class="c">!! re-initialize iteration parameters:</span>
<a name="ln-2710"></a>    <span class="n">sc</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2711"></a>    <span class="n">shgc</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2712"></a>    <span class="n">ufactor</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2713"></a>    <span class="n">flux</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2714"></a>
<a name="ln-2715"></a>    <span class="c">!! Vectors:</span>
<a name="ln-2716"></a>    <span class="n">LaminateAU</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2717"></a>    <span class="n">sumsolU</span>    <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2718"></a>    <span class="n">vfreevent</span>  <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2719"></a>    <span class="n">sol0</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2720"></a>    <span class="c">!bi...    Clear keff, keffc elements:</span>
<a name="ln-2721"></a>    <span class="n">Keff</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2722"></a>    <span class="n">ShadeGapKeffConv</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2723"></a>
<a name="ln-2724"></a>    <span class="c">! Adjust shading layer properties</span>
<a name="ln-2725"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-2726"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">VENETBLIND</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2727"></a><span class="k">        </span><span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">SlatCond</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2728"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_SCW</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2729"></a>          <span class="c">!bi...the idea here is to have glass-to-glass width the same as before scaling</span>
<a name="ln-2730"></a>          <span class="c">!bi...TODO: check for outdoor and indoor blinds! SCW model is only applicable to in-between SDs!!!</span>
<a name="ln-2731"></a>          <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">SlatAngle</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">Pi</span> <span class="o">/</span> <span class="mi">18</span><span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-2732"></a>          <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="n">SDScalar</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation gap(i-1) @ i=1: Added if condition</span>
<a name="ln-2733"></a><span class="c">!EPTeam - see above line          gap(i-1)=gap(i-1) + (1.0d0-SDScalar)/2.0d0 * thick(i)</span>
<a name="ln-2734"></a>          <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="n">SDScalar</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2735"></a>          <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SDScalar</span><span class="o">*</span><span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2736"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="n">SlatThick</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>  <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatThick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2737"></a>        <span class="k">else if</span> <span class="p">((</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_ISO15099</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_CSM</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2738"></a><span class="k">          </span><span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatThick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2739"></a>        <span class="k">end if</span>
<a name="ln-2740"></a><span class="k">      end if</span>  <span class="c">! Venetian</span>
<a name="ln-2741"></a>    <span class="k">end do</span>
<a name="ln-2742"></a>
<a name="ln-2743"></a>
<a name="ln-2744"></a><span class="k">    </span><span class="n">hint</span> <span class="o">=</span> <span class="n">hin</span>
<a name="ln-2745"></a>    <span class="n">houtt</span> <span class="o">=</span> <span class="n">hout</span>
<a name="ln-2746"></a>    <span class="n">tiltr</span> <span class="o">=</span> <span class="n">tilt</span><span class="o">*</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">36</span><span class="mf">0.0d0</span>         <span class="c">! convert tilt in degrees to radians</span>
<a name="ln-2747"></a>
<a name="ln-2748"></a>    <span class="c">! external radiation term</span>
<a name="ln-2749"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">isky</span><span class="p">)</span>
<a name="ln-2750"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2751"></a>        <span class="n">Gout</span> <span class="o">=</span> <span class="n">outir</span>
<a name="ln-2752"></a>        <span class="n">Trmout</span> <span class="o">=</span> <span class="p">(</span><span class="n">Gout</span><span class="o">/</span><span class="n">StefanBoltzmann</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.25d0</span><span class="p">)</span>
<a name="ln-2753"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>                            <span class="c">! effective clear sky emittance from swinbank (SPC142/ISO15099 equations 131, 132, ...)</span>
<a name="ln-2754"></a>        <span class="n">Rsky</span> <span class="o">=</span> <span class="mf">5.31d-13</span><span class="o">*</span><span class="n">Tout</span><span class="o">**</span><span class="mi">6</span>
<a name="ln-2755"></a>        <span class="n">esky</span> <span class="o">=</span> <span class="n">Rsky</span><span class="o">/</span><span class="p">(</span><span class="n">StefanBoltzmann</span><span class="o">*</span><span class="n">Tout</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>        <span class="c">! check esky const, also check what esky to use when tsky input...</span>
<a name="ln-2756"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2757"></a>        <span class="n">esky</span> <span class="o">=</span> <span class="n">tsky</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="n">tout</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-2758"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>                              <span class="c">! for isky=0 it is assumed that actual values for esky and Tsky are specified</span>
<a name="ln-2759"></a>        <span class="n">esky</span> <span class="o">=</span> <span class="n">esky</span><span class="o">*</span><span class="n">tsky</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="n">tout</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-2760"></a>      <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-2761"></a>        <span class="n">nperr</span> <span class="o">=</span> <span class="mi">1</span>                        <span class="c">! error 2010: isky can be: 0(esky,Tsky input), 1(Tsky input), or 2(Swinbank model)</span>
<a name="ln-2762"></a>        <span class="k">return</span>
<a name="ln-2763"></a><span class="k">      end select</span>
<a name="ln-2764"></a>
<a name="ln-2765"></a>    <span class="c">!Simon: In this case we do not need to recalculate Gout and Trmout again</span>
<a name="ln-2766"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">isky</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2767"></a><span class="k">      </span><span class="n">Fsky</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="nb">cos</span><span class="p">(</span><span class="n">tiltr</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-2768"></a>      <span class="n">Fground</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">Fsky</span>
<a name="ln-2769"></a>      <span class="n">e0</span> <span class="o">=</span> <span class="n">Fground</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="n">fclr</span><span class="p">)</span><span class="o">*</span><span class="n">Fsky</span> <span class="o">+</span> <span class="n">Fsky</span><span class="o">*</span><span class="n">fclr</span><span class="o">*</span><span class="n">esky</span>
<a name="ln-2770"></a>      <span class="c">!  Trmout = Tout * e0**0.25</span>
<a name="ln-2771"></a>
<a name="ln-2772"></a>      <span class="c">!bi   Set mean radiant temps for fixed combined film coef. case:</span>
<a name="ln-2773"></a>
<a name="ln-2774"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="c">! outside BC - fixed combined film coef.</span>
<a name="ln-2775"></a>        <span class="n">Trmout</span> <span class="o">=</span> <span class="n">Tout</span>
<a name="ln-2776"></a>      <span class="k">else</span>
<a name="ln-2777"></a><span class="k">        </span><span class="n">Trmout</span> <span class="o">=</span> <span class="n">Tout</span> <span class="o">*</span> <span class="n">e0</span><span class="o">**</span><span class="mf">0.25d0</span>
<a name="ln-2778"></a>      <span class="k">end if</span>
<a name="ln-2779"></a>
<a name="ln-2780"></a><span class="k">      </span><span class="n">Gout</span> <span class="o">=</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="n">Trmout</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-2781"></a>    <span class="k">end if</span> <span class="c">!if (isky.ne.3) then</span>
<a name="ln-2782"></a>
<a name="ln-2783"></a>    <span class="n">Ebsky</span> <span class="o">=</span> <span class="n">Gout</span>
<a name="ln-2784"></a>
<a name="ln-2785"></a>    <span class="c">!     Ebsky=sigma*Tout**4.</span>
<a name="ln-2786"></a>    <span class="c">!</span>
<a name="ln-2787"></a>    <span class="c">! As of 6/1/01 The expression for Ebsky is different in the current ISO 15099</span>
<a name="ln-2788"></a>    <span class="c">! (Ebsky=sigma*Tout**4) because equations 32 and 33 specify Tout and Tind as reference</span>
<a name="ln-2789"></a>    <span class="c">! outdoor and indoor temperatures, but I think that they should be Tne and Tni</span>
<a name="ln-2790"></a>    <span class="c">! (environmental temps).  Therefore, Ebsky becomes the same as Gout.</span>
<a name="ln-2791"></a>    <span class="c">!</span>
<a name="ln-2792"></a>    <span class="c">! Inside (room) radiation</span>
<a name="ln-2793"></a>    <span class="c">!     Ebroom = sigma*tind**4.</span>
<a name="ln-2794"></a>    <span class="c">! See comment above about Ebsky</span>
<a name="ln-2795"></a>
<a name="ln-2796"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="c">! inside BC - fixed combined film coef.</span>
<a name="ln-2797"></a>      <span class="n">Trmin</span> <span class="o">=</span> <span class="n">Tind</span>
<a name="ln-2798"></a>    <span class="k">end if</span>
<a name="ln-2799"></a>
<a name="ln-2800"></a><span class="k">    </span><span class="n">Gin</span> <span class="o">=</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="n">trmin</span><span class="o">**</span><span class="mf">4.0d0</span>
<a name="ln-2801"></a>    <span class="n">Ebroom</span> <span class="o">=</span> <span class="n">Gin</span>
<a name="ln-2802"></a>
<a name="ln-2803"></a>    <span class="c">! calculate ir reflectance:</span>
<a name="ln-2804"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-2805"></a>      <span class="n">k1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2806"></a>      <span class="n">rir</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>   <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tir</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">-</span> <span class="n">emis</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
<a name="ln-2807"></a>      <span class="n">rir</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tir</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">-</span> <span class="n">emis</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2808"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">tir</span><span class="p">(</span><span class="n">k1</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">tir</span><span class="p">(</span><span class="n">k1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">tir</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">tir</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2809"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-2810"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">k</span>
<a name="ln-2811"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Layer transmissivity is our of range (&lt;0 or &gt;1). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2812"></a>        <span class="k">return</span>
<a name="ln-2813"></a><span class="k">      end if</span>
<a name="ln-2814"></a><span class="k">      if</span> <span class="p">((</span><span class="n">emis</span><span class="p">(</span><span class="n">k1</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">emis</span><span class="p">(</span><span class="n">k1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">emis</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">emis</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2815"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">14</span>
<a name="ln-2816"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">k</span>
<a name="ln-2817"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Layer emissivity is our of range (&lt;0 or &gt;1). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2818"></a>        <span class="k">return</span>
<a name="ln-2819"></a><span class="k">      end if</span>
<a name="ln-2820"></a><span class="k">      if</span> <span class="p">((</span><span class="n">rir</span><span class="p">(</span><span class="n">k1</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rir</span><span class="p">(</span><span class="n">k1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rir</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rir</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2821"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-2822"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;(i3)&#39;</span><span class="p">)</span> <span class="n">k</span>
<a name="ln-2823"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Layer reflectivity is our of range (&lt;0 or &gt;1). Layer #&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a name="ln-2824"></a>        <span class="k">return</span>
<a name="ln-2825"></a><span class="k">      end if</span>
<a name="ln-2826"></a><span class="k">    end do</span>
<a name="ln-2827"></a>
<a name="ln-2828"></a><span class="k">  end subroutine </span><span class="n">PrepVariablesISO15099</span>
<a name="ln-2829"></a>
<a name="ln-2830"></a>  <span class="kt">logical </span><span class="k">function </span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-2831"></a>
<a name="ln-2832"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-2833"></a>
<a name="ln-2834"></a>    <span class="k">if</span> <span class="p">(((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">)).</span><span class="nb">or</span><span class="p">.((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">2000</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">3000</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-2835"></a><span class="k">      </span><span class="n">GoAhead</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>  <span class="c">! error</span>
<a name="ln-2836"></a>    <span class="k">else</span>
<a name="ln-2837"></a><span class="k">      </span><span class="n">GOAhead</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>   <span class="c">! all OK, or a warning</span>
<a name="ln-2838"></a>    <span class="k">end if</span>
<a name="ln-2839"></a>
<a name="ln-2840"></a><span class="k">    return</span>
<a name="ln-2841"></a>
<a name="ln-2842"></a><span class="k">  end function</span>
<a name="ln-2843"></a>
<a name="ln-2844"></a><span class="c">!     NOTICE</span>
<a name="ln-2845"></a><span class="c">!</span>
<a name="ln-2846"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-2847"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-2848"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-2849"></a><span class="c">!</span>
<a name="ln-2850"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-2851"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-2852"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-2853"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-2854"></a><span class="c">!</span>
<a name="ln-2855"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-2856"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-2857"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-2858"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-2859"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-2860"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-2861"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-2862"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-2863"></a><span class="c">!     permit others to do so.</span>
<a name="ln-2864"></a><span class="c">!</span>
<a name="ln-2865"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-2866"></a><span class="c">!</span>
<a name="ln-2867"></a>
<a name="ln-2868"></a><span class="k">end module </span><span class="n">TARCOGArgs</span>
<a name="ln-2869"></a>
<a name="ln-2870"></a><span class="k">module </span><span class="n">TARCOGDeflection</span>
<a name="ln-2871"></a>
<a name="ln-2872"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-2873"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-2874"></a>          <span class="c">!       DATE WRITTEN   October/22/2011</span>
<a name="ln-2875"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2876"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2877"></a>          <span class="c">!</span>
<a name="ln-2878"></a>          <span class="c">!  Revision: 7.0.02  (October 22, 2011)</span>
<a name="ln-2879"></a>          <span class="c">!   - Initial setup</span>
<a name="ln-2880"></a>
<a name="ln-2881"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-2882"></a>          <span class="c">! A module which contains functions for deflection calculation</span>
<a name="ln-2883"></a>
<a name="ln-2884"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2885"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-2886"></a>
<a name="ln-2887"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2888"></a>          <span class="c">! na</span>
<a name="ln-2889"></a>
<a name="ln-2890"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-2891"></a>          <span class="c">! na</span>
<a name="ln-2892"></a>
<a name="ln-2893"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2894"></a>
<a name="ln-2895"></a>  <span class="k">use </span><span class="n">DataGlobals</span>
<a name="ln-2896"></a>  <span class="c">!use TARCOGGassesParams</span>
<a name="ln-2897"></a>  <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-2898"></a>  <span class="k">use </span><span class="n">TARCOGCommon</span>
<a name="ln-2899"></a>
<a name="ln-2900"></a>  <span class="k">implicit none</span>
<a name="ln-2901"></a>
<a name="ln-2902"></a><span class="k">  public  </span><span class="n">PanesDeflection</span>
<a name="ln-2903"></a>  <span class="k">private </span><span class="n">DeflectionTemperatures</span>
<a name="ln-2904"></a>  <span class="k">private </span><span class="n">DeflectionWidths</span>
<a name="ln-2905"></a>
<a name="ln-2906"></a>  <span class="k">contains</span>
<a name="ln-2907"></a>
<a name="ln-2908"></a><span class="k">  subroutine </span><span class="n">PanesDeflection</span><span class="p">(</span><span class="n">DeflectionStandard</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">PaneThickness</span><span class="p">,</span> <span class="n">NonDeflectedGapWidth</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2909"></a>                          <span class="n">DeflectedGapWidthMax</span><span class="p">,</span> <span class="n">DeflectedGapWidthMean</span><span class="p">,</span> <span class="n">PanelTemps</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span><span class="p">,</span> <span class="n">LayerDeflection</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2910"></a>                          <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-2911"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-2912"></a>    <span class="c">! PanesDeflection - calculates deflection of panes and recalculate gap</span>
<a name="ln-2913"></a>    <span class="c">!                   widths at maximal point of deflection</span>
<a name="ln-2914"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-2915"></a>
<a name="ln-2916"></a>    <span class="c">!INPUT</span>
<a name="ln-2917"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DeflectionStandard</span>
<a name="ln-2918"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-2919"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span>
<a name="ln-2920"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PanelTemps</span>
<a name="ln-2921"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NonDeflectedGapWidth</span>
<a name="ln-2922"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PaneThickness</span>
<a name="ln-2923"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span>
<a name="ln-2924"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span>
<a name="ln-2925"></a>
<a name="ln-2926"></a>    <span class="c">!OUTPUT</span>
<a name="ln-2927"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerDeflection</span> <span class="c">!Objexx:ArgIN Changed IN to INOUT: Arg used and modified</span>
<a name="ln-2928"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DeflectedGapWidthMax</span>
<a name="ln-2929"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DeflectedGapWidthMean</span>
<a name="ln-2930"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-2931"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-2932"></a>
<a name="ln-2933"></a>    <span class="c">!Localy used</span>
<a name="ln-2934"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DCoeff</span>
<a name="ln-2935"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-2936"></a>
<a name="ln-2937"></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2938"></a>    <span class="c">! first calculate D coefficients since that will be necessary for any of selected standards</span>
<a name="ln-2939"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-2940"></a>      <span class="n">DCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">YoungsMod</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">PaneThickness</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0d0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">PoissonsRat</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0d0</span><span class="p">))</span>
<a name="ln-2941"></a>    <span class="k">end do</span>
<a name="ln-2942"></a>
<a name="ln-2943"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">DeflectionStandard</span><span class="p">)</span>
<a name="ln-2944"></a>      <span class="k">case</span> <span class="p">(</span><span class="n">NO_DEFLECTION_CALCULATION</span><span class="p">)</span>
<a name="ln-2945"></a>        <span class="k">return</span>
<a name="ln-2946"></a><span class="k">      case</span> <span class="p">(</span><span class="n">DEFLECTION_CALC_TEMPERATURE</span><span class="p">)</span>
<a name="ln-2947"></a>        <span class="k">call </span><span class="n">DeflectionTemperatures</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">NonDeflectedGapWidth</span><span class="p">,</span> <span class="n">DeflectedGapWidthMax</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2948"></a>                               <span class="n">DeflectedGapWidthMean</span><span class="p">,</span> <span class="n">PanelTemps</span><span class="p">,</span> <span class="n">DCoeff</span><span class="p">,</span> <span class="n">LayerDeflection</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-2949"></a>      <span class="k">case</span> <span class="p">(</span><span class="n">DEFLECTION_CALC_GAP_WIDTHS</span><span class="p">)</span>
<a name="ln-2950"></a>        <span class="k">call </span><span class="n">DeflectionWidths</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">DCoeff</span><span class="p">,</span> <span class="n">NonDeflectedGapWidth</span><span class="p">,</span> <span class="n">DeflectedGapWidthMax</span><span class="p">,</span> <span class="n">DeflectedGapWidthMean</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2951"></a>                               <span class="n">LayerDeflection</span><span class="p">)</span>
<a name="ln-2952"></a>      <span class="k">case </span><span class="n">default</span>
<a name="ln-2953"></a>        <span class="k">return</span>
<a name="ln-2954"></a><span class="k">    end select</span>
<a name="ln-2955"></a>
<a name="ln-2956"></a><span class="k">    return</span>
<a name="ln-2957"></a>
<a name="ln-2958"></a><span class="k">  end subroutine </span><span class="n">PanesDeflection</span>
<a name="ln-2959"></a>
<a name="ln-2960"></a>  <span class="k">subroutine </span><span class="n">DeflectionTemperatures</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">NonDeflectedGapWidth</span><span class="p">,</span> <span class="n">DeflectedGapWidthMax</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2961"></a>                             <span class="n">DeflectedGapWidthMean</span><span class="p">,</span> <span class="n">PanelTemps</span><span class="p">,</span> <span class="n">DCoeff</span><span class="p">,</span> <span class="n">LayerDeflection</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-2962"></a>    <span class="c">!***********************************************************************************************************</span>
<a name="ln-2963"></a>    <span class="c">! DeflectionTemperatures - calculates deflection of panes and recalculate gap</span>
<a name="ln-2964"></a>    <span class="c">!                          widths at maximal point of deflection based on gap pressures and temperatures</span>
<a name="ln-2965"></a>    <span class="c">!***********************************************************************************************************</span>
<a name="ln-2966"></a>    <span class="c">!INPUT</span>
<a name="ln-2967"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-2968"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span>
<a name="ln-2969"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PanelTemps</span>
<a name="ln-2970"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NonDeflectedGapWidth</span>
<a name="ln-2971"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DCoeff</span>
<a name="ln-2972"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span>
<a name="ln-2973"></a>
<a name="ln-2974"></a>    <span class="c">!OUTPUT</span>
<a name="ln-2975"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerDeflection</span> <span class="c">!Objexx:ArgIN Changed IN to INOUT: Arg used and modified</span>
<a name="ln-2976"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DeflectedGapWidthMax</span>
<a name="ln-2977"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DeflectedGapWidthMean</span>
<a name="ln-2978"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-2979"></a>    <span class="kt">character</span> <span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-2980"></a>
<a name="ln-2981"></a>    <span class="c">!localy used</span>
<a name="ln-2982"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DPressure</span>  <span class="c">!delta pressure at each glazing layer</span>
<a name="ln-2983"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Vini</span>
<a name="ln-2984"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Vgap</span>
<a name="ln-2985"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pgap</span>
<a name="ln-2986"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap</span>
<a name="ln-2987"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">MaxLDSum</span><span class="p">,</span> <span class="n">MeanLDSum</span><span class="p">,</span> <span class="n">Ratio</span>
<a name="ln-2988"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-2989"></a>
<a name="ln-2990"></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2991"></a>    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2992"></a>    <span class="n">Ratio</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2993"></a>    <span class="n">MeanLDSum</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2994"></a>    <span class="n">MaxLDSum</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2995"></a>
<a name="ln-2996"></a>    <span class="c">!calculate Vini for each gap</span>
<a name="ln-2997"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2998"></a>      <span class="n">Vini</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span> <span class="o">*</span> <span class="n">H</span>
<a name="ln-2999"></a>    <span class="k">end do</span> <span class="c">!do i = 1, nlayer</span>
<a name="ln-3000"></a>
<a name="ln-3001"></a>    <span class="n">MaxLDSum</span> <span class="o">=</span> <span class="n">LDSumMax</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<a name="ln-3002"></a>    <span class="n">MeanLDSum</span> <span class="o">=</span> <span class="n">LDSumMean</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<a name="ln-3003"></a>    <span class="n">Ratio</span> <span class="o">=</span> <span class="n">MeanLDSum</span> <span class="o">/</span> <span class="n">MaxLDSum</span>
<a name="ln-3004"></a>
<a name="ln-3005"></a>    <span class="c">!calculate Vgap for each gap</span>
<a name="ln-3006"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3007"></a>      <span class="n">Vgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Vini</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">W</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="n">Ratio</span> <span class="o">*</span> <span class="p">(</span><span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-3008"></a>    <span class="k">end do</span> <span class="c">!do i = 1, nlayer</span>
<a name="ln-3009"></a>
<a name="ln-3010"></a>    <span class="c">!calculate Tgap for each gap</span>
<a name="ln-3011"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3012"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span>
<a name="ln-3013"></a>      <span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">PanelTemps</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">PanelTemps</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-3014"></a>    <span class="k">end do</span> <span class="c">!do i = 1, nlayer</span>
<a name="ln-3015"></a>
<a name="ln-3016"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3017"></a>      <span class="n">Pgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Pini</span><span class="o">*</span><span class="n">Vini</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tini</span><span class="o">*</span><span class="n">Vgap</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-3018"></a>    <span class="k">end do</span> <span class="c">!do i = 1, nlayer</span>
<a name="ln-3019"></a>
<a name="ln-3020"></a>    <span class="n">DPressure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Pgap</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Pa</span>
<a name="ln-3021"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3022"></a><span class="k">      </span><span class="n">DPressure</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">=</span> <span class="n">Pa</span> <span class="o">-</span> <span class="n">Pgap</span><span class="p">(</span><span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3023"></a>    <span class="k">end if</span>
<a name="ln-3024"></a>
<a name="ln-3025"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3026"></a>      <span class="n">DPressure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Pgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">Pgap</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3027"></a>    <span class="k">end do</span> <span class="c">!do i = 1, nlayer</span>
<a name="ln-3028"></a>
<a name="ln-3029"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-3030"></a>      <span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">DeflectionRelaxation</span> <span class="o">*</span> <span class="n">MaxLDSum</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">DPressure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Pi</span><span class="o">**</span><span class="mi">6</span> <span class="o">*</span> <span class="n">DCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-3031"></a>    <span class="k">end do</span>
<a name="ln-3032"></a>
<a name="ln-3033"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3034"></a>      <span class="n">DeflectedGapWidthMax</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3035"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">DeflectedGapWidthMax</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3036"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">2001</span> <span class="c">!glazing panes collapsed</span>
<a name="ln-3037"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Glazing panes collapsed&#39;</span>
<a name="ln-3038"></a>      <span class="k">end if</span>
<a name="ln-3039"></a><span class="k">    end do</span>
<a name="ln-3040"></a>
<a name="ln-3041"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3042"></a>      <span class="n">DeflectedGapWidthMean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ratio</span> <span class="o">*</span> <span class="p">(</span><span class="n">DeflectedGapWidthMax</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-3043"></a>    <span class="k">end do</span>
<a name="ln-3044"></a>
<a name="ln-3045"></a><span class="k">    return</span>
<a name="ln-3046"></a>
<a name="ln-3047"></a><span class="k">  end subroutine </span><span class="n">DeflectionTemperatures</span>
<a name="ln-3048"></a>
<a name="ln-3049"></a>  <span class="k">subroutine </span><span class="n">DeflectionWidths</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">DCoeff</span><span class="p">,</span> <span class="n">NonDeflectedGapWidth</span><span class="p">,</span> <span class="n">DeflectedGapWidthMax</span><span class="p">,</span> <span class="n">DeflectedGapWidthMean</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3050"></a>                    <span class="n">LayerDeflection</span><span class="p">)</span>
<a name="ln-3051"></a>    <span class="c">!INPUT</span>
<a name="ln-3052"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-3053"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span>
<a name="ln-3054"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NonDeflectedGapWidth</span>
<a name="ln-3055"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DeflectedGapWidthMax</span>
<a name="ln-3056"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DCoeff</span>
<a name="ln-3057"></a>
<a name="ln-3058"></a>    <span class="c">!OUTPUT</span>
<a name="ln-3059"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerDeflection</span>
<a name="ln-3060"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DeflectedGapWidthMean</span>
<a name="ln-3061"></a>    <span class="c">!integer, intent(inout) :: nperr</span>
<a name="ln-3062"></a>    <span class="c">!character*(*) :: ErrorMessage</span>
<a name="ln-3063"></a>
<a name="ln-3064"></a>    <span class="c">!LOCALS</span>
<a name="ln-3065"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-3066"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nominator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">SumL</span>
<a name="ln-3067"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">MaxLDSum</span><span class="p">,</span> <span class="n">MeanLDSum</span><span class="p">,</span> <span class="n">Ratio</span>
<a name="ln-3068"></a>
<a name="ln-3069"></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3070"></a>    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3071"></a>    <span class="n">Ratio</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3072"></a>    <span class="n">MeanLDSum</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3073"></a>    <span class="n">MaxLDSum</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3074"></a>
<a name="ln-3075"></a>    <span class="n">nominator</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3076"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3077"></a>      <span class="n">SumL</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3078"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3079"></a>        <span class="n">SumL</span> <span class="o">=</span> <span class="n">SumL</span> <span class="o">+</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">DeflectedGapWidthMax</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-3080"></a>      <span class="k">end do</span>
<a name="ln-3081"></a><span class="k">      </span><span class="n">nominator</span> <span class="o">=</span> <span class="n">nominator</span> <span class="o">+</span> <span class="n">SumL</span> <span class="o">*</span> <span class="n">DCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3082"></a>    <span class="k">end do</span>
<a name="ln-3083"></a>
<a name="ln-3084"></a><span class="k">    </span><span class="n">denominator</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3085"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-3086"></a>      <span class="n">denominator</span> <span class="o">=</span> <span class="n">denominator</span> <span class="o">+</span> <span class="n">DCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3087"></a>    <span class="k">end do</span>
<a name="ln-3088"></a>
<a name="ln-3089"></a><span class="k">    </span><span class="n">LayerDeflection</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">=</span> <span class="n">nominator</span> <span class="o">/</span> <span class="n">denominator</span>
<a name="ln-3090"></a>
<a name="ln-3091"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-3092"></a>      <span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">DeflectedGapWidthMax</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">LayerDeflection</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3093"></a>    <span class="k">end do</span>
<a name="ln-3094"></a>
<a name="ln-3095"></a><span class="k">    </span><span class="n">MaxLDSum</span> <span class="o">=</span> <span class="n">LDSumMax</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<a name="ln-3096"></a>    <span class="n">MeanLDSum</span> <span class="o">=</span> <span class="n">LDSumMean</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<a name="ln-3097"></a>    <span class="n">Ratio</span> <span class="o">=</span> <span class="n">MeanLDSum</span> <span class="o">/</span> <span class="n">MaxLDSum</span>
<a name="ln-3098"></a>
<a name="ln-3099"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-3100"></a>      <span class="n">DeflectedGapWidthMean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ratio</span> <span class="o">*</span> <span class="p">(</span><span class="n">DeflectedGapWidthMax</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">NonDeflectedGapWidth</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-3101"></a>    <span class="k">end do</span>
<a name="ln-3102"></a>
<a name="ln-3103"></a><span class="k">    return</span>
<a name="ln-3104"></a><span class="k">  end subroutine </span><span class="n">DeflectionWidths</span>
<a name="ln-3105"></a>
<a name="ln-3106"></a><span class="c">!     NOTICE</span>
<a name="ln-3107"></a><span class="c">!</span>
<a name="ln-3108"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-3109"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-3110"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-3111"></a><span class="c">!</span>
<a name="ln-3112"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-3113"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-3114"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-3115"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-3116"></a><span class="c">!</span>
<a name="ln-3117"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-3118"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-3119"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-3120"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-3121"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-3122"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-3123"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-3124"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-3125"></a><span class="c">!     permit others to do so.</span>
<a name="ln-3126"></a><span class="c">!</span>
<a name="ln-3127"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-3128"></a><span class="c">!</span>
<a name="ln-3129"></a>
<a name="ln-3130"></a><span class="k">end module </span><span class="n">TARCOGDeflection</span>
<a name="ln-3131"></a>
<a name="ln-3132"></a><span class="k">module </span><span class="n">TarcogShading</span>
<a name="ln-3133"></a>
<a name="ln-3134"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-3135"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-3136"></a>          <span class="c">!       DATE WRITTEN   June/22/2010</span>
<a name="ln-3137"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-3138"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-3139"></a>          <span class="c">!</span>
<a name="ln-3140"></a>          <span class="c">!  Revision: 6.0.36  (June/22/2010)</span>
<a name="ln-3141"></a>          <span class="c">!   - Initial setup, extracted from TARCOG.for</span>
<a name="ln-3142"></a>
<a name="ln-3143"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-3144"></a>          <span class="c">! Module which contains subroutines used for handling shading</span>
<a name="ln-3145"></a>          <span class="c">! device layers according to ISO15099</span>
<a name="ln-3146"></a>
<a name="ln-3147"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3148"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-3149"></a>
<a name="ln-3150"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3151"></a>          <span class="c">! na</span>
<a name="ln-3152"></a>
<a name="ln-3153"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-3154"></a>          <span class="c">! na</span>
<a name="ln-3155"></a>
<a name="ln-3156"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3157"></a>
<a name="ln-3158"></a>  <span class="k">use </span><span class="n">TARCOGGassesParams</span>
<a name="ln-3159"></a>  <span class="k">use </span><span class="n">TARCOGGasses90</span>
<a name="ln-3160"></a>  <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-3161"></a>
<a name="ln-3162"></a>  <span class="k">implicit none</span>
<a name="ln-3163"></a>
<a name="ln-3164"></a><span class="k">  public  </span><span class="n">shading</span>
<a name="ln-3165"></a>  <span class="k">private </span><span class="n">forcedventilation</span>
<a name="ln-3166"></a>  <span class="k">private </span><span class="n">shadingin</span>
<a name="ln-3167"></a>  <span class="k">private </span><span class="n">shadingedge</span>
<a name="ln-3168"></a>
<a name="ln-3169"></a>  <span class="k">contains</span>
<a name="ln-3170"></a>
<a name="ln-3171"></a><span class="k">  subroutine </span><span class="n">shading</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3172"></a>                  <span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Tin</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">Tgaps</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3173"></a>                  <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">)</span>
<a name="ln-3174"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3175"></a>  <span class="c">!  Input:</span>
<a name="ln-3176"></a>  <span class="c">!</span>
<a name="ln-3177"></a>  <span class="c">! theta   Vector of average temperatures</span>
<a name="ln-3178"></a>  <span class="c">!  gap      Vector of gap widths (maxlay) [m]</span>
<a name="ln-3179"></a>  <span class="c">!  hgas    Convective part of gap effective conductivity</span>
<a name="ln-3180"></a>  <span class="c">!  frct    Fraction of gasses in a mixture (maxlay1,maxgas)</span>
<a name="ln-3181"></a>  <span class="c">!  iprop    Vector of gas identifers (maxlay1,maxgas)</span>
<a name="ln-3182"></a>  <span class="c">!  pressure  Vector of gas pressures [N/m^2]</span>
<a name="ln-3183"></a>  <span class="c">!  nmix    Vector of number of gasses for each mixture (maxgas=10)</span>
<a name="ln-3184"></a>  <span class="c">!  nlayer  Number of glazing layers</span>
<a name="ln-3185"></a>  <span class="c">!  width    IGU cavity width [m]</span>
<a name="ln-3186"></a>  <span class="c">!  height  IGU cavity height [m]</span>
<a name="ln-3187"></a>  <span class="c">!  angle    Window angle [degrees]</span>
<a name="ln-3188"></a>  <span class="c">!  Tout    Outdoor temperature [K]</span>
<a name="ln-3189"></a>  <span class="c">!  Tin      Indoor temperature [K]</span>
<a name="ln-3190"></a>  <span class="c">!  Atop    Opening between top of shading device and top of glazing cavity [m^2]</span>
<a name="ln-3191"></a>  <span class="c">!  Abot    Opening between bottom of shading device and bottom of glazing cavity [m^2]</span>
<a name="ln-3192"></a>  <span class="c">!  Al      Opening between left of shading device and left end of glazing cavity [m^2]</span>
<a name="ln-3193"></a>  <span class="c">!  Ar      Opening between right of shading device and right end of glazing cavity [m^2]</span>
<a name="ln-3194"></a>  <span class="c">!  Ah      Total area holes in the shading device [m^2]</span>
<a name="ln-3195"></a>  <span class="c">!  LayerType    Vector of layer types (0 - glazing; 1 - shading)</span>
<a name="ln-3196"></a>  <span class="c">!  Ebf      Vector of emissive power of the front surface (# of layers)</span>
<a name="ln-3197"></a>  <span class="c">!</span>
<a name="ln-3198"></a>  <span class="c">!  Input/Output:</span>
<a name="ln-3199"></a>  <span class="c">!</span>
<a name="ln-3200"></a>  <span class="c">!  Tgaps    Vector of gap temperatures [K]</span>
<a name="ln-3201"></a>  <span class="c">!</span>
<a name="ln-3202"></a>  <span class="c">!  Output:</span>
<a name="ln-3203"></a>  <span class="c">!</span>
<a name="ln-3204"></a>  <span class="c">!  qv      Vector of heat transfer to the gap by vetilation [W/m^2]</span>
<a name="ln-3205"></a>  <span class="c">!  hhatv    Vector of all film coefficients for vented cavities (maxlay3)</span>
<a name="ln-3206"></a>  <span class="c">!  hcv      Vector of surface-to-air heat transfer coefficients by condction/convection for vented cavities [W/(m^2*K)]</span>
<a name="ln-3207"></a>  <span class="c">!  Ebgap    Vector of emissive power of the vented cavities (maxlay3)</span>
<a name="ln-3208"></a>  <span class="c">!  nperr    Error flag</span>
<a name="ln-3209"></a>  <span class="c">! vfreevent   Vector of free ventilation velocities in gaps</span>
<a name="ln-3210"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3211"></a>
<a name="ln-3212"></a>    <span class="k">use </span><span class="n">TarcogCommon</span>
<a name="ln-3213"></a>
<a name="ln-3214"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span>
<a name="ln-3215"></a>    <span class="c">!real(r64), intent(in) :: Ebf(maxlay)</span>
<a name="ln-3216"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-3217"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Tin</span>
<a name="ln-3218"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span>
<a name="ln-3219"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-3220"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-3221"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span>
<a name="ln-3222"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-3223"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pressure</span>
<a name="ln-3224"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-3225"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-3226"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-3227"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-3228"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-3229"></a>
<a name="ln-3230"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qv</span>
<a name="ln-3231"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vfreevent</span>
<a name="ln-3232"></a>
<a name="ln-3233"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgaps</span>
<a name="ln-3234"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-3235"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-3236"></a>
<a name="ln-3237"></a>
<a name="ln-3238"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atops</span><span class="p">,</span> <span class="n">Abots</span><span class="p">,</span> <span class="n">Als</span><span class="p">,</span> <span class="n">Ars</span><span class="p">,</span> <span class="n">Ahs</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">press2</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">hcvs</span>
<a name="ln-3239"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qvs</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">hc1</span><span class="p">,</span> <span class="n">hc2</span>
<a name="ln-3240"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">frct2</span>
<a name="ln-3241"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">speed</span><span class="p">,</span> <span class="n">Tav</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">Temp</span>
<a name="ln-3242"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">speed1</span><span class="p">,</span> <span class="n">speed2</span><span class="p">,</span> <span class="n">Tav1</span><span class="p">,</span> <span class="n">Tav2</span><span class="p">,</span> <span class="n">Tgap1</span><span class="p">,</span> <span class="n">Tgap2</span><span class="p">,</span> <span class="n">hcv1</span><span class="p">,</span> <span class="n">hcv2</span><span class="p">,</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qv2</span>
<a name="ln-3243"></a>
<a name="ln-3244"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-3245"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">nmix2</span>
<a name="ln-3246"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop1</span><span class="p">,</span> <span class="n">iprop2</span>
<a name="ln-3247"></a>
<a name="ln-3248"></a>    <span class="c">! init vectors:</span>
<a name="ln-3249"></a>    <span class="n">qv</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3250"></a>    <span class="c">!hhatv = 0.0</span>
<a name="ln-3251"></a>    <span class="c">!Ebgap = 0.0</span>
<a name="ln-3252"></a>    <span class="c">!hcv = 0.0</span>
<a name="ln-3253"></a>
<a name="ln-3254"></a>    <span class="c">!main loop:</span>
<a name="ln-3255"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-3256"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3257"></a>      <span class="c">!if (LayerType(i).eq.VENETBLIND) then</span>
<a name="ln-3258"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-3259"></a>        <span class="c">!dr.........set Shading device geometry</span>
<a name="ln-3260"></a>        <span class="n">Atops</span> <span class="o">=</span> <span class="n">Atop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3261"></a>        <span class="n">Abots</span> <span class="o">=</span> <span class="n">Abot</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3262"></a>        <span class="n">Als</span>   <span class="o">=</span> <span class="n">Al</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3263"></a>        <span class="n">Ars</span>   <span class="o">=</span> <span class="n">Ar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3264"></a>        <span class="n">Ahs</span>   <span class="o">=</span> <span class="n">Ah</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3265"></a>
<a name="ln-3266"></a>        <span class="c">!dr.....setting gas properies for two adjacent gaps (or enviroment)</span>
<a name="ln-3267"></a>        <span class="n">nmix1</span> <span class="o">=</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3268"></a>        <span class="n">nmix2</span> <span class="o">=</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3269"></a>        <span class="n">press1</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3270"></a>        <span class="n">press2</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3271"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxgas</span>
<a name="ln-3272"></a>          <span class="n">iprop1</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-3273"></a>          <span class="n">iprop2</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-3274"></a>          <span class="n">frct1</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-3275"></a>          <span class="n">frct2</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-3276"></a>        <span class="k">end do</span>  <span class="c">! j</span>
<a name="ln-3277"></a>
<a name="ln-3278"></a>        <span class="c">!dr.......shading on outdoor side</span>
<a name="ln-3279"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3280"></a><span class="k">          </span><span class="n">s</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3281"></a>          <span class="n">hc</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3282"></a>          <span class="c">!Tenv = tvent(1)</span>
<a name="ln-3283"></a>          <span class="n">Tav</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3284"></a>          <span class="n">Tgap</span> <span class="o">=</span> <span class="n">Tgaps</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3285"></a>
<a name="ln-3286"></a>          <span class="c">!bi......use Tout as temp of the air at inlet</span>
<a name="ln-3287"></a>          <span class="k">call </span><span class="n">shadingedge</span><span class="p">(</span><span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span>  <span class="n">press2</span><span class="p">,</span> <span class="n">nmix2</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3288"></a>                            <span class="n">Atops</span><span class="p">,</span> <span class="n">Abots</span><span class="p">,</span> <span class="n">Als</span><span class="p">,</span> <span class="n">Ars</span><span class="p">,</span> <span class="n">Ahs</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">vvent</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">hc</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Tav</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">hcvs</span><span class="p">,</span> <span class="n">qvs</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3289"></a>                            <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
<a name="ln-3290"></a>
<a name="ln-3291"></a>          <span class="c">! exit on error</span>
<a name="ln-3292"></a>          <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span>  <span class="k">return</span>
<a name="ln-3293"></a>
<a name="ln-3294"></a><span class="k">          </span><span class="n">Tgaps</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">Tgap</span>
<a name="ln-3295"></a>          <span class="c">!Ebgap(3) = sigma * Tgap ** 4</span>
<a name="ln-3296"></a>
<a name="ln-3297"></a>          <span class="n">hcgas</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=</span> <span class="n">hcvs</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3298"></a>          <span class="n">hgas</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">hrgas</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3299"></a>          <span class="n">qv</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="o">=</span> <span class="n">qvs</span>
<a name="ln-3300"></a>
<a name="ln-3301"></a>          <span class="c">!bi.........Add free ventilation velocity</span>
<a name="ln-3302"></a>          <span class="n">vfreevent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">speed</span>
<a name="ln-3303"></a>        <span class="k">end if</span> <span class="c">!if (i.eq.1) then</span>
<a name="ln-3304"></a>
<a name="ln-3305"></a>        <span class="c">!dr.......shading on indoor side</span>
<a name="ln-3306"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3307"></a><span class="k">          if</span> <span class="p">(</span><span class="n">nlayer</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3308"></a><span class="k">            </span><span class="n">s</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation gap(nlayer - 1) @ nlayer=1</span>
<a name="ln-3309"></a>            <span class="n">Tav</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0d0</span> <span class="c">!Objexx:BoundsViolation theta(2 * nlayer - 2) @ nlayer=1</span>
<a name="ln-3310"></a>          <span class="k">else</span>
<a name="ln-3311"></a><span class="k">            </span><span class="n">s</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3312"></a>            <span class="n">Tav</span> <span class="o">=</span> <span class="mi">27</span><span class="mf">3.15d0</span>
<a name="ln-3313"></a>          <span class="k">end if</span>
<a name="ln-3314"></a><span class="k">          </span><span class="n">hc</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-3315"></a>          <span class="c">!Tenv = tvent(nlayer + 1)</span>
<a name="ln-3316"></a>
<a name="ln-3317"></a>          <span class="n">Tgap</span> <span class="o">=</span> <span class="n">Tgaps</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-3318"></a>
<a name="ln-3319"></a>          <span class="c">!bi.........use Tin as temp of the air at inlet</span>
<a name="ln-3320"></a>          <span class="k">call </span><span class="n">shadingedge</span><span class="p">(</span><span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span> <span class="n">press2</span><span class="p">,</span> <span class="n">nmix2</span><span class="p">,</span> <span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span>  <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3321"></a>                    <span class="n">Atops</span><span class="p">,</span> <span class="n">Abots</span><span class="p">,</span> <span class="n">Als</span><span class="p">,</span> <span class="n">Ars</span><span class="p">,</span> <span class="n">Ahs</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">vvent</span><span class="p">(</span><span class="n">nlayer</span><span class="p">),</span> <span class="n">hc</span><span class="p">,</span> <span class="n">Tin</span><span class="p">,</span> <span class="n">Tav</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">hcvs</span><span class="p">,</span> <span class="n">qvs</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3322"></a>                    <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
<a name="ln-3323"></a>
<a name="ln-3324"></a>          <span class="c">! exit on error</span>
<a name="ln-3325"></a>          <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span>  <span class="k">return</span>
<a name="ln-3326"></a>
<a name="ln-3327"></a><span class="k">          </span><span class="n">Tgaps</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">=</span> <span class="n">Tgap</span>
<a name="ln-3328"></a>          <span class="n">hcgas</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span>   <span class="o">=</span> <span class="n">hcvs</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3329"></a>          <span class="n">hgas</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">+</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-3330"></a>          <span class="n">qv</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span>    <span class="o">=</span> <span class="n">qvs</span>
<a name="ln-3331"></a>
<a name="ln-3332"></a>          <span class="c">!bi.........Add free ventilation velocity</span>
<a name="ln-3333"></a>          <span class="n">vfreevent</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">speed</span>
<a name="ln-3334"></a>        <span class="k">end if</span> <span class="c">!if (i.eq.nlayer) then</span>
<a name="ln-3335"></a>
<a name="ln-3336"></a>        <span class="c">!dr.......shading between glass layers</span>
<a name="ln-3337"></a>        <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3338"></a>          <span class="c">!dr.........average temperatures</span>
<a name="ln-3339"></a>          <span class="n">Tav1</span>  <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3340"></a>          <span class="n">Tav2</span>  <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3341"></a>          <span class="n">Tgap1</span> <span class="o">=</span> <span class="n">Tgaps</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3342"></a>          <span class="n">Tgap2</span> <span class="o">=</span> <span class="n">Tgaps</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3343"></a>
<a name="ln-3344"></a>          <span class="n">hc1</span>   <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3345"></a>          <span class="n">hc2</span>   <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3346"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="n">s1</span>    <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3347"></a>          <span class="n">s2</span>  <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3348"></a>
<a name="ln-3349"></a>          <span class="c">!speed1 = vvent(i)</span>
<a name="ln-3350"></a>          <span class="c">!speed2 = vvent(i+1)</span>
<a name="ln-3351"></a>
<a name="ln-3352"></a>          <span class="k">if</span> <span class="p">((</span><span class="n">CalcForcedVentilation</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.((</span><span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-3353"></a><span class="k">            call </span><span class="n">forcedventilation</span><span class="p">(</span><span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">hc1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3354"></a>                    <span class="p">&amp;</span> <span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">tvent</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">Tav1</span><span class="p">,</span> <span class="n">hcv1</span><span class="p">,</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3355"></a>            <span class="k">call </span><span class="n">forcedventilation</span><span class="p">(</span><span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span> <span class="n">press2</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">hc1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3356"></a>                    <span class="p">&amp;</span> <span class="n">vvent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">tvent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">Tav2</span><span class="p">,</span> <span class="n">hcv2</span><span class="p">,</span> <span class="n">qv2</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3357"></a>          <span class="k">else</span>
<a name="ln-3358"></a><span class="k">            call </span><span class="n">shadingin</span><span class="p">(</span><span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span>  <span class="n">press2</span><span class="p">,</span> <span class="n">nmix2</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3359"></a>                            <span class="n">Atops</span><span class="p">,</span> <span class="n">Abots</span><span class="p">,</span> <span class="n">Als</span><span class="p">,</span> <span class="n">Ars</span><span class="p">,</span> <span class="n">Ahs</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">hc1</span><span class="p">,</span> <span class="n">hc2</span><span class="p">,</span> <span class="n">speed1</span><span class="p">,</span> <span class="n">speed2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3360"></a>                            <span class="n">Tgap1</span><span class="p">,</span> <span class="n">Tgap2</span><span class="p">,</span> <span class="n">Tav1</span><span class="p">,</span> <span class="n">Tav2</span><span class="p">,</span> <span class="n">hcv1</span><span class="p">,</span> <span class="n">hcv2</span><span class="p">,</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qv2</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3361"></a>          <span class="k">end if</span>
<a name="ln-3362"></a>
<a name="ln-3363"></a>          <span class="c">! exit on error</span>
<a name="ln-3364"></a>          <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span>  <span class="k">return</span>
<a name="ln-3365"></a>
<a name="ln-3366"></a>          <span class="c">!if (vvent(i).gt.0) then !not implemented for inside shadin yet</span>
<a name="ln-3367"></a>          <span class="c">!  nperr = 1006</span>
<a name="ln-3368"></a>          <span class="c">!  ErrorMessage = &#39;Forced ventilation not implemented for internal SD layers.&#39;</span>
<a name="ln-3369"></a>          <span class="c">!  return</span>
<a name="ln-3370"></a>          <span class="c">!end if</span>
<a name="ln-3371"></a>
<a name="ln-3372"></a>          <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">hcv1</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3373"></a>          <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcv2</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3374"></a>          <span class="n">hgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-3375"></a>          <span class="n">hgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3376"></a>          <span class="n">qv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>      <span class="o">=</span> <span class="n">qv1</span>
<a name="ln-3377"></a>          <span class="n">qv</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>    <span class="o">=</span> <span class="n">qv2</span>
<a name="ln-3378"></a>          <span class="n">Tgaps</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>         <span class="o">=</span> <span class="n">Tgap1</span>
<a name="ln-3379"></a>          <span class="n">Tgaps</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>     <span class="o">=</span> <span class="n">Tgap2</span>
<a name="ln-3380"></a>          <span class="c">!bi.........Add free ventilation velocity</span>
<a name="ln-3381"></a>          <span class="n">vfreevent</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">speed1</span>
<a name="ln-3382"></a>          <span class="n">vfreevent</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">speed2</span>
<a name="ln-3383"></a>        <span class="k">end if</span> <span class="c">!if ((i.gt.1).and.(i.lt.nlayer)) then</span>
<a name="ln-3384"></a>      <span class="k">end if</span>  <span class="c">!if (LayerType(i).eq.SHADING) then</span>
<a name="ln-3385"></a>    <span class="k">end do</span>
<a name="ln-3386"></a>
<a name="ln-3387"></a><span class="k">  end subroutine</span>
<a name="ln-3388"></a>
<a name="ln-3389"></a><span class="k">  subroutine </span><span class="n">forcedventilation</span><span class="p">(</span><span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">press</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3390"></a>        <span class="p">&amp;</span> <span class="n">forcedspeed</span><span class="p">,</span> <span class="n">Tinlet</span><span class="p">,</span> <span class="n">Toutlet</span><span class="p">,</span> <span class="n">Tav</span><span class="p">,</span> <span class="n">hcv</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3391"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3392"></a>  <span class="c">!  Input:</span>
<a name="ln-3393"></a>  <span class="c">!</span>
<a name="ln-3394"></a>  <span class="c">!  iprop      Vector of gas identifiers</span>
<a name="ln-3395"></a>  <span class="c">!  frct      Fraction of gasses in a mixture</span>
<a name="ln-3396"></a>  <span class="c">!  nmix      Number of gasses in a mixture</span>
<a name="ln-3397"></a>  <span class="c">!  press      Pressure in mixture</span>
<a name="ln-3398"></a>  <span class="c">!  s1        Gap width [m]</span>
<a name="ln-3399"></a>  <span class="c">!  H          IGU cavity height [m]</span>
<a name="ln-3400"></a>  <span class="c">!  L          IGU cavity width [m]</span>
<a name="ln-3401"></a>  <span class="c">!  hc        Convective/conductive coefficient for non-vented gap</span>
<a name="ln-3402"></a>  <span class="c">!  Tav        Average temperature of gap surfaces</span>
<a name="ln-3403"></a>  <span class="c">! Tinlet    Temperature of inlet air</span>
<a name="ln-3404"></a>  <span class="c">!</span>
<a name="ln-3405"></a>  <span class="c">!  Output:</span>
<a name="ln-3406"></a>  <span class="c">!</span>
<a name="ln-3407"></a>  <span class="c">!  hcv    Convective/conductive coefficient for vented gap</span>
<a name="ln-3408"></a>  <span class="c">!  qv    Heat transfer to the gap by vetilation [W/m^2]</span>
<a name="ln-3409"></a>  <span class="c">!  nperr      Error flag</span>
<a name="ln-3410"></a>  <span class="c">! ErrorMessage string containing error message</span>
<a name="ln-3411"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3412"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-3413"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-3414"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-3415"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-3416"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-3417"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">press</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">H</span>
<a name="ln-3418"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hc</span><span class="p">,</span> <span class="n">Tav</span><span class="p">,</span> <span class="n">forcedspeed</span><span class="p">,</span> <span class="n">Tinlet</span>
<a name="ln-3419"></a>
<a name="ln-3420"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcv</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">Toutlet</span>
<a name="ln-3421"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-3422"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-3423"></a>
<a name="ln-3424"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">H0</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span>
<a name="ln-3425"></a>
<a name="ln-3426"></a>    <span class="k">call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">Tav</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">press</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3427"></a>
<a name="ln-3428"></a>    <span class="n">H0</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens</span> <span class="o">*</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">forcedspeed</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">hc</span> <span class="o">+</span> <span class="mf">8.0d0</span> <span class="o">*</span> <span class="n">forcedspeed</span><span class="p">)</span>
<a name="ln-3429"></a>
<a name="ln-3430"></a>    <span class="n">Toutlet</span> <span class="o">=</span> <span class="n">Tav</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tav</span> <span class="o">-</span> <span class="n">Tinlet</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">H</span><span class="o">/</span><span class="n">H0</span><span class="p">))</span>
<a name="ln-3431"></a>
<a name="ln-3432"></a>    <span class="n">qv</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dens</span> <span class="o">*</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">forcedspeed</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">Toutlet</span> <span class="o">-</span> <span class="n">Tinlet</span><span class="p">)</span> <span class="o">/</span> <span class="n">H</span>
<a name="ln-3433"></a>
<a name="ln-3434"></a>    <span class="c">!Need to calculate surface-to-air convection heat transfer coefficient.  This is needed later to calculate layer</span>
<a name="ln-3435"></a>    <span class="c">!to gap thermal resistance</span>
<a name="ln-3436"></a>    <span class="n">hcv</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">hc</span> <span class="o">+</span> <span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">forcedspeed</span>
<a name="ln-3437"></a>
<a name="ln-3438"></a>  <span class="k">end subroutine </span><span class="n">forcedventilation</span>
<a name="ln-3439"></a>
<a name="ln-3440"></a>  <span class="k">subroutine </span><span class="n">shadingin</span><span class="p">(</span><span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span>  <span class="n">press2</span><span class="p">,</span> <span class="n">nmix2</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-3441"></a>                        <span class="p">&amp;</span>  <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">hc1</span><span class="p">,</span> <span class="n">hc2</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-3442"></a>                        <span class="p">&amp;</span>  <span class="n">speed1</span><span class="p">,</span> <span class="n">speed2</span><span class="p">,</span> <span class="n">Tgap1</span><span class="p">,</span> <span class="n">Tgap2</span><span class="p">,</span> <span class="n">Tav1</span><span class="p">,</span> <span class="n">Tav2</span><span class="p">,</span> <span class="n">hcv1</span><span class="p">,</span> <span class="n">hcv2</span><span class="p">,</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qv2</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3443"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3444"></a>  <span class="c">!  Input:</span>
<a name="ln-3445"></a>  <span class="c">!</span>
<a name="ln-3446"></a>  <span class="c">!  iprop1      Vector of gas identifiers</span>
<a name="ln-3447"></a>  <span class="c">!  frct1      Fraction of gasses in a mixture</span>
<a name="ln-3448"></a>  <span class="c">!  nmix1      Number of gasses in a mixture</span>
<a name="ln-3449"></a>  <span class="c">!  press1      Pressure in mixture</span>
<a name="ln-3450"></a>  <span class="c">!  iprop2      Vector of gas identifiers</span>
<a name="ln-3451"></a>  <span class="c">!  frct2      Fraction of gasses in a mixture</span>
<a name="ln-3452"></a>  <span class="c">!  nmix2      Number of gasses in a mixture</span>
<a name="ln-3453"></a>  <span class="c">!  press2      Pressure in mixture</span>
<a name="ln-3454"></a>  <span class="c">!  Atop      Opening between top of shading device and top of glazing cavity [m^2]</span>
<a name="ln-3455"></a>  <span class="c">!  Abot      Opening between bottom of shading device and bottom of glazing cavity [m^2]</span>
<a name="ln-3456"></a>  <span class="c">!  Al        Opening between left of shading device and left end of glazing cavity [m^2]</span>
<a name="ln-3457"></a>  <span class="c">!  Ar        Opening between right of shading device and right end of glazing cavity [m^2]</span>
<a name="ln-3458"></a>  <span class="c">!  Ah        Total area holes in the shading device [m^2]</span>
<a name="ln-3459"></a>  <span class="c">!  s1, s2      Gap width [m]</span>
<a name="ln-3460"></a>  <span class="c">!  H        IGU cavity height [m]</span>
<a name="ln-3461"></a>  <span class="c">!  L        IGU cavity width [m]</span>
<a name="ln-3462"></a>  <span class="c">!  angle      Window angle [degrees]</span>
<a name="ln-3463"></a>  <span class="c">!  hc1, hc2    Convective/conductive coefficient for non-vented gap</span>
<a name="ln-3464"></a>  <span class="c">!  Tav1, Tav2    Average temperature of gap surfaces</span>
<a name="ln-3465"></a>  <span class="c">!</span>
<a name="ln-3466"></a>  <span class="c">!  Output:</span>
<a name="ln-3467"></a>  <span class="c">!</span>
<a name="ln-3468"></a>  <span class="c">!  Tgap1, Tgap2  Temperature of vented gap</span>
<a name="ln-3469"></a>  <span class="c">!  hcv1, hcv2    Convective/conductive coefficient for vented gap</span>
<a name="ln-3470"></a>  <span class="c">!  qv1, qv2    Heat transfer to the gap by vetilation [W/m^2]</span>
<a name="ln-3471"></a>  <span class="c">!  speed1, speed2  Air/gas velocities in gaps around SD layer</span>
<a name="ln-3472"></a>  <span class="c">!  nperr      Error flag</span>
<a name="ln-3473"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3474"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">KelvinConv</span>
<a name="ln-3475"></a>
<a name="ln-3476"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop1</span><span class="p">,</span> <span class="n">iprop2</span>
<a name="ln-3477"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">nmix2</span>
<a name="ln-3478"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">frct2</span>
<a name="ln-3479"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-3480"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-3481"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">press1</span><span class="p">,</span> <span class="n">press2</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">angle</span>
<a name="ln-3482"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span>
<a name="ln-3483"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hc1</span><span class="p">,</span> <span class="n">hc2</span><span class="p">,</span> <span class="n">Tav1</span><span class="p">,</span> <span class="n">Tav2</span>
<a name="ln-3484"></a>
<a name="ln-3485"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap1</span><span class="p">,</span> <span class="n">Tgap2</span> <span class="c">!Objexx:ArgIN Changed IN to INOUT: These are used and modified</span>
<a name="ln-3486"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcv1</span><span class="p">,</span> <span class="n">hcv2</span><span class="p">,</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qv2</span><span class="p">,</span> <span class="n">speed1</span><span class="p">,</span> <span class="n">speed2</span>
<a name="ln-3487"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-3488"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-3489"></a>
<a name="ln-3490"></a>
<a name="ln-3491"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">A</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="n">D1</span><span class="p">,</span> <span class="n">D2</span>
<a name="ln-3492"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Zin1</span><span class="p">,</span> <span class="n">Zin2</span><span class="p">,</span> <span class="n">Zout1</span><span class="p">,</span> <span class="n">Zout2</span>
<a name="ln-3493"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">A1eqin</span><span class="p">,</span> <span class="n">A1eqout</span><span class="p">,</span> <span class="n">A2eqin</span><span class="p">,</span> <span class="n">A2eqout</span>
<a name="ln-3494"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">T0</span><span class="p">,</span> <span class="n">tilt</span>
<a name="ln-3495"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">dens0</span><span class="p">,</span> <span class="n">visc0</span><span class="p">,</span> <span class="n">con0</span><span class="p">,</span> <span class="n">pr0</span><span class="p">,</span> <span class="n">cp0</span>
<a name="ln-3496"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">dens1</span><span class="p">,</span> <span class="n">visc1</span><span class="p">,</span> <span class="n">con1</span><span class="p">,</span> <span class="n">pr1</span><span class="p">,</span> <span class="n">cp1</span>
<a name="ln-3497"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">dens2</span><span class="p">,</span> <span class="n">visc2</span><span class="p">,</span> <span class="n">con2</span><span class="p">,</span> <span class="n">pr2</span><span class="p">,</span> <span class="n">cp2</span>
<a name="ln-3498"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Tup</span><span class="p">,</span> <span class="n">Tdown</span>
<a name="ln-3499"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">H01</span><span class="p">,</span> <span class="n">H02</span><span class="p">,</span> <span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="n">alpha1</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span>
<a name="ln-3500"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">qsmooth</span>
<a name="ln-3501"></a>
<a name="ln-3502"></a>    <span class="c">! iteration parameters</span>
<a name="ln-3503"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iter</span>
<a name="ln-3504"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">TGapOld1</span><span class="p">,</span> <span class="n">TGapOld2</span><span class="p">,</span> <span class="n">Temp1</span><span class="p">,</span> <span class="n">Temp2</span>
<a name="ln-3505"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">converged</span>
<a name="ln-3506"></a>
<a name="ln-3507"></a>    <span class="n">TGapOld1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3508"></a>    <span class="n">TGapOld2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3509"></a>    <span class="n">tilt</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">180</span> <span class="o">*</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span>
<a name="ln-3510"></a>    <span class="n">T0</span> <span class="o">=</span> <span class="mf">0.0d0</span> <span class="o">+</span> <span class="n">KelvinConv</span>
<a name="ln-3511"></a>    <span class="n">A1eqin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3512"></a>    <span class="n">A2eqout</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3513"></a>    <span class="n">A1eqout</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3514"></a>    <span class="n">A2eqin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3515"></a>    <span class="n">P1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3516"></a>    <span class="n">P2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3517"></a>
<a name="ln-3518"></a>    <span class="k">call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">con0</span><span class="p">,</span> <span class="n">visc0</span><span class="p">,</span> <span class="n">dens0</span><span class="p">,</span> <span class="n">cp0</span><span class="p">,</span> <span class="n">pr0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3519"></a>                    <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3520"></a>
<a name="ln-3521"></a>    <span class="c">! exit on error:</span>
<a name="ln-3522"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span>  <span class="k">return</span>
<a name="ln-3523"></a>
<a name="ln-3524"></a>  <span class="c">!dr...check for error messages</span>
<a name="ln-3525"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">Tgap1</span><span class="o">*</span><span class="n">Tgap2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3526"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">15</span>
<a name="ln-3527"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Temperature of vented gap must be greater than 0 [K].&#39;</span>
<a name="ln-3528"></a>      <span class="k">return</span>
<a name="ln-3529"></a><span class="k">    end if</span>
<a name="ln-3530"></a>
<a name="ln-3531"></a><span class="k">    if</span> <span class="p">((</span><span class="n">Atop</span> <span class="o">+</span> <span class="n">Abot</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3532"></a>  <span class="c">!    nperr = 16</span>
<a name="ln-3533"></a>  <span class="c">!    return</span>
<a name="ln-3534"></a>      <span class="n">Atop</span> <span class="o">=</span> <span class="mf">0.000001d0</span>
<a name="ln-3535"></a>      <span class="n">Abot</span> <span class="o">=</span> <span class="mf">0.000001d0</span>
<a name="ln-3536"></a>    <span class="k">end if</span>
<a name="ln-3537"></a>
<a name="ln-3538"></a><span class="k">    </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3539"></a>    <span class="n">iter</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3540"></a>    <span class="k">do while</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">converged</span><span class="p">)</span>
<a name="ln-3541"></a>      <span class="n">iter</span> <span class="o">=</span> <span class="n">iter</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3542"></a>      <span class="k">call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">Tgap1</span><span class="p">,</span> <span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">con1</span><span class="p">,</span> <span class="n">visc1</span><span class="p">,</span> <span class="n">dens1</span><span class="p">,</span> <span class="n">cp1</span><span class="p">,</span> <span class="n">pr1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3543"></a>                    <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3544"></a>      <span class="k">call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">Tgap2</span><span class="p">,</span> <span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span> <span class="n">press2</span><span class="p">,</span> <span class="n">nmix2</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">con2</span><span class="p">,</span> <span class="n">visc2</span><span class="p">,</span> <span class="n">dens2</span><span class="p">,</span> <span class="n">cp2</span><span class="p">,</span> <span class="n">pr2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3545"></a>                    <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3546"></a>
<a name="ln-3547"></a>      <span class="c">!  A = dens0 * T0 * GravityConstant * abs(cos(tilt)) * abs(Tgap1 - Tgap2) / (Tgap1 * Tgap2)</span>
<a name="ln-3548"></a>
<a name="ln-3549"></a>      <span class="c">!bi...Bug fix #00005:</span>
<a name="ln-3550"></a>      <span class="n">A</span> <span class="o">=</span> <span class="n">dens0</span> <span class="o">*</span> <span class="n">T0</span> <span class="o">*</span> <span class="n">GravityConstant</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="nb">ABS</span><span class="p">(</span><span class="nb">COS</span><span class="p">(</span><span class="n">tilt</span><span class="p">))</span> <span class="o">*</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">Tgap1</span> <span class="o">-</span> <span class="n">Tgap2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tgap1</span> <span class="o">*</span> <span class="n">Tgap2</span><span class="p">)</span>
<a name="ln-3551"></a>
<a name="ln-3552"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3553"></a><span class="k">        </span><span class="n">qv1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3554"></a>        <span class="n">qv2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3555"></a>        <span class="n">speed1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3556"></a>        <span class="n">speed2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3557"></a>        <span class="n">hcv1</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">hc1</span>
<a name="ln-3558"></a>        <span class="n">hcv2</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">hc2</span>
<a name="ln-3559"></a>        <span class="k">return</span>
<a name="ln-3560"></a><span class="k">      </span><span class="n">endif</span>
<a name="ln-3561"></a>
<a name="ln-3562"></a>      <span class="n">B1</span> <span class="o">=</span> <span class="n">dens1</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-3563"></a>      <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">s1</span> <span class="o">/</span> <span class="n">s2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-3564"></a>
<a name="ln-3565"></a>      <span class="n">C1</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">visc1</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">s1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-3566"></a>      <span class="n">C2</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">visc2</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">s2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">s1</span> <span class="o">/</span> <span class="n">s2</span><span class="p">)</span>
<a name="ln-3567"></a>
<a name="ln-3568"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">Tgap1</span> <span class="o">&gt;=</span> <span class="n">Tgap2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3569"></a><span class="k">        </span><span class="n">A1eqin</span> <span class="o">=</span> <span class="n">Abot</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Atop</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3570"></a>        <span class="n">A2eqout</span> <span class="o">=</span> <span class="n">Abot</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Atop</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3571"></a>        <span class="n">A1eqout</span> <span class="o">=</span> <span class="n">Atop</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Abot</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3572"></a>        <span class="n">A2eqin</span> <span class="o">=</span> <span class="n">Atop</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Abot</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3573"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">Tgap1</span> <span class="o">&lt;</span> <span class="n">Tgap2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3574"></a><span class="k">        </span><span class="n">A1eqout</span> <span class="o">=</span> <span class="n">Abot</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Atop</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3575"></a>        <span class="n">A2eqin</span> <span class="o">=</span> <span class="n">Abot</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Atop</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3576"></a>        <span class="n">A1eqin</span> <span class="o">=</span> <span class="n">Atop</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Abot</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3577"></a>        <span class="n">A2eqout</span> <span class="o">=</span> <span class="n">Atop</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Abot</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3578"></a>      <span class="k">end if</span>
<a name="ln-3579"></a>
<a name="ln-3580"></a><span class="k">      </span><span class="n">Zin1</span> <span class="o">=</span> <span class="p">((</span><span class="n">s1</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.6d0</span> <span class="o">*</span> <span class="n">A1eqin</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<a name="ln-3581"></a>      <span class="n">Zin2</span> <span class="o">=</span> <span class="p">((</span><span class="n">s2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.6d0</span> <span class="o">*</span> <span class="n">A2eqin</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<a name="ln-3582"></a>      <span class="n">Zout1</span> <span class="o">=</span> <span class="p">((</span><span class="n">s1</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.6d0</span> <span class="o">*</span> <span class="n">A1eqout</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<a name="ln-3583"></a>      <span class="n">Zout2</span> <span class="o">=</span> <span class="p">((</span><span class="n">s2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.6d0</span> <span class="o">*</span> <span class="n">A2eqout</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<a name="ln-3584"></a>
<a name="ln-3585"></a>      <span class="n">D1</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens1</span> <span class="o">/</span> <span class="mf">2.0d0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Zin1</span> <span class="o">+</span> <span class="n">Zout1</span><span class="p">)</span>
<a name="ln-3586"></a>      <span class="n">D2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens2</span> <span class="o">/</span> <span class="mf">2.0d0</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">s1</span> <span class="o">/</span> <span class="n">s2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Zin2</span> <span class="o">+</span> <span class="n">Zout2</span><span class="p">)</span>
<a name="ln-3587"></a>
<a name="ln-3588"></a>      <span class="n">A1</span> <span class="o">=</span> <span class="n">B1</span> <span class="o">+</span> <span class="n">D1</span> <span class="o">+</span> <span class="n">B2</span> <span class="o">+</span> <span class="n">D2</span>
<a name="ln-3589"></a>      <span class="n">A2</span> <span class="o">=</span> <span class="n">C1</span> <span class="o">+</span> <span class="n">C2</span>
<a name="ln-3590"></a>
<a name="ln-3591"></a>      <span class="n">speed1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">SQRT</span><span class="p">((</span><span class="n">A2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">ABS</span><span class="p">(</span><span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">A1</span><span class="p">))</span> <span class="o">-</span> <span class="n">A2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">A1</span><span class="p">)</span>
<a name="ln-3592"></a>      <span class="n">speed2</span> <span class="o">=</span> <span class="n">speed1</span> <span class="o">*</span> <span class="n">s1</span> <span class="o">/</span> <span class="n">s2</span>
<a name="ln-3593"></a>
<a name="ln-3594"></a>      <span class="n">H01</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens1</span> <span class="o">*</span> <span class="n">cp1</span> <span class="o">*</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">speed1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">hc1</span> <span class="o">+</span> <span class="mf">8.0d0</span> <span class="o">*</span> <span class="n">speed1</span><span class="p">)</span>
<a name="ln-3595"></a>      <span class="n">H02</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens2</span> <span class="o">*</span> <span class="n">cp2</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">speed2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">hc2</span> <span class="o">+</span> <span class="mf">8.0d0</span> <span class="o">*</span> <span class="n">speed2</span><span class="p">)</span>
<a name="ln-3596"></a>
<a name="ln-3597"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">H01</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">H02</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3598"></a><span class="k">        </span><span class="n">P1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">H</span> <span class="o">/</span> <span class="n">H01</span>
<a name="ln-3599"></a>        <span class="n">P2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">H</span> <span class="o">/</span> <span class="n">H02</span>
<a name="ln-3600"></a>      <span class="k">end if</span>
<a name="ln-3601"></a>
<a name="ln-3602"></a><span class="k">      </span><span class="n">beta1</span> <span class="o">=</span> <span class="n">e</span> <span class="o">**</span> <span class="n">P1</span>
<a name="ln-3603"></a>      <span class="n">beta2</span> <span class="o">=</span> <span class="n">e</span> <span class="o">**</span> <span class="n">P2</span>
<a name="ln-3604"></a>
<a name="ln-3605"></a>      <span class="n">alpha1</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">beta1</span>
<a name="ln-3606"></a>      <span class="n">alpha2</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">beta2</span>
<a name="ln-3607"></a>
<a name="ln-3608"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">Tgap1</span> <span class="o">&gt;</span> <span class="n">Tgap2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3609"></a><span class="k">        </span><span class="n">Tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha1</span> <span class="o">*</span> <span class="n">Tav1</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">alpha2</span> <span class="o">*</span> <span class="n">Tav2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">beta2</span><span class="p">)</span>
<a name="ln-3610"></a>        <span class="n">Tdown</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">*</span> <span class="n">Tav2</span> <span class="o">+</span> <span class="n">beta2</span> <span class="o">*</span> <span class="n">Tup</span>
<a name="ln-3611"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">Tgap2</span> <span class="o">&gt;=</span> <span class="n">Tgap1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3612"></a><span class="k">        </span><span class="n">Tdown</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha1</span> <span class="o">*</span> <span class="n">Tav1</span> <span class="o">+</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">alpha2</span> <span class="o">*</span> <span class="n">Tav2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">beta2</span><span class="p">)</span>
<a name="ln-3613"></a>        <span class="n">Tup</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">*</span> <span class="n">Tav2</span> <span class="o">+</span> <span class="n">beta2</span> <span class="o">*</span> <span class="n">Tdown</span>
<a name="ln-3614"></a>      <span class="k">end if</span>
<a name="ln-3615"></a>
<a name="ln-3616"></a><span class="k">      </span><span class="n">TGapOld1</span> <span class="o">=</span> <span class="n">Tgap1</span>
<a name="ln-3617"></a>      <span class="n">TGapOld2</span> <span class="o">=</span> <span class="n">Tgap2</span>
<a name="ln-3618"></a>
<a name="ln-3619"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">Tgap1</span> <span class="o">&gt;</span> <span class="n">Tgap2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3620"></a><span class="k">        </span><span class="n">Temp1</span> <span class="o">=</span> <span class="n">Tav1</span> <span class="o">-</span> <span class="p">(</span><span class="n">H01</span> <span class="o">/</span> <span class="n">H</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tup</span> <span class="o">-</span> <span class="n">Tdown</span><span class="p">)</span>
<a name="ln-3621"></a>        <span class="n">Temp2</span> <span class="o">=</span> <span class="n">Tav2</span> <span class="o">-</span> <span class="p">(</span><span class="n">H02</span> <span class="o">/</span> <span class="n">H</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tdown</span> <span class="o">-</span> <span class="n">Tup</span><span class="p">)</span>
<a name="ln-3622"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">Tgap2</span> <span class="o">&gt;=</span> <span class="n">Tgap1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3623"></a><span class="k">        </span><span class="n">Temp1</span> <span class="o">=</span> <span class="n">Tav1</span> <span class="o">-</span> <span class="p">(</span><span class="n">H01</span> <span class="o">/</span> <span class="n">H</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tdown</span> <span class="o">-</span> <span class="n">Tup</span><span class="p">)</span>
<a name="ln-3624"></a>        <span class="n">Temp2</span> <span class="o">=</span> <span class="n">Tav2</span> <span class="o">-</span> <span class="p">(</span><span class="n">H02</span> <span class="o">/</span> <span class="n">H</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tup</span> <span class="o">-</span> <span class="n">Tdown</span><span class="p">)</span>
<a name="ln-3625"></a>      <span class="k">end if</span>
<a name="ln-3626"></a>
<a name="ln-3627"></a><span class="k">      </span><span class="n">Tgap1</span> <span class="o">=</span> <span class="n">AirflowRelaxationParameter</span> <span class="o">*</span> <span class="n">Temp1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">AirflowRelaxationParameter</span><span class="p">)</span> <span class="o">*</span> <span class="n">TGapOld1</span>
<a name="ln-3628"></a>      <span class="n">Tgap2</span> <span class="o">=</span> <span class="n">AirflowRelaxationParameter</span> <span class="o">*</span> <span class="n">Temp2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">AirflowRelaxationParameter</span><span class="p">)</span> <span class="o">*</span> <span class="n">TGapOld2</span>
<a name="ln-3629"></a>
<a name="ln-3630"></a>      <span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3631"></a>      <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">Tgap1</span> <span class="o">-</span> <span class="n">TGapOld1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">AirflowConvergenceTolerance</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">iter</span> <span class="o">&gt;=</span> <span class="n">NumOfIterations</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3632"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Tgap2</span> <span class="o">-</span> <span class="n">TGapOld2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">AirflowConvergenceTolerance</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3633"></a><span class="k">          </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-3634"></a>        <span class="k">end if</span>
<a name="ln-3635"></a><span class="k">      </span><span class="n">endif</span>
<a name="ln-3636"></a>
<a name="ln-3637"></a>    <span class="k">end do</span>
<a name="ln-3638"></a>
<a name="ln-3639"></a><span class="k">    </span><span class="n">hcv1</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">hc1</span> <span class="o">+</span> <span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">speed1</span>
<a name="ln-3640"></a>    <span class="n">hcv2</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">hc2</span> <span class="o">+</span> <span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">speed2</span>
<a name="ln-3641"></a>
<a name="ln-3642"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">Tgap2</span> <span class="o">&gt;=</span> <span class="n">Tgap1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3643"></a><span class="k">      </span><span class="n">qv1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dens1</span> <span class="o">*</span> <span class="n">cp1</span> <span class="o">*</span> <span class="n">speed1</span> <span class="o">*</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tdown</span> <span class="o">-</span> <span class="n">Tup</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">L</span><span class="p">)</span>
<a name="ln-3644"></a>      <span class="n">qv2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dens2</span> <span class="o">*</span> <span class="n">cp2</span> <span class="o">*</span> <span class="n">speed2</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tup</span> <span class="o">-</span> <span class="n">Tdown</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">L</span><span class="p">)</span>
<a name="ln-3645"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">Tgap2</span> <span class="o">&lt;</span> <span class="n">Tgap1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3646"></a><span class="k">      </span><span class="n">qv1</span> <span class="o">=</span>  <span class="n">dens1</span> <span class="o">*</span> <span class="n">cp1</span> <span class="o">*</span> <span class="n">speed1</span> <span class="o">*</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tdown</span> <span class="o">-</span> <span class="n">Tup</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">L</span><span class="p">)</span>
<a name="ln-3647"></a>      <span class="n">qv2</span> <span class="o">=</span>  <span class="n">dens2</span> <span class="o">*</span> <span class="n">cp2</span> <span class="o">*</span> <span class="n">speed2</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tup</span> <span class="o">-</span> <span class="n">Tdown</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">L</span><span class="p">)</span>
<a name="ln-3648"></a>    <span class="k">end if</span>
<a name="ln-3649"></a>
<a name="ln-3650"></a>  <span class="c">!  write(*, *) Tup-Tdown</span>
<a name="ln-3651"></a>  <span class="c">!  write(*, 998) Tup - Tdown, qv1, qv2</span>
<a name="ln-3652"></a>
<a name="ln-3653"></a>  <span class="c">!998  format(f15.9, f15.9, f15.9)</span>
<a name="ln-3654"></a>
<a name="ln-3655"></a>  <span class="c">!bi..  testing - velocities output file</span>
<a name="ln-3656"></a>  <span class="c">!bi      open(unit = 33, file = &#39;velocities.out&#39;, status=&#39;unknown&#39;, form=&#39;formatted&#39;, iostat = er)</span>
<a name="ln-3657"></a>
<a name="ln-3658"></a>  <span class="c">!bi  write(33, 987) speed1</span>
<a name="ln-3659"></a>
<a name="ln-3660"></a>    <span class="n">qsmooth</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">qv1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">qv2</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-3661"></a>
<a name="ln-3662"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">qv1</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3663"></a><span class="k">      </span><span class="n">qv1</span> <span class="o">=</span> <span class="n">qsmooth</span>
<a name="ln-3664"></a>      <span class="n">qv2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">qsmooth</span>
<a name="ln-3665"></a>    <span class="k">else</span>
<a name="ln-3666"></a><span class="k">      </span><span class="n">qv1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">qsmooth</span>
<a name="ln-3667"></a>      <span class="n">qv2</span> <span class="o">=</span> <span class="n">qsmooth</span>
<a name="ln-3668"></a>    <span class="k">end if</span>
<a name="ln-3669"></a>
<a name="ln-3670"></a><span class="k">  </span><span class="mi">987</span>   <span class="k">format</span><span class="p">(</span><span class="s1">&#39; V = &#39;</span><span class="p">,</span> <span class="n">F8</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-3671"></a>
<a name="ln-3672"></a>  <span class="k">end subroutine</span>
<a name="ln-3673"></a>
<a name="ln-3674"></a><span class="k">  subroutine </span><span class="n">shadingedge</span><span class="p">(</span><span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span>  <span class="n">press2</span><span class="p">,</span> <span class="n">nmix2</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3675"></a>                  <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">forcedspeed</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">Tenv</span><span class="p">,</span> <span class="n">Tav</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">hcv</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
<a name="ln-3676"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3677"></a>  <span class="c">!  Input:</span>
<a name="ln-3678"></a>  <span class="c">!</span>
<a name="ln-3679"></a>  <span class="c">!  iprop1      Vector of gas identifiers</span>
<a name="ln-3680"></a>  <span class="c">!  frct1      Fraction of gasses in a mixture</span>
<a name="ln-3681"></a>  <span class="c">!  nmix1      Number of gasses in a mixture</span>
<a name="ln-3682"></a>  <span class="c">!  press1      Pressure in mixture</span>
<a name="ln-3683"></a>  <span class="c">!  iprop2      Vector of gas identifiers</span>
<a name="ln-3684"></a>  <span class="c">!  frct2      Fraction of gasses in a mixture</span>
<a name="ln-3685"></a>  <span class="c">!  nmix2      Number of gasses in a mixture</span>
<a name="ln-3686"></a>  <span class="c">!  press2      Pressure in mixture</span>
<a name="ln-3687"></a>  <span class="c">!  Atop      Opening between top of shading device and top of glazing cavity [m^2]</span>
<a name="ln-3688"></a>  <span class="c">!  Abot      Opening between bottom of shading device and bottom of glazing cavity [m^2]</span>
<a name="ln-3689"></a>  <span class="c">!  Al        Opening between left of shading device and left end of glazing cavity [m^2]</span>
<a name="ln-3690"></a>  <span class="c">!  Ar        Opening between right of shading device and right end of glazing cavity [m^2]</span>
<a name="ln-3691"></a>  <span class="c">!  Ah        Total area holes in the shading device [m^2]</span>
<a name="ln-3692"></a>  <span class="c">!  s        Gap width [m]</span>
<a name="ln-3693"></a>  <span class="c">!  H        IGU cavity height [m]</span>
<a name="ln-3694"></a>  <span class="c">!  L        IGU cavity width [m]</span>
<a name="ln-3695"></a>  <span class="c">!  angle      Window angle [degrees]</span>
<a name="ln-3696"></a>  <span class="c">!  forcedspeed    Speed of forced ventilation [m/s]</span>
<a name="ln-3697"></a>  <span class="c">!  hc        Convective/conductive coefficient for non-vented gap</span>
<a name="ln-3698"></a>  <span class="c">!  Tenv      Enviromental temperature</span>
<a name="ln-3699"></a>  <span class="c">!  Tav        Average temperature of gap surfaces</span>
<a name="ln-3700"></a>  <span class="c">!</span>
<a name="ln-3701"></a>  <span class="c">!  Output:</span>
<a name="ln-3702"></a>  <span class="c">!</span>
<a name="ln-3703"></a>  <span class="c">!  Tgap      Temperature of vented gap</span>
<a name="ln-3704"></a>  <span class="c">!  hcv        Convective/conductive coefficient for vented gap</span>
<a name="ln-3705"></a>  <span class="c">!  qv        Heat transfer to the gap by vetilation [W/m^2]</span>
<a name="ln-3706"></a>  <span class="c">!  nperr      Error flag</span>
<a name="ln-3707"></a>  <span class="c">!  speed      Air velocity</span>
<a name="ln-3708"></a>  <span class="c">!**************************************************************************************************************</span>
<a name="ln-3709"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">KelvinConv</span>
<a name="ln-3710"></a>
<a name="ln-3711"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop1</span><span class="p">,</span> <span class="n">iprop2</span>
<a name="ln-3712"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">nmix2</span>
<a name="ln-3713"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">frct2</span>
<a name="ln-3714"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>
<a name="ln-3715"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-3716"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">press1</span><span class="p">,</span> <span class="n">press2</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">Tenv</span><span class="p">,</span> <span class="n">Tav</span>
<a name="ln-3717"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Ah</span>
<a name="ln-3718"></a>
<a name="ln-3719"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap</span> <span class="c">!Objexx:ArgIN Changed IN to INOUT: Arg used and modified</span>
<a name="ln-3720"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcv</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">speed</span>
<a name="ln-3721"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-3722"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-3723"></a>
<a name="ln-3724"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">D1</span>
<a name="ln-3725"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Zin1</span><span class="p">,</span> <span class="n">Zout1</span>
<a name="ln-3726"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A1eqin</span><span class="p">,</span> <span class="n">A1eqout</span>
<a name="ln-3727"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">T0</span><span class="p">,</span> <span class="n">tilt</span>
<a name="ln-3728"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dens0</span><span class="p">,</span> <span class="n">visc0</span><span class="p">,</span> <span class="n">con0</span><span class="p">,</span> <span class="n">pr0</span><span class="p">,</span> <span class="n">cp0</span>
<a name="ln-3729"></a>    <span class="c">!real(r64) :: dens1, visc1, con1, pr1, cp1</span>
<a name="ln-3730"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dens2</span><span class="p">,</span> <span class="n">visc2</span><span class="p">,</span> <span class="n">con2</span><span class="p">,</span> <span class="n">pr2</span><span class="p">,</span> <span class="n">cp2</span>
<a name="ln-3731"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgapout</span><span class="p">,</span> <span class="n">forcedspeed</span>
<a name="ln-3732"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">H0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">beta</span>
<a name="ln-3733"></a>
<a name="ln-3734"></a>    <span class="c">! iteration parameters</span>
<a name="ln-3735"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iter</span>
<a name="ln-3736"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">TGapOld</span>
<a name="ln-3737"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">converged</span>
<a name="ln-3738"></a>
<a name="ln-3739"></a>    <span class="n">tilt</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.0d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="mi">9</span><span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-3740"></a>    <span class="n">T0</span> <span class="o">=</span> <span class="mf">0.0d0</span> <span class="o">+</span> <span class="n">KelvinConv</span>
<a name="ln-3741"></a>
<a name="ln-3742"></a>    <span class="k">call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">iprop1</span><span class="p">,</span> <span class="n">frct1</span><span class="p">,</span> <span class="n">press1</span><span class="p">,</span> <span class="n">nmix1</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">con0</span><span class="p">,</span> <span class="n">visc0</span><span class="p">,</span> <span class="n">dens0</span><span class="p">,</span> <span class="n">cp0</span><span class="p">,</span> <span class="n">pr0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3743"></a>                    <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3744"></a>    <span class="c">!call gasses90(Tenv, iprop1, frct1, press1, nmix1, xwght, xgcon, xgvis, xgcp, con1, visc1, dens1, cp1, pr1, 1, &amp;</span>
<a name="ln-3745"></a>    <span class="c">!                nperr, ErrorMessage)</span>
<a name="ln-3746"></a>
<a name="ln-3747"></a>    <span class="c">! exit on error:</span>
<a name="ln-3748"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span>  <span class="k">return</span>
<a name="ln-3749"></a>
<a name="ln-3750"></a>    <span class="c">!dr...check for error messages</span>
<a name="ln-3751"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">Tgap</span><span class="o">*</span><span class="n">Tenv</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3752"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">15</span>
<a name="ln-3753"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Temperature of vented air must be greater then 0 [K].&#39;</span>
<a name="ln-3754"></a>      <span class="k">return</span>
<a name="ln-3755"></a><span class="k">    end if</span>
<a name="ln-3756"></a>
<a name="ln-3757"></a><span class="k">    if</span> <span class="p">((</span><span class="n">Atop</span> <span class="o">+</span> <span class="n">Abot</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3758"></a>  <span class="c">!    nperr = 16</span>
<a name="ln-3759"></a>  <span class="c">!    return</span>
<a name="ln-3760"></a>      <span class="n">Atop</span> <span class="o">=</span> <span class="mf">0.000001d0</span>
<a name="ln-3761"></a>      <span class="n">Abot</span> <span class="o">=</span> <span class="mf">0.000001d0</span>
<a name="ln-3762"></a>    <span class="k">end if</span>
<a name="ln-3763"></a><span class="k">    if</span> <span class="p">((</span><span class="n">Ah</span><span class="o">+</span><span class="n">Al</span><span class="o">+</span><span class="n">Ar</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3764"></a><span class="k">      </span><span class="n">Ah</span> <span class="o">=</span> <span class="mf">0.000001d0</span>
<a name="ln-3765"></a>    <span class="k">end if</span>
<a name="ln-3766"></a>
<a name="ln-3767"></a><span class="k">    </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3768"></a>    <span class="n">iter</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3769"></a>    <span class="k">do while</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">converged</span><span class="p">)</span>
<a name="ln-3770"></a>      <span class="n">iter</span> <span class="o">=</span> <span class="n">iter</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3771"></a>      <span class="k">call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">Tgap</span><span class="p">,</span> <span class="n">iprop2</span><span class="p">,</span> <span class="n">frct2</span><span class="p">,</span> <span class="n">press2</span><span class="p">,</span> <span class="n">nmix2</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">con2</span><span class="p">,</span> <span class="n">visc2</span><span class="p">,</span> <span class="n">dens2</span><span class="p">,</span> <span class="n">cp2</span><span class="p">,</span> <span class="n">pr2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3772"></a>                      <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3773"></a>
<a name="ln-3774"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">nperr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">))</span>  <span class="k">return</span>
<a name="ln-3775"></a>
<a name="ln-3776"></a>    <span class="c">!  A = dens0 * T0 * gravity * abs(cos(tilt)) * abs(Tgap - Tenv) / (Tgap * Tenv)</span>
<a name="ln-3777"></a>
<a name="ln-3778"></a>    <span class="c">!bi...Bug fix #00005:</span>
<a name="ln-3779"></a>      <span class="n">A</span> <span class="o">=</span> <span class="n">dens0</span> <span class="o">*</span> <span class="n">T0</span> <span class="o">*</span> <span class="n">GravityConstant</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">cos</span><span class="p">(</span><span class="n">tilt</span><span class="p">))</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Tgap</span> <span class="o">-</span> <span class="n">Tenv</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tgap</span> <span class="o">*</span> <span class="n">Tenv</span><span class="p">)</span>
<a name="ln-3780"></a>    <span class="c">!  A = dens0 * T0 * GravityConstant * H * abs(cos(tilt)) * (Tgap - Tenv) / (Tgap * Tenv)</span>
<a name="ln-3781"></a>
<a name="ln-3782"></a>      <span class="n">B1</span> <span class="o">=</span> <span class="n">dens2</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-3783"></a>      <span class="n">C1</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">visc2</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">**</span> <span class="mf">2.0d0</span><span class="p">)</span>
<a name="ln-3784"></a>
<a name="ln-3785"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">Tgap</span> <span class="o">&gt;</span> <span class="n">Tenv</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3786"></a><span class="k">        </span><span class="n">A1eqin</span> <span class="o">=</span> <span class="n">Abot</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Atop</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3787"></a>        <span class="n">A1eqout</span> <span class="o">=</span> <span class="n">Atop</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Abot</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3788"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">Tgap</span> <span class="o">&lt;=</span> <span class="n">Tenv</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3789"></a><span class="k">        </span><span class="n">A1eqout</span> <span class="o">=</span> <span class="n">Abot</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Atop</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3790"></a>        <span class="n">A1eqin</span> <span class="o">=</span> <span class="n">Atop</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">Abot</span> <span class="o">*</span> <span class="p">(</span><span class="n">Al</span> <span class="o">+</span> <span class="n">Ar</span> <span class="o">+</span> <span class="n">Ah</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Abot</span> <span class="o">+</span> <span class="n">Atop</span><span class="p">)</span>
<a name="ln-3791"></a>      <span class="k">end if</span>
<a name="ln-3792"></a>
<a name="ln-3793"></a><span class="k">      </span><span class="n">Zin1</span> <span class="o">=</span> <span class="p">((</span><span class="n">s</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.6d0</span> <span class="o">*</span> <span class="n">A1eqin</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0d0</span>
<a name="ln-3794"></a>      <span class="n">Zout1</span> <span class="o">=</span> <span class="p">((</span><span class="n">s</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.6d0</span> <span class="o">*</span> <span class="n">A1eqout</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0d0</span>
<a name="ln-3795"></a>
<a name="ln-3796"></a>      <span class="n">D1</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens2</span> <span class="o">/</span> <span class="mf">2.0d0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Zin1</span> <span class="o">+</span> <span class="n">Zout1</span><span class="p">)</span>
<a name="ln-3797"></a>
<a name="ln-3798"></a>      <span class="n">A1</span> <span class="o">=</span> <span class="n">B1</span> <span class="o">+</span> <span class="n">D1</span>
<a name="ln-3799"></a>      <span class="n">A2</span> <span class="o">=</span> <span class="n">C1</span>
<a name="ln-3800"></a>
<a name="ln-3801"></a>    <span class="c">!dr...recalculate speed if forced speed exist</span>
<a name="ln-3802"></a>    <span class="c">!bi...skip forced vent for now</span>
<a name="ln-3803"></a>    <span class="c">!  if (forcedspeed.ne.0) then</span>
<a name="ln-3804"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">forcedspeed</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">CalcForcedVentilation</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3805"></a><span class="k">        </span><span class="n">speed</span> <span class="o">=</span> <span class="n">forcedspeed</span>
<a name="ln-3806"></a>      <span class="k">else</span>
<a name="ln-3807"></a><span class="k">        </span><span class="n">speed</span> <span class="o">=</span> <span class="p">(</span><span class="nb">SQRT</span><span class="p">((</span><span class="n">A2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">ABS</span><span class="p">(</span><span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">A1</span><span class="p">))</span> <span class="o">-</span> <span class="n">A2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">A1</span><span class="p">)</span>
<a name="ln-3808"></a>    <span class="c">!  speed = abs((sqrt((A2 ** 2) + (4 * A * A1)) - A2) / (2 * A1))</span>
<a name="ln-3809"></a>      <span class="k">end if</span>
<a name="ln-3810"></a>
<a name="ln-3811"></a><span class="k">      </span><span class="n">TGapOld</span> <span class="o">=</span> <span class="n">Tgap</span>
<a name="ln-3812"></a>
<a name="ln-3813"></a>      <span class="c">! Speed is zero when environment temperature is equal to average layer temperatures</span>
<a name="ln-3814"></a>      <span class="c">! For example, this can happen when inside and outside temperatures are equal</span>
<a name="ln-3815"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">speed</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3816"></a><span class="k">        </span><span class="n">H0</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens2</span> <span class="o">*</span> <span class="n">cp2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">speed</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">hc</span> <span class="o">+</span> <span class="mf">8.0d0</span> <span class="o">*</span> <span class="n">speed</span><span class="p">)</span>
<a name="ln-3817"></a>
<a name="ln-3818"></a>        <span class="n">P</span> <span class="o">=</span> <span class="o">-</span> <span class="n">H</span> <span class="o">/</span> <span class="n">H0</span>
<a name="ln-3819"></a>        <span class="n">beta</span> <span class="o">=</span> <span class="n">e</span> <span class="o">**</span> <span class="n">P</span>
<a name="ln-3820"></a>        <span class="n">Tgapout</span> <span class="o">=</span> <span class="n">Tav</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tav</span> <span class="o">-</span> <span class="n">Tenv</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta</span>
<a name="ln-3821"></a>        <span class="n">Tgap</span> <span class="o">=</span> <span class="n">Tav</span> <span class="o">-</span> <span class="p">(</span><span class="n">H0</span> <span class="o">/</span> <span class="n">H</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tgapout</span> <span class="o">-</span> <span class="n">Tenv</span><span class="p">)</span>
<a name="ln-3822"></a>      <span class="k">else</span>
<a name="ln-3823"></a><span class="k">        </span><span class="n">Tgapout</span> <span class="o">=</span> <span class="n">Tav</span>
<a name="ln-3824"></a>        <span class="n">Tgap</span> <span class="o">=</span> <span class="n">Tav</span>
<a name="ln-3825"></a>      <span class="k">end if</span>
<a name="ln-3826"></a>
<a name="ln-3827"></a><span class="k">      </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3828"></a>      <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">Tgap</span> <span class="o">-</span> <span class="n">TGapOld</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">AirflowConvergenceTolerance</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">iter</span> <span class="o">&gt;=</span> <span class="n">NumOfIterations</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3829"></a><span class="k">        </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-3830"></a>      <span class="k">end if</span>
<a name="ln-3831"></a>
<a name="ln-3832"></a>      <span class="c">!if (iter &gt; NumOfIterations) then</span>
<a name="ln-3833"></a>      <span class="c">!  converged = .true.</span>
<a name="ln-3834"></a>      <span class="c">!end if</span>
<a name="ln-3835"></a>
<a name="ln-3836"></a>    <span class="k">end do</span>
<a name="ln-3837"></a>
<a name="ln-3838"></a>  <span class="c">!bi...Test output:</span>
<a name="ln-3839"></a>  <span class="c">!  write(*,101) tenv, tgap, tgapout</span>
<a name="ln-3840"></a>  <span class="c">!101  format(f15.9, f15.9, f15.9)</span>
<a name="ln-3841"></a>
<a name="ln-3842"></a>    <span class="n">hcv</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">hc</span> <span class="o">+</span> <span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">speed</span>
<a name="ln-3843"></a>
<a name="ln-3844"></a>    <span class="n">qv</span> <span class="o">=</span> <span class="n">dens2</span> <span class="o">*</span> <span class="n">cp2</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tenv</span> <span class="o">-</span> <span class="n">Tgapout</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">L</span><span class="p">)</span>
<a name="ln-3845"></a>
<a name="ln-3846"></a>  <span class="k">end subroutine</span>
<a name="ln-3847"></a>
<a name="ln-3848"></a><span class="c">!     NOTICE</span>
<a name="ln-3849"></a><span class="c">!</span>
<a name="ln-3850"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-3851"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-3852"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-3853"></a><span class="c">!</span>
<a name="ln-3854"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-3855"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-3856"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-3857"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-3858"></a><span class="c">!</span>
<a name="ln-3859"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-3860"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-3861"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-3862"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-3863"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-3864"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-3865"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-3866"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-3867"></a><span class="c">!     permit others to do so.</span>
<a name="ln-3868"></a><span class="c">!</span>
<a name="ln-3869"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-3870"></a><span class="c">!</span>
<a name="ln-3871"></a>
<a name="ln-3872"></a><span class="k">end module </span><span class="n">TarcogShading</span>
<a name="ln-3873"></a>
<a name="ln-3874"></a><span class="k">module </span><span class="n">ThermalEN673Calc</span>
<a name="ln-3875"></a>
<a name="ln-3876"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-3877"></a>          <span class="c">!       AUTHOR         D. Charlie Curcija</span>
<a name="ln-3878"></a>          <span class="c">!       DATE WRITTEN   July/2000</span>
<a name="ln-3879"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-3880"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-3881"></a>
<a name="ln-3882"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-3883"></a>          <span class="c">! Calculate thermal properties of IGU according to EN673 standard</span>
<a name="ln-3884"></a>
<a name="ln-3885"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3886"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-3887"></a>
<a name="ln-3888"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3889"></a>          <span class="c">! na</span>
<a name="ln-3890"></a>
<a name="ln-3891"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-3892"></a>          <span class="c">! na</span>
<a name="ln-3893"></a>
<a name="ln-3894"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3895"></a>
<a name="ln-3896"></a>  <span class="k">use </span><span class="n">TARCOGGassesParams</span>
<a name="ln-3897"></a>  <span class="k">use </span><span class="n">TARCOGGasses90</span>
<a name="ln-3898"></a>  <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-3899"></a>
<a name="ln-3900"></a>  <span class="k">implicit none</span>
<a name="ln-3901"></a>
<a name="ln-3902"></a><span class="k">  public  </span><span class="n">Calc_EN673</span>
<a name="ln-3903"></a>  <span class="k">public  </span><span class="n">EN673ISO10292</span>
<a name="ln-3904"></a>  <span class="k">private </span><span class="n">linint</span>
<a name="ln-3905"></a>  <span class="k">private </span><span class="n">solar_EN673</span>
<a name="ln-3906"></a>
<a name="ln-3907"></a>  <span class="k">contains</span>
<a name="ln-3908"></a>
<a name="ln-3909"></a><span class="k">  subroutine </span><span class="n">Calc_EN673</span><span class="p">(</span><span class="n">standard</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-3910"></a>          <span class="n">tilt</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3911"></a>          <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span><span class="n">Nu</span><span class="p">)</span>
<a name="ln-3912"></a>
<a name="ln-3913"></a>    <span class="k">use </span><span class="n">TARCOGArgs</span><span class="p">,</span> <span class="n">ONLY</span> <span class="p">:</span> <span class="n">GoAhead</span>
<a name="ln-3914"></a>    <span class="k">use </span><span class="n">TarcogOutput</span>
<a name="ln-3915"></a>
<a name="ln-3916"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-3917"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-3918"></a>
<a name="ln-3919"></a>    <span class="c">!!! function attributes:</span>
<a name="ln-3920"></a>
<a name="ln-3921"></a>    <span class="c">!!! INPUTS:</span>
<a name="ln-3922"></a>
<a name="ln-3923"></a>    <span class="c">!!! General:</span>
<a name="ln-3924"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">standard</span>
<a name="ln-3925"></a>
<a name="ln-3926"></a>    <span class="c">!!! Environment related:</span>
<a name="ln-3927"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-3928"></a>
<a name="ln-3929"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-3930"></a>
<a name="ln-3931"></a>    <span class="c">!!! Layers:</span>
<a name="ln-3932"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">emis</span>
<a name="ln-3933"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">asol</span>
<a name="ln-3934"></a>
<a name="ln-3935"></a>
<a name="ln-3936"></a>    <span class="c">!!! Gaps:</span>
<a name="ln-3937"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-3938"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-3939"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">frct</span>
<a name="ln-3940"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">presure</span>
<a name="ln-3941"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-3942"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">xwght</span>
<a name="ln-3943"></a>
<a name="ln-3944"></a>
<a name="ln-3945"></a>    <span class="c">!!!! INPUTS/OUTPUTS:</span>
<a name="ln-3946"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span><span class="p">,</span> <span class="n">thick</span>
<a name="ln-3947"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-3948"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span>
<a name="ln-3949"></a>
<a name="ln-3950"></a>    <span class="c">!!! OUTPUTS:</span>
<a name="ln-3951"></a>      <span class="c">!!! Overall:</span>
<a name="ln-3952"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-3953"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-3954"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span>
<a name="ln-3955"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">shgc</span>
<a name="ln-3956"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcin</span>
<a name="ln-3957"></a>
<a name="ln-3958"></a>    <span class="c">!!! Layers:</span>
<a name="ln-3959"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-3960"></a>
<a name="ln-3961"></a>    <span class="c">!!! Gaps:</span>
<a name="ln-3962"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span>
<a name="ln-3963"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span>
<a name="ln-3964"></a>
<a name="ln-3965"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-3966"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-3967"></a>
<a name="ln-3968"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-3969"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rtot</span><span class="p">,</span> <span class="n">sft</span>
<a name="ln-3970"></a>
<a name="ln-3971"></a>    <span class="c">!call  propcon90(standard, mgas, gcon, gvis, gcp, grho, wght, nperr)</span>
<a name="ln-3972"></a>    <span class="n">rtot</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3973"></a>    <span class="n">sft</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3974"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3975"></a><span class="k">      call  </span><span class="n">EN673ISO10292</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span><span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3976"></a>                              <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span><span class="n">standard</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3977"></a>                              <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3978"></a>
<a name="ln-3979"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3980"></a><span class="k">        </span><span class="n">rtot</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">ufactor</span>
<a name="ln-3981"></a>        <span class="k">call  </span><span class="n">solar_EN673</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">rtot</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">sft</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3982"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3983"></a><span class="k">          </span><span class="n">shgc</span><span class="o">=</span><span class="n">sft</span>
<a name="ln-3984"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">WriteDebugOutput</span><span class="p">)</span> <span class="k">call </span><span class="n">WriteOutputEN673</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="n">DBGD</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">nperr</span><span class="p">)</span>
<a name="ln-3985"></a>        <span class="k">end if</span>  <span class="c">! GoAhead after solar</span>
<a name="ln-3986"></a>      <span class="k">end if</span>  <span class="c">! GoAhead after EN673ISO10292</span>
<a name="ln-3987"></a>    <span class="k">end if</span>  <span class="c">! GopAhead after propcon90</span>
<a name="ln-3988"></a>
<a name="ln-3989"></a>  <span class="k">end subroutine </span><span class="n">Calc_EN673</span>
<a name="ln-3990"></a>
<a name="ln-3991"></a>  <span class="k">subroutine </span><span class="n">EN673ISO10292</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3992"></a>      <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-3993"></a>
<a name="ln-3994"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span>
<a name="ln-3995"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">standard</span>
<a name="ln-3996"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-3997"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-3998"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span> <span class="p">,</span><span class="n">scon</span>
<a name="ln-3999"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">emis</span>
<a name="ln-4000"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-4001"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-4002"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-4003"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">xwght</span>
<a name="ln-4004"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-4005"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-4006"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-4007"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-4008"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tilt</span>
<a name="ln-4009"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hout</span>
<a name="ln-4010"></a>
<a name="ln-4011"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-4012"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hin</span> <span class="c">!Objexx:ArgIN Changed IN to INOUT: Arg used and modified</span>
<a name="ln-4013"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">ufactor</span>
<a name="ln-4014"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">hg</span>
<a name="ln-4015"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-4016"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-4017"></a>
<a name="ln-4018"></a>    <span class="c">!dr...internal variables</span>
<a name="ln-4019"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tm</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">Rg</span>
<a name="ln-4020"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dT</span>
<a name="ln-4021"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">iter</span>
<a name="ln-4022"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dens</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span>
<a name="ln-4023"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Gr</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">Ra</span>
<a name="ln-4024"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">sumRs</span><span class="p">,</span> <span class="n">sumRsold</span>
<a name="ln-4025"></a>
<a name="ln-4026"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1.0d-4</span>  <span class="c">! set iteration accuracy</span>
<a name="ln-4027"></a>
<a name="ln-4028"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frctg</span>
<a name="ln-4029"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ipropg</span>
<a name="ln-4030"></a>
<a name="ln-4031"></a><span class="c">!EPTeam    ! Initialization</span>
<a name="ln-4032"></a><span class="c">!EPTeam - comment out until proven    con = 0.0d0 !Objexx:Uninit Line added to eliminate chance of use uninitialized</span>
<a name="ln-4033"></a>
<a name="ln-4034"></a>  <span class="c">!jel..hrin is 4.4 for standard clear glass:</span>
<a name="ln-4035"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.85d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.83d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4036"></a><span class="k">      </span><span class="n">hrin</span> <span class="o">=</span>  <span class="mf">4.4d0</span>
<a name="ln-4037"></a>    <span class="k">else</span>
<a name="ln-4038"></a><span class="k">      </span><span class="n">hrin</span> <span class="o">=</span>  <span class="mf">4.4d0</span> <span class="o">*</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.837d0</span>
<a name="ln-4039"></a>  <span class="c">!       hrin = 4.4 * emis(2*nlayer) / 0.84  !old formula</span>
<a name="ln-4040"></a>    <span class="k">end if</span>
<a name="ln-4041"></a>
<a name="ln-4042"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4043"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">38</span>
<a name="ln-4044"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Boundary conditions for EN673 can be combined hout for outdoor and either convective (hcin) &#39;</span><span class="o">//</span>  <span class="p">&amp;</span>
<a name="ln-4045"></a>         <span class="s1">&#39;or combined (hin) for indoor.  Others are not supported currently.&#39;</span>
<a name="ln-4046"></a>      <span class="k">return</span>
<a name="ln-4047"></a><span class="k">    end if</span>
<a name="ln-4048"></a>
<a name="ln-4049"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4050"></a><span class="k">      CONTINUE</span>
<a name="ln-4051"></a><span class="k">    else if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4052"></a><span class="k">      </span><span class="n">hcin</span> <span class="o">=</span> <span class="n">hin</span>
<a name="ln-4053"></a>      <span class="n">hin</span> <span class="o">=</span> <span class="n">hcin</span> <span class="o">+</span> <span class="n">hrin</span>
<a name="ln-4054"></a>    <span class="k">else</span>
<a name="ln-4055"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">39</span>
<a name="ln-4056"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;CSM and SCW thermal models cannot be used for outdoor and indoor SD layers.&#39;</span>
<a name="ln-4057"></a>      <span class="k">return</span>
<a name="ln-4058"></a><span class="k">    end if</span>
<a name="ln-4059"></a>
<a name="ln-4060"></a><span class="k">    </span><span class="n">rs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">hout</span>
<a name="ln-4061"></a>    <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">hin</span>
<a name="ln-4062"></a>
<a name="ln-4063"></a>    <span class="n">Tm</span> <span class="o">=</span> <span class="mi">28</span><span class="mf">3.0d0</span>
<a name="ln-4064"></a>    <span class="n">iter</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4065"></a>    <span class="n">sumRs</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4066"></a>    <span class="n">Rg</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4067"></a>
<a name="ln-4068"></a>    <span class="c">!bi Init vectors:</span>
<a name="ln-4069"></a>    <span class="n">Gr</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4070"></a>    <span class="n">Nu</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4071"></a>    <span class="n">Ra</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4072"></a>    <span class="n">con</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4073"></a>
<a name="ln-4074"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-4075"></a>      <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">! thermal resistance of each glazing layer</span>
<a name="ln-4076"></a>      <span class="n">Rg</span> <span class="o">=</span> <span class="n">Rg</span> <span class="o">+</span> <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="c">! cumulative thermal resistance of glazing layers</span>
<a name="ln-4077"></a>    <span class="k">end do</span>
<a name="ln-4078"></a>
<a name="ln-4079"></a><span class="k">    if</span> <span class="p">(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="c">! Calc U-Factor and glazing temperature for simgle glazing and return</span>
<a name="ln-4080"></a>      <span class="n">ufactor</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hin</span> <span class="o">+</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hout</span> <span class="o">+</span> <span class="n">Rg</span><span class="p">)</span>
<a name="ln-4081"></a>      <span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="n">hout</span><span class="o">+</span><span class="n">tout</span>
<a name="ln-4082"></a>      <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">tind</span> <span class="o">-</span> <span class="n">ufactor</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="n">hin</span>
<a name="ln-4083"></a>      <span class="k">return</span>
<a name="ln-4084"></a><span class="k">    else</span>
<a name="ln-4085"></a><span class="k">      if</span> <span class="p">(</span><span class="n">tind</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">tout</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4086"></a>        <span class="c">!dr...linear interpolation for gas conductance coefficients</span>
<a name="ln-4087"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">tilt</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4088"></a><span class="k">          </span><span class="n">A</span> <span class="o">=</span> <span class="mf">0.16d0</span>
<a name="ln-4089"></a>          <span class="n">n</span> <span class="o">=</span> <span class="mf">0.28d0</span>
<a name="ln-4090"></a>        <span class="k">else if</span> <span class="p">((</span><span class="n">tilt</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">4</span><span class="mf">5.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4091"></a><span class="k">          call  </span><span class="n">linint</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mi">4</span><span class="mf">5.0d0</span><span class="p">,</span> <span class="mf">0.16d0</span><span class="p">,</span> <span class="mf">0.1d0</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
<a name="ln-4092"></a>          <span class="k">call  </span><span class="n">linint</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mi">4</span><span class="mf">5.0d0</span><span class="p">,</span> <span class="mf">0.28d0</span><span class="p">,</span> <span class="mf">0.31d0</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-4093"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">tilt</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="mf">5.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4094"></a><span class="k">          </span><span class="n">A</span> <span class="o">=</span> <span class="mf">0.10d0</span>
<a name="ln-4095"></a>          <span class="n">n</span> <span class="o">=</span> <span class="mf">0.31d0</span>
<a name="ln-4096"></a>        <span class="k">else if</span> <span class="p">((</span><span class="n">tilt</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">4</span><span class="mf">5.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4097"></a><span class="k">          call  </span><span class="n">linint</span><span class="p">(</span><span class="mi">4</span><span class="mf">5.0d0</span><span class="p">,</span> <span class="mi">9</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.1d0</span><span class="p">,</span> <span class="mf">0.035d0</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
<a name="ln-4098"></a>          <span class="k">call  </span><span class="n">linint</span><span class="p">(</span><span class="mi">4</span><span class="mf">5.0d0</span><span class="p">,</span> <span class="mi">9</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.31d0</span><span class="p">,</span> <span class="mf">0.38d0</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-4099"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">tilt</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">90</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4100"></a><span class="k">          </span><span class="n">A</span> <span class="o">=</span> <span class="mf">0.035d0</span>
<a name="ln-4101"></a>          <span class="n">n</span> <span class="o">=</span> <span class="mf">0.38d0</span>
<a name="ln-4102"></a>        <span class="k">end if</span>  <span class="c">! tilt</span>
<a name="ln-4103"></a>
<a name="ln-4104"></a>        <span class="c">!c   gas constants</span>
<a name="ln-4105"></a>        <span class="c">!    open(unit=18,  file=&#39;gas.dbg&#39;,  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,</span>
<a name="ln-4106"></a>        <span class="c">!  2            form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-4107"></a>        <span class="c">!    write(18,*) &#39;New calc&#39;</span>
<a name="ln-4108"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4109"></a>          <span class="c">!22222  format(&#39;Gas #&#39;, I3, &#39; : Dens=&#39;, F9.7, &#39; Visc=&#39;, F12.9, &#39; Cond=&#39;, F9.7, &#39; Cp=&#39;, F9.7)</span>
<a name="ln-4110"></a>          <span class="c">!   write(18, 22222) iprop(i+1, j), tempDens, gvis(iprop(i+1,j), 1), gcon(iprop(i+1,j), 1), gcp(iprop(i+1,j), 1)</span>
<a name="ln-4111"></a>          <span class="n">dT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">5.0d0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c">! set initial temperature distribution</span>
<a name="ln-4112"></a>          <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4113"></a>            <span class="n">ipropg</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-4114"></a>            <span class="n">frctg</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-4115"></a>          <span class="k">end do</span>
<a name="ln-4116"></a><span class="k">          call  </span><span class="n">gasses90</span><span class="p">(</span><span class="n">Tm</span><span class="p">,</span> <span class="n">ipropg</span><span class="p">,</span> <span class="n">frctg</span><span class="p">,</span> <span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4117"></a>                          <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-4118"></a>          <span class="n">Gr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">GravityConstant</span> <span class="o">*</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0d0</span> <span class="o">*</span> <span class="n">dT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">dens</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tm</span> <span class="o">*</span> <span class="n">visc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4119"></a>          <span class="n">Ra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Gr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">pr</span>
<a name="ln-4120"></a>          <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">Ra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span>
<a name="ln-4121"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4122"></a><span class="k">            </span><span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-4123"></a>          <span class="k">end if</span>
<a name="ln-4124"></a><span class="k">          </span><span class="n">hg</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span> <span class="o">/</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4125"></a>        <span class="k">end do</span>  <span class="c">! gaps</span>
<a name="ln-4126"></a>      <span class="k">else</span>
<a name="ln-4127"></a><span class="k">        do  </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4128"></a>          <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-4129"></a>          <span class="n">hg</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span> <span class="o">/</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">!Objexx:Uninit con is uninitialized: Initialization added above: With con=0 this line is pointless</span>
<a name="ln-4130"></a>        <span class="k">end do</span>
<a name="ln-4131"></a><span class="k">      end if</span>
<a name="ln-4132"></a><span class="k">      do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4133"></a>        <span class="n">hr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0d0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Tm</span><span class="o">**</span><span class="mi">3</span>
<a name="ln-4134"></a>        <span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hg</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">hr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4135"></a>        <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">! Thermal resistance of each gap</span>
<a name="ln-4136"></a>        <span class="n">sumRs</span> <span class="o">=</span> <span class="n">sumRs</span> <span class="o">+</span> <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4137"></a>      <span class="k">end do</span>
<a name="ln-4138"></a>        <span class="c">!    write(18,*) &#39;------&#39;</span>
<a name="ln-4139"></a>        <span class="c">!    close(18)</span>
<a name="ln-4140"></a>
<a name="ln-4141"></a>      <span class="n">ufactor</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hin</span> <span class="o">+</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hout</span> <span class="o">+</span> <span class="n">sumRs</span> <span class="o">+</span> <span class="n">Rg</span><span class="p">)</span>
<a name="ln-4142"></a>      <span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="n">hout</span><span class="o">+</span><span class="n">tout</span>
<a name="ln-4143"></a>      <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">=</span> <span class="n">tind</span> <span class="o">-</span> <span class="n">ufactor</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="n">hin</span>
<a name="ln-4144"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">nlayer</span>
<a name="ln-4145"></a>        <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">*</span><span class="n">thick</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">scon</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-4146"></a>        <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4147"></a>      <span class="k">end do</span>  <span class="c">! end of first iteration</span>
<a name="ln-4148"></a>
<a name="ln-4149"></a>  <span class="c">!bi More iterations:</span>
<a name="ln-4150"></a>      <span class="k">DO</span>
<a name="ln-4151"></a><span class="k">        </span><span class="n">sumRsold</span> <span class="o">=</span> <span class="n">sumRs</span>
<a name="ln-4152"></a>        <span class="n">sumRs</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4153"></a>
<a name="ln-4154"></a>        <span class="k">if</span> <span class="p">((</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4155"></a><span class="k">          return</span>  <span class="c">! If EN673 declared values path and glazing has 2 layers, end claculations and return</span>
<a name="ln-4156"></a>        <span class="k">else</span>
<a name="ln-4157"></a><span class="k">          if</span> <span class="p">(</span><span class="n">tind</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">tout</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4158"></a><span class="k">            do  </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4159"></a>              <span class="n">dT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">5.0d0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">/</span> <span class="n">sumRsold</span>  <span class="c">! updated temperature distribution</span>
<a name="ln-4160"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4161"></a><span class="k">                </span><span class="n">Tm</span> <span class="o">=</span> <span class="mi">28</span><span class="mf">3.0d0</span>
<a name="ln-4162"></a>              <span class="k">else</span>
<a name="ln-4163"></a><span class="k">                </span><span class="n">Tm</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-4164"></a>              <span class="k">end if</span>
<a name="ln-4165"></a><span class="k">              do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4166"></a>                <span class="n">ipropg</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-4167"></a>                <span class="n">frctg</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-4168"></a>              <span class="k">end do</span>  <span class="c">! j, gas mix</span>
<a name="ln-4169"></a>              <span class="k">call  </span><span class="n">gasses90</span><span class="p">(</span><span class="n">Tm</span><span class="p">,</span> <span class="n">ipropg</span><span class="p">,</span> <span class="n">frctg</span><span class="p">,</span> <span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4170"></a>                              <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-4171"></a>              <span class="n">Gr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">GravityConstant</span> <span class="o">*</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0d0</span> <span class="o">*</span> <span class="n">dT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">dens</span><span class="o">**</span><span class="mf">2.0d0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tm</span> <span class="o">*</span> <span class="n">visc</span><span class="o">**</span><span class="mf">2.0d0</span><span class="p">)</span>
<a name="ln-4172"></a>              <span class="n">Ra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Gr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">pr</span>
<a name="ln-4173"></a>              <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">Ra</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span>
<a name="ln-4174"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4175"></a><span class="k">                </span><span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-4176"></a>              <span class="k">end if</span>
<a name="ln-4177"></a><span class="k">              </span><span class="n">hg</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span> <span class="o">/</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4178"></a>            <span class="k">end do</span>  <span class="c">! i, gaps</span>
<a name="ln-4179"></a>          <span class="k">else</span>
<a name="ln-4180"></a><span class="k">            do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-4181"></a>              <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-4182"></a>              <span class="n">hg</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">con</span> <span class="o">/</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">!Objexx:Uninit con may be uninitialized: Initialization added above: With con=0 this line is pointless</span>
<a name="ln-4183"></a>            <span class="k">end do</span>
<a name="ln-4184"></a><span class="k">          end if</span>   <span class="c">! tind &gt; tout</span>
<a name="ln-4185"></a>        <span class="k">end if</span>
<a name="ln-4186"></a>
<a name="ln-4187"></a><span class="k">        do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4188"></a>      <span class="c">!      hr(i) = 4 * sigma * (1/emis(2*i) + 1/emis(2*i+1) - 1)**(-1) * Tm**3</span>
<a name="ln-4189"></a>          <span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hg</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">hr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4190"></a>          <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">! Thermal resistance of each gap</span>
<a name="ln-4191"></a>          <span class="n">sumRs</span> <span class="o">=</span> <span class="n">sumRs</span> <span class="o">+</span> <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4192"></a>        <span class="k">end do</span>
<a name="ln-4193"></a><span class="k">        </span><span class="n">ufactor</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hin</span> <span class="o">+</span> <span class="mf">1.0d0</span> <span class="o">/</span> <span class="n">hout</span> <span class="o">+</span> <span class="n">sumRs</span> <span class="o">+</span> <span class="n">Rg</span><span class="p">)</span>
<a name="ln-4194"></a>        <span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">tind</span> <span class="o">-</span> <span class="n">tout</span><span class="p">)</span> <span class="o">/</span> <span class="n">hout</span> <span class="o">+</span> <span class="n">tout</span>
<a name="ln-4195"></a>        <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">=</span> <span class="n">tind</span> <span class="o">-</span> <span class="n">ufactor</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="n">hin</span>
<a name="ln-4196"></a>        <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">nlayer</span>
<a name="ln-4197"></a>          <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">tind</span> <span class="o">-</span> <span class="n">tout</span><span class="p">)</span> <span class="o">*</span> <span class="n">thick</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">scon</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-4198"></a>          <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">tind</span> <span class="o">-</span> <span class="n">tout</span><span class="p">)</span> <span class="o">/</span> <span class="n">hs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4199"></a>        <span class="k">end do</span>
<a name="ln-4200"></a><span class="k">        </span><span class="n">iter</span> <span class="o">=</span> <span class="n">iter</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c">! end of next iteration</span>
<a name="ln-4201"></a>        <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sumRs</span> <span class="o">-</span> <span class="n">sumRsold</span><span class="p">)</span>
<a name="ln-4202"></a>        <span class="c">!bi: perhaps we should also limit No. of iterations?</span>
<a name="ln-4203"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">diff</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">eps</span><span class="p">)</span> <span class="k">EXIT</span>  <span class="c">! tolerance was met - exit loop</span>
<a name="ln-4204"></a>      <span class="k">end do</span>  <span class="c">! remaining iterations</span>
<a name="ln-4205"></a>    <span class="k">end if</span>
<a name="ln-4206"></a>
<a name="ln-4207"></a>    <span class="c">!dr...END OF ITERATIONS</span>
<a name="ln-4208"></a>    <span class="k">return</span>
<a name="ln-4209"></a>
<a name="ln-4210"></a><span class="k">  end subroutine</span>
<a name="ln-4211"></a>
<a name="ln-4212"></a><span class="k">  subroutine </span><span class="n">linint</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a name="ln-4213"></a>
<a name="ln-4214"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x</span>
<a name="ln-4215"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y</span>
<a name="ln-4216"></a>
<a name="ln-4217"></a>    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">y1</span> <span class="c">!Objexx:DivZero Should protect against divide by zero</span>
<a name="ln-4218"></a>
<a name="ln-4219"></a>    <span class="k">return</span>
<a name="ln-4220"></a>
<a name="ln-4221"></a><span class="k">  end subroutine</span>
<a name="ln-4222"></a>
<a name="ln-4223"></a><span class="k">  subroutine </span><span class="n">solar_EN673</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">rtot</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">absol</span><span class="p">,</span> <span class="n">sf</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-4224"></a>  <span class="c">!***********************************************************************</span>
<a name="ln-4225"></a>  <span class="c">!   This subroutine calculates the shading coefficient for a window.</span>
<a name="ln-4226"></a>  <span class="c">!***********************************************************************</span>
<a name="ln-4227"></a>  <span class="c">!  Inputs:</span>
<a name="ln-4228"></a>  <span class="c">!    absol     array of absorped fraction of solar radiation in lites</span>
<a name="ln-4229"></a>  <span class="c">!    totsol    total solar transmittance</span>
<a name="ln-4230"></a>  <span class="c">!    rtot      total thermal resistance of window</span>
<a name="ln-4231"></a>  <span class="c">!    rs        array of thermal resistances of each gap and layer</span>
<a name="ln-4232"></a>  <span class="c">!    layer     number of layers</span>
<a name="ln-4233"></a>  <span class="c">!  Outputs:</span>
<a name="ln-4234"></a>  <span class="c">!    sf        solar gain of space</span>
<a name="ln-4235"></a>  <span class="c">!</span>
<a name="ln-4236"></a>
<a name="ln-4237"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">standard</span>
<a name="ln-4238"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-4239"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">absol</span>
<a name="ln-4240"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">rtot</span><span class="p">,</span> <span class="n">dir</span>
<a name="ln-4241"></a>
<a name="ln-4242"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sf</span>
<a name="ln-4243"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-4244"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-4245"></a>
<a name="ln-4246"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-4247"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fract</span><span class="p">,</span> <span class="n">flowin</span>
<a name="ln-4248"></a>
<a name="ln-4249"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-4250"></a>
<a name="ln-4251"></a>    <span class="n">fract</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4252"></a>    <span class="n">flowin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4253"></a>    <span class="n">sf</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4254"></a>
<a name="ln-4255"></a>    <span class="c">! evaluate inward flowing fraction of absorbed radiation:</span>
<a name="ln-4256"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">standard</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">EN673Design</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4257"></a><span class="k">      if</span> <span class="p">(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4258"></a><span class="k">        </span><span class="n">fract</span> <span class="o">=</span> <span class="n">dir</span><span class="o">*</span><span class="n">absol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">rs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rs</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">rs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">rs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">rs</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-4259"></a>      <span class="k">else</span>
<a name="ln-4260"></a><span class="k">        </span><span class="n">flowin</span> <span class="o">=</span> <span class="p">(</span><span class="n">rs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">rtot</span>
<a name="ln-4261"></a>        <span class="n">fract</span> <span class="o">=</span> <span class="n">dir</span> <span class="o">*</span> <span class="n">absol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">rs</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-4262"></a>        <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-4263"></a>          <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span>
<a name="ln-4264"></a>          <span class="n">flowin</span> <span class="o">=</span> <span class="n">flowin</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">rs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">rs</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="o">+</span> <span class="n">rs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">rtot</span>
<a name="ln-4265"></a>          <span class="n">fract</span> <span class="o">=</span> <span class="n">fract</span> <span class="o">+</span> <span class="n">absol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">flowin</span>
<a name="ln-4266"></a>        <span class="k">end do</span>
<a name="ln-4267"></a><span class="k">        </span><span class="n">fract</span> <span class="o">=</span> <span class="n">fract</span> <span class="o">+</span> <span class="n">dir</span> <span class="o">*</span> <span class="n">absol</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">*</span> <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-4268"></a>      <span class="k">end if</span>
<a name="ln-4269"></a><span class="k">    else</span>
<a name="ln-4270"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">28</span>
<a name="ln-4271"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Invalid code for standard.&#39;</span>
<a name="ln-4272"></a>      <span class="k">return</span>
<a name="ln-4273"></a><span class="k">    end if</span>
<a name="ln-4274"></a>
<a name="ln-4275"></a><span class="k">    </span><span class="n">sf</span> <span class="o">=</span> <span class="n">totsol</span><span class="o">+</span><span class="n">fract</span>       <span class="c">! add inward fraction to directly transmitted fraction</span>
<a name="ln-4276"></a>
<a name="ln-4277"></a>  <span class="k">end subroutine</span>
<a name="ln-4278"></a>
<a name="ln-4279"></a><span class="c">!     NOTICE</span>
<a name="ln-4280"></a><span class="c">!</span>
<a name="ln-4281"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-4282"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-4283"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-4284"></a><span class="c">!</span>
<a name="ln-4285"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-4286"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-4287"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-4288"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-4289"></a><span class="c">!</span>
<a name="ln-4290"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-4291"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-4292"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-4293"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-4294"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-4295"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-4296"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-4297"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-4298"></a><span class="c">!     permit others to do so.</span>
<a name="ln-4299"></a><span class="c">!</span>
<a name="ln-4300"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-4301"></a><span class="c">!</span>
<a name="ln-4302"></a><span class="k">end module </span><span class="n">ThermalEN673Calc</span>
<a name="ln-4303"></a>
<a name="ln-4304"></a><span class="k">module </span><span class="n">ThermalISO15099Calc</span>
<a name="ln-4305"></a>  <span class="c">!***********************************************************************</span>
<a name="ln-4306"></a>  <span class="c">! ThermalISO15099Calc: a TARCOG module</span>
<a name="ln-4307"></a>  <span class="c">!</span>
<a name="ln-4308"></a>  <span class="c">!    module For Calculation of Thermal Performance Indices For Center</span>
<a name="ln-4309"></a>  <span class="c">!     of Glass According to ISO 15099</span>
<a name="ln-4310"></a>  <span class="c">!</span>
<a name="ln-4311"></a>  <span class="c">! History of Revisions:</span>
<a name="ln-4312"></a>  <span class="c">!</span>
<a name="ln-4313"></a>  <span class="c">!  Revision: 6.0.36  (June/22/2010)</span>
<a name="ln-4314"></a>  <span class="c">!   - Initial setup, extracted and refactored from TARCOG.for</span>
<a name="ln-4315"></a>  <span class="c">!</span>
<a name="ln-4316"></a>  <span class="c">!***********************************************************************</span>
<a name="ln-4317"></a>
<a name="ln-4318"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-4319"></a>          <span class="c">!       AUTHOR         D. Charlie Curcija</span>
<a name="ln-4320"></a>          <span class="c">!       DATE WRITTEN   July/2000</span>
<a name="ln-4321"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-4322"></a>          <span class="c">!       RE-ENGINEERED  March/27/2012, Simon Vidanovic</span>
<a name="ln-4323"></a>
<a name="ln-4324"></a>          <span class="c">!  Revision: 7.0.13  (March/27/2012), Simon Vidanovic</span>
<a name="ln-4325"></a>          <span class="c">!   - feature: New set of equaitons is set instead of hhat coefficents and new approach to solution which improves</span>
<a name="ln-4326"></a>          <span class="c">!               speed and stability.  Note that this solution does not include laminates</span>
<a name="ln-4327"></a>
<a name="ln-4328"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-4329"></a>          <span class="c">! Module For Calculation of Thermal Performance Indices For Center</span>
<a name="ln-4330"></a>          <span class="c">!  of Glass According to ISO 15099</span>
<a name="ln-4331"></a>
<a name="ln-4332"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-4333"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-4334"></a>
<a name="ln-4335"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-4336"></a>          <span class="c">! na</span>
<a name="ln-4337"></a>
<a name="ln-4338"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-4339"></a>          <span class="c">! na</span>
<a name="ln-4340"></a>
<a name="ln-4341"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-4342"></a>
<a name="ln-4343"></a>  <span class="k">use </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-4344"></a>  <span class="k">use </span><span class="n">TARCOGGassesParams</span>
<a name="ln-4345"></a>  <span class="k">use </span><span class="n">TARCOGParams</span>
<a name="ln-4346"></a>  <span class="k">use </span><span class="n">TARCOGArgs</span>
<a name="ln-4347"></a>  <span class="k">use </span><span class="n">TARCOGOutput</span>
<a name="ln-4348"></a>  <span class="k">use </span><span class="n">TARCOGGasses90</span>
<a name="ln-4349"></a>  <span class="k">use </span><span class="n">TarcogShading</span>
<a name="ln-4350"></a>
<a name="ln-4351"></a>  <span class="k">implicit none</span>
<a name="ln-4352"></a>
<a name="ln-4353"></a><span class="k">  public  </span><span class="n">Calc_ISO15099</span>
<a name="ln-4354"></a>  <span class="k">private </span><span class="n">film</span>
<a name="ln-4355"></a>  <span class="k">private </span><span class="n">therm1d</span>
<a name="ln-4356"></a>  <span class="k">private </span><span class="n">guess</span>
<a name="ln-4357"></a>  <span class="k">private </span><span class="n">TemperaturesFromEnergy</span>
<a name="ln-4358"></a>  <span class="k">private </span><span class="n">solarISO15099</span>
<a name="ln-4359"></a>  <span class="k">private </span><span class="n">resist</span>
<a name="ln-4360"></a>  <span class="k">private </span><span class="n">hatter</span>
<a name="ln-4361"></a>  <span class="k">private </span><span class="n">filmi</span>
<a name="ln-4362"></a>  <span class="k">private </span><span class="n">filmg</span>
<a name="ln-4363"></a>  <span class="k">private </span><span class="n">filmPillar</span>
<a name="ln-4364"></a>  <span class="k">private </span><span class="n">nusselt</span>
<a name="ln-4365"></a>  <span class="c">!private picard</span>
<a name="ln-4366"></a>  <span class="k">private </span><span class="n">adjusthhat</span>
<a name="ln-4367"></a>  <span class="k">private </span><span class="n">storeIterationResults</span>
<a name="ln-4368"></a>  <span class="k">private </span><span class="n">CalculateFuncResults</span>
<a name="ln-4369"></a>
<a name="ln-4370"></a>  <span class="k">contains</span>
<a name="ln-4371"></a>
<a name="ln-4372"></a><span class="k">  subroutine </span><span class="n">film</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span><span class="n">tw</span><span class="p">,</span><span class="n">ws</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">hcout</span><span class="p">,</span><span class="n">ibc</span><span class="p">)</span>
<a name="ln-4373"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-4374"></a>    <span class="c">! purpose - to find outdoor film coeff</span>
<a name="ln-4375"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-4376"></a>    <span class="c">! Inputs -</span>
<a name="ln-4377"></a>    <span class="c">!   tex - outdoor air temp [k]</span>
<a name="ln-4378"></a>    <span class="c">!   tw - outside surface temp</span>
<a name="ln-4379"></a>    <span class="c">!   ws - wind speed [m/s]</span>
<a name="ln-4380"></a>    <span class="c">!   iwd - wind direction [0 - windward; 1 - leeward]</span>
<a name="ln-4381"></a>    <span class="c">! Outputs</span>
<a name="ln-4382"></a>    <span class="c">!   hcout - convective film coeff [w m-2 k-1]</span>
<a name="ln-4383"></a>
<a name="ln-4384"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tex</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">ws</span>
<a name="ln-4385"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">ibc</span>
<a name="ln-4386"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcout</span>
<a name="ln-4387"></a>
<a name="ln-4388"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">conv</span> <span class="o">=</span> <span class="mf">5.6783d0</span>
<a name="ln-4389"></a>
<a name="ln-4390"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vc</span><span class="p">,</span> <span class="n">acoef</span><span class="p">,</span> <span class="n">bexp</span>
<a name="ln-4391"></a>
<a name="ln-4392"></a>    <span class="c">! calculation of convection component of exterior film coefficient using the :</span>
<a name="ln-4393"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">ibc</span><span class="p">)</span>
<a name="ln-4394"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>    <span class="c">!ISO 15099</span>
<a name="ln-4395"></a>        <span class="n">hcout</span> <span class="o">=</span> <span class="mf">4.0d0</span> <span class="o">+</span> <span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">ws</span>
<a name="ln-4396"></a>      <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c">! old ASHRAE SPC142 correlation</span>
<a name="ln-4397"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">iwd</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>    <span class="c">! windward</span>
<a name="ln-4398"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">ws</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">2.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4399"></a><span class="k">            </span><span class="n">vc</span> <span class="o">=</span> <span class="mf">0.25d0</span> <span class="o">*</span> <span class="n">ws</span>
<a name="ln-4400"></a>          <span class="k">else</span>
<a name="ln-4401"></a><span class="k">            </span><span class="n">vc</span> <span class="o">=</span> <span class="mf">0.5d0</span>
<a name="ln-4402"></a>          <span class="k">end if</span>
<a name="ln-4403"></a><span class="k">        else</span>        <span class="c">! leeward</span>
<a name="ln-4404"></a>          <span class="n">vc</span> <span class="o">=</span> <span class="mf">0.3d0</span> <span class="o">+</span> <span class="mf">0.05d0</span> <span class="o">*</span> <span class="n">ws</span>
<a name="ln-4405"></a>        <span class="k">end if</span>
<a name="ln-4406"></a><span class="k">        </span><span class="n">hcout</span> <span class="o">=</span> <span class="mf">3.28d0</span> <span class="o">*</span> <span class="p">((</span><span class="n">vc</span><span class="p">)</span><span class="o">**</span><span class="mf">0.605d0</span><span class="p">)</span>
<a name="ln-4407"></a>        <span class="n">hcout</span> <span class="o">=</span> <span class="n">conv</span><span class="o">*</span><span class="n">hcout</span>     <span class="c">! convert to metric</span>
<a name="ln-4408"></a>      <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Yazdanian-Klems correlation:</span>
<a name="ln-4409"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">iwd</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>    <span class="c">! windward</span>
<a name="ln-4410"></a>          <span class="n">acoef</span> <span class="o">=</span> <span class="mf">2.38d0</span>
<a name="ln-4411"></a>          <span class="n">bexp</span> <span class="o">=</span> <span class="mf">0.89d0</span>
<a name="ln-4412"></a>        <span class="k">else</span>        <span class="c">! leeward</span>
<a name="ln-4413"></a>          <span class="n">acoef</span> <span class="o">=</span> <span class="mf">2.86d0</span>
<a name="ln-4414"></a>          <span class="n">bexp</span> <span class="o">=</span> <span class="mf">0.617d0</span>
<a name="ln-4415"></a>        <span class="k">end if</span>
<a name="ln-4416"></a><span class="k">        </span><span class="n">hcout</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.84d0</span><span class="o">*</span><span class="p">(</span><span class="n">tw</span><span class="o">-</span><span class="n">tex</span><span class="p">)</span><span class="o">**</span><span class="mf">0.33d0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">acoef</span><span class="o">*</span><span class="n">ws</span><span class="o">**</span><span class="n">bexp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5d0</span>
<a name="ln-4417"></a>      <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>  <span class="c">! Kimura correlation (Section 8.4.2.3 in ISO 15099-2001):</span>
<a name="ln-4418"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">iwd</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>    <span class="c">! windward</span>
<a name="ln-4419"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">ws</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">2.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4420"></a><span class="k">            </span><span class="n">vc</span> <span class="o">=</span> <span class="mf">0.25d0</span> <span class="o">*</span> <span class="n">ws</span>
<a name="ln-4421"></a>          <span class="k">else</span>
<a name="ln-4422"></a><span class="k">            </span><span class="n">vc</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">ws</span>
<a name="ln-4423"></a>          <span class="k">end if</span>
<a name="ln-4424"></a><span class="k">        else</span>        <span class="c">! leeward</span>
<a name="ln-4425"></a>          <span class="n">vc</span> <span class="o">=</span> <span class="mf">0.3d0</span> <span class="o">+</span> <span class="mf">0.05d0</span><span class="o">*</span><span class="n">ws</span>
<a name="ln-4426"></a>        <span class="k">end if</span>
<a name="ln-4427"></a><span class="k">        </span><span class="n">hcout</span> <span class="o">=</span> <span class="mf">4.7d0</span> <span class="o">+</span> <span class="mf">7.6d0</span> <span class="o">*</span> <span class="n">vc</span>
<a name="ln-4428"></a>    <span class="k">end select</span>
<a name="ln-4429"></a>
<a name="ln-4430"></a><span class="k">  end subroutine </span><span class="n">film</span>
<a name="ln-4431"></a>
<a name="ln-4432"></a>  <span class="k">subroutine </span><span class="n">Calc_ISO15099</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">tind</span><span class="p">,</span><span class="n">trmin</span><span class="p">,</span><span class="n">wso</span><span class="p">,</span><span class="n">wsi</span><span class="p">,</span><span class="n">dir</span><span class="p">,</span><span class="n">outir</span><span class="p">,</span><span class="n">isky</span><span class="p">,</span><span class="n">tsky</span><span class="p">,</span><span class="n">esky</span><span class="p">,</span><span class="n">fclr</span><span class="p">,</span><span class="n">VacuumPressure</span><span class="p">,</span><span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4433"></a>          <span class="p">&amp;</span> <span class="n">gap</span><span class="p">,</span><span class="n">thick</span><span class="p">,</span><span class="n">scon</span><span class="p">,</span><span class="n">tir</span><span class="p">,</span><span class="n">emis</span><span class="p">,</span><span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4434"></a>          <span class="p">&amp;</span>  <span class="n">tilt</span><span class="p">,</span><span class="n">asol</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">heightt</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">presure</span><span class="p">,</span><span class="n">iprop</span><span class="p">,</span><span class="n">frct</span><span class="p">,</span><span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span><span class="n">gama</span><span class="p">,</span><span class="n">nmix</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4435"></a>          <span class="p">&amp;</span> <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4436"></a>          <span class="p">&amp;</span>  <span class="n">theta</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">qv</span><span class="p">,</span><span class="n">ufactor</span><span class="p">,</span><span class="n">sc</span><span class="p">,</span><span class="n">hflux</span><span class="p">,</span><span class="n">hcin</span><span class="p">,</span><span class="n">hcout</span><span class="p">,</span><span class="n">hrin</span><span class="p">,</span><span class="n">hrout</span><span class="p">,</span><span class="n">hin</span><span class="p">,</span><span class="n">hout</span><span class="p">,</span><span class="n">hcgas</span><span class="p">,</span><span class="n">hrgas</span><span class="p">,</span><span class="n">shgc</span><span class="p">,</span><span class="n">nperr</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4437"></a>          <span class="p">&amp;</span>  <span class="n">shgct</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">troom</span><span class="p">,</span><span class="n">ibc</span><span class="p">,</span><span class="n">Atop</span><span class="p">,</span><span class="n">Abot</span><span class="p">,</span><span class="n">Al</span><span class="p">,</span><span class="n">Ar</span><span class="p">,</span><span class="n">Ah</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4438"></a>          <span class="p">&amp;</span>  <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span><span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4439"></a>          <span class="p">&amp;</span>  <span class="n">sumsol</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span><span class="n">Nu</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4440"></a>          <span class="p">&amp;</span>  <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4441"></a>          <span class="p">&amp;</span>  <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">SHGCCalc</span><span class="p">,</span> <span class="n">NumOfIterations</span><span class="p">)</span>
<a name="ln-4442"></a>
<a name="ln-4443"></a>    <span class="c">!!! function attributes:</span>
<a name="ln-4444"></a>
<a name="ln-4445"></a>    <span class="c">!!! INPUTS:</span>
<a name="ln-4446"></a>
<a name="ln-4447"></a>    <span class="c">!!! General:</span>
<a name="ln-4448"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-4449"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span>
<a name="ln-4450"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ThermalMod</span>
<a name="ln-4451"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SHGCCalc</span>      <span class="c">! SHGC calculation switch:</span>
<a name="ln-4452"></a>                                          <span class="c">!    0 - do not perform SHGC calculations</span>
<a name="ln-4453"></a>                                          <span class="c">!    1 - perform SHGC calculations</span>
<a name="ln-4454"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_mode</span> <span class="c">! Switch for debug output files:</span>
<a name="ln-4455"></a>                                        <span class="c">!    0 - don&#39;t create debug output files</span>
<a name="ln-4456"></a>                                        <span class="c">!    1 - append results to existing debug output file</span>
<a name="ln-4457"></a>                                        <span class="c">!    2 - store results in new debug output file</span>
<a name="ln-4458"></a>                                        <span class="c">!   3 - save in-between results (in all iterations) to existing debug file</span>
<a name="ln-4459"></a>
<a name="ln-4460"></a>    <span class="c">!!! Environment related:</span>
<a name="ln-4461"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span>
<a name="ln-4462"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span>
<a name="ln-4463"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">isky</span>
<a name="ln-4464"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-4465"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NumOfIterations</span>
<a name="ln-4466"></a>
<a name="ln-4467"></a>      <span class="c">!!! Layers:</span>
<a name="ln-4468"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-4469"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span>
<a name="ln-4470"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">asol</span>
<a name="ln-4471"></a>
<a name="ln-4472"></a>    <span class="c">!!! Venetians:</span>
<a name="ln-4473"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span>
<a name="ln-4474"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span>
<a name="ln-4475"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span>
<a name="ln-4476"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span>
<a name="ln-4477"></a>
<a name="ln-4478"></a>    <span class="c">!!! Laminates:</span>
<a name="ln-4479"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nslice</span>
<a name="ln-4480"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateA</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="n">LaminateB</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="n">sumsol</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span>
<a name="ln-4481"></a>
<a name="ln-4482"></a>    <span class="c">!!! Gaps:</span>
<a name="ln-4483"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-4484"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-4485"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">frct</span>
<a name="ln-4486"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">presure</span>
<a name="ln-4487"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span>
<a name="ln-4488"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">gama</span>
<a name="ln-4489"></a>
<a name="ln-4490"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPillar</span>    <span class="c">! Shows whether or not gap have support pillar</span>
<a name="ln-4491"></a>                                                               <span class="c">! 0 - does not have support pillar</span>
<a name="ln-4492"></a>                                                               <span class="c">! 1 - have support pillar</span>
<a name="ln-4493"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span>  <span class="c">! Pillar spacing for each gap (used in case there is support pillar)</span>
<a name="ln-4494"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarRadius</span>   <span class="c">! Pillar radius for each gap (used in case there is support pillar)</span>
<a name="ln-4495"></a>
<a name="ln-4496"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SDScalar</span>
<a name="ln-4497"></a>
<a name="ln-4498"></a>    <span class="c">!!!! INPUTS/OUTPUTS:</span>
<a name="ln-4499"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">esky</span><span class="p">,</span> <span class="n">trmin</span>
<a name="ln-4500"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span><span class="p">,</span> <span class="n">thick</span>
<a name="ln-4501"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-4502"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span>
<a name="ln-4503"></a>
<a name="ln-4504"></a>    <span class="c">!!! OUTPUTS:</span>
<a name="ln-4505"></a>      <span class="c">!!! Overall:</span>
<a name="ln-4506"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-4507"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-4508"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">hflux</span>
<a name="ln-4509"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">shgct</span>
<a name="ln-4510"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">troom</span>
<a name="ln-4511"></a>
<a name="ln-4512"></a>    <span class="c">!!! Layers:</span>
<a name="ln-4513"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-4514"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">q</span>
<a name="ln-4515"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qv</span>
<a name="ln-4516"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Keff</span>
<a name="ln-4517"></a>
<a name="ln-4518"></a>    <span class="c">!!! Gaps:</span>
<a name="ln-4519"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span>
<a name="ln-4520"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span>
<a name="ln-4521"></a>
<a name="ln-4522"></a>    <span class="c">!!! Shading related:</span>
<a name="ln-4523"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span>
<a name="ln-4524"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">HcUnshadedin</span>
<a name="ln-4525"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeGapKeffConv</span>
<a name="ln-4526"></a>
<a name="ln-4527"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-4528"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-4529"></a>
<a name="ln-4530"></a>    <span class="c">! Variables</span>
<a name="ln-4531"></a>
<a name="ln-4532"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thetas</span><span class="p">,</span> <span class="n">rir</span>
<a name="ln-4533"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgass</span><span class="p">,</span> <span class="n">hrgass</span>
<a name="ln-4534"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4535"></a>
<a name="ln-4536"></a>  <span class="c">!  real(r64) :: grho(maxgas,3)</span>
<a name="ln-4537"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qs</span>
<a name="ln-4538"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qvs</span>
<a name="ln-4539"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateAU</span><span class="p">,</span> <span class="n">sumsolU</span><span class="p">,</span> <span class="n">sol0</span>
<a name="ln-4540"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">shgct_NOSD</span><span class="p">,</span><span class="n">trmout</span>
<a name="ln-4541"></a>
<a name="ln-4542"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Gout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">AchievedErrorTolerance</span><span class="p">,</span> <span class="n">AchievedErrorToleranceSolar</span>
<a name="ln-4543"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">NumOfIter</span><span class="p">,</span> <span class="n">NumOfIterSolar</span>
<a name="ln-4544"></a>
<a name="ln-4545"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tgg</span><span class="p">,</span> <span class="n">qc1</span><span class="p">,</span> <span class="n">qc2</span><span class="p">,</span> <span class="n">qcgg</span>
<a name="ln-4546"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">qcgas</span><span class="p">,</span> <span class="n">qcgaps</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">,</span> <span class="n">qrgaps</span>
<a name="ln-4547"></a>
<a name="ln-4548"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ShadeHcModifiedOut</span><span class="p">,</span> <span class="n">ShadeHcModifiedIn</span>
<a name="ln-4549"></a>
<a name="ln-4550"></a>    <span class="c">!real(r64) :: xgrho(maxgas, 3)   !!!!!!!!!!!!!!!!!1</span>
<a name="ln-4551"></a>
<a name="ln-4552"></a>
<a name="ln-4553"></a>    <span class="c">!cbi...Variables for &quot;unshaded&quot; run:</span>
<a name="ln-4554"></a>
<a name="ln-4555"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">NeedUnshadedRun</span>
<a name="ln-4556"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">nlayer_NOSD</span>
<a name="ln-4557"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">AchievedErrorTolerance_NOSD</span>
<a name="ln-4558"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">NumOfIter_NOSD</span>
<a name="ln-4559"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Atop_NOSD</span><span class="p">,</span> <span class="n">Abot_NOSD</span><span class="p">,</span> <span class="n">Al_NOSD</span><span class="p">,</span> <span class="n">Ar_NOSD</span><span class="p">,</span> <span class="n">Ah_NOSD</span>
<a name="ln-4560"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatThick_NOSD</span><span class="p">,</span> <span class="n">SlatWidth_NOSD</span><span class="p">,</span> <span class="n">SlatAngle_NOSD</span>
<a name="ln-4561"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatCond_NOSD</span><span class="p">,</span> <span class="n">SlatSpacing_NOSD</span><span class="p">,</span> <span class="n">SlatCurve_NOSD</span>
<a name="ln-4562"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vvent_NOSD</span><span class="p">,</span> <span class="n">tvent_NOSD</span><span class="p">,</span> <span class="n">qv_NOSD</span>
<a name="ln-4563"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">q_NOSD</span>
<a name="ln-4564"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hin_NOSD</span><span class="p">,</span> <span class="n">flux_NOSD</span><span class="p">,</span> <span class="n">hcin_NOSD</span><span class="p">,</span> <span class="n">hrin_NOSD</span><span class="p">,</span> <span class="n">hcout_NOSD</span><span class="p">,</span> <span class="n">hrout_NOSD</span>
<a name="ln-4565"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tamb_NOSD</span><span class="p">,</span> <span class="n">troom_NOSD</span>
<a name="ln-4566"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType_NOSD</span>
<a name="ln-4567"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ufactor_NOSD</span><span class="p">,</span><span class="n">sc_NOSD</span><span class="p">,</span><span class="n">hflux_NOSD</span><span class="p">,</span><span class="n">shgc_NOSD</span><span class="p">,</span><span class="n">hout_NOSD</span>
<a name="ln-4568"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">gap_NOSD</span><span class="p">,</span> <span class="n">thick_NOSD</span><span class="p">,</span> <span class="n">scon_NOSD</span>
<a name="ln-4569"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">emis_NOSD</span><span class="p">,</span> <span class="n">rir_NOSD</span><span class="p">,</span> <span class="n">tir_NOSD</span>
<a name="ln-4570"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta_NOSD</span>
<a name="ln-4571"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct_NOSD</span>
<a name="ln-4572"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop_NOSD</span>
<a name="ln-4573"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix_NOSD</span>
<a name="ln-4574"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">presure_NOSD</span>
<a name="ln-4575"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hcgas_NOSD</span><span class="p">,</span> <span class="n">hrgas_NOSD</span>
<a name="ln-4576"></a>    <span class="c">!real(r64) ::  rs_NOSD(maxlay3)!,sol(maxlay)</span>
<a name="ln-4577"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">LaminateA_NOSD</span><span class="p">,</span> <span class="n">LaminateB_NOSD</span><span class="p">,</span> <span class="n">sumsol_NOSD</span>
<a name="ln-4578"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ra_NOSD</span><span class="p">,</span> <span class="n">Nu_NOSD</span>
<a name="ln-4579"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ShadeEmisRatioOut_NOSD</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn_NOSD</span>
<a name="ln-4580"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ShadeHcRatioOut_NOSD</span><span class="p">,</span> <span class="n">ShadeHcRatioIn_NOSD</span>
<a name="ln-4581"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ShadeHcModifiedOut_NOSD</span><span class="p">,</span> <span class="n">ShadeHcModifiedIn_NOSD</span>
<a name="ln-4582"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Rf</span>
<a name="ln-4583"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ebbs</span><span class="p">,</span> <span class="n">Ebfs</span><span class="p">,</span> <span class="n">Rbs</span><span class="p">,</span> <span class="n">Rfs</span>
<a name="ln-4584"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ebb_NOSD</span><span class="p">,</span> <span class="n">Ebf_NOSD</span><span class="p">,</span> <span class="n">Rb_NOSD</span><span class="p">,</span> <span class="n">Rf_NOSD</span>
<a name="ln-4585"></a>
<a name="ln-4586"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ShadeGapKeffConv_NOSD</span>
<a name="ln-4587"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">qcgas_NOSD</span><span class="p">,</span> <span class="n">Keff_NOSD</span><span class="p">,</span> <span class="n">qrgas_NOSD</span>
<a name="ln-4588"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nslice_NOSD</span>
<a name="ln-4589"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vfreevent_NOSD</span>
<a name="ln-4590"></a>
<a name="ln-4591"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">FirstSpecularLayer</span><span class="p">,</span> <span class="n">LastSpecularLayer</span>
<a name="ln-4592"></a>
<a name="ln-4593"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vfreevent</span>
<a name="ln-4594"></a>
<a name="ln-4595"></a>    <span class="c">!cbi...Other variables:</span>
<a name="ln-4596"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">flux</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">houtt</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Ebroom</span>
<a name="ln-4597"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-4598"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">OriginalIndex</span><span class="p">,</span> <span class="n">UnshadedDebug</span>
<a name="ln-4599"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">rtot</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4600"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">sft</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4601"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hcins</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4602"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hrins</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4603"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hins</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4604"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hcouts</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4605"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hrouts</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4606"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">houts</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4607"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ufactors</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4608"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">fluxs</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4609"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">qeff</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4610"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">flux_nonsolar</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4611"></a>
<a name="ln-4612"></a>    <span class="n">AchievedErrorTolerance</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4613"></a>    <span class="n">AchievedErrorToleranceSolar</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4614"></a>    <span class="n">AchievedErrorTolerance_NOSD</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4615"></a>
<a name="ln-4616"></a>    <span class="k">call </span><span class="n">PrepVariablesISO15099</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4617"></a>          <span class="p">&amp;</span>  <span class="n">tilt</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="n">SlatCond</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-4618"></a>          <span class="p">&amp;</span>  <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4619"></a>          <span class="p">&amp;</span> <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">LaminateAU</span><span class="p">,</span> <span class="n">sumsolU</span><span class="p">,</span> <span class="n">sol0</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4620"></a>          <span class="p">&amp;</span> <span class="n">hint</span><span class="p">,</span> <span class="n">houtt</span><span class="p">,</span> <span class="n">trmout</span><span class="p">,</span> <span class="n">ebsky</span><span class="p">,</span> <span class="n">ebroom</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-4621"></a>
<a name="ln-4622"></a>    <span class="c">!No option to take hardcoded variables.  All gas coefficients are now passed from outside.</span>
<a name="ln-4623"></a>    <span class="c">!if (GoAhead(nperr)) call propcon90(ISO15099,mgas,xgcon,xgvis,xgcp,xgrho,xwght,nperr)</span>
<a name="ln-4624"></a>
<a name="ln-4625"></a>    <span class="c">! exit on error</span>
<a name="ln-4626"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">return</span>
<a name="ln-4627"></a>
<a name="ln-4628"></a>    <span class="c">!bi...Write intermediate results to output file:</span>
<a name="ln-4629"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">WriteDebugOutput</span><span class="p">)</span>  <span class="k">then</span>
<a name="ln-4630"></a><span class="k">      call </span><span class="n">WriteModifiedArguments</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="n">DBGD</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">trmout</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">ebsky</span><span class="p">,</span> <span class="n">ebroom</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4631"></a>                                    <span class="n">nlayer</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">)</span>
<a name="ln-4632"></a>    <span class="k">end if</span>
<a name="ln-4633"></a>
<a name="ln-4634"></a>  <span class="c">!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span>
<a name="ln-4635"></a>  <span class="c">!</span>
<a name="ln-4636"></a>  <span class="c">!     This is &quot;solar radiation&quot; pass</span>
<a name="ln-4637"></a>  <span class="c">!</span>
<a name="ln-4638"></a>  <span class="c">!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span>
<a name="ln-4639"></a>
<a name="ln-4640"></a>  <span class="c">!This is main calculation in case UFactor calculations will not be performed</span>
<a name="ln-4641"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">dir</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">SHGCCalc</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4642"></a>      <span class="c">! call therm1d to calculate heat flux with solar radiation</span>
<a name="ln-4643"></a>
<a name="ln-4644"></a>      <span class="k">call </span><span class="n">therm1d</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4645"></a>                    <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4646"></a>                    <span class="n">nmix</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4647"></a>                    <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4648"></a>                    <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4649"></a>                    <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcModifiedOut</span><span class="p">,</span> <span class="n">ShadeHcModifiedIn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4650"></a>                    <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="n">AchievedErrorToleranceSolar</span><span class="p">,</span> <span class="n">NumOfIterSolar</span><span class="p">)</span>
<a name="ln-4651"></a>
<a name="ln-4652"></a>      <span class="n">NumOfIterations</span> <span class="o">=</span> <span class="n">NumOfIterSolar</span>
<a name="ln-4653"></a>      <span class="c">!exit on error:</span>
<a name="ln-4654"></a>
<a name="ln-4655"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4656"></a><span class="k">        do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-4657"></a>          <span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">*</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4658"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-4659"></a><span class="k">            </span><span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">*</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4660"></a>          <span class="k">end if</span>
<a name="ln-4661"></a><span class="k">          if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-4662"></a><span class="k">            </span><span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">*</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4663"></a>          <span class="k">end if</span>
<a name="ln-4664"></a><span class="k">        end do</span>
<a name="ln-4665"></a><span class="k">      end if</span>
<a name="ln-4666"></a>
<a name="ln-4667"></a><span class="k">      if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">return</span>
<a name="ln-4668"></a>
<a name="ln-4669"></a>      <span class="c">!No need to store results in case of non-ufactor run</span>
<a name="ln-4670"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">SHGCCalc</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">dir</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4671"></a><span class="k">        call </span><span class="n">solarISO15099</span><span class="p">(</span><span class="n">totsol</span><span class="p">,</span> <span class="n">rtot</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">sft</span><span class="p">)</span>
<a name="ln-4672"></a>        <span class="n">shgct</span> <span class="o">=</span> <span class="n">sft</span>
<a name="ln-4673"></a>        <span class="n">shgct_NOSD</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4674"></a>        <span class="n">hcins</span><span class="o">=</span><span class="n">hcin</span>
<a name="ln-4675"></a>        <span class="n">hrins</span><span class="o">=</span><span class="n">hrin</span>
<a name="ln-4676"></a>        <span class="n">hins</span><span class="o">=</span><span class="n">hin</span>
<a name="ln-4677"></a>        <span class="n">hcouts</span><span class="o">=</span><span class="n">hcout</span>
<a name="ln-4678"></a>        <span class="n">hrouts</span><span class="o">=</span><span class="n">hrout</span>
<a name="ln-4679"></a>        <span class="n">houts</span><span class="o">=</span><span class="n">hout</span>
<a name="ln-4680"></a>        <span class="n">ufactors</span><span class="o">=</span><span class="n">ufactor</span>
<a name="ln-4681"></a>        <span class="n">fluxs</span><span class="o">=</span><span class="n">flux</span>
<a name="ln-4682"></a>        <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span>
<a name="ln-4683"></a>          <span class="n">thetas</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4684"></a>          <span class="n">thetas</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4685"></a>          <span class="n">Ebbs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4686"></a>          <span class="n">Ebfs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4687"></a>          <span class="n">Rbs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4688"></a>          <span class="n">Rfs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4689"></a>          <span class="n">qs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-4690"></a>          <span class="n">qs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4691"></a>          <span class="c">!qprims(2*i - 1) = qprim(2*i - 1)</span>
<a name="ln-4692"></a>          <span class="c">!qprims(2*i) = qprim(2*i)</span>
<a name="ln-4693"></a>          <span class="n">qvs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">qv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-4694"></a>          <span class="n">qvs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">qv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4695"></a>          <span class="n">hcgass</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4696"></a>          <span class="n">hrgass</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4697"></a>          <span class="n">qrgaps</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4698"></a>          <span class="n">qcgaps</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4699"></a>        <span class="k">end do</span>
<a name="ln-4700"></a>    <span class="c">!    CHECK THIS!</span>
<a name="ln-4701"></a>        <span class="n">qs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4702"></a>      <span class="k">end if</span> <span class="c">!if (UFactorCalc.gt.0) then</span>
<a name="ln-4703"></a>
<a name="ln-4704"></a>    <span class="k">end if</span>
<a name="ln-4705"></a>
<a name="ln-4706"></a>    <span class="c">!No solar radiation pass is not needed to be calculated</span>
<a name="ln-4707"></a>    <span class="c">!if ((SHGCCalc.gt.0).or.(dir.eq.0)) then</span>
<a name="ln-4708"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SHGCCalc</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4709"></a>
<a name="ln-4710"></a>        <span class="c">!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span>
<a name="ln-4711"></a>        <span class="c">!</span>
<a name="ln-4712"></a>        <span class="c">!      This is &quot;no solar radiation&quot; pass</span>
<a name="ln-4713"></a>        <span class="c">!</span>
<a name="ln-4714"></a>        <span class="c">!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span>
<a name="ln-4715"></a>
<a name="ln-4716"></a>          <span class="n">hin</span><span class="o">=</span><span class="n">hint</span>
<a name="ln-4717"></a>          <span class="n">hout</span><span class="o">=</span><span class="n">houtt</span>
<a name="ln-4718"></a>
<a name="ln-4719"></a>          <span class="c">! call therm1d to calculate heat flux without solar radiation</span>
<a name="ln-4720"></a>          <span class="k">call </span><span class="n">therm1d</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4721"></a>                        <span class="mf">0.0d0</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4722"></a>                        <span class="n">tilt</span><span class="p">,</span> <span class="n">sol0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4723"></a>                        <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4724"></a>                        <span class="n">theta</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4725"></a>                        <span class="n">tamb</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4726"></a>                        <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcModifiedOut</span><span class="p">,</span> <span class="n">ShadeHcModifiedIn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4727"></a>                        <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="n">AchievedErrorTolerance</span><span class="p">,</span> <span class="n">NumOfIter</span><span class="p">)</span>
<a name="ln-4728"></a>
<a name="ln-4729"></a>          <span class="n">NumOfIterations</span> <span class="o">=</span> <span class="n">NumOfIter</span>
<a name="ln-4730"></a>
<a name="ln-4731"></a>          <span class="c">!exit on error:</span>
<a name="ln-4732"></a>          <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">return</span>
<a name="ln-4733"></a>
<a name="ln-4734"></a>          <span class="c">!bi...Keep hcout, hcin in case this is an unshaded system:</span>
<a name="ln-4735"></a>          <span class="n">HcUnshadedOut</span> <span class="o">=</span> <span class="n">hcout</span>
<a name="ln-4736"></a>          <span class="n">HcUnshadedIn</span>  <span class="o">=</span> <span class="n">hcin</span>
<a name="ln-4737"></a>
<a name="ln-4738"></a>          <span class="c">!bi...do an Unshaded run if necessary (Uvalue/Winter conditions):</span>
<a name="ln-4739"></a>          <span class="c">!bi...Prepare variables for UNSHADED (NO SD) run:</span>
<a name="ln-4740"></a>
<a name="ln-4741"></a>          <span class="n">NeedUnshadedRun</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4742"></a>          <span class="n">FirstSpecularLayer</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4743"></a>          <span class="n">LastSpecularLayer</span> <span class="o">=</span> <span class="n">nlayer</span>
<a name="ln-4744"></a>          <span class="n">nlayer_NOSD</span> <span class="o">=</span> <span class="n">nlayer</span>
<a name="ln-4745"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-4746"></a><span class="k">            </span><span class="n">nlayer_NOSD</span> <span class="o">=</span> <span class="n">nlayer_NOSD</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4747"></a>            <span class="n">FirstSpecularLayer</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-4748"></a>            <span class="n">NeedUnshadedRun</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4749"></a>          <span class="k">end if</span>
<a name="ln-4750"></a>
<a name="ln-4751"></a>        <span class="c">!  if (LayerType(nlayer).eq.VENETBLIND) then</span>
<a name="ln-4752"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-4753"></a><span class="k">            </span><span class="n">nlayer_NOSD</span> <span class="o">=</span> <span class="n">nlayer_NOSD</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-4754"></a>            <span class="n">LastSpecularLayer</span> <span class="o">=</span> <span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-4755"></a>            <span class="n">NeedUnshadedRun</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4756"></a>          <span class="k">end if</span>
<a name="ln-4757"></a>
<a name="ln-4758"></a>          <span class="c">! no unshaded run for now</span>
<a name="ln-4759"></a>          <span class="n">NeedUnshadedRun</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4760"></a>          <span class="c">!bi...Set outdoor &amp; indoor gas properties:</span>
<a name="ln-4761"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">NeedUnshadedRun</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4762"></a><span class="k">            </span><span class="n">nmix_NOSD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="o">=</span> <span class="n">nmix</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4763"></a>            <span class="n">presure_NOSD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">presure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4764"></a>            <span class="n">nmix_NOSD</span><span class="p">(</span><span class="n">nlayer_NOSD</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">nmix</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4765"></a>            <span class="n">presure_NOSD</span><span class="p">(</span><span class="n">nlayer_NOSD</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">presure</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4766"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4767"></a>              <span class="n">iprop_NOSD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-4768"></a>              <span class="n">frct_NOSD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>  <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-4769"></a>            <span class="k">end do</span>
<a name="ln-4770"></a><span class="k">            do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">nlayer_NOSD</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4771"></a>              <span class="n">iprop_NOSD</span><span class="p">(</span><span class="n">nlayer_NOSD</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-4772"></a>              <span class="n">frct_NOSD</span><span class="p">(</span><span class="n">nlayer_NOSD</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>  <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-4773"></a>            <span class="k">end do</span>
<a name="ln-4774"></a><span class="k">            do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer_NOSD</span>
<a name="ln-4775"></a>              <span class="n">OriginalIndex</span> <span class="o">=</span> <span class="n">FirstSpecularLayer</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4776"></a>              <span class="n">Atop_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Atop</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4777"></a>              <span class="n">Abot_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Abot</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4778"></a>              <span class="n">Al_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Al</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4779"></a>              <span class="n">Ar_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ar</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4780"></a>              <span class="n">Ah_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ah</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4781"></a>
<a name="ln-4782"></a>              <span class="n">SlatThick_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatThick</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4783"></a>              <span class="n">SlatWidth_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatWidth</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4784"></a>              <span class="n">SlatAngle_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatAngle</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4785"></a>              <span class="n">SlatCond_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">SlatCond</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4786"></a>              <span class="n">SlatSpacing_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatSpacing</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4787"></a>              <span class="n">SlatCurve_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">SlatCurve</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4788"></a>
<a name="ln-4789"></a>              <span class="c">!cbi...    TO do when Forced Ventilation is implemented: take care of appropriate arguments!!!</span>
<a name="ln-4790"></a>              <span class="c">!</span>
<a name="ln-4791"></a>              <span class="c">!      vvent_NOSD</span>
<a name="ln-4792"></a>              <span class="c">!      tvent_NOSD</span>
<a name="ln-4793"></a>              <span class="c">!</span>
<a name="ln-4794"></a>
<a name="ln-4795"></a>              <span class="n">LayerType_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4796"></a>
<a name="ln-4797"></a>              <span class="n">thick_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="n">thick</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4798"></a>              <span class="n">scon_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>     <span class="o">=</span> <span class="n">scon</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4799"></a>              <span class="n">tir_NOSD</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">tir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">OriginalIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4800"></a>              <span class="n">emis_NOSD</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">OriginalIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4801"></a>              <span class="n">emis_NOSD</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4802"></a>              <span class="n">rir_NOSD</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">rir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">OriginalIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4803"></a>              <span class="n">rir_NOSD</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="n">rir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4804"></a>
<a name="ln-4805"></a>              <span class="n">gap_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>        <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4806"></a>
<a name="ln-4807"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">nlayer_NOSD</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4808"></a><span class="k">                </span><span class="n">nmix_NOSD</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>     <span class="o">=</span> <span class="n">nmix</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4809"></a>                <span class="n">presure_NOSD</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">presure</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4810"></a>                <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nmix_NOSD</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4811"></a>                  <span class="n">iprop_NOSD</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>  <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-4812"></a>                  <span class="n">frct_NOSD</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>   <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-4813"></a>                <span class="k">end do</span>
<a name="ln-4814"></a><span class="k">              end if</span>
<a name="ln-4815"></a>
<a name="ln-4816"></a><span class="k">              </span><span class="n">LaminateA_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">LaminateA</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4817"></a>              <span class="n">LaminateB_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">LaminateB</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4818"></a>              <span class="n">sumsol_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>     <span class="o">=</span> <span class="n">sumsol</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4819"></a>
<a name="ln-4820"></a>              <span class="n">nslice_NOSD</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">nslice</span><span class="p">(</span><span class="n">OriginalIndex</span><span class="p">)</span>
<a name="ln-4821"></a>
<a name="ln-4822"></a>            <span class="k">end do</span>
<a name="ln-4823"></a>
<a name="ln-4824"></a>            <span class="c">!    This is UNSHADED pass - no solar radiation:</span>
<a name="ln-4825"></a>            <span class="n">hin_NOSD</span><span class="o">=</span><span class="n">hint</span>
<a name="ln-4826"></a>            <span class="n">hout_NOSD</span><span class="o">=</span><span class="n">houtt</span>
<a name="ln-4827"></a>
<a name="ln-4828"></a>            <span class="c">!Simon: Removed unshaded debug output for now</span>
<a name="ln-4829"></a>            <span class="n">UnshadedDebug</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4830"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">WriteDebugOutput</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">UnshadedDebug</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4831"></a><span class="k">              </span><span class="n">FileMode</span> <span class="o">=</span> <span class="s1">&#39;APPEND&#39;</span>
<a name="ln-4832"></a>              <span class="c">! InArgumentsFile should already be open</span>
<a name="ln-4833"></a>              <span class="c">!open(unit=InArgumentsFile,  file=TRIM(DBGD)//DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode,  &amp;</span>
<a name="ln-4834"></a>              <span class="c">!  &amp;    form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-4835"></a>
<a name="ln-4836"></a>              <span class="c">!if (nperr.ne.0)  open(unit=InArgumentsFile,  file=DebugOutputFileName,  status=&#39;unknown&#39;, access=FileMode, &amp;</span>
<a name="ln-4837"></a>              <span class="c">!  &amp;   form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-4838"></a>              <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-4839"></a>              <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;UNSHADED RUN:&#39;</span>
<a name="ln-4840"></a>              <span class="k">write</span><span class="p">(</span><span class="n">InArgumentsFile</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<a name="ln-4841"></a>              <span class="c">!close(InArgumentsFile)</span>
<a name="ln-4842"></a>
<a name="ln-4843"></a>              <span class="k">call </span><span class="n">WriteInputArguments</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span>  <span class="n">wso</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4844"></a>                                        <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">hout_NOSD</span><span class="p">,</span> <span class="n">hin_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4845"></a>                                        <span class="n">ISO15099</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4846"></a>                                        <span class="n">nlayer_NOSD</span><span class="p">,</span> <span class="n">LayerType_NOSD</span><span class="p">,</span> <span class="n">thick_NOSD</span><span class="p">,</span> <span class="n">scon_NOSD</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">tir_NOSD</span><span class="p">,</span> <span class="n">emis_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4847"></a>                                        <span class="n">Atop_NOSD</span><span class="p">,</span> <span class="n">Abot_NOSD</span><span class="p">,</span> <span class="n">Al_NOSD</span><span class="p">,</span> <span class="n">Ar_NOSD</span><span class="p">,</span> <span class="n">Ah_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4848"></a>                                        <span class="n">SlatThick_NOSD</span><span class="p">,</span> <span class="n">SlatWidth_NOSD</span><span class="p">,</span> <span class="n">SlatAngle_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4849"></a>                                        <span class="n">SlatCond_NOSD</span><span class="p">,</span> <span class="n">SlatSpacing_NOSD</span><span class="p">,</span> <span class="n">SlatCurve_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4850"></a>                                        <span class="n">nslice_NOSD</span><span class="p">,</span> <span class="n">LaminateA_NOSD</span><span class="p">,</span> <span class="n">LaminateB_NOSD</span><span class="p">,</span> <span class="n">sumsol_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4851"></a>                                        <span class="n">gap_NOSD</span><span class="p">,</span> <span class="n">vvent_NOSD</span><span class="p">,</span> <span class="n">tvent_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4852"></a>                                        <span class="n">presure_NOSD</span><span class="p">,</span> <span class="n">nmix_NOSD</span><span class="p">,</span> <span class="n">iprop_NOSD</span><span class="p">,</span> <span class="n">frct_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4853"></a>                                        <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">)</span>
<a name="ln-4854"></a>
<a name="ln-4855"></a>            <span class="k">end if</span> <span class="c">! end if UnshadedDebug = 1</span>
<a name="ln-4856"></a>
<a name="ln-4857"></a>        <span class="c">!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span>
<a name="ln-4858"></a>        <span class="c">!</span>
<a name="ln-4859"></a>        <span class="c">!      This is &quot;Unshaded, No solar radiation&quot; pass</span>
<a name="ln-4860"></a>        <span class="c">!</span>
<a name="ln-4861"></a>        <span class="c">!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc</span>
<a name="ln-4862"></a>            <span class="c">! call therm1d to calculate heat flux with solar radiation</span>
<a name="ln-4863"></a>            <span class="k">call </span><span class="n">therm1d</span><span class="p">(</span><span class="n">nlayer_NOSD</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4864"></a>                          <span class="mf">0.0d0</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">tir_NOSD</span><span class="p">,</span> <span class="n">rir_NOSD</span><span class="p">,</span> <span class="n">emis_NOSD</span><span class="p">,</span> <span class="n">gap_NOSD</span><span class="p">,</span> <span class="n">thick_NOSD</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4865"></a>                          <span class="n">scon_NOSD</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">sol0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">iprop_NOSD</span><span class="p">,</span> <span class="n">frct_NOSD</span><span class="p">,</span> <span class="n">presure_NOSD</span><span class="p">,</span> <span class="n">nmix_NOSD</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4866"></a>                          <span class="n">xwght</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4867"></a>                          <span class="n">theta_NOSD</span><span class="p">,</span> <span class="n">q_NOSD</span><span class="p">,</span> <span class="n">qv_NOSD</span><span class="p">,</span> <span class="n">flux_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4868"></a>                          <span class="n">hcin_NOSD</span><span class="p">,</span> <span class="n">hrin_NOSD</span><span class="p">,</span> <span class="n">hcout_NOSD</span><span class="p">,</span> <span class="n">hrout_NOSD</span><span class="p">,</span> <span class="n">hin_NOSD</span><span class="p">,</span> <span class="n">hout_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4869"></a>                          <span class="n">hcgas_NOSD</span><span class="p">,</span> <span class="n">hrgas_NOSD</span><span class="p">,</span> <span class="n">ufactor_NOSD</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">tamb_NOSD</span><span class="p">,</span> <span class="n">troom_NOSD</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4870"></a>                          <span class="n">Atop_NOSD</span><span class="p">,</span> <span class="n">Abot_NOSD</span><span class="p">,</span> <span class="n">Al_NOSD</span><span class="p">,</span> <span class="n">Ar_NOSD</span><span class="p">,</span> <span class="n">Ah_NOSD</span><span class="p">,</span> <span class="n">vvent_NOSD</span><span class="p">,</span> <span class="n">tvent_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4871"></a>                          <span class="n">LayerType_NOSD</span><span class="p">,</span> <span class="n">Ra_NOSD</span><span class="p">,</span> <span class="n">Nu_NOSD</span><span class="p">,</span> <span class="n">vfreevent_NOSD</span><span class="p">,</span> <span class="n">qcgas_NOSD</span><span class="p">,</span> <span class="n">qrgas_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4872"></a>                          <span class="n">Ebf_NOSD</span><span class="p">,</span> <span class="n">Ebb_NOSD</span><span class="p">,</span> <span class="n">Rf_NOSD</span><span class="p">,</span> <span class="n">Rb_NOSD</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4873"></a>                          <span class="n">ShadeEmisRatioOut_NOSD</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn_NOSD</span><span class="p">,</span> <span class="n">ShadeHcModifiedOut_NOSD</span><span class="p">,</span> <span class="n">ShadeHcModifiedIn_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4874"></a>                          <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="n">AchievedErrorTolerance_NOSD</span><span class="p">,</span> <span class="n">NumOfIter_NOSD</span><span class="p">)</span>
<a name="ln-4875"></a>
<a name="ln-4876"></a>            <span class="n">NumOfIterations</span> <span class="o">=</span> <span class="n">NumOfIter_NOSD</span>
<a name="ln-4877"></a>            <span class="c">! exit on error</span>
<a name="ln-4878"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">return</span>
<a name="ln-4879"></a>
<a name="ln-4880"></a>            <span class="c">!bi...  Keep these values:</span>
<a name="ln-4881"></a>            <span class="n">HcUnshadedOut</span> <span class="o">=</span> <span class="n">hcout_NOSD</span>
<a name="ln-4882"></a>            <span class="n">HcUnshadedIn</span>  <span class="o">=</span> <span class="n">hcin_NOSD</span>
<a name="ln-4883"></a>
<a name="ln-4884"></a>            <span class="n">ShadeHcRatioOut</span> <span class="o">=</span> <span class="n">ShadeHcModifiedOut</span> <span class="o">/</span> <span class="n">HcUnshadedOut</span>
<a name="ln-4885"></a>            <span class="n">ShadeHcRatioIn</span>  <span class="o">=</span> <span class="n">ShadeHcModifiedIn</span>  <span class="o">/</span> <span class="n">HcUnshadedIn</span>
<a name="ln-4886"></a>
<a name="ln-4887"></a>
<a name="ln-4888"></a>            <span class="c">!bi...unshaded results:</span>
<a name="ln-4889"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">WriteDebugOutput</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">UnshadedDebug</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4890"></a><span class="k">              call </span><span class="n">WriteOutputArguments</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="n">DBGD</span><span class="p">,</span> <span class="n">nlayer_NOSD</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">q_NOSD</span><span class="p">,</span> <span class="n">qv_NOSD</span><span class="p">,</span> <span class="n">qcgas_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4891"></a>                                        <span class="n">qrgas_NOSD</span><span class="p">,</span> <span class="n">theta_NOSD</span><span class="p">,</span> <span class="n">vfreevent_NOSD</span><span class="p">,</span> <span class="n">vvent_NOSD</span><span class="p">,</span> <span class="n">Keff_NOSD</span><span class="p">,</span> <span class="n">ShadeGapKeffConv_NOSD</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4892"></a>                                        <span class="n">troom_NOSD</span><span class="p">,</span> <span class="n">ufactor_NOSD</span><span class="p">,</span> <span class="n">shgc_NOSD</span><span class="p">,</span> <span class="n">sc_NOSD</span><span class="p">,</span> <span class="n">hflux_NOSD</span><span class="p">,</span> <span class="n">shgct_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4893"></a>                                        <span class="n">hcin_NOSD</span><span class="p">,</span> <span class="n">hrin_NOSD</span><span class="p">,</span> <span class="n">hcout_NOSD</span><span class="p">,</span> <span class="n">hrout_NOSD</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-4894"></a>                                        <span class="n">Ra_NOSD</span><span class="p">,</span> <span class="n">Nu_NOSD</span><span class="p">,</span> <span class="n">LayerType_NOSD</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4895"></a>                                        <span class="n">Ebf_NOSD</span><span class="p">,</span> <span class="n">Ebb_NOSD</span><span class="p">,</span> <span class="n">Rf_NOSD</span><span class="p">,</span> <span class="n">Rb_NOSD</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4896"></a>                                        <span class="n">ShadeEmisRatioIn_NOSD</span><span class="p">,</span> <span class="n">ShadeEmisRatioOut_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4897"></a>                                        <span class="n">ShadeHcRatioIn_NOSD</span><span class="p">,</span> <span class="n">ShadeHcRatioOut_NOSD</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4898"></a>                                        <span class="n">hcin_NOSD</span><span class="p">,</span> <span class="n">hcout_NOSD</span><span class="p">,</span> <span class="n">hcgas_NOSD</span><span class="p">,</span> <span class="n">hrgas_NOSD</span><span class="p">,</span> <span class="n">AchievedErrorTolerance_NOSD</span><span class="p">,</span> <span class="n">NumOfIter_NOSD</span><span class="p">)</span>
<a name="ln-4899"></a>            <span class="k">end if</span> <span class="c">! end if UnshadedDebug = 1</span>
<a name="ln-4900"></a>          <span class="k">end if</span> <span class="c">! end if NeedUnshadedRun...</span>
<a name="ln-4901"></a>
<a name="ln-4902"></a>
<a name="ln-4903"></a>          <span class="c">!bi Set T6-related quantities keff, keffc: (using non-solar pass results)</span>
<a name="ln-4904"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4905"></a><span class="k">            do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-4906"></a>              <span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">*</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4907"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-4908"></a><span class="k">                </span><span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">*</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4909"></a>              <span class="k">end if</span>
<a name="ln-4910"></a><span class="k">              if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-4911"></a><span class="k">                </span><span class="n">Keff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>   <span class="o">*</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4912"></a>              <span class="k">end if</span>
<a name="ln-4913"></a><span class="k">              if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-4914"></a>                <span class="c">!Keff(i)   = gap(i)   * qprim(2*i+1) / (theta(2*i+1) - theta(2*i))</span>
<a name="ln-4915"></a>                <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4916"></a><span class="k">                  </span><span class="n">tgg</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4917"></a>                  <span class="n">qc1</span> <span class="o">=</span> <span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4918"></a>                  <span class="n">qc2</span> <span class="o">=</span> <span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4919"></a>                  <span class="n">qcgg</span> <span class="o">=</span> <span class="p">(</span><span class="n">qc1</span> <span class="o">+</span> <span class="n">qc2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0d0</span>
<a name="ln-4920"></a>                  <span class="n">ShadeGapKeffConv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">tgg</span> <span class="o">*</span> <span class="n">qcgg</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-4921"></a>                <span class="k">end if</span>
<a name="ln-4922"></a><span class="k">              end if</span>
<a name="ln-4923"></a><span class="k">            end do</span>
<a name="ln-4924"></a><span class="k">          end if</span>
<a name="ln-4925"></a>
<a name="ln-4926"></a><span class="k">    end if</span> <span class="c">!if (UFactorCalc.ne.0) then</span>
<a name="ln-4927"></a>
<a name="ln-4928"></a>    <span class="c">!bi...  For debugging purposes:</span>
<a name="ln-4929"></a>    <span class="n">qeff</span> <span class="o">=</span> <span class="n">ufactor</span> <span class="o">*</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">tout</span> <span class="o">-</span> <span class="n">tind</span><span class="p">)</span>
<a name="ln-4930"></a>    <span class="n">flux_nonsolar</span> <span class="o">=</span> <span class="n">flux</span>
<a name="ln-4931"></a>
<a name="ln-4932"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">SHGCCalc</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">dir</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4933"></a><span class="k">      </span><span class="n">shgc</span><span class="o">=</span><span class="n">totsol</span><span class="o">-</span><span class="p">(</span><span class="n">fluxs</span><span class="o">-</span><span class="n">flux</span><span class="p">)</span><span class="o">/</span><span class="n">dir</span>
<a name="ln-4934"></a>      <span class="n">sc</span><span class="o">=</span><span class="n">shgc</span><span class="o">/</span><span class="mf">0.87d0</span>
<a name="ln-4935"></a>      <span class="n">hcin</span><span class="o">=</span><span class="n">hcins</span>
<a name="ln-4936"></a>      <span class="n">hrin</span><span class="o">=</span><span class="n">hrins</span>
<a name="ln-4937"></a>      <span class="n">hin</span><span class="o">=</span><span class="n">hins</span>
<a name="ln-4938"></a>      <span class="n">hcout</span><span class="o">=</span><span class="n">hcouts</span>
<a name="ln-4939"></a>      <span class="n">hrout</span><span class="o">=</span><span class="n">hrouts</span>
<a name="ln-4940"></a>      <span class="n">hout</span><span class="o">=</span><span class="n">houts</span>
<a name="ln-4941"></a>      <span class="n">flux</span><span class="o">=</span><span class="n">fluxs</span> <span class="c">! &lt;--- ???</span>
<a name="ln-4942"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span>
<a name="ln-4943"></a>        <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">thetas</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4944"></a>        <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">thetas</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4945"></a>        <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ebbs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4946"></a>        <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ebfs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4947"></a>        <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Rbs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4948"></a>        <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Rfs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4949"></a>        <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">qs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-4950"></a>        <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">qs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4951"></a>        <span class="c">!qprim(2*i - 1) = qprims(2*i - 1)</span>
<a name="ln-4952"></a>        <span class="c">!qprim(2*i) = qprims(2*i)</span>
<a name="ln-4953"></a>        <span class="n">qv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">qvs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-4954"></a>        <span class="n">qv</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">qvs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4955"></a>        <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">hcgass</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4956"></a>        <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">hrgass</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4957"></a>        <span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">qcgaps</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4958"></a>        <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">qrgaps</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4959"></a>        <span class="n">AchievedErrorTolerance</span> <span class="o">=</span> <span class="n">AchievedErrorToleranceSolar</span>
<a name="ln-4960"></a>        <span class="n">NumOfIter</span> <span class="o">=</span> <span class="n">NumOfIterSolar</span>
<a name="ln-4961"></a>      <span class="k">end do</span>
<a name="ln-4962"></a>
<a name="ln-4963"></a>      <span class="c">! bi    CHECK THIS!</span>
<a name="ln-4964"></a>       <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">qs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4965"></a>    <span class="k">end if</span>
<a name="ln-4966"></a>
<a name="ln-4967"></a><span class="k">    </span><span class="n">hflux</span> <span class="o">=</span> <span class="n">flux</span>        <span class="c">! save flux value for output table</span>
<a name="ln-4968"></a>
<a name="ln-4969"></a>    <span class="c">!bi...  Write results to debug output file:</span>
<a name="ln-4970"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">WriteDebugOutput</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4971"></a><span class="k">         call </span><span class="n">WriteOutputArguments</span><span class="p">(</span><span class="n">OutArgumentsFile</span><span class="p">,</span> <span class="n">DBGD</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4972"></a>                                 <span class="p">&amp;</span>   <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">hflux</span><span class="p">,</span> <span class="n">shgct</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4973"></a>                                 <span class="p">&amp;</span>   <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4974"></a>                                 <span class="p">&amp;</span>   <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4975"></a>                                 <span class="p">&amp;</span>   <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4976"></a>                                 <span class="p">&amp;</span>   <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">AchievedErrorTolerance</span><span class="p">,</span> <span class="n">NumOfIter</span><span class="p">)</span>
<a name="ln-4977"></a>      <span class="k">end if</span>  <span class="c">! if WriteDebugOutput.eq.true - writing output file</span>
<a name="ln-4978"></a>
<a name="ln-4979"></a>  <span class="k">end subroutine </span><span class="n">Calc_ISO15099</span>
<a name="ln-4980"></a>
<a name="ln-4981"></a>  <span class="k">subroutine </span><span class="n">therm1d</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4982"></a>                      <span class="n">dir</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4983"></a>                      <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4984"></a>                      <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4985"></a>                      <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4986"></a>                      <span class="n">theta</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4987"></a>                      <span class="n">tamb</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4988"></a>                      <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4989"></a>                      <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcModifiedOut</span><span class="p">,</span> <span class="n">ShadeHcModifiedIn</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-4990"></a>                      <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="n">AchievedErrorTolerance</span><span class="p">,</span> <span class="n">TotalIndex</span><span class="p">)</span>
<a name="ln-4991"></a>    <span class="c">!********************************************************************************</span>
<a name="ln-4992"></a>    <span class="c">! Main subroutine for calculation of 1-D heat transfer in the center of glazing.</span>
<a name="ln-4993"></a>    <span class="c">!********************************************************************************</span>
<a name="ln-4994"></a>    <span class="c">! Inputs</span>
<a name="ln-4995"></a>    <span class="c">!</span>
<a name="ln-4996"></a>    <span class="c">!   nlayer    number of solid layers</span>
<a name="ln-4997"></a>    <span class="c">!   iwd   wind direction</span>
<a name="ln-4998"></a>    <span class="c">!   tout  outside temp in k</span>
<a name="ln-4999"></a>    <span class="c">!   tind  inside temp in k</span>
<a name="ln-5000"></a>    <span class="c">!   wso   wind speed in m/s</span>
<a name="ln-5001"></a>    <span class="c">!   wsi   inside forced air speed m/s</span>
<a name="ln-5002"></a>    <span class="c">!   Ebsky     ir flux from outside</span>
<a name="ln-5003"></a>    <span class="c">!   Gout  back facing radiosity from outside</span>
<a name="ln-5004"></a>    <span class="c">!   Trmout    Mean outdoor radiant temperature</span>
<a name="ln-5005"></a>    <span class="c">!   Trmin     Mean indoor radiant temperature</span>
<a name="ln-5006"></a>    <span class="c">!   Ebroom    ir flux from room</span>
<a name="ln-5007"></a>    <span class="c">!   Gin   front facing radiosity from room</span>
<a name="ln-5008"></a>    <span class="c">!   tir   ir transmittance of each layer</span>
<a name="ln-5009"></a>    <span class="c">!   rir   ir reflectance of each surface</span>
<a name="ln-5010"></a>    <span class="c">!   emis  ir emittances of each surface</span>
<a name="ln-5011"></a>    <span class="c">!   gap   array of gap widths in meters</span>
<a name="ln-5012"></a>    <span class="c">!   thick     thickness of glazing layers (m)</span>
<a name="ln-5013"></a>    <span class="c">!   scon  Vector of conductivities of &#39;glazing&#39; layers</span>
<a name="ln-5014"></a>    <span class="c">!   tilt  Window tilt (deg). vert: tilt=90, hor out up: tilt=0, hor out down: tilt=180</span>
<a name="ln-5015"></a>    <span class="c">!   sol   absorbed solar energy for each layer in w/m2</span>
<a name="ln-5016"></a>    <span class="c">!   height    glazing cavity height</span>
<a name="ln-5017"></a>    <span class="c">!   heightt</span>
<a name="ln-5018"></a>    <span class="c">!   iprop</span>
<a name="ln-5019"></a>    <span class="c">!   frct</span>
<a name="ln-5020"></a>    <span class="c">!   presure</span>
<a name="ln-5021"></a>    <span class="c">!   nmix  vector of number of gasses in a mixture for each gap</span>
<a name="ln-5022"></a>    <span class="c">!   hin  convective indoor film coefficient (if non-zero hin input)</span>
<a name="ln-5023"></a>    <span class="c">!   hout     convective outdoor film coeff. (if non-zero hout input)</span>
<a name="ln-5024"></a>    <span class="c">!</span>
<a name="ln-5025"></a>    <span class="c">! outputs</span>
<a name="ln-5026"></a>    <span class="c">!</span>
<a name="ln-5027"></a>    <span class="c">!   theta     temp distribution in k</span>
<a name="ln-5028"></a>    <span class="c">!   flux  net heat flux between room and window</span>
<a name="ln-5029"></a>    <span class="c">!   rtot  overall thermal resistance</span>
<a name="ln-5030"></a>    <span class="c">!   rs    ?</span>
<a name="ln-5031"></a>    <span class="c">!   hcin  convective indoor film coeff.</span>
<a name="ln-5032"></a>    <span class="c">!   hrin  radiative part of indoor film coeff.</span>
<a name="ln-5033"></a>    <span class="c">!   hcout     convective outdoor film coeff.</span>
<a name="ln-5034"></a>    <span class="c">!   hrout     radiative part of outdoor film coeff.</span>
<a name="ln-5035"></a>    <span class="c">!   hin   convective indoor film coefficient</span>
<a name="ln-5036"></a>    <span class="c">!   hout  convective outdoor film coeff.</span>
<a name="ln-5037"></a>    <span class="c">!   ufactor   overall u-factor</span>
<a name="ln-5038"></a>    <span class="c">!   qcgap     vector of convective/conductive parts of flux in gaps</span>
<a name="ln-5039"></a>    <span class="c">!   qrgap     vector of radiative parts of flux in gaps</span>
<a name="ln-5040"></a>    <span class="c">!   nperr</span>
<a name="ln-5041"></a>    <span class="c">! *Inactives**</span>
<a name="ln-5042"></a>    <span class="c">!   wa - window azimuth (degrees, clockwise from south)</span>
<a name="ln-5043"></a>    <span class="c">!   hgas  matrix of gap film coefficients</span>
<a name="ln-5044"></a>    <span class="c">! Locals</span>
<a name="ln-5045"></a>    <span class="c">!   Ebb   Vector</span>
<a name="ln-5046"></a>    <span class="c">!   Ebf   Vector</span>
<a name="ln-5047"></a>    <span class="c">!   Rb    Vector</span>
<a name="ln-5048"></a>    <span class="c">!   Rf    Vector</span>
<a name="ln-5049"></a>    <span class="c">!   a     Array</span>
<a name="ln-5050"></a>    <span class="c">!   b     Array</span>
<a name="ln-5051"></a>    <span class="c">!   hhat  Vector</span>
<a name="ln-5052"></a>    <span class="c">!   err   iteration tolerance</span>
<a name="ln-5053"></a>    <span class="c">!   dtmax     max temp dfference after iteration</span>
<a name="ln-5054"></a>    <span class="c">!   index     iteration step</span>
<a name="ln-5055"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">ThermalMod</span>
<a name="ln-5056"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_mode</span> <span class="c">! Switch for debug output files:</span>
<a name="ln-5057"></a>                                        <span class="c">!    0 - don&#39;t create debug output files</span>
<a name="ln-5058"></a>                                        <span class="c">!    1 - append results to existing debug output file</span>
<a name="ln-5059"></a>                                        <span class="c">!    2 - store results in new debug output file</span>
<a name="ln-5060"></a>                                        <span class="c">!   3 - save in-between results (in all iterations) to existing debug file</span>
<a name="ln-5061"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>
<a name="ln-5062"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-5063"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-5064"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-5065"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dir</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Gin</span>
<a name="ln-5066"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span>
<a name="ln-5067"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">TotalIndex</span>
<a name="ln-5068"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-5069"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span>
<a name="ln-5070"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">tir</span>
<a name="ln-5071"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">asol</span><span class="p">,</span> <span class="n">scon</span>
<a name="ln-5072"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-5073"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-5074"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gama</span>
<a name="ln-5075"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span>
<a name="ln-5076"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span>
<a name="ln-5077"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span>
<a name="ln-5078"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span>
<a name="ln-5079"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPillar</span>
<a name="ln-5080"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span>
<a name="ln-5081"></a>
<a name="ln-5082"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Ebsky</span>
<a name="ln-5083"></a>
<a name="ln-5084"></a>    <span class="c">! real(r64), intent(in) :: sumsol(maxlay)</span>
<a name="ln-5085"></a>    <span class="c">!integer, intent(in) :: nslice(maxlay)</span>
<a name="ln-5086"></a>
<a name="ln-5087"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flux</span>
<a name="ln-5088"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">q</span>
<a name="ln-5089"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span>
<a name="ln-5090"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span>
<a name="ln-5091"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vfreevent</span>
<a name="ln-5092"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcModifiedOut</span><span class="p">,</span> <span class="n">ShadeHcModifiedIn</span>
<a name="ln-5093"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">hcin</span>
<a name="ln-5094"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span>
<a name="ln-5095"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tamb</span><span class="p">,</span> <span class="n">Troom</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcout</span>
<a name="ln-5096"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-5097"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span>
<a name="ln-5098"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Rf</span>
<a name="ln-5099"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AchievedErrorTolerance</span>
<a name="ln-5100"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-5101"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-5102"></a>
<a name="ln-5103"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">width</span><span class="p">,</span> <span class="n">glsyswidth</span>
<a name="ln-5104"></a>    <span class="c">!real(r64) :: Ebbold(maxlay), Ebfold(maxlay), Rbold(maxlay), Rfold(maxlay)</span>
<a name="ln-5105"></a>    <span class="c">!real(r64) :: rs(maxlay3)</span>
<a name="ln-5106"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-5107"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b</span>
<a name="ln-5108"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hgas</span>
<a name="ln-5109"></a>    <span class="c">!real(r64) :: hhatv(maxlay3),hcv(maxlay3), Ebgap(maxlay3), Tgap(maxlay1)</span>
<a name="ln-5110"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap</span>
<a name="ln-5111"></a>
<a name="ln-5112"></a>    <span class="c">!real(r64) ::  alpha</span>
<a name="ln-5113"></a>    <span class="kt">integer</span> <span class="kd">::</span>   <span class="n">maxiter</span>
<a name="ln-5114"></a>
<a name="ln-5115"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">qr_gap_out</span><span class="p">,</span> <span class="n">qr_gap_in</span>
<a name="ln-5116"></a>
<a name="ln-5117"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="kd">::</span> <span class="n">told</span>
<a name="ln-5118"></a>
<a name="ln-5119"></a>    <span class="c">! Simon: parameters used in case of JCFN iteration method</span>
<a name="ln-5120"></a>    <span class="c">!real(r64) :: Dvector(maxlay4) ! store diagonal matrix used in JCFN iterations</span>
<a name="ln-5121"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">FRes</span><span class="p">(:)</span> <span class="c">! store function results from current iteration</span>
<a name="ln-5122"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">FResOld</span><span class="p">(:)</span> <span class="c">! store function results from previous iteration</span>
<a name="ln-5123"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">FResDiff</span><span class="p">(:)</span> <span class="c">! save difference in results between iterations</span>
<a name="ln-5124"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">Radiation</span><span class="p">(:)</span> <span class="c">! radiation on layer surfaces.  used as temporary storage during iterations</span>
<a name="ln-5125"></a>
<a name="ln-5126"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(:)</span> <span class="c">! temporary vector for storing results (theta and Radiation).  used for easier handling</span>
<a name="ln-5127"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">dX</span><span class="p">(:)</span> <span class="c">! difference in results</span>
<a name="ln-5128"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">Jacobian</span><span class="p">(:,:)</span> <span class="c">! diagonal vector for jacobian comuptation-free newton method</span>
<a name="ln-5129"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">DRes</span><span class="p">(:)</span> <span class="c">! used in jacobian forward-difference approximation</span>
<a name="ln-5130"></a>
<a name="ln-5131"></a>    <span class="c">! This is used to store matrix before equation solver.  It is important because solver destroys</span>
<a name="ln-5132"></a>    <span class="c">! content of matrices</span>
<a name="ln-5133"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">LeftHandSide</span><span class="p">(:,:)</span>
<a name="ln-5134"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">RightHandSide</span><span class="p">(:)</span>
<a name="ln-5135"></a>
<a name="ln-5136"></a>    <span class="c">! Simon: Keep best achieved convergence</span>
<a name="ln-5137"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">prevDifference</span><span class="p">,</span> <span class="n">Relaxation</span>
<a name="ln-5138"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">RadiationSave</span><span class="p">(:)</span>
<a name="ln-5139"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">thetaSave</span><span class="p">(:)</span>
<a name="ln-5140"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">currentTry</span>
<a name="ln-5141"></a>
<a name="ln-5142"></a>    <span class="kt">integer</span> <span class="kd">::</span>   <span class="n">LayerTypeSpec</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span>
<a name="ln-5143"></a>    <span class="kt">integer</span> <span class="kd">::</span>   <span class="n">SDLayerIndex</span>
<a name="ln-5144"></a>
<a name="ln-5145"></a>    <span class="kt">integer</span> <span class="kd">::</span>   <span class="n">CSMFlag</span>
<a name="ln-5146"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-5147"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">curDifference</span>
<a name="ln-5148"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nb">index</span>
<a name="ln-5149"></a><span class="nb">    </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">curTempCorrection</span>
<a name="ln-5150"></a>
<a name="ln-5151"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qc_gap_out</span><span class="p">,</span> <span class="n">qcgapout2</span><span class="p">,</span> <span class="n">hc_modified_out</span><span class="p">,</span> <span class="n">qc_gap_in</span><span class="p">,</span> <span class="n">hc_modified_in</span>
<a name="ln-5152"></a>
<a name="ln-5153"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">CalcOutcome</span>
<a name="ln-5154"></a>
<a name="ln-5155"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">iterationsFinished</span> <span class="c">! To mark whether or not iterations are finished</span>
<a name="ln-5156"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">saveIterationResults</span>
<a name="ln-5157"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">updateGapTemperature</span>
<a name="ln-5158"></a>    <span class="c">!logical :: TurnOnNewton</span>
<a name="ln-5159"></a>
<a name="ln-5160"></a>    <span class="n">SDLayerIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-5161"></a>
<a name="ln-5162"></a>    <span class="c">! Allocate arrays</span>
<a name="ln-5163"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">FRes</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">FRes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5164"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">FResOld</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">FResOld</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5165"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">FResDiff</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">FResDiff</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5166"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">Radiation</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">Radiation</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5167"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">RadiationSave</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">RadiationSave</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5168"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">thetaSave</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">thetaSave</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5169"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5170"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">dX</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">dX</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5171"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">Jacobian</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">Jacobian</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5172"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">DRes</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">DRes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5173"></a>
<a name="ln-5174"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">LeftHandSide</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">LeftHandSide</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5175"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">RightHandSide</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">RightHandSide</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-5176"></a>
<a name="ln-5177"></a>    <span class="n">dX</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5178"></a>
<a name="ln-5179"></a>    <span class="c">! Simon: This is set to zero until it is resolved what to do with modifier</span>
<a name="ln-5180"></a>    <span class="n">ShadeHcModifiedOut</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5181"></a>    <span class="c">!BuffIndex = 0</span>
<a name="ln-5182"></a>    <span class="n">CSMFlag</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5183"></a>    <span class="n">CalcOutcome</span> <span class="o">=</span> <span class="n">CALC_UNKNOWN</span>
<a name="ln-5184"></a>    <span class="n">curTempCorrection</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5185"></a>    <span class="n">AchievedErrorTolerance</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5186"></a>    <span class="n">curDifference</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5187"></a>    <span class="c">!TurnOnNewton = .true.</span>
<a name="ln-5188"></a>    <span class="n">currentTry</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5189"></a>    <span class="nb">index</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5190"></a>    <span class="n">TotalIndex</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5191"></a>    <span class="n">iterationsFinished</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5192"></a>    <span class="n">qv</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-5193"></a>    <span class="n">Ebb</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5194"></a>    <span class="n">Ebf</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5195"></a>    <span class="n">Rb</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5196"></a>    <span class="n">Rf</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5197"></a>    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5198"></a>    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5199"></a>
<a name="ln-5200"></a>    <span class="c">!Dvector = 0.0</span>
<a name="ln-5201"></a>    <span class="n">FRes</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5202"></a>    <span class="n">FResOld</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5203"></a>    <span class="n">FResDiff</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5204"></a>    <span class="n">Radiation</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5205"></a>    <span class="n">Relaxation</span> <span class="o">=</span> <span class="n">RelaxationStart</span>
<a name="ln-5206"></a>    <span class="c">!alpha = PicardRelaxation</span>
<a name="ln-5207"></a>
<a name="ln-5208"></a>    <span class="n">maxiter</span> <span class="o">=</span> <span class="n">NumOfIterations</span>
<a name="ln-5209"></a>
<a name="ln-5210"></a>    <span class="c">!call MarkVentilatedGaps(nlayer, isVentilated, LayerType, vvent)</span>
<a name="ln-5211"></a>
<a name="ln-5212"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">Debug_mode</span> <span class="o">==</span> <span class="n">saveIntermediateResults</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5213"></a><span class="k">      </span><span class="n">saveIterationResults</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5214"></a>    <span class="k">else</span>
<a name="ln-5215"></a><span class="k">      </span><span class="n">saveIterationResults</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5216"></a>    <span class="k">end if</span>
<a name="ln-5217"></a>
<a name="ln-5218"></a>    <span class="c">!call guess(tout, tind, nlayer, gap, thick, glsyswidth, theta, Ebb, Ebf, Tgap)</span>
<a name="ln-5219"></a>
<a name="ln-5220"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5221"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-5222"></a>      <span class="n">Radiation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5223"></a>      <span class="n">Radiation</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5224"></a>      <span class="n">told</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5225"></a>      <span class="n">told</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5226"></a>      <span class="c">!told(k-1) = theta(k-1)</span>
<a name="ln-5227"></a>      <span class="c">!told(k) = theta(k)</span>
<a name="ln-5228"></a>    <span class="k">end do</span>
<a name="ln-5229"></a>
<a name="ln-5230"></a>    <span class="c">!bi...Set LayerTypeSpec array - need to treat venetians AND woven shades as glass:</span>
<a name="ln-5231"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ThermalMod</span> <span class="o">==</span> <span class="n">THERM_MOD_CSM</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5232"></a><span class="k">      do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5233"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-5234"></a><span class="k">          </span><span class="n">LayerTypeSpec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5235"></a>          <span class="n">SDLayerIndex</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-5236"></a>        <span class="k">else</span>
<a name="ln-5237"></a><span class="k">          </span><span class="n">LayerTypeSpec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5238"></a>        <span class="k">end if</span>
<a name="ln-5239"></a><span class="k">      end do</span>
<a name="ln-5240"></a><span class="k">    end if</span>
<a name="ln-5241"></a>
<a name="ln-5242"></a>    <span class="c">!first store results before iterations begin</span>
<a name="ln-5243"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">saveIterationResults</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5244"></a><span class="k">      call </span><span class="n">storeIterationResults</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="nb">index</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Tamb</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Troom</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5245"></a>            <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">nperr</span><span class="p">)</span>
<a name="ln-5246"></a>    <span class="k">end if</span>
<a name="ln-5247"></a>
<a name="ln-5248"></a><span class="k">    </span><span class="n">Tgap</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tout</span>
<a name="ln-5249"></a>    <span class="n">Tgap</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tind</span>
<a name="ln-5250"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5251"></a>      <span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-5252"></a>    <span class="k">end do</span>
<a name="ln-5253"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-5254"></a>    <span class="c">!!!! MAIN ITERATION LOOP</span>
<a name="ln-5255"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-5256"></a>    <span class="k">do while</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">iterationsFinished</span><span class="p">))</span>
<a name="ln-5257"></a>
<a name="ln-5258"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-5259"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5260"></a><span class="k">          </span><span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">*</span> <span class="n">i</span>
<a name="ln-5261"></a>        <span class="k">end if</span>
<a name="ln-5262"></a><span class="k">      end do</span>
<a name="ln-5263"></a>
<a name="ln-5264"></a>      <span class="c">!do i=1,nlayer+1</span>
<a name="ln-5265"></a>      <span class="c">!  if (i == 1) then</span>
<a name="ln-5266"></a>      <span class="c">!    Tgap(i) = tout</span>
<a name="ln-5267"></a>      <span class="c">!  else if (i == nlayer+1) then</span>
<a name="ln-5268"></a>      <span class="c">!    Tgap(i) = tind</span>
<a name="ln-5269"></a>      <span class="c">!  else</span>
<a name="ln-5270"></a>      <span class="c">!    Tgap(i) = (theta(2*i-2) + theta(2*i-1)) / 2.0d0</span>
<a name="ln-5271"></a>      <span class="c">!  end if</span>
<a name="ln-5272"></a>      <span class="c">!end do</span>
<a name="ln-5273"></a>
<a name="ln-5274"></a>      <span class="c">! skip updating gap temperatures for shading devices. Gap temperature in that case is not simply average</span>
<a name="ln-5275"></a>      <span class="c">! between two layer temperatures</span>
<a name="ln-5276"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5277"></a>        <span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5278"></a>        <span class="k">if</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)))).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))))</span> <span class="k">then</span>
<a name="ln-5279"></a><span class="k">          </span><span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5280"></a>        <span class="k">end if</span>
<a name="ln-5281"></a><span class="k">        if</span> <span class="p">(</span><span class="n">updateGapTemperature</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5282"></a><span class="k">          </span><span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-5283"></a>        <span class="k">end if</span>
<a name="ln-5284"></a><span class="k">      end do</span>
<a name="ln-5285"></a>
<a name="ln-5286"></a>      <span class="c">! evaluate convective/conductive components of gap</span>
<a name="ln-5287"></a>      <span class="k">call </span><span class="n">hatter</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Tamb</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Troom</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5288"></a>                    <span class="n">gap</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">Radiation</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5289"></a>                    <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5290"></a>                    <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5291"></a>                    <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5292"></a>                    <span class="nb">index</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">)</span>
<a name="ln-5293"></a>
<a name="ln-5294"></a>      <span class="c">! exit on error</span>
<a name="ln-5295"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">return</span>
<a name="ln-5296"></a>
<a name="ln-5297"></a>      <span class="c">!bi...Override hhat values near SHADING DEVICE layer(s), but only for CSM thermal model:</span>
<a name="ln-5298"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">ThermalMod</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">THERM_MOD_CSM</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">SDLayerIndex</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5299"></a>        <span class="c">! adjust hhat values</span>
<a name="ln-5300"></a>        <span class="c">!call adjusthhat(SDLayerIndex, ibc, tout, tind, nlayer, theta, wso, wsi, iwd, height, heightt, tilt,  &amp;</span>
<a name="ln-5301"></a>        <span class="c">!               &amp;  thick, gap, hout, hrout, hin, hrin, iprop, frct, presure, nmix, wght, gcon, gvis, gcp, &amp;</span>
<a name="ln-5302"></a>        <span class="c">!               index, SDScalar, Ebf, Ebb, hgas, hhat, nperr, ErrorMessage)</span>
<a name="ln-5303"></a>        <span class="c">!do i = 1, maxlay3</span>
<a name="ln-5304"></a>          <span class="c">!hhatv(i) = 0.0</span>
<a name="ln-5305"></a>          <span class="c">!Ebgap(i) = 0.0</span>
<a name="ln-5306"></a>          <span class="c">!qv(i)    = 0.0</span>
<a name="ln-5307"></a>          <span class="c">!hcv(i)   = 0.0</span>
<a name="ln-5308"></a>        <span class="c">!end do</span>
<a name="ln-5309"></a>        <span class="k">call </span><span class="n">matrixQBalance</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5310"></a>            <span class="n">Tind</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">)</span>
<a name="ln-5311"></a>      <span class="k">else</span>
<a name="ln-5312"></a>        <span class="c">!bi...There are no Venetian layers, or ThermalMod is not CSM, so carry on as usual:</span>
<a name="ln-5313"></a>        <span class="k">call </span><span class="n">shading</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5314"></a>          <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5315"></a>          <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">)</span>
<a name="ln-5316"></a>
<a name="ln-5317"></a>        <span class="c">! exit on error</span>
<a name="ln-5318"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">return</span>
<a name="ln-5319"></a>
<a name="ln-5320"></a><span class="k">        call </span><span class="n">matrixQBalance</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5321"></a>            <span class="n">Tind</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Gin</span><span class="p">,</span> <span class="n">Gout</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">tir</span><span class="p">,</span> <span class="n">rir</span><span class="p">,</span> <span class="n">emis</span><span class="p">)</span>
<a name="ln-5322"></a>
<a name="ln-5323"></a>      <span class="k">end if</span> <span class="c">!  end if</span>
<a name="ln-5324"></a>
<a name="ln-5325"></a>      <span class="n">FResOld</span> <span class="o">=</span> <span class="n">FRes</span>
<a name="ln-5326"></a>
<a name="ln-5327"></a>      <span class="c">! Pack results in one array</span>
<a name="ln-5328"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5329"></a>        <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span>
<a name="ln-5330"></a>        <span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-5331"></a>
<a name="ln-5332"></a>        <span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-5333"></a>        <span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5334"></a>        <span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-5335"></a>        <span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5336"></a>      <span class="k">end do</span>
<a name="ln-5337"></a>
<a name="ln-5338"></a><span class="k">      call </span><span class="n">CalculateFuncResults</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">FRes</span><span class="p">)</span>
<a name="ln-5339"></a>
<a name="ln-5340"></a>      <span class="n">FResDiff</span> <span class="o">=</span> <span class="n">FRes</span> <span class="o">-</span> <span class="n">FResOld</span>
<a name="ln-5341"></a>
<a name="ln-5342"></a>      <span class="c">!if (TurnOnNewton) then</span>
<a name="ln-5343"></a>      <span class="c">!  do i = 1, 4*nlayer</span>
<a name="ln-5344"></a>      <span class="c">!    temp = x(i)</span>
<a name="ln-5345"></a>      <span class="c">!    h = ConvergenceTolerance * abs(x(i))</span>
<a name="ln-5346"></a>      <span class="c">!    if (h == 0) then</span>
<a name="ln-5347"></a>      <span class="c">!      h = ConvergenceTolerance</span>
<a name="ln-5348"></a>      <span class="c">!    end if</span>
<a name="ln-5349"></a>      <span class="c">!    x(i) = temp + h</span>
<a name="ln-5350"></a>      <span class="c">!    h = x(i) - temp ! trick to reduce finite precision error</span>
<a name="ln-5351"></a>      <span class="c">!    call CalculateFuncResults(nlayer, a, b, x, DRes, nperr, ErrorMessage)</span>
<a name="ln-5352"></a>      <span class="c">!    do j = 1, 4*nlayer</span>
<a name="ln-5353"></a>      <span class="c">!      Jacobian(j,i) = (DRes(j) - FRes(j)) / h</span>
<a name="ln-5354"></a>      <span class="c">!    end do</span>
<a name="ln-5355"></a>      <span class="c">!    x(i) = temp</span>
<a name="ln-5356"></a>      <span class="c">!  end do</span>
<a name="ln-5357"></a>      <span class="c">!end if</span>
<a name="ln-5358"></a>
<a name="ln-5359"></a>      <span class="c">!if (TurnOnNewton) then</span>
<a name="ln-5360"></a>      <span class="c">!  LeftHandSide = Jacobian</span>
<a name="ln-5361"></a>      <span class="c">!  RightHandSide = -FRes</span>
<a name="ln-5362"></a>      <span class="c">!else</span>
<a name="ln-5363"></a>        <span class="n">LeftHandSide</span> <span class="o">=</span> <span class="n">a</span>
<a name="ln-5364"></a>        <span class="n">RightHandSide</span> <span class="o">=</span> <span class="n">b</span>
<a name="ln-5365"></a>      <span class="c">!end if</span>
<a name="ln-5366"></a>      <span class="k">call </span><span class="n">EquationsSolver</span><span class="p">(</span><span class="n">LeftHandSide</span><span class="p">,</span> <span class="n">RightHandSide</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-5367"></a>
<a name="ln-5368"></a>      <span class="c">!if (TurnOnNewton) then</span>
<a name="ln-5369"></a>      <span class="c">!  dx = RightHandSide</span>
<a name="ln-5370"></a>      <span class="c">!end if</span>
<a name="ln-5371"></a>
<a name="ln-5372"></a>      <span class="c">! Simon: This is much better, but also much slower convergence criteria.  Think of how to make this flexible and allow</span>
<a name="ln-5373"></a>      <span class="c">! user to change this from outside (through argument passing)</span>
<a name="ln-5374"></a>      <span class="c">!curDifference = abs(FRes(1))</span>
<a name="ln-5375"></a>      <span class="c">!do i = 2, 4*nlayer</span>
<a name="ln-5376"></a>        <span class="c">!curDifference = max(curDifference, abs(FRes(i)))</span>
<a name="ln-5377"></a>        <span class="c">!curDifference = curDifference + abs(FRes(i))</span>
<a name="ln-5378"></a>      <span class="c">!end do</span>
<a name="ln-5379"></a>
<a name="ln-5380"></a>      <span class="n">curDifference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">told</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-5381"></a>      <span class="c">!curDifference = abs(FRes(1))</span>
<a name="ln-5382"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-5383"></a>      <span class="c">!do i = 2, 4*nlayer</span>
<a name="ln-5384"></a>        <span class="n">curDifference</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">curDifference</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">told</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-5385"></a>        <span class="c">!curDifference = MAX(abs(FRes(i)), curDifference)</span>
<a name="ln-5386"></a>      <span class="k">end do</span>
<a name="ln-5387"></a>
<a name="ln-5388"></a><span class="k">      do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5389"></a>        <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span>
<a name="ln-5390"></a>        <span class="n">j</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-5391"></a>        <span class="c">!if (TurnOnNewton) then</span>
<a name="ln-5392"></a>        <span class="c">!  theta(j) = theta(j) + Relaxation*dx(k)</span>
<a name="ln-5393"></a>        <span class="c">!  theta(j+1) = theta(j+1) + Relaxation*dx(k+1)</span>
<a name="ln-5394"></a>        <span class="c">!  Radiation(j) = Radiation(j) + Relaxation*dx(k+2)</span>
<a name="ln-5395"></a>        <span class="c">!  Radiation(j+1) = Radiation(j+1) + Relaxation*dx(k+3)</span>
<a name="ln-5396"></a>        <span class="c">!else</span>
<a name="ln-5397"></a>        <span class="c">!  dX(k) = RightHandSide(k) - theta(j)</span>
<a name="ln-5398"></a>        <span class="c">!  dX(k+1) = RightHandSide(k + 1) - theta(j+1)</span>
<a name="ln-5399"></a>        <span class="c">!  dX(k+2) = RightHandSide(k + 2) - Radiation(j)</span>
<a name="ln-5400"></a>        <span class="c">!  dX(k+3) = RightHandSide(k + 3) - Radiation(j+1)</span>
<a name="ln-5401"></a>        <span class="n">told</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-5402"></a>        <span class="n">told</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5403"></a>        <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Relaxation</span><span class="p">)</span> <span class="o">*</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">Relaxation</span> <span class="o">*</span> <span class="n">RightHandSide</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-5404"></a>        <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Relaxation</span><span class="p">)</span> <span class="o">*</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Relaxation</span> <span class="o">*</span> <span class="n">RightHandSide</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5405"></a>        <span class="n">Radiation</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Relaxation</span><span class="p">)</span> <span class="o">*</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">Relaxation</span> <span class="o">*</span> <span class="n">RightHandSide</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-5406"></a>        <span class="n">Radiation</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Relaxation</span><span class="p">)</span> <span class="o">*</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Relaxation</span> <span class="o">*</span> <span class="n">RightHandSide</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-5407"></a>        <span class="c">!end if</span>
<a name="ln-5408"></a>      <span class="k">end do</span>
<a name="ln-5409"></a>
<a name="ln-5410"></a>      <span class="c">! it is important not to update gaps around shading layers since that is already calculated by</span>
<a name="ln-5411"></a>      <span class="c">! shading routines</span>
<a name="ln-5412"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-5413"></a>        <span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5414"></a>        <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5415"></a>          <span class="c">! update gap array with interior and exterior temperature</span>
<a name="ln-5416"></a>          <span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5417"></a>        <span class="k">else</span>
<a name="ln-5418"></a>          <span class="c">! update gap temperature only if gap on both sides</span>
<a name="ln-5419"></a>          <span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5420"></a>          <span class="k">if</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)))).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))))</span> <span class="k">then</span>
<a name="ln-5421"></a><span class="k">            </span><span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5422"></a>          <span class="k">end if</span>
<a name="ln-5423"></a><span class="k">        end if</span>
<a name="ln-5424"></a><span class="k">        </span><span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5425"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">updateGapTemperature</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5426"></a><span class="k">          if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5427"></a><span class="k">            </span><span class="n">Tgap</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tout</span>
<a name="ln-5428"></a>          <span class="k">else if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5429"></a><span class="k">            </span><span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">tind</span>
<a name="ln-5430"></a>          <span class="k">else</span>
<a name="ln-5431"></a><span class="k">            </span><span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-5432"></a>          <span class="k">end if</span>
<a name="ln-5433"></a><span class="k">        end if</span>
<a name="ln-5434"></a><span class="k">      end do</span>
<a name="ln-5435"></a>
<a name="ln-5436"></a>      <span class="c">!and store results during iterations</span>
<a name="ln-5437"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">saveIterationResults</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5438"></a><span class="k">        call </span><span class="n">storeIterationResults</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="nb">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Tamb</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Troom</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5439"></a>          <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">nperr</span><span class="p">)</span>
<a name="ln-5440"></a>      <span class="k">end if</span>
<a name="ln-5441"></a>
<a name="ln-5442"></a><span class="k">      if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">return</span>
<a name="ln-5443"></a>
<a name="ln-5444"></a><span class="k">      </span><span class="n">prevDifference</span> <span class="o">=</span> <span class="n">curDifference</span>
<a name="ln-5445"></a>
<a name="ln-5446"></a>      <span class="k">if</span> <span class="p">((</span><span class="nb">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">curDifference</span> <span class="o">&lt;</span> <span class="n">AchievedErrorTolerance</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5447"></a><span class="k">        </span><span class="n">AchievedErrorTolerance</span> <span class="o">=</span> <span class="n">curDifference</span>
<a name="ln-5448"></a>        <span class="n">currentTry</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5449"></a>        <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-5450"></a>          <span class="n">RadiationSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5451"></a>          <span class="n">thetaSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5452"></a>        <span class="k">end do</span>
<a name="ln-5453"></a><span class="k">      else</span>
<a name="ln-5454"></a>        <span class="c">! This is case when program solution diverged</span>
<a name="ln-5455"></a>        <span class="n">currentTry</span> <span class="o">=</span> <span class="n">currentTry</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-5456"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">currentTry</span> <span class="o">&gt;=</span> <span class="n">NumOfTries</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5457"></a><span class="k">          </span><span class="n">currentTry</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5458"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-5459"></a>            <span class="n">Radiation</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">RadiationSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5460"></a>            <span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">thetaSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5461"></a>          <span class="k">end do</span>
<a name="ln-5462"></a>          <span class="c">!if (.not.TurnOnNewton) then</span>
<a name="ln-5463"></a>          <span class="c">!  TurnOnNewton = .true.</span>
<a name="ln-5464"></a>          <span class="c">!else</span>
<a name="ln-5465"></a>            <span class="n">Relaxation</span> <span class="o">=</span> <span class="n">Relaxation</span> <span class="o">-</span> <span class="n">RelaxationDecrease</span>
<a name="ln-5466"></a>            <span class="n">TotalIndex</span> <span class="o">=</span> <span class="n">TotalIndex</span> <span class="o">+</span> <span class="nb">index</span>
<a name="ln-5467"></a><span class="nb">            index</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5468"></a>            <span class="c">! Start from best achieved convergence</span>
<a name="ln-5469"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">Relaxation</span> <span class="o">&lt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! cannot continue with relaxation equal to zero</span>
<a name="ln-5470"></a>              <span class="n">iterationsFinished</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5471"></a>            <span class="k">end if</span>
<a name="ln-5472"></a>           <span class="c">! TurnOnNewton = .true.</span>
<a name="ln-5473"></a>          <span class="c">!end if ! if (.not.TurnOnNewton) then</span>
<a name="ln-5474"></a>        <span class="k">end if</span> <span class="c">! f (currentTry == NumOfTries) then</span>
<a name="ln-5475"></a>      <span class="k">end if</span>
<a name="ln-5476"></a>
<a name="ln-5477"></a>      <span class="c">! Chek if results were found:</span>
<a name="ln-5478"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">curDifference</span> <span class="o">&lt;</span> <span class="n">ConvergenceTolerance</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5479"></a><span class="k">        </span><span class="n">CalcOutcome</span> <span class="o">=</span> <span class="n">CALC_OK</span>
<a name="ln-5480"></a>        <span class="n">TotalIndex</span> <span class="o">=</span> <span class="n">TotalIndex</span> <span class="o">+</span> <span class="nb">index</span>
<a name="ln-5481"></a><span class="nb">        </span><span class="n">iterationsFinished</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5482"></a>      <span class="k">end if</span>
<a name="ln-5483"></a>
<a name="ln-5484"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">index</span> <span class="o">&gt;=</span> <span class="n">maxiter</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5485"></a><span class="k">        </span><span class="n">Relaxation</span> <span class="o">=</span> <span class="n">Relaxation</span> <span class="o">-</span> <span class="n">RelaxationDecrease</span>
<a name="ln-5486"></a>        <span class="n">TotalIndex</span> <span class="o">=</span> <span class="n">TotalIndex</span> <span class="o">+</span> <span class="nb">index</span>
<a name="ln-5487"></a><span class="nb">        index</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5488"></a>        <span class="c">!TurnOnNewton = .true.</span>
<a name="ln-5489"></a>
<a name="ln-5490"></a>        <span class="c">! Start from best achieved convergence</span>
<a name="ln-5491"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-5492"></a>          <span class="n">Radiation</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">RadiationSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5493"></a>          <span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">thetaSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5494"></a>        <span class="k">end do</span>
<a name="ln-5495"></a><span class="k">        if</span> <span class="p">(</span><span class="n">Relaxation</span> <span class="o">&lt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! cannot continue with relaxation equal to zero</span>
<a name="ln-5496"></a>          <span class="n">iterationsFinished</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5497"></a>        <span class="k">end if</span>
<a name="ln-5498"></a><span class="k">      end if</span>
<a name="ln-5499"></a>
<a name="ln-5500"></a><span class="k">      </span><span class="nb">index</span> <span class="o">=</span> <span class="nb">index</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-5501"></a>    <span class="k">end do</span>
<a name="ln-5502"></a>
<a name="ln-5503"></a>    <span class="c">! Get results from closest iteration and store it</span>
<a name="ln-5504"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">CalcOutcome</span> <span class="o">==</span> <span class="n">CALC_OK</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5505"></a><span class="k">      do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-5506"></a>        <span class="n">Radiation</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">RadiationSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5507"></a>        <span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">thetaSave</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5508"></a>      <span class="k">end do</span>
<a name="ln-5509"></a>
<a name="ln-5510"></a><span class="k">      do </span><span class="n">i</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5511"></a>        <span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5512"></a>        <span class="k">if</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)))).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">i</span><span class="p">)))))</span> <span class="k">then</span>
<a name="ln-5513"></a><span class="k">          </span><span class="n">updateGapTemperature</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5514"></a>        <span class="k">end if</span>
<a name="ln-5515"></a>
<a name="ln-5516"></a><span class="k">        if</span> <span class="p">(</span><span class="n">updateGapTemperature</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5517"></a><span class="k">          </span><span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-5518"></a>        <span class="k">end if</span>
<a name="ln-5519"></a><span class="k">      end do</span>
<a name="ln-5520"></a>
<a name="ln-5521"></a>      <span class="c">! Simon: It is important to recalculate coefficients from most accurate run</span>
<a name="ln-5522"></a>      <span class="k">call </span><span class="n">hatter</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Tamb</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">Troom</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5523"></a>                    <span class="n">gap</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">Radiation</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5524"></a>                    <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5525"></a>                    <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5526"></a>                    <span class="nb">index</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">)</span>
<a name="ln-5527"></a>
<a name="ln-5528"></a>      <span class="k">call </span><span class="n">shading</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5529"></a>        <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span> <span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5530"></a>        <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">vfreevent</span><span class="p">)</span>
<a name="ln-5531"></a>    <span class="k">end if</span>
<a name="ln-5532"></a>
<a name="ln-5533"></a><span class="k">    if</span> <span class="p">(</span><span class="n">CalcOutcome</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">CALC_UNKNOWN</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5534"></a><span class="k">        </span><span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Tarcog failed to converge&#39;</span>
<a name="ln-5535"></a>        <span class="n">nperr</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c">! error 2: failed to converge...</span>
<a name="ln-5536"></a>    <span class="k">end if</span>
<a name="ln-5537"></a>
<a name="ln-5538"></a>    <span class="c">! Get radiation results first</span>
<a name="ln-5539"></a>    <span class="c">!if (curEquationsApproach.eq.eaQBalance) then</span>
<a name="ln-5540"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5541"></a>      <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-5542"></a>      <span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-5543"></a>      <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5544"></a>      <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">StefanBoltzmann</span><span class="o">*</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-5545"></a>      <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">StefanBoltzmann</span><span class="o">*</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-5546"></a>    <span class="k">end do</span>
<a name="ln-5547"></a>    <span class="c">!end if</span>
<a name="ln-5548"></a>
<a name="ln-5549"></a>    <span class="c">! Finishing calcs:</span>
<a name="ln-5550"></a>    <span class="k">call </span><span class="n">resist</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">Theta</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5551"></a>             <span class="p">&amp;</span>   <span class="n">qv</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5552"></a>             <span class="p">&amp;</span>   <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">)</span>
<a name="ln-5553"></a>
<a name="ln-5554"></a>    <span class="c">!bi...  Set T6-related quantities - ratios for modified epsilon, hc for modelling external SDs:</span>
<a name="ln-5555"></a>    <span class="c">!    (using non-solar pass results)</span>
<a name="ln-5556"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">dir</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nlayer</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5557"></a>
<a name="ln-5558"></a><span class="k">      </span><span class="n">qr_gap_out</span> <span class="o">=</span> <span class="n">Rf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="o">-</span> <span class="n">Rb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5559"></a>      <span class="n">qr_gap_in</span>  <span class="o">=</span> <span class="n">Rf</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">-</span> <span class="n">Rb</span><span class="p">(</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5560"></a>
<a name="ln-5561"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-5562"></a><span class="k">        </span><span class="n">ShadeEmisRatioOut</span> <span class="o">=</span> <span class="n">qr_gap_out</span> <span class="o">/</span> <span class="p">(</span> <span class="n">emis</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">Trmout</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-5563"></a>        <span class="c">!qc_gap_out = qprim(3) - qr_gap_out</span>
<a name="ln-5564"></a>        <span class="c">!qcgapout2 = qcgas(1)</span>
<a name="ln-5565"></a>        <span class="c">!Hc_modified_out = (qc_gap_out / (theta(3) - tout))</span>
<a name="ln-5566"></a>        <span class="c">!ShadeHcModifiedOut = Hc_modified_out</span>
<a name="ln-5567"></a>      <span class="k">end if</span>
<a name="ln-5568"></a>
<a name="ln-5569"></a><span class="k">      if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-5570"></a><span class="k">        </span><span class="n">ShadeEmisRatioIn</span>  <span class="o">=</span> <span class="n">qr_gap_in</span> <span class="o">/</span> <span class="p">(</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="p">(</span><span class="n">Trmin</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-5571"></a>        <span class="n">qc_gap_in</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">qr_gap_in</span>
<a name="ln-5572"></a>        <span class="n">Hc_modified_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">qc_gap_in</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tind</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">2</span><span class="p">)))</span>
<a name="ln-5573"></a>        <span class="n">ShadeHcModifiedIn</span> <span class="o">=</span> <span class="n">Hc_modified_in</span>
<a name="ln-5574"></a>      <span class="k">end if</span>
<a name="ln-5575"></a><span class="k">    end if</span> <span class="c">! IF dir = 0</span>
<a name="ln-5576"></a>
<a name="ln-5577"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">FRes</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">FRes</span><span class="p">)</span>
<a name="ln-5578"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">FResOld</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">FResOld</span><span class="p">)</span>
<a name="ln-5579"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">FResDiff</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">FResDiff</span><span class="p">)</span>
<a name="ln-5580"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">Radiation</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">Radiation</span><span class="p">)</span>
<a name="ln-5581"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">RadiationSave</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">RadiationSave</span><span class="p">)</span>
<a name="ln-5582"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">thetaSave</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">thetaSave</span><span class="p">)</span>
<a name="ln-5583"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<a name="ln-5584"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">dX</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">dX</span><span class="p">)</span>
<a name="ln-5585"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">Jacobian</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">Jacobian</span><span class="p">)</span>
<a name="ln-5586"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">DRes</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">DRes</span><span class="p">)</span>
<a name="ln-5587"></a>
<a name="ln-5588"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">LeftHandSide</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">LeftHandSide</span><span class="p">)</span>
<a name="ln-5589"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">RightHandSide</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">RightHandSide</span><span class="p">)</span>
<a name="ln-5590"></a>
<a name="ln-5591"></a>    <span class="c">!do i=1, nlayer-1</span>
<a name="ln-5592"></a>    <span class="c">!  if (((LayerType(i).eq.VENETBLIND)  &amp;</span>
<a name="ln-5593"></a>    <span class="c">!      &amp;  .and.(ThermalMod.ne.THERM_MOD_CSM))  &amp;</span>
<a name="ln-5594"></a>    <span class="c">!      &amp;  .or.(LayerType(i).eq.WOVSHADE)) then</span>
<a name="ln-5595"></a>    <span class="c">!    !hcgas(i+1)=hcv(2*i+1)</span>
<a name="ln-5596"></a>    <span class="c">!  else</span>
<a name="ln-5597"></a>    <span class="c">!    !hcgas(i+1)=hgas(i+1)</span>
<a name="ln-5598"></a>    <span class="c">!  end if</span>
<a name="ln-5599"></a>    <span class="c">!end do</span>
<a name="ln-5600"></a>
<a name="ln-5601"></a>    <span class="mi">1111</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Outdoor: &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39; ;  alt2: &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; ; alt3: &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; ; alt4: &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-5602"></a>    <span class="mi">1112</span>  <span class="k">format</span><span class="p">(</span><span class="s1">&#39;Indoor:  &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39; ;  alt2: &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; ; alt3: &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39; ; alt4: &#39;</span><span class="p">,</span> <span class="n">F9</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-5603"></a>
<a name="ln-5604"></a>    <span class="c">!110   format(&#39; Theta(&#39;,I1,&#39;) = &#39;,F12.6)</span>
<a name="ln-5605"></a>    <span class="c">!111   format(&#39; T(&#39;,I1,&#39;)=&#39;,F15.9)</span>
<a name="ln-5606"></a>    <span class="c">!112  format(&#39; &#39;,A3,&#39; =&#39;,F15.9)</span>
<a name="ln-5607"></a>
<a name="ln-5608"></a>  <span class="k">end subroutine </span><span class="n">therm1d</span>
<a name="ln-5609"></a>
<a name="ln-5610"></a>  <span class="k">subroutine </span><span class="n">guess</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">)</span>
<a name="ln-5611"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5612"></a>    <span class="c">! purpose - initializes temperature distribution assuming</span>
<a name="ln-5613"></a>    <span class="c">!   a constant temperature gradient across the window</span>
<a name="ln-5614"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5615"></a>    <span class="c">! Input</span>
<a name="ln-5616"></a>    <span class="c">!   tout    outdoor air temperature (k)</span>
<a name="ln-5617"></a>    <span class="c">!   tind     indoor air temperature (k)</span>
<a name="ln-5618"></a>    <span class="c">!   nlayer  number of solid layers in window output</span>
<a name="ln-5619"></a>    <span class="c">!   gap     thickness of gas gaps (m)</span>
<a name="ln-5620"></a>    <span class="c">!   thick   thickness of glazing layers (m)</span>
<a name="ln-5621"></a>    <span class="c">! Output</span>
<a name="ln-5622"></a>    <span class="c">!   width   total width of the glazing system</span>
<a name="ln-5623"></a>    <span class="c">!   theta   array of surface temps starting from outdoor layer (k)</span>
<a name="ln-5624"></a>    <span class="c">!   Ebb     vector of emissive power (?) of the back surface (# of layers)</span>
<a name="ln-5625"></a>    <span class="c">!   Ebf     vector of emissive power (?) of the front surface (# of layers)</span>
<a name="ln-5626"></a>    <span class="c">! Locals</span>
<a name="ln-5627"></a>    <span class="c">!   x   Vector of running width</span>
<a name="ln-5628"></a>    <span class="c">!   delta   delta T per unit length</span>
<a name="ln-5629"></a>
<a name="ln-5630"></a>
<a name="ln-5631"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-5632"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span>
<a name="ln-5633"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-5634"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span>
<a name="ln-5635"></a>
<a name="ln-5636"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">width</span>
<a name="ln-5637"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span>
<a name="ln-5638"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap</span>
<a name="ln-5639"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-5640"></a>
<a name="ln-5641"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-5642"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-5643"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-5644"></a>
<a name="ln-5645"></a>    <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.001d0</span>
<a name="ln-5646"></a>    <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">thick</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5647"></a>
<a name="ln-5648"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5649"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-5650"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-5651"></a>      <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5652"></a>      <span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5653"></a>    <span class="k">end do</span>
<a name="ln-5654"></a>
<a name="ln-5655"></a><span class="k">    </span><span class="n">width</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">nlayer</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.01d0</span>
<a name="ln-5656"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="n">width</span>
<a name="ln-5657"></a>
<a name="ln-5658"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">delta</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5659"></a><span class="k">      </span><span class="n">delta</span> <span class="o">=</span> <span class="n">TemperatureQuessDiff</span><span class="o">/</span><span class="n">width</span>
<a name="ln-5660"></a>    <span class="k">end if</span>
<a name="ln-5661"></a>
<a name="ln-5662"></a><span class="k">    do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5663"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-5664"></a>      <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tout</span> <span class="o">+</span> <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span>
<a name="ln-5665"></a>      <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">tout</span> <span class="o">+</span> <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span>
<a name="ln-5666"></a>      <span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-5667"></a>      <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">StefanBoltzmann</span> <span class="o">*</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-5668"></a>    <span class="k">end do</span>
<a name="ln-5669"></a>
<a name="ln-5670"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-5671"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5672"></a><span class="k">        </span><span class="n">Tgap</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tout</span>
<a name="ln-5673"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5674"></a><span class="k">        </span><span class="n">Tgap</span><span class="p">(</span><span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tind</span>
<a name="ln-5675"></a>      <span class="k">else</span>
<a name="ln-5676"></a><span class="k">        </span><span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-5677"></a>      <span class="k">end if</span>
<a name="ln-5678"></a><span class="k">    end do</span>
<a name="ln-5679"></a>
<a name="ln-5680"></a><span class="k">  end subroutine </span><span class="n">guess</span>
<a name="ln-5681"></a>
<a name="ln-5682"></a>  <span class="k">subroutine </span><span class="n">TemperaturesFromEnergy</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-5683"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5684"></a>    <span class="c">! this subroutine computes the new temperature distribution</span>
<a name="ln-5685"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5686"></a>
<a name="ln-5687"></a>
<a name="ln-5688"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-5689"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span>
<a name="ln-5690"></a>
<a name="ln-5691"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-5692"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap</span>
<a name="ln-5693"></a>
<a name="ln-5694"></a>    <span class="c">!real(r64), intent(out) :: dtmax</span>
<a name="ln-5695"></a>    <span class="c">!integer, intent(out) :: MaxIndex</span>
<a name="ln-5696"></a>
<a name="ln-5697"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-5698"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-5699"></a>
<a name="ln-5700"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">told</span>
<a name="ln-5701"></a>    <span class="kt">integer</span> <span class="kd">::</span>   <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-5702"></a>
<a name="ln-5703"></a>
<a name="ln-5704"></a>    <span class="c">!dtmax = 0.0</span>
<a name="ln-5705"></a>    <span class="c">!MaxIndex = 0</span>
<a name="ln-5706"></a>
<a name="ln-5707"></a>    <span class="c">! first check for energy values. They cannot be negative because power to 0.25</span>
<a name="ln-5708"></a>    <span class="c">! will crash application</span>
<a name="ln-5709"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5710"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5711"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">!this is flag for convergence error</span>
<a name="ln-5712"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Tarcog failed to converge.&#39;</span>
<a name="ln-5713"></a>        <span class="k">return</span> <span class="c">! stop execution</span>
<a name="ln-5714"></a>      <span class="k">end if</span>
<a name="ln-5715"></a><span class="k">    end do</span>
<a name="ln-5716"></a>
<a name="ln-5717"></a><span class="k">    do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5718"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-5719"></a>      <span class="n">told</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>    <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-5720"></a>      <span class="n">told</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5721"></a>      <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">StefanBoltzmann</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25d0</span>
<a name="ln-5722"></a>      <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">StefanBoltzmann</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25d0</span>
<a name="ln-5723"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5724"></a><span class="k">        </span><span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
<a name="ln-5725"></a>      <span class="k">end if</span>
<a name="ln-5726"></a><span class="k">    end do</span>
<a name="ln-5727"></a>
<a name="ln-5728"></a><span class="k">  end subroutine </span><span class="n">TemperaturesFromEnergy</span>
<a name="ln-5729"></a>
<a name="ln-5730"></a>  <span class="k">subroutine </span><span class="n">solarISO15099</span><span class="p">(</span><span class="n">totsol</span><span class="p">,</span> <span class="n">rtot</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">absol</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>
<a name="ln-5731"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5732"></a>    <span class="c">!   This subroutine calculates the shading coefficient for a window.</span>
<a name="ln-5733"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5734"></a>    <span class="c">!  Inputs:</span>
<a name="ln-5735"></a>    <span class="c">!    absol     array of absorped fraction of solar radiation in lites</span>
<a name="ln-5736"></a>    <span class="c">!    totsol    total solar transmittance</span>
<a name="ln-5737"></a>    <span class="c">!    rtot  total thermal resistance of window</span>
<a name="ln-5738"></a>    <span class="c">!    rs    array of thermal resistances of each gap and layer</span>
<a name="ln-5739"></a>    <span class="c">!    layer     number of layers</span>
<a name="ln-5740"></a>    <span class="c">!     dir  direct solar radiation</span>
<a name="ln-5741"></a>    <span class="c">!  Outputs:</span>
<a name="ln-5742"></a>    <span class="c">!    sf    solar gain of space</span>
<a name="ln-5743"></a>
<a name="ln-5744"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">rtot</span>
<a name="ln-5745"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">absol</span>
<a name="ln-5746"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rs</span>
<a name="ln-5747"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-5748"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sf</span>
<a name="ln-5749"></a>
<a name="ln-5750"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flowin</span><span class="p">,</span> <span class="n">fract</span>
<a name="ln-5751"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-5752"></a>
<a name="ln-5753"></a>    <span class="n">fract</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5754"></a>    <span class="n">flowin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5755"></a>    <span class="n">sf</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5756"></a>
<a name="ln-5757"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rtot</span> <span class="o">==</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5758"></a><span class="k">      return</span>
<a name="ln-5759"></a><span class="k">    end if</span>
<a name="ln-5760"></a>
<a name="ln-5761"></a>    <span class="c">! evaluate inward flowing fraction of absorbed radiation:</span>
<a name="ln-5762"></a>    <span class="n">flowin</span> <span class="o">=</span> <span class="p">(</span><span class="n">rs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5d0</span> <span class="o">*</span> <span class="n">rs</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">rtot</span>
<a name="ln-5763"></a>    <span class="n">fract</span> <span class="o">=</span> <span class="n">absol</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">flowin</span>
<a name="ln-5764"></a>
<a name="ln-5765"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5766"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-5767"></a>      <span class="n">flowin</span> <span class="o">=</span> <span class="n">flowin</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">rs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">rs</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="o">+</span> <span class="n">rs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">rtot</span>
<a name="ln-5768"></a>      <span class="n">fract</span> <span class="o">=</span> <span class="n">fract</span> <span class="o">+</span> <span class="n">absol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">flowin</span>
<a name="ln-5769"></a>    <span class="k">end do</span>
<a name="ln-5770"></a><span class="k">    </span><span class="n">sf</span> <span class="o">=</span> <span class="n">totsol</span><span class="o">+</span><span class="n">fract</span>   <span class="c">! add inward fraction to directly transmitted fraction</span>
<a name="ln-5771"></a>
<a name="ln-5772"></a>  <span class="k">end subroutine </span><span class="n">solarISO15099</span>
<a name="ln-5773"></a>
<a name="ln-5774"></a>  <span class="k">subroutine </span><span class="n">resist</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">Theta</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5775"></a>                      <span class="p">&amp;</span>  <span class="n">qlayer</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-5776"></a>                      <span class="p">&amp;</span>  <span class="n">ufactor</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span><span class="p">)</span>
<a name="ln-5777"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5778"></a>    <span class="c">! subroutine to calculate total thermal resistance of the glazing system</span>
<a name="ln-5779"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5780"></a>
<a name="ln-5781"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span>
<a name="ln-5782"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Tout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">tind</span>
<a name="ln-5783"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span>
<a name="ln-5784"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-5785"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qv</span>
<a name="ln-5786"></a>
<a name="ln-5787"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">flux</span>
<a name="ln-5788"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span>
<a name="ln-5789"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qcgas</span><span class="p">,</span> <span class="n">qrgas</span>
<a name="ln-5790"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qlayer</span>
<a name="ln-5791"></a>
<a name="ln-5792"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-5793"></a>
<a name="ln-5794"></a>    <span class="c">!R_tot = 0.0</span>
<a name="ln-5795"></a>
<a name="ln-5796"></a>    <span class="c">! Simon: calculation of heat flow through gaps and layers as well as ventilation speed and heat flow</span>
<a name="ln-5797"></a>    <span class="c">! are kept just for reporting purposes.  U-factor calculation is performed by calculating heat flow transfer</span>
<a name="ln-5798"></a>    <span class="c">! at indoor layer</span>
<a name="ln-5799"></a>
<a name="ln-5800"></a>    <span class="c">!calculate heat flow for external and internal environments and gaps</span>
<a name="ln-5801"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-5802"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5803"></a><span class="k">        </span><span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Tout</span><span class="p">)</span>
<a name="ln-5804"></a>        <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Trmout</span><span class="p">)</span>
<a name="ln-5805"></a>        <span class="n">qlayer</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5806"></a>    <span class="c">!    rs(2*i-1) = 1/hgas(i)</span>
<a name="ln-5807"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5808"></a><span class="k">        </span><span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Tind</span> <span class="o">-</span> <span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-5809"></a>        <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Trmin</span> <span class="o">-</span> <span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-5810"></a>        <span class="n">qlayer</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5811"></a>    <span class="c">!    rs(2*i-1) = 1/hgas(i)</span>
<a name="ln-5812"></a>      <span class="k">else</span>
<a name="ln-5813"></a><span class="k">        </span><span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-5814"></a>        <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-5815"></a>        <span class="n">qlayer</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">qcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">qrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5816"></a>    <span class="c">!    rs(2*i-1) = 1/hgas(i)</span>
<a name="ln-5817"></a>      <span class="k">end if</span>
<a name="ln-5818"></a><span class="k">    end do</span>
<a name="ln-5819"></a>
<a name="ln-5820"></a>    <span class="c">!.....Calculate thermal resistances for glazing layers:</span>
<a name="ln-5821"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5822"></a>    <span class="c">!  rs(2*i) = thick(i)/scon(i)</span>
<a name="ln-5823"></a>      <span class="n">qlayer</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">thick</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">Theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-5824"></a>    <span class="k">end do</span>
<a name="ln-5825"></a>
<a name="ln-5826"></a>    <span class="c">!R_tot = 0.0</span>
<a name="ln-5827"></a>
<a name="ln-5828"></a>    <span class="c">!do i = 1, 2*nlayer+1</span>
<a name="ln-5829"></a>    <span class="c">!  R_tot = R_tot + rs(i)</span>
<a name="ln-5830"></a>    <span class="c">!end do</span>
<a name="ln-5831"></a>
<a name="ln-5832"></a>    <span class="c">! U factor:</span>
<a name="ln-5833"></a>    <span class="c">!ufactor = 1./R_tot</span>
<a name="ln-5834"></a>
<a name="ln-5835"></a>    <span class="n">flux</span> <span class="o">=</span> <span class="n">qlayer</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-5836"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">IsShadingLayer</span><span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-5837"></a><span class="k">      </span><span class="n">flux</span> <span class="o">=</span> <span class="n">flux</span> <span class="o">+</span> <span class="n">qv</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-5838"></a>    <span class="k">end if</span>
<a name="ln-5839"></a>
<a name="ln-5840"></a><span class="k">    </span><span class="n">ufactor</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-5841"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">Tind</span> <span class="o">/=</span> <span class="n">Tout</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5842"></a><span class="k">      </span><span class="n">ufactor</span> <span class="o">=</span> <span class="n">flux</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tind</span> <span class="o">-</span> <span class="n">Tout</span><span class="p">)</span>
<a name="ln-5843"></a>    <span class="k">end if</span>
<a name="ln-5844"></a>
<a name="ln-5845"></a><span class="k">  end subroutine</span>
<a name="ln-5846"></a>
<a name="ln-5847"></a><span class="k">  subroutine </span><span class="n">hatter</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5848"></a>                      <span class="n">gap</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">Radiation</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5849"></a>                      <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5850"></a>                      <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="nb">index</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span> <span class="p">)</span>
<a name="ln-5851"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5852"></a>    <span class="c">!  This subroutine calculates the array of conductances/film coefficients used to model convection.  The conductances/film</span>
<a name="ln-5853"></a>    <span class="c">!  coefficients are calculated as functions of temperature defined with the usual variable h and THEN are converted into an</span>
<a name="ln-5854"></a>    <span class="c">!  equivalent value interms of the black body emittance based on the surface</span>
<a name="ln-5855"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-5856"></a>    <span class="c">! Inputs</span>
<a name="ln-5857"></a>    <span class="c">!   nlayer   number of solid layers</span>
<a name="ln-5858"></a>    <span class="c">!   iwd  wind direction</span>
<a name="ln-5859"></a>    <span class="c">!   tout     outside temp in k</span>
<a name="ln-5860"></a>    <span class="c">!   tind  inside temp in k</span>
<a name="ln-5861"></a>    <span class="c">!   wso  wind speed in m/s</span>
<a name="ln-5862"></a>    <span class="c">!   wsi  inside forced air speed m/s</span>
<a name="ln-5863"></a>    <span class="c">!   Ebsky    ir flux from outside</span>
<a name="ln-5864"></a>    <span class="c">!   Ebroom   ir flux from room</span>
<a name="ln-5865"></a>    <span class="c">!   Gout     radiosity (ir flux) of the combined environment (sky+ground)</span>
<a name="ln-5866"></a>    <span class="c">!   Gin</span>
<a name="ln-5867"></a>    <span class="c">!   gap  vector of gap widths in meters</span>
<a name="ln-5868"></a>    <span class="c">!   height   IGU cavity height</span>
<a name="ln-5869"></a>    <span class="c">!   heightt</span>
<a name="ln-5870"></a>    <span class="c">!   thick    glazing layer thickness</span>
<a name="ln-5871"></a>    <span class="c">!   scon   Vector of conductivities of each glazing layer</span>
<a name="ln-5872"></a>    <span class="c">!   tilt   Window tilt (in degrees)</span>
<a name="ln-5873"></a>    <span class="c">!   theta  Vector of average temperatures</span>
<a name="ln-5874"></a>    <span class="c">!   Ebb</span>
<a name="ln-5875"></a>    <span class="c">!   Ebf</span>
<a name="ln-5876"></a>    <span class="c">!   iprop    array of gap mixtures</span>
<a name="ln-5877"></a>    <span class="c">!   frct     vector of mixture fractions</span>
<a name="ln-5878"></a>    <span class="c">!   presure</span>
<a name="ln-5879"></a>    <span class="c">!   hin   Indoor Indoor combined film coefficient (if non-zero)</span>
<a name="ln-5880"></a>    <span class="c">!   hout  Outdoor combined film coefficient (if non-zero)</span>
<a name="ln-5881"></a>    <span class="c">!   nmix  vector of number of gasses in a mixture for each gap</span>
<a name="ln-5882"></a>    <span class="c">! Ouputs</span>
<a name="ln-5883"></a>    <span class="c">!   hhat     vector of all film coefficients (maxlay3)</span>
<a name="ln-5884"></a>    <span class="c">!   hgas     vector of gap &#39;film&#39; coeff.</span>
<a name="ln-5885"></a>    <span class="c">!   hcin  Indoor convective surface heat transfer coefficient</span>
<a name="ln-5886"></a>    <span class="c">!   hcout     Outdoor convective heat transfer coeff</span>
<a name="ln-5887"></a>    <span class="c">!   hrin    Indoor radiative surface heat transfer coefficient</span>
<a name="ln-5888"></a>    <span class="c">!   hrout   Outdoor radiative surface heat transfer coefficient</span>
<a name="ln-5889"></a>    <span class="c">!   hin   Indoor combined film coefficient</span>
<a name="ln-5890"></a>    <span class="c">!   hout  Outdoor combined film coefficient</span>
<a name="ln-5891"></a>    <span class="c">!   index    iteration step</span>
<a name="ln-5892"></a>    <span class="c">!   ibc</span>
<a name="ln-5893"></a>    <span class="c">!</span>
<a name="ln-5894"></a>    <span class="c">! Inactives**</span>
<a name="ln-5895"></a>    <span class="c">!   wa - window azimuth (degrees, clockwise from south)</span>
<a name="ln-5896"></a>    <span class="c">!</span>
<a name="ln-5897"></a>
<a name="ln-5898"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="nb">index</span><span class="p">,</span> <span class="n">iwd</span>
<a name="ln-5899"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-5900"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-5901"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-5902"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gama</span>
<a name="ln-5903"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span>
<a name="ln-5904"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span>
<a name="ln-5905"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-5906"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span>
<a name="ln-5907"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-5908"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Radiation</span>
<a name="ln-5909"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap</span>
<a name="ln-5910"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Ebroom</span>
<a name="ln-5911"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-5912"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPillar</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span>
<a name="ln-5913"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span>
<a name="ln-5914"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span>
<a name="ln-5915"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span>
<a name="ln-5916"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span>
<a name="ln-5917"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="kd">::</span> <span class="n">hgas</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span>
<a name="ln-5918"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">troom</span><span class="p">,</span> <span class="n">tamb</span>
<a name="ln-5919"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-5920"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-5921"></a>
<a name="ln-5922"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nface</span>
<a name="ln-5923"></a>    <span class="c">!character*(3) :: a</span>
<a name="ln-5924"></a>
<a name="ln-5925"></a>  <span class="c">!  common    /props/ gcon(maxgas,3),gvis(maxgas,3),gcp(maxgas,3),grho(maxgas,3),wght(maxgas)</span>
<a name="ln-5926"></a>
<a name="ln-5927"></a>    <span class="c">! evaluate convective/conductive components of gap grashof number, thermal conductivity and their derivatives:</span>
<a name="ln-5928"></a>    <span class="n">nface</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-5929"></a>
<a name="ln-5930"></a>    <span class="c">!do i = 1, nlayer</span>
<a name="ln-5931"></a>    <span class="c">!  j=2*i</span>
<a name="ln-5932"></a>
<a name="ln-5933"></a>    <span class="c">!  if ((Ebb(i)-Ebf(i)).eq.0) then</span>
<a name="ln-5934"></a>    <span class="c">!    theta(j) = theta(j) + tempCorrection</span>
<a name="ln-5935"></a>    <span class="c">!    Ebb(i) = sigma * (theta(j) ** 4)</span>
<a name="ln-5936"></a>    <span class="c">!  end if</span>
<a name="ln-5937"></a>    <span class="c">!  hhat(j) = scon(i)/thick(i) * (theta(j)-theta(j-1))/(Ebb(i)-Ebf(i))</span>
<a name="ln-5938"></a>
<a name="ln-5939"></a>      <span class="c">!dr.....caluclate for laminate procedure</span>
<a name="ln-5940"></a>    <span class="c">!  if (nslice(i).gt.1) then</span>
<a name="ln-5941"></a>    <span class="c">!    if ((LaminateB(i).ne.0).and.((Ebb(i)-Ebf(i)).ne.0)) then</span>
<a name="ln-5942"></a>    <span class="c">!      hhat(j) = (theta(j)-theta(j-1))/(LaminateB(i) * (Ebb(i)-Ebf(i)))</span>
<a name="ln-5943"></a>    <span class="c">!    end if</span>
<a name="ln-5944"></a>    <span class="c">!  end if</span>
<a name="ln-5945"></a>      <span class="c">!if (hhat(j).lt.0) then</span>
<a name="ln-5946"></a>      <span class="c">!  nperr = 6</span>
<a name="ln-5947"></a>      <span class="c">!  write(a, &#39;(i3)&#39;) i</span>
<a name="ln-5948"></a>      <span class="c">!  ErrorMessage = &#39;Heat transfer coefficient based on emissive power in glazing layer is less than zero. Layer #&#39;//trim(a)</span>
<a name="ln-5949"></a>      <span class="c">!  return</span>
<a name="ln-5950"></a>      <span class="c">!end if</span>
<a name="ln-5951"></a>    <span class="c">!end do</span>
<a name="ln-5952"></a>
<a name="ln-5953"></a>    <span class="k">call </span><span class="n">filmg</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5954"></a>        <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-5955"></a>
<a name="ln-5956"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-5957"></a><span class="k">      return</span>
<a name="ln-5958"></a><span class="k">    end if</span>
<a name="ln-5959"></a>
<a name="ln-5960"></a>    <span class="c">!this is adding influence of pillar to hgas</span>
<a name="ln-5961"></a>    <span class="k">call </span><span class="n">filmPillar</span><span class="p">(</span><span class="n">SupportPillar</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5962"></a>                      <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-5963"></a>
<a name="ln-5964"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-5965"></a><span class="k">      return</span>
<a name="ln-5966"></a><span class="k">    end if</span>
<a name="ln-5967"></a>
<a name="ln-5968"></a>    <span class="c">! adjust radiation coefficients</span>
<a name="ln-5969"></a>    <span class="c">!hrgas = 0.0d0</span>
<a name="ln-5970"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-5971"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-5972"></a>      <span class="c">!if ((theta(k)-theta(k-1)) == 0) then</span>
<a name="ln-5973"></a>      <span class="c">!  theta(k-1) = theta(k-1) + tempCorrection</span>
<a name="ln-5974"></a>      <span class="c">!end if</span>
<a name="ln-5975"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5976"></a><span class="k">        </span><span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Radiation</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-5977"></a>      <span class="k">end if</span>
<a name="ln-5978"></a>
<a name="ln-5979"></a><span class="k">      </span><span class="n">hgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">hrgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-5980"></a>    <span class="k">end do</span>
<a name="ln-5981"></a>
<a name="ln-5982"></a>    <span class="c">! convective indoor film coeff:</span>
<a name="ln-5983"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5984"></a><span class="k">      call </span><span class="n">filmi</span><span class="p">(</span><span class="n">tind</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="n">nface</span><span class="p">),</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-5985"></a>                  <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-5986"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5987"></a><span class="k">      </span><span class="n">hcin</span> <span class="o">=</span> <span class="n">hin</span><span class="o">-</span><span class="n">hrin</span>
<a name="ln-5988"></a>    <span class="c">!Simon: First iteration is with index = 0 and that means it should reenter iteration with whatever is provided as input</span>
<a name="ln-5989"></a>    <span class="c">!else if (ibc(2).eq.2.and.index.eq.1) then</span>
<a name="ln-5990"></a>    <span class="k">else if</span> <span class="p">((</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="nb">index</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5991"></a><span class="k">      </span><span class="n">hcin</span><span class="o">=</span><span class="n">hin</span>
<a name="ln-5992"></a>    <span class="k">end if</span>
<a name="ln-5993"></a><span class="k">    if</span> <span class="p">(</span><span class="n">hcin</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5994"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-5995"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Hcin is less then zero.&#39;</span>
<a name="ln-5996"></a>      <span class="k">return</span>
<a name="ln-5997"></a><span class="k">    end if</span>
<a name="ln-5998"></a>
<a name="ln-5999"></a><span class="k">    </span><span class="n">hcgas</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcin</span>
<a name="ln-6000"></a>    <span class="c">!hrin = 0.95*(Ebroom - Radiation(2*nlayer))/(Trmin-theta(2*nlayer))+0.05*hrin</span>
<a name="ln-6001"></a>    <span class="n">hrin</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ebroom</span> <span class="o">-</span> <span class="n">Radiation</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">Trmin</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-6002"></a>    <span class="c">!if ((Theta(2*nlayer) - Trmin).ne.0) then</span>
<a name="ln-6003"></a>    <span class="c">!  hrin =  sigma * emis(2*nlayer) * (Theta(2*nlayer)**4 - Trmin**4)/(Theta(2*nlayer) - Trmin)</span>
<a name="ln-6004"></a>    <span class="c">!else</span>
<a name="ln-6005"></a>    <span class="c">!  Theta(2*nlayer) = Theta(2*nlayer) + tempCorrection</span>
<a name="ln-6006"></a>    <span class="c">!  hrin =  sigma * emis(2*nlayer) * (Theta(2*nlayer)**4 - Trmin**4)/(Theta(2*nlayer) - Trmin)</span>
<a name="ln-6007"></a>    <span class="c">!end if</span>
<a name="ln-6008"></a>    <span class="n">hrgas</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hrin</span>
<a name="ln-6009"></a>    <span class="c">!hgas(nlayer+1)  = hcgas(nlayer+1) + hrgas(nlayer+1)</span>
<a name="ln-6010"></a>    <span class="n">troom</span> <span class="o">=</span> <span class="p">(</span><span class="n">hcin</span><span class="o">*</span><span class="n">tind</span><span class="o">+</span><span class="n">hrin</span><span class="o">*</span><span class="n">trmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">hcin</span><span class="o">+</span><span class="n">hrin</span><span class="p">)</span>
<a name="ln-6011"></a>
<a name="ln-6012"></a>    <span class="c">! convective outdoor film coeff:</span>
<a name="ln-6013"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6014"></a><span class="k">      call </span><span class="n">film</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">wso</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">hcout</span><span class="p">,</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6015"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6016"></a><span class="k">      </span><span class="n">hcout</span> <span class="o">=</span> <span class="n">hout</span><span class="o">-</span><span class="n">hrout</span>
<a name="ln-6017"></a>    <span class="c">!Simon: First iteration is with index = 0 and that means it should reenter iteration with whatever is provided as input</span>
<a name="ln-6018"></a>    <span class="c">!else if (ibc(1).eq.2.and.index.eq.1) then</span>
<a name="ln-6019"></a>    <span class="k">else if</span> <span class="p">((</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="nb">index</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6020"></a><span class="k">      </span><span class="n">hcout</span><span class="o">=</span><span class="n">hout</span>
<a name="ln-6021"></a>    <span class="k">end if</span>
<a name="ln-6022"></a><span class="k">    if</span> <span class="p">(</span><span class="n">hcout</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6023"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-6024"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Hcout is less than zero.&#39;</span>
<a name="ln-6025"></a>      <span class="k">return</span>
<a name="ln-6026"></a><span class="k">    end if</span>
<a name="ln-6027"></a>
<a name="ln-6028"></a><span class="k">    </span><span class="n">hcgas</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcout</span>
<a name="ln-6029"></a>    <span class="n">hrout</span> <span class="o">=</span> <span class="p">(</span><span class="n">Radiation</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ebsky</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">Trmout</span><span class="p">)</span>
<a name="ln-6030"></a>    <span class="c">!if ((Theta(1) - Trmout).ne.0) then</span>
<a name="ln-6031"></a>    <span class="c">!  hrout = sigma * emis(1) * (Theta(1)**4 - Trmout**4)/(Theta(1) - Trmout)</span>
<a name="ln-6032"></a>    <span class="c">!else</span>
<a name="ln-6033"></a>    <span class="c">!  Theta(1) = Theta(1) + tempCorrection</span>
<a name="ln-6034"></a>    <span class="c">!  hrout = sigma * emis(1) * (Theta(1)**4 - Trmout**4)/(Theta(1) - Trmout)</span>
<a name="ln-6035"></a>    <span class="c">!end if</span>
<a name="ln-6036"></a>    <span class="n">hrgas</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hrout</span>
<a name="ln-6037"></a>    <span class="c">!hgas(1)  = hrout + hcout</span>
<a name="ln-6038"></a>    <span class="n">tamb</span> <span class="o">=</span> <span class="p">(</span><span class="n">hcout</span><span class="o">*</span><span class="n">tout</span><span class="o">+</span><span class="n">hrout</span><span class="o">*</span><span class="n">trmout</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">hcout</span><span class="o">+</span><span class="n">hrout</span><span class="p">)</span>
<a name="ln-6039"></a>
<a name="ln-6040"></a>  <span class="k">end subroutine </span><span class="n">hatter</span>
<a name="ln-6041"></a>
<a name="ln-6042"></a>  <span class="k">subroutine </span><span class="n">filmi</span><span class="p">(</span><span class="n">tair</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">nlayer</span><span class="p">,</span><span class="n">tilt</span><span class="p">,</span><span class="n">wsi</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">iprop</span><span class="p">,</span><span class="n">frct</span><span class="p">,</span><span class="n">presure</span><span class="p">,</span><span class="n">nmix</span><span class="p">,</span><span class="n">wght</span><span class="p">,</span><span class="n">gcon</span><span class="p">,</span><span class="n">gvis</span><span class="p">,</span><span class="n">gcp</span><span class="p">,</span><span class="n">hcin</span><span class="p">,</span><span class="n">ibc</span><span class="p">,</span><span class="n">nperr</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6043"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6044"></a>    <span class="c">!  purpose to evaluate heat flux at indoor surface of window using still air correlations (Curcija and Goss 1993)</span>
<a name="ln-6045"></a>    <span class="c">!  found in SPC142 equations 5.43 - 5.48.</span>
<a name="ln-6046"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6047"></a>    <span class="c">! Input</span>
<a name="ln-6048"></a>    <span class="c">!   tair - room air temperature</span>
<a name="ln-6049"></a>    <span class="c">!   t - inside surface temperature</span>
<a name="ln-6050"></a>    <span class="c">!   nlayer  number of glazing layers</span>
<a name="ln-6051"></a>    <span class="c">!   tilt - the tilt of the glazing in degrees</span>
<a name="ln-6052"></a>    <span class="c">!   wsi - room wind speed (m/s)</span>
<a name="ln-6053"></a>    <span class="c">!   height - window height</span>
<a name="ln-6054"></a>    <span class="c">!   iprop</span>
<a name="ln-6055"></a>    <span class="c">!   frct</span>
<a name="ln-6056"></a>    <span class="c">!   presure</span>
<a name="ln-6057"></a>    <span class="c">!   nmix  vector of number of gasses in a mixture for each gap</span>
<a name="ln-6058"></a>    <span class="c">! Output</span>
<a name="ln-6059"></a>    <span class="c">!   hcin - indoor convecive heat transfer coeff</span>
<a name="ln-6060"></a>
<a name="ln-6061"></a>    <span class="c">! If there is forced air in the room than use SPC142 corelation 5.49 to calculate the room side film coefficient.</span>
<a name="ln-6062"></a>
<a name="ln-6063"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tair</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">height</span>
<a name="ln-6064"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-6065"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-6066"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wght</span>
<a name="ln-6067"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span>
<a name="ln-6068"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">ibc</span>
<a name="ln-6069"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-6070"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-6071"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcin</span>
<a name="ln-6072"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-6073"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-6074"></a>
<a name="ln-6075"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frcti</span>
<a name="ln-6076"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">j</span>
<a name="ln-6077"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ipropi</span>
<a name="ln-6078"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tiltr</span><span class="p">,</span> <span class="n">tmean</span><span class="p">,</span> <span class="n">delt</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">gr</span><span class="p">,</span> <span class="n">RaCrit</span><span class="p">,</span> <span class="n">RaL</span><span class="p">,</span> <span class="n">Gnui</span>
<a name="ln-6079"></a>
<a name="ln-6080"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">wsi</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! main IF</span>
<a name="ln-6081"></a>      <span class="k">select case</span> <span class="p">(</span><span class="n">ibc</span><span class="p">)</span>
<a name="ln-6082"></a>        <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-6083"></a>          <span class="n">hcin</span> <span class="o">=</span> <span class="mf">4.0d0</span> <span class="o">+</span> <span class="mf">4.0d0</span> <span class="o">*</span> <span class="n">wsi</span>
<a name="ln-6084"></a>        <span class="k">case</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6085"></a>          <span class="n">hcin</span> <span class="o">=</span> <span class="mf">5.6d0</span> <span class="o">+</span> <span class="mf">3.8d0</span> <span class="o">*</span> <span class="n">wsi</span>   <span class="c">! SPC142 correlation</span>
<a name="ln-6086"></a>          <span class="k">return</span>
<a name="ln-6087"></a><span class="k">      end select</span>
<a name="ln-6088"></a><span class="k">    else</span>       <span class="c">! main IF - else</span>
<a name="ln-6089"></a>      <span class="n">tiltr</span> <span class="o">=</span> <span class="n">tilt</span><span class="o">*</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">36</span><span class="mf">0.0d0</span>     <span class="c">! convert tilt in degrees to radians</span>
<a name="ln-6090"></a>      <span class="n">tmean</span> <span class="o">=</span> <span class="n">tair</span> <span class="o">+</span> <span class="mf">0.25d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">tair</span><span class="p">)</span>
<a name="ln-6091"></a>      <span class="n">delt</span> <span class="o">=</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">tair</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
<a name="ln-6092"></a>
<a name="ln-6093"></a>      <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6094"></a>        <span class="n">ipropi</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-6095"></a>        <span class="n">frcti</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-6096"></a>      <span class="k">end do</span>
<a name="ln-6097"></a>
<a name="ln-6098"></a><span class="k">      call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">tmean</span><span class="p">,</span> <span class="n">ipropi</span><span class="p">,</span> <span class="n">frcti</span><span class="p">,</span> <span class="n">presure</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">nmix</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6099"></a>                      <span class="n">ISO15099</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6100"></a>
<a name="ln-6101"></a>      <span class="c">!   Calculate grashoff number:</span>
<a name="ln-6102"></a>      <span class="c">!   The grashoff number is the Rayleigh Number (equation 5.29) in SPC142 divided by the Prandtl Number (prand):</span>
<a name="ln-6103"></a>      <span class="n">gr</span> <span class="o">=</span> <span class="n">GravityConstant</span> <span class="o">*</span> <span class="n">height</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">delt</span><span class="o">*</span><span class="n">dens</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">tmean</span><span class="o">*</span><span class="n">visc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-6104"></a>
<a name="ln-6105"></a>      <span class="n">RaL</span> <span class="o">=</span> <span class="n">gr</span><span class="o">*</span><span class="n">pr</span>
<a name="ln-6106"></a>      <span class="c">!   write(*,*)&#39; RaCrit,RaL,gr,pr &#39;</span>
<a name="ln-6107"></a>      <span class="c">!   write(*,*) RaCrit,RaL,gr,pr</span>
<a name="ln-6108"></a>
<a name="ln-6109"></a>      <span class="k">if</span> <span class="p">((</span><span class="mf">0.0d0</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">tilt</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1</span><span class="mf">5.0d0</span><span class="p">))</span> <span class="k">then</span>      <span class="c">! IF no. 1</span>
<a name="ln-6110"></a>        <span class="n">Gnui</span> <span class="o">=</span> <span class="mf">0.13d0</span> <span class="o">*</span> <span class="n">RaL</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span>
<a name="ln-6111"></a>      <span class="k">else if</span> <span class="p">((</span><span class="mi">1</span><span class="mf">5.0d0</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">tilt</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6112"></a>        <span class="c">!   if the room air is still THEN use equations 5.43 - 5.48:</span>
<a name="ln-6113"></a>        <span class="n">RaCrit</span> <span class="o">=</span> <span class="mf">2.5d5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">EXP</span><span class="p">(</span><span class="mf">0.72d0</span> <span class="o">*</span> <span class="n">tilt</span><span class="p">)</span> <span class="o">/</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">tiltr</span><span class="p">))</span><span class="o">**</span><span class="mf">0.2d0</span>
<a name="ln-6114"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">RaL</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">RaCrit</span><span class="p">)</span>  <span class="k">THEN</span>           <span class="c">! IF no. 2</span>
<a name="ln-6115"></a>          <span class="n">Gnui</span> <span class="o">=</span> <span class="mf">0.56d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">RaL</span> <span class="o">*</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">tiltr</span><span class="p">))</span><span class="o">**</span><span class="mf">0.25d0</span>
<a name="ln-6116"></a>          <span class="c">! write(*,*) &#39; Nu &#39;, Gnui</span>
<a name="ln-6117"></a>        <span class="k">else</span>
<a name="ln-6118"></a>          <span class="c">!Gnui = 0.13*(RaL**0.3333 - RaCrit**0.3333) + 0.56*(RaCrit*sin(tiltr))**0.25</span>
<a name="ln-6119"></a>          <span class="n">Gnui</span> <span class="o">=</span> <span class="mf">0.13d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">RaL</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span> <span class="o">-</span> <span class="n">RaCrit</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.56d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">RaCrit</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">tiltr</span><span class="p">))</span><span class="o">**</span><span class="mf">0.25d0</span>
<a name="ln-6120"></a>        <span class="k">end if</span>              <span class="c">! end if no. 2</span>
<a name="ln-6121"></a>      <span class="k">else if</span> <span class="p">((</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">tilt</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">17</span><span class="mf">9.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6122"></a><span class="k">        </span><span class="n">Gnui</span> <span class="o">=</span> <span class="mf">0.56d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">RaL</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">tiltr</span><span class="p">))</span><span class="o">**</span><span class="mf">0.25d0</span>
<a name="ln-6123"></a>      <span class="k">else if</span> <span class="p">((</span><span class="mi">17</span><span class="mf">9.0d0</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">tilt</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">18</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6124"></a><span class="k">        </span><span class="n">Gnui</span> <span class="o">=</span> <span class="mf">0.58d0</span> <span class="o">*</span> <span class="n">RaL</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span>
<a name="ln-6125"></a>      <span class="k">end if</span>                   <span class="c">! end if no. 1</span>
<a name="ln-6126"></a>      <span class="c">!   write(*,*) &#39; RaL   &#39;, RaL, &#39;   RaCrit&#39;, RaCrit</span>
<a name="ln-6127"></a>      <span class="c">!   write(*,*)&#39;   Nusselt Number   &#39;,Gnui</span>
<a name="ln-6128"></a>
<a name="ln-6129"></a>      <span class="n">hcin</span> <span class="o">=</span> <span class="n">Gnui</span> <span class="o">*</span> <span class="p">(</span><span class="n">con</span><span class="o">/</span><span class="n">height</span><span class="p">)</span>
<a name="ln-6130"></a>  <span class="c">!   hin = 1.77*(abs(t-tair))**0.25</span>
<a name="ln-6131"></a>
<a name="ln-6132"></a>    <span class="k">end if</span>  <span class="c">! end main IF</span>
<a name="ln-6133"></a>
<a name="ln-6134"></a>  <span class="k">end subroutine </span><span class="n">filmi</span>
<a name="ln-6135"></a>
<a name="ln-6136"></a>  <span class="k">subroutine </span><span class="n">filmg</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Tgap</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6137"></a>                    <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">Rayleigh</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6138"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6139"></a>    <span class="c">! sobroutine to calculate effective conductance of gaps</span>
<a name="ln-6140"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6141"></a>    <span class="c">! Inputs:</span>
<a name="ln-6142"></a>    <span class="c">!   tilt  window angle (deg)</span>
<a name="ln-6143"></a>    <span class="c">!   theta     vector of surface temperatures [K]</span>
<a name="ln-6144"></a>    <span class="c">!   nlayer    total number of glazing layers</span>
<a name="ln-6145"></a>    <span class="c">!   height    glazing cavity height</span>
<a name="ln-6146"></a>    <span class="c">!   gap   vector of gap widths [m]</span>
<a name="ln-6147"></a>    <span class="c">!   iprop</span>
<a name="ln-6148"></a>    <span class="c">!   frct</span>
<a name="ln-6149"></a>    <span class="c">!   presure</span>
<a name="ln-6150"></a>    <span class="c">!   nmix  vector of number of gasses in a mixture for each gap</span>
<a name="ln-6151"></a>    <span class="c">! Output:</span>
<a name="ln-6152"></a>    <span class="c">!   hgas  vector of gap coefficients</span>
<a name="ln-6153"></a>    <span class="c">!   nperr     error code</span>
<a name="ln-6154"></a>    <span class="c">! Locals:</span>
<a name="ln-6155"></a>    <span class="c">!   gr    gap grashof number</span>
<a name="ln-6156"></a>    <span class="c">!   con   gap gas conductivity</span>
<a name="ln-6157"></a>    <span class="c">!   visc  dynamic viscosity @ mean temperature [g/m*s]</span>
<a name="ln-6158"></a>    <span class="c">!   dens  density @ mean temperature [kg/m^3]</span>
<a name="ln-6159"></a>    <span class="c">!   cp    specific heat @ mean temperature [J/g*K]</span>
<a name="ln-6160"></a>    <span class="c">!   pr    gap gas Prandtl number</span>
<a name="ln-6161"></a>    <span class="c">!   tmean     average film temperature</span>
<a name="ln-6162"></a>    <span class="c">!   delt  temperature difference</span>
<a name="ln-6163"></a>
<a name="ln-6164"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">VacuumPressure</span>
<a name="ln-6165"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-6166"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tgap</span>
<a name="ln-6167"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-6168"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-6169"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-6170"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gama</span>
<a name="ln-6171"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span>
<a name="ln-6172"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-6173"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-6174"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-6175"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Rayleigh</span><span class="p">,</span> <span class="n">Nu</span>
<a name="ln-6176"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgas</span>
<a name="ln-6177"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-6178"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-6179"></a>
<a name="ln-6180"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">delt</span><span class="p">,</span> <span class="n">tmean</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">asp</span><span class="p">,</span> <span class="n">gnu</span>
<a name="ln-6181"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frctg</span>
<a name="ln-6182"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ipropg</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span>
<a name="ln-6183"></a>
<a name="ln-6184"></a>    <span class="n">hcgas</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6185"></a>
<a name="ln-6186"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-6187"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span>
<a name="ln-6188"></a>      <span class="n">k</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-6189"></a>      <span class="c">! determine the gas properties of each gap:</span>
<a name="ln-6190"></a>      <span class="c">!tmean = (theta(j)+theta(k))/2.</span>
<a name="ln-6191"></a>      <span class="n">tmean</span> <span class="o">=</span> <span class="n">Tgap</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">! Tgap(1) is exterior environment</span>
<a name="ln-6192"></a>      <span class="n">delt</span> <span class="o">=</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<a name="ln-6193"></a>      <span class="c">! Temperatures should not be equal. This can happen in initial temperature guess before iterations started</span>
<a name="ln-6194"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">delt</span> <span class="o">==</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">delt</span> <span class="o">=</span> <span class="mf">1.0d-6</span>
<a name="ln-6195"></a>      <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6196"></a>        <span class="n">ipropg</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
<a name="ln-6197"></a>        <span class="n">frctg</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
<a name="ln-6198"></a>      <span class="k">end do</span>
<a name="ln-6199"></a>
<a name="ln-6200"></a><span class="k">      if</span> <span class="p">(</span><span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="n">VacuumPressure</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6201"></a><span class="k">        call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">tmean</span><span class="p">,</span> <span class="n">ipropg</span><span class="p">,</span> <span class="n">frctg</span><span class="p">,</span> <span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6202"></a>                        <span class="n">ISO15099</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6203"></a>
<a name="ln-6204"></a>        <span class="c">! Calculate grashoff number:</span>
<a name="ln-6205"></a>        <span class="c">! The grashoff number is the Rayleigh Number (equation 5.29) in SPC142 divided by the Prandtl Number (prand):</span>
<a name="ln-6206"></a>        <span class="n">ra</span> <span class="o">=</span> <span class="n">GravityConstant</span> <span class="o">*</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">delt</span><span class="o">*</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">dens</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">tmean</span><span class="o">*</span><span class="n">visc</span><span class="o">*</span><span class="n">con</span><span class="p">)</span>
<a name="ln-6207"></a>        <span class="n">Rayleigh</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ra</span>
<a name="ln-6208"></a>        <span class="c">! write(*,*) &#39;height,gap(i),asp&#39;,height,gap(i),asp</span>
<a name="ln-6209"></a>        <span class="c">!asp = 1</span>
<a name="ln-6210"></a>        <span class="c">!if (gap(i).ne.0) then</span>
<a name="ln-6211"></a>        <span class="n">asp</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-6212"></a>        <span class="c">!end if</span>
<a name="ln-6213"></a>        <span class="c">! determine the Nusselt number:</span>
<a name="ln-6214"></a>        <span class="k">call </span><span class="n">nusselt</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">asp</span><span class="p">,</span> <span class="n">gnu</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6215"></a>
<a name="ln-6216"></a>        <span class="n">Nu</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">gnu</span>
<a name="ln-6217"></a>        <span class="c">! calculate effective conductance of the gap</span>
<a name="ln-6218"></a>        <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">con</span><span class="o">/</span><span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">gnu</span>
<a name="ln-6219"></a>
<a name="ln-6220"></a>        <span class="c">! write(*,*)&#39;theta(j),theta(k),j,k&#39;,j,theta(j),k,theta(k)</span>
<a name="ln-6221"></a>        <span class="c">! write(*,*)&#39;Nusselt,Rayleigh,Prandtl,hgas(k),k&#39;</span>
<a name="ln-6222"></a>        <span class="c">! write(*,*) gnu,gr*pr,pr,hgas(k),k</span>
<a name="ln-6223"></a>      <span class="k">else</span> <span class="c">!low pressure calculations</span>
<a name="ln-6224"></a>        <span class="k">call </span><span class="n">GassesLow</span><span class="p">(</span><span class="n">tmean</span><span class="p">,</span> <span class="n">wght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">gama</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">con</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6225"></a>        <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">con</span>
<a name="ln-6226"></a>      <span class="k">end if</span> <span class="c">!if (pressure(i+1).gt.VacuumPressure) then</span>
<a name="ln-6227"></a>    <span class="k">end do</span>
<a name="ln-6228"></a><span class="k">  end subroutine </span><span class="n">filmg</span>
<a name="ln-6229"></a>
<a name="ln-6230"></a>  <span class="k">subroutine </span><span class="n">filmPillar</span><span class="p">(</span><span class="n">SupportPillar</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6231"></a>                          <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6232"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6233"></a>    <span class="c">! subroutine to calculate effective conductance of support pillars</span>
<a name="ln-6234"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6235"></a>
<a name="ln-6236"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPillar</span>     <span class="c">! Shows whether or not gap have support pillar</span>
<a name="ln-6237"></a>                                                                <span class="c">!   0 - does not have support pillar</span>
<a name="ln-6238"></a>                                                                <span class="c">!   1 - have support pillar</span>
<a name="ln-6239"></a>
<a name="ln-6240"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span>            <span class="c">! Conductivity of glass layers</span>
<a name="ln-6241"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span>   <span class="c">! Pillar spacing for each gap (used in case there is support pillar)</span>
<a name="ln-6242"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarRadius</span>    <span class="c">! Pillar radius for each gap (used in case there is support pillar)</span>
<a name="ln-6243"></a>
<a name="ln-6244"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">VacuumMaxGapThickness</span>
<a name="ln-6245"></a>
<a name="ln-6246"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-6247"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-6248"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgas</span>
<a name="ln-6249"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span> <span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-6250"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-6251"></a>
<a name="ln-6252"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cpa</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6253"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">aveGlassConductivity</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6254"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-6255"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-6256"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<a name="ln-6257"></a>
<a name="ln-6258"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-6259"></a>      <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-6260"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">SupportPillar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">YES_SupportPillar</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6261"></a><span class="c">!lkl        if (gap(i).gt.(VacuumMaxGapThickness + InputDataTolerance)) then</span>
<a name="ln-6262"></a><span class="c">!lkl          nperr = 1007 !support pillar is not necessary for wide gaps (calculation will continue)</span>
<a name="ln-6263"></a><span class="c">!lkl          write(a, &#39;(f12.6)&#39;) VacuumMaxGapThickness</span>
<a name="ln-6264"></a><span class="c">!lkl          write(b, &#39;(i3)&#39;) i</span>
<a name="ln-6265"></a><span class="c">!lkl          ErrorMessage = &#39;Gap width is more than &#39;//trim(a)//&#39; and it contains support pillar. Gap #&#39;//trim(b)</span>
<a name="ln-6266"></a><span class="c">!lkl        end if  !if (gap(i).gt.VacuumMaxGapThickness) then</span>
<a name="ln-6267"></a>
<a name="ln-6268"></a>        <span class="c">!Average glass conductivity is taken as average from both glass surrounding gap</span>
<a name="ln-6269"></a>        <span class="n">aveGlassConductivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">scon</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<a name="ln-6270"></a>
<a name="ln-6271"></a>        <span class="n">cpa</span> <span class="o">=</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">aveGlassConductivity</span> <span class="o">*</span> <span class="n">PillarRadius</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">PillarSpacing</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-6272"></a>          <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">2.0d0</span> <span class="o">*</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">PillarRadius</span><span class="p">(</span><span class="n">i</span><span class="p">))))</span>
<a name="ln-6273"></a>
<a name="ln-6274"></a>        <span class="c">!It is important to add on prevoius values caluculated for gas</span>
<a name="ln-6275"></a>        <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cpa</span>
<a name="ln-6276"></a>      <span class="k">end if</span> <span class="c">!if (SupportPillar(i).eq.YES_SupportPillar) then</span>
<a name="ln-6277"></a>
<a name="ln-6278"></a>    <span class="k">end do</span>
<a name="ln-6279"></a>
<a name="ln-6280"></a><span class="k">  end subroutine </span><span class="n">filmPillar</span>
<a name="ln-6281"></a>
<a name="ln-6282"></a>  <span class="k">subroutine </span><span class="n">nusselt</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">asp</span><span class="p">,</span> <span class="n">gnu</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6283"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6284"></a>    <span class="c">! purpose to calculate nusselt modulus for air gaps (ISO15099)</span>
<a name="ln-6285"></a>    <span class="c">!***********************************************************************</span>
<a name="ln-6286"></a>    <span class="c">! Input</span>
<a name="ln-6287"></a>    <span class="c">!   tilt   tilt in degrees</span>
<a name="ln-6288"></a>    <span class="c">!   ra     rayleigh number</span>
<a name="ln-6289"></a>    <span class="c">!   asp    Aspect ratio</span>
<a name="ln-6290"></a>    <span class="c">!</span>
<a name="ln-6291"></a>    <span class="c">! Output</span>
<a name="ln-6292"></a>    <span class="c">!   gnu    nusselt number</span>
<a name="ln-6293"></a>    <span class="c">!   nperr</span>
<a name="ln-6294"></a>
<a name="ln-6295"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">asp</span>
<a name="ln-6296"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gnu</span>
<a name="ln-6297"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-6298"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-6299"></a>
<a name="ln-6300"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">subNu1</span><span class="p">,</span> <span class="n">subNu2</span><span class="p">,</span> <span class="n">subNu3</span><span class="p">,</span> <span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Nu60</span><span class="p">,</span> <span class="n">Nu90</span><span class="p">,</span> <span class="n">tiltr</span>
<a name="ln-6301"></a>
<a name="ln-6302"></a>    <span class="n">subNu1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6303"></a>    <span class="n">subNu2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6304"></a>    <span class="n">subNu3</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6305"></a>    <span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6306"></a>    <span class="n">Nu2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6307"></a>    <span class="n">Nu90</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6308"></a>    <span class="n">Nu60</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6309"></a>    <span class="n">G</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-6310"></a>    <span class="n">tiltr</span> <span class="o">=</span> <span class="n">tilt</span><span class="o">*</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">36</span><span class="mf">0.0d0</span>     <span class="c">! convert tilt in degrees to radians</span>
<a name="ln-6311"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">tilt</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">6</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>                 <span class="c">!ISO/DIS 15099 - chapter 5.3.3.1</span>
<a name="ln-6312"></a>      <span class="n">subNu1</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">-</span> <span class="mi">170</span><span class="mf">8.0d0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ra</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">tiltr</span><span class="p">))</span>
<a name="ln-6313"></a>      <span class="n">subNu1</span> <span class="o">=</span> <span class="n">pos</span><span class="p">(</span><span class="n">subNu1</span><span class="p">)</span>
<a name="ln-6314"></a>      <span class="n">subNu2</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">-</span> <span class="p">(</span><span class="mi">170</span><span class="mf">8.0d0</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="mf">1.8d0</span> <span class="o">*</span> <span class="n">tiltr</span><span class="p">))</span> <span class="o">**</span> <span class="mf">1.6d0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ra</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">tiltr</span><span class="p">))</span>
<a name="ln-6315"></a>      <span class="n">subNu3</span> <span class="o">=</span> <span class="p">((</span><span class="n">ra</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">tiltr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">583</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.0d0</span>
<a name="ln-6316"></a>      <span class="n">subNu3</span> <span class="o">=</span> <span class="n">pos</span><span class="p">(</span><span class="n">subNu3</span><span class="p">)</span>
<a name="ln-6317"></a>      <span class="n">gnu</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">1.44d0</span> <span class="o">*</span> <span class="n">subNu1</span> <span class="o">*</span> <span class="n">subNu2</span> <span class="o">+</span> <span class="n">subNu3</span>                         <span class="c">!equation 42</span>
<a name="ln-6318"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mf">1.0d5</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6319"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">1001</span>    <span class="c">! Rayleigh number is out of range</span>
<a name="ln-6320"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Rayleigh number out of range in Nusselt num. calc. for gaps (angle between 0 and 60 deg).&#39;</span>
<a name="ln-6321"></a>      <span class="k">end if</span>
<a name="ln-6322"></a><span class="k">      if</span> <span class="p">(</span><span class="n">asp</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">2</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6323"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">1002</span>    <span class="c">! Aspect Ratio is out of range</span>
<a name="ln-6324"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Aspect Ratio out of range in Nusselt num. calc. for gaps (angle between 0 and 60 deg).&#39;</span>
<a name="ln-6325"></a>      <span class="k">end if</span>
<a name="ln-6326"></a><span class="k">    else if</span> <span class="p">(</span><span class="n">tilt</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">6</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>                               <span class="c">!ISO/DIS 15099 - chapter 5.3.3.2</span>
<a name="ln-6327"></a>      <span class="n">G</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="mi">316</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="mf">0.6d0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.1d0</span><span class="p">)</span>                      <span class="c">!equation 47</span>
<a name="ln-6328"></a>      <span class="n">Nu1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">((</span><span class="mf">0.0936d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.314d0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">G</span><span class="p">))</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.1428571d0</span><span class="p">)</span>  <span class="c">!equation 45</span>
<a name="ln-6329"></a>      <span class="n">Nu2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.104d0</span> <span class="o">+</span> <span class="mf">0.175d0</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">**</span> <span class="mf">0.283d0</span><span class="p">)</span>                       <span class="c">!equation 46</span>
<a name="ln-6330"></a>      <span class="n">gnu</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                               <span class="c">!equation 44</span>
<a name="ln-6331"></a>    <span class="k">else if</span> <span class="p">((</span><span class="n">tilt</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">6</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>            <span class="c">!ISO/DIS 15099 - chapter 5.3.3.3</span>
<a name="ln-6332"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">10</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">ra</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mf">2.0d7</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">asp</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">5.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">asp</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">10</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6333"></a><span class="k">        </span><span class="n">G</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="mi">316</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="mf">0.6d0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.1d0</span><span class="p">)</span>                     <span class="c">!equation 47</span>
<a name="ln-6334"></a>        <span class="n">Nu1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">((</span><span class="mf">0.0936d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.314d0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">G</span><span class="p">))</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.1428571d0</span><span class="p">)</span> <span class="c">!equation 45</span>
<a name="ln-6335"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.104d0</span> <span class="o">+</span> <span class="mf">0.175d0</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">**</span> <span class="mf">0.283d0</span><span class="p">)</span>                      <span class="c">!equation 46</span>
<a name="ln-6336"></a>        <span class="n">Nu60</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                             <span class="c">!equation 44</span>
<a name="ln-6337"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="mf">0.242d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.272d0</span>                                <span class="c">!equation 52</span>
<a name="ln-6338"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6339"></a><span class="k">          </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.0673838d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span>                                <span class="c">!equation 49</span>
<a name="ln-6340"></a>        <span class="k">else if</span> <span class="p">((</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6341"></a><span class="k">          </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.028154d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.4134d0</span>                                  <span class="c">!equation 50</span>
<a name="ln-6342"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6343"></a><span class="k">          </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">1.7596678d-10</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">2.2984755d0</span>                      <span class="c">!equation 51</span>
<a name="ln-6344"></a>        <span class="k">end if</span>
<a name="ln-6345"></a><span class="k">      else if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">10</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6346"></a><span class="k">        </span><span class="n">G</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="mi">316</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="mf">0.6d0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.1d0</span><span class="p">)</span>                      <span class="c">!equation 47</span>
<a name="ln-6347"></a>        <span class="n">Nu1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">((</span><span class="mf">0.0936d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.314d0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">G</span><span class="p">))</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.1428571d0</span><span class="p">)</span>  <span class="c">!equation 45</span>
<a name="ln-6348"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.104d0</span> <span class="o">+</span> <span class="mf">0.175d0</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">**</span> <span class="mf">0.283d0</span><span class="p">)</span>                       <span class="c">!equation 46</span>
<a name="ln-6349"></a>        <span class="n">Nu60</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                              <span class="c">!equation 44</span>
<a name="ln-6350"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="mf">0.242d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.272d0</span>                                 <span class="c">!equation 52</span>
<a name="ln-6351"></a>        <span class="n">Nu1</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">1.7596678d-10</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">2.2984755d0</span>                         <span class="c">!equation 51</span>
<a name="ln-6352"></a>        <span class="n">nperr</span> <span class="o">=</span> <span class="mi">1003</span>   <span class="c">! Rayleigh number is less than 100</span>
<a name="ln-6353"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Rayleigh number is less than 100 in Nusselt number calculations for gaps &#39;</span><span class="o">//</span>  <span class="p">&amp;</span>
<a name="ln-6354"></a>           <span class="s1">&#39;(angle between 60 and 90 degrees).&#39;</span>
<a name="ln-6355"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">2.0d7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6356"></a><span class="k">        </span><span class="n">G</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="mi">316</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="mf">0.6d0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.1d0</span><span class="p">)</span>                      <span class="c">!equation 47</span>
<a name="ln-6357"></a>        <span class="n">Nu1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">((</span><span class="mf">0.0936d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.314d0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">G</span><span class="p">))</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.1428571d0</span><span class="p">)</span>  <span class="c">!equation 45</span>
<a name="ln-6358"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.104d0</span> <span class="o">+</span> <span class="mf">0.175d0</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">**</span> <span class="mf">0.283d0</span><span class="p">)</span>                       <span class="c">!equation 46</span>
<a name="ln-6359"></a>        <span class="n">Nu60</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                              <span class="c">!equation 44</span>
<a name="ln-6360"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="mf">0.242d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.272d0</span>                                 <span class="c">!equation 52</span>
<a name="ln-6361"></a>        <span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.0673838d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span>                                   <span class="c">!equation 49</span>
<a name="ln-6362"></a>        <span class="n">nperr</span> <span class="o">=</span> <span class="mi">1004</span>   <span class="c">! Rayleigh number is great from 2e7</span>
<a name="ln-6363"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Rayleigh number is greater than 2e7 in Nusselt number calculations for gaps&#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-6364"></a>                          <span class="s1">&#39; (angle between 60 and 90 degrees).&#39;</span>
<a name="ln-6365"></a>      <span class="k">else if</span> <span class="p">((</span><span class="n">asp</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">5.0d0</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">asp</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">10</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6366"></a><span class="k">        </span><span class="n">G</span> <span class="o">=</span> <span class="mf">0.5d0</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="mi">316</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="mf">0.6d0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.1d0</span><span class="p">)</span>                      <span class="c">!equation 47</span>
<a name="ln-6367"></a>        <span class="n">Nu1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">((</span><span class="mf">0.0936d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.314d0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">G</span><span class="p">))</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.1428571d0</span><span class="p">)</span>  <span class="c">!equation 45</span>
<a name="ln-6368"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.104d0</span> <span class="o">+</span> <span class="mf">0.175d0</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">**</span> <span class="mf">0.283d0</span><span class="p">)</span>                       <span class="c">!equation 46</span>
<a name="ln-6369"></a>        <span class="n">Nu60</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                              <span class="c">!equation 44</span>
<a name="ln-6370"></a>        <span class="n">Nu2</span> <span class="o">=</span> <span class="mf">0.242d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.272d0</span>                                 <span class="c">!equation 52</span>
<a name="ln-6371"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6372"></a><span class="k">          </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.0673838d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span>                                 <span class="c">!equation 49</span>
<a name="ln-6373"></a>        <span class="k">else if</span> <span class="p">((</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6374"></a><span class="k">          </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.028154d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.4134d0</span>                                   <span class="c">!equation 50</span>
<a name="ln-6375"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6376"></a><span class="k">          </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">1.7596678d-10</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">2.2984755d0</span>                       <span class="c">!equation 51</span>
<a name="ln-6377"></a>        <span class="k">end if</span>
<a name="ln-6378"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">1005</span> <span class="c">! Aspect Ratio is out of range</span>
<a name="ln-6379"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Aspect Ratio is out of range in Nusselt number calculations for gaps (angle between 60 and 90 degrees).&#39;</span>
<a name="ln-6380"></a>      <span class="k">end if</span>
<a name="ln-6381"></a><span class="k">      </span><span class="n">Nu90</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                  <span class="c">!equation 48</span>
<a name="ln-6382"></a>      <span class="n">gnu</span> <span class="o">=</span> <span class="p">((</span><span class="n">Nu90</span> <span class="o">-</span> <span class="n">Nu60</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="mf">0.0d0</span> <span class="o">-</span> <span class="mi">6</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">tilt</span> <span class="o">-</span> <span class="mi">6</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="o">+</span> <span class="n">Nu60</span>  <span class="c">!linear interpolation between 60 and 90 degrees</span>
<a name="ln-6383"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">tilt</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>                                <span class="c">!ISO/DIS 15099 - chapter 5.3.3.4</span>
<a name="ln-6384"></a>      <span class="n">Nu2</span> <span class="o">=</span> <span class="mf">0.242d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.272d0</span>                     <span class="c">!equation 52</span>
<a name="ln-6385"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6386"></a><span class="k">        </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.0673838d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">))</span>             <span class="c">!equation 49</span>
<a name="ln-6387"></a>      <span class="k">else if</span> <span class="p">((</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6388"></a><span class="k">        </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.028154d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.4134d0</span>                       <span class="c">!equation 50</span>
<a name="ln-6389"></a>        <span class="c">!Nu1 = 0.028154 * ra ** 0.414d0                       !equation 50 - DISCONTINUITY CORRECTED</span>
<a name="ln-6390"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6391"></a><span class="k">        </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">1.7596678d-10</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">2.2984755d0</span>           <span class="c">!equation 51</span>
<a name="ln-6392"></a>      <span class="k">end if</span>
<a name="ln-6393"></a><span class="k">      </span><span class="n">gnu</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                   <span class="c">!equation 48</span>
<a name="ln-6394"></a>    <span class="k">else if</span> <span class="p">((</span><span class="n">tilt</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">9</span><span class="mf">0.0d0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">tilt</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">18</span><span class="mf">0.0d0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6395"></a><span class="k">      </span><span class="n">Nu2</span> <span class="o">=</span> <span class="mf">0.242d0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra</span> <span class="o">/</span> <span class="n">asp</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.272d0</span>                     <span class="c">!equation 52</span>
<a name="ln-6396"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6397"></a><span class="k">        </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.0673838d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span>               <span class="c">!equation 49</span>
<a name="ln-6398"></a>      <span class="k">else if</span> <span class="p">((</span><span class="n">ra</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">5.0d4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6399"></a><span class="k">        </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">0.028154d0</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">0.4134d0</span>                       <span class="c">!equation 50</span>
<a name="ln-6400"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">ra</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mf">1.0d4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6401"></a><span class="k">        </span><span class="n">Nu1</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="mf">1.7596678d-10</span> <span class="o">*</span> <span class="n">ra</span> <span class="o">**</span> <span class="mf">2.2984755d0</span>           <span class="c">!equation 51</span>
<a name="ln-6402"></a>      <span class="k">end if</span>
<a name="ln-6403"></a><span class="k">      </span><span class="n">gnu</span> <span class="o">=</span> <span class="nb">Max</span><span class="p">(</span><span class="n">Nu1</span><span class="p">,</span> <span class="n">Nu2</span><span class="p">)</span>                                   <span class="c">!equation 48</span>
<a name="ln-6404"></a>      <span class="n">gnu</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="p">(</span><span class="n">gnu</span> <span class="o">-</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">tiltr</span><span class="p">)</span>                      <span class="c">!equation 53</span>
<a name="ln-6405"></a>    <span class="k">else</span>
<a name="ln-6406"></a><span class="k">      </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">10</span>    <span class="c">!error flag: angle is out of range</span>
<a name="ln-6407"></a>      <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Window tilt angle is out of range.&#39;</span>
<a name="ln-6408"></a>    <span class="k">return</span>
<a name="ln-6409"></a><span class="k">    end if</span>
<a name="ln-6410"></a>
<a name="ln-6411"></a><span class="k">  end subroutine </span><span class="n">nusselt</span>
<a name="ln-6412"></a>
<a name="ln-6413"></a><span class="c">!  subroutine picard(nlayer, alpha, Ebb, Ebf, Rf, Rb, Ebbold, Ebfold, Rfold, Rbold)</span>
<a name="ln-6414"></a><span class="c">!</span>
<a name="ln-6415"></a><span class="c">!    integer, intent(in) :: nlayer</span>
<a name="ln-6416"></a><span class="c">!    real(r64), intent(in) :: alpha</span>
<a name="ln-6417"></a><span class="c">!    real(r64), intent(in) :: Ebbold(maxlay), Ebfold(maxlay), Rbold(maxlay), Rfold(maxlay)</span>
<a name="ln-6418"></a><span class="c">!    real(r64), intent(inout) :: Ebb(maxlay), Ebf(maxlay), Rb(maxlay), Rf(maxlay)</span>
<a name="ln-6419"></a><span class="c">!</span>
<a name="ln-6420"></a><span class="c">!    integer :: i</span>
<a name="ln-6421"></a><span class="c">!</span>
<a name="ln-6422"></a><span class="c">!    do i=1,nlayer</span>
<a name="ln-6423"></a><span class="c">!      Ebb(i) = alpha * Ebb(i) + (1-alpha) * Ebbold(i)</span>
<a name="ln-6424"></a><span class="c">!      Ebf(i) = alpha * Ebf(i) + (1-alpha) * Ebfold(i)</span>
<a name="ln-6425"></a><span class="c">!      Rb(i) = alpha * Rb(i) + (1-alpha) * Rbold(i)</span>
<a name="ln-6426"></a><span class="c">!      Rf(i) = alpha * Rf(i) + (1-alpha) * Rfold(i)</span>
<a name="ln-6427"></a><span class="c">!    end do</span>
<a name="ln-6428"></a><span class="c">!</span>
<a name="ln-6429"></a><span class="c">!    return</span>
<a name="ln-6430"></a><span class="c">!  end subroutine picard</span>
<a name="ln-6431"></a>
<a name="ln-6432"></a>  <span class="k">subroutine </span><span class="n">adjusthhat</span><span class="p">(</span><span class="n">SDLayerIndex</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-6433"></a>                     <span class="n">thick</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6434"></a>                     <span class="nb">index</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">hgas</span><span class="p">,</span> <span class="n">hhat</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6435"></a>
<a name="ln-6436"></a>    <span class="c">!********************************************************************</span>
<a name="ln-6437"></a>    <span class="c">!  Modifies hhat, hgas coefficients around SD layers</span>
<a name="ln-6438"></a>    <span class="c">!********************************************************************</span>
<a name="ln-6439"></a>
<a name="ln-6440"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SDLayerIndex</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="nb">index</span>
<a name="ln-6441"></a><span class="nb">    </span><span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ibc</span>
<a name="ln-6442"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>
<a name="ln-6443"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>
<a name="ln-6444"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wght</span>
<a name="ln-6445"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span>
<a name="ln-6446"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">tilt</span>
<a name="ln-6447"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-6448"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span>
<a name="ln-6449"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>
<a name="ln-6450"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">SDScalar</span>
<a name="ln-6451"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span>
<a name="ln-6452"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>
<a name="ln-6453"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Ebb</span>
<a name="ln-6454"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hgas</span>
<a name="ln-6455"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hhat</span>
<a name="ln-6456"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-6457"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span>
<a name="ln-6458"></a>
<a name="ln-6459"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hc_NOSD</span><span class="p">,</span> <span class="n">hc_0</span><span class="p">,</span> <span class="n">hc_1</span><span class="p">,</span> <span class="n">hc_alpha</span><span class="p">,</span> <span class="n">hhat_alpha</span>
<a name="ln-6460"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hc_1_1</span><span class="p">,</span> <span class="n">hc_1_2</span><span class="p">,</span> <span class="n">hc_alpha1</span><span class="p">,</span> <span class="n">hc_alpha2</span><span class="p">,</span> <span class="n">hhat_alpha1</span><span class="p">,</span> <span class="n">hhat_alpha2</span>
<a name="ln-6461"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frctg</span>
<a name="ln-6462"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span>
<a name="ln-6463"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ipropg</span>
<a name="ln-6464"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tmean</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">delt</span><span class="p">,</span> <span class="n">gap_NOSD</span><span class="p">,</span> <span class="n">rayl</span><span class="p">,</span> <span class="n">asp</span><span class="p">,</span> <span class="n">gnu</span>
<a name="ln-6465"></a>
<a name="ln-6466"></a>
<a name="ln-6467"></a>    <span class="c">!bi...  Step 1: Calculate hc as if there was no SD here</span>
<a name="ln-6468"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">SDLayerIndex</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6469"></a>      <span class="c">!car    SD is the first layer (outdoor)</span>
<a name="ln-6470"></a>      <span class="c">! calc hc_0 as hcout:</span>
<a name="ln-6471"></a>      <span class="c">! convective outdoor film coeff:</span>
<a name="ln-6472"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6473"></a><span class="k">        call </span><span class="n">film</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">wso</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">hc_NOSD</span><span class="p">,</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6474"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6475"></a><span class="k">        </span><span class="n">hc_NOSD</span> <span class="o">=</span> <span class="n">hout</span><span class="o">-</span><span class="n">hrout</span>
<a name="ln-6476"></a>      <span class="k">else if</span> <span class="p">((</span><span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="nb">index</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6477"></a><span class="k">        </span><span class="n">hc_NOSD</span><span class="o">=</span><span class="n">hout</span>
<a name="ln-6478"></a>      <span class="k">end if</span>
<a name="ln-6479"></a><span class="k">      if</span> <span class="p">(</span><span class="n">hc_NOSD</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6480"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-6481"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Hcout is out of range.&#39;</span>
<a name="ln-6482"></a>        <span class="k">return</span>
<a name="ln-6483"></a><span class="k">      end if</span>
<a name="ln-6484"></a><span class="k">      </span><span class="n">hc_0</span> <span class="o">=</span> <span class="n">hc_NOSD</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">tout</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-6485"></a>      <span class="n">hc_1</span> <span class="o">=</span> <span class="n">hgas</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-6486"></a>      <span class="n">hc_alpha</span> <span class="o">=</span> <span class="n">SDScalar</span><span class="o">*</span><span class="p">(</span><span class="n">hc_1</span> <span class="o">-</span> <span class="n">hc_0</span><span class="p">)</span> <span class="o">+</span> <span class="n">hc_0</span>
<a name="ln-6487"></a>      <span class="n">hhat_alpha</span> <span class="o">=</span> <span class="n">hc_alpha</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ebf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">Ebb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6488"></a>
<a name="ln-6489"></a>      <span class="n">hgas</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">hc_alpha</span>
<a name="ln-6490"></a>      <span class="n">hhat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">hhat_alpha</span>
<a name="ln-6491"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">SDLayerIndex</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6492"></a>      <span class="c">!car    SD is the last layer (indoor)</span>
<a name="ln-6493"></a>      <span class="c">! calc hc_0 as hcin:</span>
<a name="ln-6494"></a>      <span class="c">! convective indoor film coeff:</span>
<a name="ln-6495"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6496"></a><span class="k">        call </span><span class="n">filmi</span><span class="p">(</span><span class="n">tind</span><span class="p">,</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6497"></a>                    <span class="n">hc_NOSD</span><span class="p">,</span> <span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6498"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6499"></a><span class="k">        </span><span class="n">hc_NOSD</span> <span class="o">=</span> <span class="n">hin</span><span class="o">-</span><span class="n">hrin</span>
<a name="ln-6500"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">2.</span><span class="nb">and</span><span class="p">.</span><span class="nb">index</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6501"></a><span class="k">        </span><span class="n">hc_NOSD</span> <span class="o">=</span> <span class="n">hin</span>
<a name="ln-6502"></a>      <span class="k">end if</span>
<a name="ln-6503"></a><span class="k">      if</span> <span class="p">(</span><span class="n">hc_NOSD</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6504"></a><span class="k">        </span><span class="n">nperr</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-6505"></a>        <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Hcin is out of range.&#39;</span>
<a name="ln-6506"></a>        <span class="k">return</span>
<a name="ln-6507"></a><span class="k">      end if</span>
<a name="ln-6508"></a>      <span class="c">!    hgas(2*nlayer+1) = hcin</span>
<a name="ln-6509"></a>      <span class="n">hc_0</span> <span class="o">=</span> <span class="n">hc_NOSD</span><span class="o">*</span><span class="p">(</span><span class="n">tind</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-6510"></a>      <span class="n">hc_1</span> <span class="o">=</span> <span class="n">hgas</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6511"></a>      <span class="n">hc_alpha</span> <span class="o">=</span> <span class="n">SDScalar</span><span class="o">*</span><span class="p">(</span><span class="n">hc_1</span> <span class="o">-</span> <span class="n">hc_0</span><span class="p">)</span> <span class="o">+</span> <span class="n">hc_0</span>
<a name="ln-6512"></a>      <span class="n">hhat_alpha</span> <span class="o">=</span> <span class="n">hc_alpha</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ebf</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span><span class="o">-</span><span class="n">Ebb</span><span class="p">(</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6513"></a>
<a name="ln-6514"></a>      <span class="n">hgas</span><span class="p">(</span><span class="n">nlayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hc_alpha</span>
<a name="ln-6515"></a>      <span class="n">hhat</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hhat_alpha</span>
<a name="ln-6516"></a>    <span class="k">else</span>
<a name="ln-6517"></a>      <span class="c">!car     SD is in between glazing</span>
<a name="ln-6518"></a>      <span class="c">!  calc hc_NOSD as hcgas:</span>
<a name="ln-6519"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">SDLayerIndex</span><span class="o">-</span><span class="mi">2</span>
<a name="ln-6520"></a>      <span class="n">k</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-6521"></a>      <span class="c">! determine the gas properties for this &quot;gap&quot;:</span>
<a name="ln-6522"></a>      <span class="n">tmean</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-6523"></a>      <span class="n">delt</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<a name="ln-6524"></a>      <span class="n">i</span> <span class="o">=</span> <span class="n">SDLayerIndex</span>
<a name="ln-6525"></a>      <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6526"></a>        <span class="n">ipropg</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">iprop</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
<a name="ln-6527"></a>        <span class="n">frctg</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">frct</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
<a name="ln-6528"></a>      <span class="k">end do</span>
<a name="ln-6529"></a><span class="k">      call </span><span class="n">gasses90</span><span class="p">(</span><span class="n">tmean</span><span class="p">,</span> <span class="n">ipropg</span><span class="p">,</span> <span class="n">frctg</span><span class="p">,</span> <span class="n">presure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">nmix</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">visc</span><span class="p">,</span> <span class="n">dens</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6530"></a>                    <span class="n">ISO15099</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6531"></a>      <span class="n">gap_NOSD</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">SDLayerIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">gap</span><span class="p">(</span><span class="n">SDLayerIndex</span><span class="p">)</span> <span class="o">+</span> <span class="n">thick</span><span class="p">(</span><span class="n">SDLayerIndex</span><span class="p">)</span>
<a name="ln-6532"></a>      <span class="c">! determine the Rayleigh number:</span>
<a name="ln-6533"></a>      <span class="n">rayl</span> <span class="o">=</span> <span class="n">GravityConstant</span> <span class="o">*</span> <span class="n">gap_NOSD</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">delt</span><span class="o">*</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">dens</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">tmean</span><span class="o">*</span><span class="n">visc</span><span class="o">*</span><span class="n">con</span><span class="p">)</span>
<a name="ln-6534"></a>      <span class="n">asp</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">gap_NOSD</span>
<a name="ln-6535"></a>      <span class="c">! determine the Nusselt number:</span>
<a name="ln-6536"></a>      <span class="k">call </span><span class="n">nusselt</span><span class="p">(</span><span class="n">tilt</span><span class="p">,</span> <span class="n">rayl</span><span class="p">,</span> <span class="n">asp</span><span class="p">,</span> <span class="n">gnu</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-6537"></a>      <span class="c">! calculate effective conductance of the gap</span>
<a name="ln-6538"></a>      <span class="n">hc_NOSD</span> <span class="o">=</span> <span class="n">con</span><span class="o">/</span><span class="n">gap_NOSD</span><span class="o">*</span><span class="n">gnu</span>
<a name="ln-6539"></a>      <span class="n">i</span> <span class="o">=</span> <span class="n">SDLayerIndex</span>
<a name="ln-6540"></a>      <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span>
<a name="ln-6541"></a>      <span class="c">!car     changed hc interpolation with temperatures by inverting ratios</span>
<a name="ln-6542"></a>      <span class="c">!car  hc_0_1 = hc_NOSD*abs((theta(2*i-1) - theta(2*i-2))/(theta(2*i+1) - theta(2*i-2)))</span>
<a name="ln-6543"></a>      <span class="c">!car  hc_0_2 = hc_NOSD*abs((theta(2*i+1) - theta(2*i))/(theta(2*i+1) - theta(2*i-2)))</span>
<a name="ln-6544"></a>      <span class="n">hc_1_1</span> <span class="o">=</span> <span class="n">hgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-6545"></a>      <span class="n">hc_1_2</span> <span class="o">=</span> <span class="n">hgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6546"></a>
<a name="ln-6547"></a>      <span class="c">!car    changed how SDscalar interpolation is done.  Instead of hc_0_1 and hc_0_2, hc_NOSD is used</span>
<a name="ln-6548"></a>      <span class="n">hc_alpha1</span> <span class="o">=</span> <span class="n">SDScalar</span><span class="o">*</span><span class="p">(</span><span class="n">hc_1_1</span> <span class="o">-</span> <span class="n">hc_NOSD</span><span class="p">)</span> <span class="o">+</span> <span class="n">hc_NOSD</span>
<a name="ln-6549"></a>      <span class="n">hc_alpha2</span> <span class="o">=</span> <span class="n">SDScalar</span><span class="o">*</span><span class="p">(</span><span class="n">hc_1_2</span> <span class="o">-</span> <span class="n">hc_NOSD</span><span class="p">)</span> <span class="o">+</span> <span class="n">hc_NOSD</span>
<a name="ln-6550"></a>
<a name="ln-6551"></a>      <span class="n">hhat_alpha1</span> <span class="o">=</span> <span class="n">hc_alpha1</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6552"></a>      <span class="n">hhat_alpha2</span> <span class="o">=</span> <span class="n">hc_alpha2</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-6553"></a>
<a name="ln-6554"></a>      <span class="n">hgas</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">hc_alpha1</span>
<a name="ln-6555"></a>      <span class="n">hgas</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hc_alpha2</span>
<a name="ln-6556"></a>      <span class="n">hhat</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hhat_alpha1</span>
<a name="ln-6557"></a>      <span class="n">hhat</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">hhat_alpha2</span>
<a name="ln-6558"></a>    <span class="k">end if</span>
<a name="ln-6559"></a>
<a name="ln-6560"></a><span class="k">  end subroutine </span><span class="n">adjusthhat</span>
<a name="ln-6561"></a>
<a name="ln-6562"></a>  <span class="k">subroutine </span><span class="n">storeIterationResults</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="nb">index</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Tamb</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Troom</span><span class="p">,</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Ebroom</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-6563"></a>              <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">nperr</span><span class="p">)</span>
<a name="ln-6564"></a>
<a name="ln-6565"></a>    <span class="k">use </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">KelvinConv</span>
<a name="ln-6566"></a>
<a name="ln-6567"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>
<a name="ln-6568"></a>    <span class="c">!character*(*), intent(inout) :: ErrorMessage</span>
<a name="ln-6569"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span><span class="p">,</span> <span class="nb">index</span>
<a name="ln-6570"></a><span class="nb">    </span><span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span>
<a name="ln-6571"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Trmout</span><span class="p">,</span> <span class="n">Tamb</span><span class="p">,</span> <span class="n">Trmin</span><span class="p">,</span> <span class="n">Troom</span>
<a name="ln-6572"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebsky</span><span class="p">,</span> <span class="n">Ebroom</span>
<a name="ln-6573"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span>
<a name="ln-6574"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ebb</span><span class="p">,</span> <span class="n">Ebf</span><span class="p">,</span> <span class="n">Rb</span><span class="p">,</span> <span class="n">Rf</span>
<a name="ln-6575"></a>
<a name="ln-6576"></a>    <span class="c">!localy used</span>
<a name="ln-6577"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-6578"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-6579"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-6580"></a>
<a name="ln-6581"></a>    <span class="c">!open(unit=InArgumentsFile,  file=TRIM(DBGD)//&#39;TarcogIterations.dbg&#39;,  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-6582"></a>    <span class="c">!          &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-6583"></a>
<a name="ln-6584"></a>    <span class="c">!if (nperr.ne.0)  open(unit=InArgumentsFile,  file=&#39;TarcogIterations.dbg&#39;,  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-6585"></a>    <span class="c">!          &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-6586"></a>
<a name="ln-6587"></a>    <span class="c">!open(unit=IterationCSV,  file=TRIM(DBGD)//Trim(IterationCSVName),  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-6588"></a>    <span class="c">!          &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-6589"></a>
<a name="ln-6590"></a>    <span class="c">!if (nperr.ne.0)  open(unit=IterationCSV,  file=Trim(IterationCSVName),  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-6591"></a>    <span class="c">!          &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-6592"></a>
<a name="ln-6593"></a>    <span class="c">!open(unit=IterationHHAT,  file=TRIM(DBGD)//Trim(IterationHHATName),  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-6594"></a>    <span class="c">!          &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-6595"></a>
<a name="ln-6596"></a>    <span class="c">!if (nperr.ne.0)  open(unit=IterationHHAT,  file=Trim(IterationHHATName),  status=&#39;unknown&#39;, access=&#39;APPEND&#39;,  &amp;</span>
<a name="ln-6597"></a>    <span class="c">!          &amp;  form=&#39;formatted&#39;, iostat=nperr)</span>
<a name="ln-6598"></a>
<a name="ln-6599"></a>    <span class="c">!write(a,1000) index</span>
<a name="ln-6600"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;*********************************************************************************&#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-6601"></a>        <span class="p">&amp;</span><span class="s1">&#39;****************&quot;)&#39;</span><span class="p">)</span>
<a name="ln-6602"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;Iteration number: &quot;, i5)&#39;</span><span class="p">)</span> <span class="nb">index</span>
<a name="ln-6603"></a>
<a name="ln-6604"></a><span class="nb">    </span><span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;Trmin = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">Trmin</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-6605"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;Troom = &quot;, f12.6)&#39;</span><span class="p">)</span> <span class="n">Troom</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-6606"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;Trmout = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">Trmout</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-6607"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;Tamb = &quot;, f12.6)&#39;</span><span class="p">)</span> <span class="n">Tamb</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-6608"></a>
<a name="ln-6609"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;Ebsky = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">Ebsky</span>
<a name="ln-6610"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;Ebroom = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">Ebroom</span>
<a name="ln-6611"></a>
<a name="ln-6612"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;hcin = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">hcin</span>
<a name="ln-6613"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;hcout = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">hcout</span>
<a name="ln-6614"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;hrin = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">hrin</span>
<a name="ln-6615"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;hrout = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">hrout</span>
<a name="ln-6616"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;hin = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">hin</span>
<a name="ln-6617"></a>    <span class="k">write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="s1">&#39;(&quot;hout = &quot;, f8.4)&#39;</span><span class="p">)</span> <span class="n">hout</span>
<a name="ln-6618"></a>
<a name="ln-6619"></a>    <span class="c">!Write headers for Ebb and Ebf</span>
<a name="ln-6620"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6621"></a>
<a name="ln-6622"></a>      <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c">!this is just to simulate correct integer in brackets</span>
<a name="ln-6623"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6624"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(&quot;&#39;</span>
<a name="ln-6625"></a>      <span class="k">end if</span>
<a name="ln-6626"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6627"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;Ebf(&#39;</span><span class="o">//</span><span class="n">a</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6628"></a>      <span class="k">else</span>
<a name="ln-6629"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;Ebb(&#39;</span><span class="o">//</span><span class="n">a</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6630"></a>      <span class="k">end if</span>
<a name="ln-6631"></a><span class="k">      if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6632"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot;)&#39;</span>
<a name="ln-6633"></a>      <span class="k">else</span>
<a name="ln-6634"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;===&#39;</span>
<a name="ln-6635"></a>      <span class="k">end if</span>
<a name="ln-6636"></a><span class="k">    end do</span>
<a name="ln-6637"></a><span class="k">    write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span>
<a name="ln-6638"></a>
<a name="ln-6639"></a>    <span class="c">!write Ebb and Ebf</span>
<a name="ln-6640"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6641"></a>
<a name="ln-6642"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6643"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(  &#39;</span>
<a name="ln-6644"></a>      <span class="k">end if</span>
<a name="ln-6645"></a><span class="k">      </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;f16.8&#39;</span>
<a name="ln-6646"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6647"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6648"></a>      <span class="k">else</span>
<a name="ln-6649"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;,&quot;   &quot; &#39;</span>
<a name="ln-6650"></a>      <span class="k">end if</span>
<a name="ln-6651"></a><span class="k">    end do</span>
<a name="ln-6652"></a><span class="k">    write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span> <span class="p">(</span><span class="n">Ebf</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Ebb</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-6653"></a>
<a name="ln-6654"></a>    <span class="c">!Write headers for Rb and Rf</span>
<a name="ln-6655"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6656"></a>
<a name="ln-6657"></a>      <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c">!this is just to simulate correct integer in brackets</span>
<a name="ln-6658"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6659"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(&quot;&#39;</span>
<a name="ln-6660"></a>      <span class="k">end if</span>
<a name="ln-6661"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6662"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;Rf(&#39;</span><span class="o">//</span><span class="n">a</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6663"></a>      <span class="k">else</span>
<a name="ln-6664"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;Rb(&#39;</span><span class="o">//</span><span class="n">a</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6665"></a>      <span class="k">end if</span>
<a name="ln-6666"></a><span class="k">      if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6667"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot;)&#39;</span>
<a name="ln-6668"></a>      <span class="k">else</span>
<a name="ln-6669"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;===&#39;</span>
<a name="ln-6670"></a>      <span class="k">end if</span>
<a name="ln-6671"></a><span class="k">    end do</span>
<a name="ln-6672"></a><span class="k">    write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span>
<a name="ln-6673"></a>
<a name="ln-6674"></a>    <span class="c">!write Rb and Rf</span>
<a name="ln-6675"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6676"></a>
<a name="ln-6677"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6678"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(  &#39;</span>
<a name="ln-6679"></a>      <span class="k">end if</span>
<a name="ln-6680"></a><span class="k">      </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;f16.8&#39;</span>
<a name="ln-6681"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6682"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6683"></a>      <span class="k">else</span>
<a name="ln-6684"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;,&quot;   &quot; &#39;</span>
<a name="ln-6685"></a>      <span class="k">end if</span>
<a name="ln-6686"></a><span class="k">    end do</span>
<a name="ln-6687"></a><span class="k">    write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span> <span class="p">(</span><span class="n">Rf</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Rb</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-6688"></a>
<a name="ln-6689"></a>    <span class="c">!Write header for temperatures</span>
<a name="ln-6690"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6691"></a>
<a name="ln-6692"></a>      <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span> <span class="n">i</span>
<a name="ln-6693"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6694"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(&quot;&#39;</span>
<a name="ln-6695"></a>      <span class="k">end if</span>
<a name="ln-6696"></a><span class="k">      </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;theta(&#39;</span><span class="o">//</span><span class="n">a</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6697"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6698"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot;)&#39;</span>
<a name="ln-6699"></a>      <span class="k">else</span>
<a name="ln-6700"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;==&#39;</span>
<a name="ln-6701"></a>      <span class="k">end if</span>
<a name="ln-6702"></a><span class="k">    end do</span>
<a name="ln-6703"></a><span class="k">    write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span>
<a name="ln-6704"></a>
<a name="ln-6705"></a>
<a name="ln-6706"></a>    <span class="c">!write temperatures</span>
<a name="ln-6707"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6708"></a>
<a name="ln-6709"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6710"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(  &#39;</span>
<a name="ln-6711"></a>      <span class="k">end if</span>
<a name="ln-6712"></a><span class="k">      </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;f8.4&#39;</span>
<a name="ln-6713"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6714"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6715"></a>      <span class="k">else</span>
<a name="ln-6716"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;,&quot;   &quot; &#39;</span>
<a name="ln-6717"></a>      <span class="k">end if</span>
<a name="ln-6718"></a><span class="k">    end do</span>
<a name="ln-6719"></a><span class="k">    write</span><span class="p">(</span><span class="n">TarcogIterationsFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-6720"></a>
<a name="ln-6721"></a>    <span class="c">!close(TarcogIterationsFileNumber)</span>
<a name="ln-6722"></a>
<a name="ln-6723"></a>    <span class="c">!write results in csv file</span>
<a name="ln-6724"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6725"></a><span class="k">      </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(&quot;  &#39;</span>
<a name="ln-6726"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6727"></a>        <span class="k">write</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span> <span class="n">i</span> <span class="c">!this is just to simulate correct integer in brackets</span>
<a name="ln-6728"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6729"></a><span class="k">          </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;theta(&#39;</span><span class="o">//</span><span class="n">a</span><span class="o">//</span><span class="s1">&#39;),&#39;</span>
<a name="ln-6730"></a>        <span class="k">else</span>
<a name="ln-6731"></a><span class="k">          </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;theta(&#39;</span><span class="o">//</span><span class="n">a</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6732"></a>        <span class="k">end if</span>
<a name="ln-6733"></a><span class="k">      end do</span>
<a name="ln-6734"></a><span class="k">      </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot;)&#39;</span>
<a name="ln-6735"></a>      <span class="k">write</span><span class="p">(</span><span class="n">IterationCSVFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span>
<a name="ln-6736"></a>    <span class="k">end if</span>
<a name="ln-6737"></a><span class="k">    do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6738"></a>
<a name="ln-6739"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6740"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="s1">&#39;(  &#39;</span>
<a name="ln-6741"></a>      <span class="k">end if</span>
<a name="ln-6742"></a><span class="k">      </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;f8.4&#39;</span>
<a name="ln-6743"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6744"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-6745"></a>      <span class="k">else</span>
<a name="ln-6746"></a><span class="k">        </span><span class="n">dynFormat</span> <span class="o">=</span> <span class="nb">TRIM</span><span class="p">(</span><span class="n">dynFormat</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;,&quot;,   &quot; &#39;</span>
<a name="ln-6747"></a>      <span class="k">end if</span>
<a name="ln-6748"></a><span class="k">    end do</span>
<a name="ln-6749"></a><span class="k">    write</span><span class="p">(</span><span class="n">IterationCSVFileNumber</span><span class="p">,</span> <span class="n">dynFormat</span><span class="p">)</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span>
<a name="ln-6750"></a>
<a name="ln-6751"></a>    <span class="c">!close(IterationCSVFileNumber)</span>
<a name="ln-6752"></a>
<a name="ln-6753"></a>
<a name="ln-6754"></a>  <span class="mi">1000</span>  <span class="k">format</span><span class="p">(</span><span class="n">I3</span><span class="p">)</span>
<a name="ln-6755"></a>  <span class="k">end subroutine </span><span class="n">storeIterationResults</span>
<a name="ln-6756"></a>
<a name="ln-6757"></a>  <span class="k">subroutine </span><span class="n">CalculateFuncResults</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">FRes</span><span class="p">)</span>
<a name="ln-6758"></a>    <span class="c">!calculate balance equations by using temperature solution and estimates stores error in FRes</span>
<a name="ln-6759"></a>    <span class="c">!real(r64), intent(in) :: theta(maxlay2)</span>
<a name="ln-6760"></a>    <span class="c">!real(r64), intent(in) :: R(maxlay2)  ! Radiation on layer surfaces</span>
<a name="ln-6761"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>
<a name="ln-6762"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span>
<a name="ln-6763"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span>
<a name="ln-6764"></a>
<a name="ln-6765"></a>    <span class="c">!integer, intent(out) :: nperr</span>
<a name="ln-6766"></a>    <span class="c">!character*(*), intent(out) :: ErrorMessage</span>
<a name="ln-6767"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">FRes</span>
<a name="ln-6768"></a>
<a name="ln-6769"></a>    <span class="c">!Local variables</span>
<a name="ln-6770"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-6771"></a>
<a name="ln-6772"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6773"></a>      <span class="n">FRes</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span> <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-6774"></a>      <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-6775"></a>        <span class="n">FRes</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">FRes</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-6776"></a>      <span class="k">end do</span>
<a name="ln-6777"></a><span class="k">    end do</span> <span class="c">!do i=1, 4*nlayer</span>
<a name="ln-6778"></a>
<a name="ln-6779"></a>  <span class="k">end subroutine </span><span class="n">CalculateFuncResults</span>
<a name="ln-6780"></a>
<a name="ln-6781"></a><span class="c">!     NOTICE</span>
<a name="ln-6782"></a><span class="c">!</span>
<a name="ln-6783"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-6784"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-6785"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-6786"></a><span class="c">!</span>
<a name="ln-6787"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-6788"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-6789"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-6790"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-6791"></a><span class="c">!</span>
<a name="ln-6792"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-6793"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-6794"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-6795"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-6796"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-6797"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-6798"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-6799"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-6800"></a><span class="c">!     permit others to do so.</span>
<a name="ln-6801"></a><span class="c">!</span>
<a name="ln-6802"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-6803"></a><span class="c">!</span>
<a name="ln-6804"></a>
<a name="ln-6805"></a><span class="k">end module </span><span class="n">ThermalISO15099Calc</span>
<a name="ln-6806"></a>
<a name="ln-6807"></a><span class="k">module </span><span class="n">TARCOGMain</span>
<a name="ln-6808"></a>          <span class="c">! TARCOG: Thermal Analysis Routine for Center of Glazing</span>
<a name="ln-6809"></a>
<a name="ln-6810"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-6811"></a>          <span class="c">!       AUTHOR         D. Charlie Curcija</span>
<a name="ln-6812"></a>          <span class="c">!       DATE WRITTEN   July 2000</span>
<a name="ln-6813"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-6814"></a>          <span class="c">!       RE-ENGINEERED  (see information bellow)</span>
<a name="ln-6815"></a>          <span class="c">!</span>
<a name="ln-6816"></a>          <span class="c">!  Revision: 7.0.13  (March/27/2012), Simon Vidanovic</span>
<a name="ln-6817"></a>          <span class="c">!   - feature: New set of equaitons is set instead of hhat coefficents and new approach to solution which improves</span>
<a name="ln-6818"></a>          <span class="c">!               speed and stability.  Note that this solution does not include laminates</span>
<a name="ln-6819"></a>          <span class="c">!</span>
<a name="ln-6820"></a>          <span class="c">!  Revision: 7.0.12  (March/06/2012), Simon Vidanovic</span>
<a name="ln-6821"></a>          <span class="c">!   - feature: Additional state for isky introduced.  Tarcog now can accept IR radiance from external source.</span>
<a name="ln-6822"></a>          <span class="c">!</span>
<a name="ln-6823"></a>          <span class="c">!  Revision: 7.0.11  (January/04/2012), Simon Vidanovic</span>
<a name="ln-6824"></a>          <span class="c">!   - imrovements/bug fixes: Several items merged from Windows tarcog version into this one:</span>
<a name="ln-6825"></a>          <span class="c">!      - bug fix: Correct foramtting for VacuumMaxGapThickness when program writes input file</span>
<a name="ln-6826"></a>          <span class="c">!      - improvement: Gamma coefficient is now written in scientific notation (needed for correct output file generation)</span>
<a name="ln-6827"></a>          <span class="c">!      - imporvement: Gap data are now saved with higer precision to wincog input file (test purposes, debug mode only)</span>
<a name="ln-6828"></a>          <span class="c">!      - bug fix: Gap temperatures are recalculated within iterations (for thermally driven and forced ventilation)</span>
<a name="ln-6829"></a>          <span class="c">!</span>
<a name="ln-6830"></a>          <span class="c">!  Revision: 7.0.10  (December/15/2011), Simon Vidanovic</span>
<a name="ln-6831"></a>          <span class="c">!   - imrovement: Flag for performing SHGC calculations</span>
<a name="ln-6832"></a>          <span class="c">!</span>
<a name="ln-6833"></a>          <span class="c">!  Revision: 7.0.09  (November/15/2011), Simon Vidanovic</span>
<a name="ln-6834"></a>          <span class="c">!   - imrovement: Added error message tolerance (This is necessary to handle error messages in correct way)</span>
<a name="ln-6835"></a>          <span class="c">!</span>
<a name="ln-6836"></a>          <span class="c">!  Revision: 7.0.08  (November/15/2011), Simon Vidanovic</span>
<a name="ln-6837"></a>          <span class="c">!   - bug fix: Fixed program crashing when warrning message 1007 occured (output could not fit in string)</span>
<a name="ln-6838"></a>          <span class="c">!   - feature: relaxation parameter changed</span>
<a name="ln-6839"></a>          <span class="c">!</span>
<a name="ln-6840"></a>          <span class="c">!  Revision: 7.0.07  (November/08/2011), Simon Vidanovic</span>
<a name="ln-6841"></a>          <span class="c">!   - feature: Error message (as string) is now return from tarcog</span>
<a name="ln-6842"></a>          <span class="c">!</span>
<a name="ln-6843"></a>          <span class="c">!  Revision: 7.0.06  (November/07/2011), Simon Vidanovic</span>
<a name="ln-6844"></a>          <span class="c">!   - bug fix: Error report now actually use passed VacuumMaxGapThickness value</span>
<a name="ln-6845"></a>          <span class="c">!</span>
<a name="ln-6846"></a>          <span class="c">!  Revision: 7.0.05  (November/07/2011), Simon Vidanovic</span>
<a name="ln-6847"></a>          <span class="c">!   - bug fix: Troom and Tamb are not passed out of hhat routine after recalculation is performed.</span>
<a name="ln-6848"></a>          <span class="c">!              This will cause differences in calculation of U-factor</span>
<a name="ln-6849"></a>          <span class="c">!   - feature: VacuumMaxGapThickness is added to list of input paramters</span>
<a name="ln-6850"></a>          <span class="c">!</span>
<a name="ln-6851"></a>          <span class="c">!  Revision: 7.0.04  (November/03/2011), Simon Vidanovic</span>
<a name="ln-6852"></a>          <span class="c">!   - bug fix: one of debug files did not update properly</span>
<a name="ln-6853"></a>          <span class="c">!</span>
<a name="ln-6854"></a>          <span class="c">!  Revision: 7.0.03  (November/01/2011), Simon Vidanovic</span>
<a name="ln-6855"></a>          <span class="c">!   - tarcog will now exit if error code is in range from 2000 to 3000</span>
<a name="ln-6856"></a>          <span class="c">!   - tarcog now accepts file name which is template for debug output files creation</span>
<a name="ln-6857"></a>          <span class="c">!   - temperature correction added in case temperatures on the layers are equal</span>
<a name="ln-6858"></a>          <span class="c">!     which in case of energy calculation will give division with zero</span>
<a name="ln-6859"></a>          <span class="c">!   - iteration results now can be saved in the file (just for debugging purposes)</span>
<a name="ln-6860"></a>          <span class="c">!</span>
<a name="ln-6861"></a>          <span class="c">!  Revision: 7.0.02  (October/10/2011), Simon Vidanovic</span>
<a name="ln-6862"></a>          <span class="c">!   - Deflection calculations implemented.</span>
<a name="ln-6863"></a>          <span class="c">!</span>
<a name="ln-6864"></a>          <span class="c">!  Revision: 7.0.01  (September/23/2011), Simon Vidanovic</span>
<a name="ln-6865"></a>          <span class="c">!   - Support pillars implemented.</span>
<a name="ln-6866"></a>          <span class="c">!</span>
<a name="ln-6867"></a>          <span class="c">!  Revision: 7.0.00  (August/23/2011), Simon Vidanovic</span>
<a name="ln-6868"></a>          <span class="c">!   - Added comments to input arguments; Fixed bug in Nu calculation for angle between 60 and 90 degrees.</span>
<a name="ln-6869"></a>          <span class="c">!</span>
<a name="ln-6870"></a>          <span class="c">!  Revision: 6.0.36  (June/22/2010)</span>
<a name="ln-6871"></a>          <span class="c">!   - Converted to F95; refactoring.</span>
<a name="ln-6872"></a>          <span class="c">!</span>
<a name="ln-6873"></a>          <span class="c">!  Revision: 6.0.35  (June/4/2010)</span>
<a name="ln-6874"></a>          <span class="c">!   - Fixed a few potential bugs</span>
<a name="ln-6875"></a>          <span class="c">!</span>
<a name="ln-6876"></a>          <span class="c">!  Revision: 6.0.34  (May/26/2009)</span>
<a name="ln-6877"></a>          <span class="c">!   - Updated creation of W6 debug file (added ClosedBlind flag)</span>
<a name="ln-6878"></a>          <span class="c">!</span>
<a name="ln-6879"></a>          <span class="c">!  Revision: 6.0.33  (March/03/2008)</span>
<a name="ln-6880"></a>          <span class="c">!   - Fixed a bug in arguments checking.</span>
<a name="ln-6881"></a>          <span class="c">!   - Added creation of WINCOG input file in debug mode.</span>
<a name="ln-6882"></a>          <span class="c">!</span>
<a name="ln-6883"></a>          <span class="c">!  Revision: 6.0.32  (February/29/2008)</span>
<a name="ln-6884"></a>          <span class="c">!   - Applied CSM thermal model to Woven Shades layers.</span>
<a name="ln-6885"></a>          <span class="c">!   - Introduced a new error message (#39)</span>
<a name="ln-6886"></a>          <span class="c">!</span>
<a name="ln-6887"></a>          <span class="c">!  Revision: 6.0.31  (February/15/2008)</span>
<a name="ln-6888"></a>          <span class="c">!   - EN673 Design and Declared standards added/fixed (it used to be EN673 and ISO 10292).</span>
<a name="ln-6889"></a>          <span class="c">!</span>
<a name="ln-6890"></a>          <span class="c">!  Revision: 6.0.30  (May/05/2007)</span>
<a name="ln-6891"></a>          <span class="c">!   - Scalar model (CSM) fixed.</span>
<a name="ln-6892"></a>          <span class="c">!</span>
<a name="ln-6893"></a>          <span class="c">!  Revision: 6.0.29  (September/14/2006)</span>
<a name="ln-6894"></a>          <span class="c">!   - Fixed a bug in CSM calculation that affected some cases.</span>
<a name="ln-6895"></a>          <span class="c">!</span>
<a name="ln-6896"></a>          <span class="c">!  Revision: 6.0.28  (September/05/2006)</span>
<a name="ln-6897"></a>          <span class="c">!   - Woven Shade layer type introduced. These layers will be treated</span>
<a name="ln-6898"></a>          <span class="c">!    the same way as Venetian Blind layers.</span>
<a name="ln-6899"></a>          <span class="c">!</span>
<a name="ln-6900"></a>          <span class="c">!  Revision: 6.0.27  (August/24/2006)</span>
<a name="ln-6901"></a>          <span class="c">!   - Implemented new thermal model (thermal model 2 - Convection Scalar Model)</span>
<a name="ln-6902"></a>          <span class="c">!   - Added new input argument - SDScalar:</span>
<a name="ln-6903"></a>          <span class="c">!      0.0  - No SD (in terms of convection)</span>
<a name="ln-6904"></a>          <span class="c">!      1.0  - Closed SD (SD treated as a &#39;regular&#39; specular layer)</span>
<a name="ln-6905"></a>          <span class="c">!      between 0 and 1 - cobination of No SD and Closed SD cases</span>
<a name="ln-6906"></a>          <span class="c">!   - A bug in unshaded run (remapping gas properties in removal of indoor SD layer) was fixed</span>
<a name="ln-6907"></a>          <span class="c">!   - TARCOG error codes have been updated (error codes 30 and 37 added)</span>
<a name="ln-6908"></a>          <span class="c">!</span>
<a name="ln-6909"></a>          <span class="c">!  Revision: 6.0.26  (May/31/2006)</span>
<a name="ln-6910"></a>          <span class="c">!   - Hard-coded Xenon gas properties for EN673 were updated.</span>
<a name="ln-6911"></a>          <span class="c">!   - hrin equation in EN673 routine was updated.</span>
<a name="ln-6912"></a>          <span class="c">!</span>
<a name="ln-6913"></a>          <span class="c">!  Revision: 6.0.25  (March/29/2006)</span>
<a name="ln-6914"></a>          <span class="c">!   - Bug fixes in EN673/ISO10292 procedure:</span>
<a name="ln-6915"></a>          <span class="c">!    .values of gas properties for EN673 and ISO10292 procedure can now be passed to TARCOG</span>
<a name="ln-6916"></a>          <span class="c">!     via A coefficients in gvis, gcon and gcp matrices and wght array</span>
<a name="ln-6917"></a>          <span class="c">!    .gas mixture buid-up limited to number of gasses used in the mix</span>
<a name="ln-6918"></a>          <span class="c">!    .dT array is now updated correctly after each iteration</span>
<a name="ln-6919"></a>          <span class="c">!    .hrin formula fixed</span>
<a name="ln-6920"></a>          <span class="c">!   - Bug fix (checking of slat tilt angle - negative values are now allowed)</span>
<a name="ln-6921"></a>          <span class="c">!</span>
<a name="ln-6922"></a>          <span class="c">!  Revision: 6.0.24  (November/25/2005)</span>
<a name="ln-6923"></a>          <span class="c">!   - Code responsible for ETR calculation (in U factor calculation)</span>
<a name="ln-6924"></a>          <span class="c">!    has been redesigned and cleared of all bugs.</span>
<a name="ln-6925"></a>          <span class="c">!</span>
<a name="ln-6926"></a>          <span class="c">!  Revision: 6.0.23  (November/24/2005)</span>
<a name="ln-6927"></a>          <span class="c">!   - Bug fix (wrong U factor results for IGUs with one glass + indoor SD)</span>
<a name="ln-6928"></a>          <span class="c">!   - Bug fix (wrong results for Hc modification ratios)</span>
<a name="ln-6929"></a>          <span class="c">!    when fixed H or fixed Hc model is used.</span>
<a name="ln-6930"></a>          <span class="c">!   - Allowed DiffuseShade as layer type (does not affect calculation algorithm).</span>
<a name="ln-6931"></a>          <span class="c">!   - hflux value has been updated - includes contribution from freely ventilated air</span>
<a name="ln-6932"></a>          <span class="c">!    around indoor SD layer (this affects SHGC value)</span>
<a name="ln-6933"></a>          <span class="c">!   - Debug file has been updated:</span>
<a name="ln-6934"></a>          <span class="c">!      . qr is shown in each gap,</span>
<a name="ln-6935"></a>          <span class="c">!      . hcgas values have been updated to include contribution from freely ventilated air</span>
<a name="ln-6936"></a>          <span class="c">!        around SD layers (this affects output argument as well),</span>
<a name="ln-6937"></a>          <span class="c">!      . hrgas values have been introduced in debug file.</span>
<a name="ln-6938"></a>          <span class="c">!</span>
<a name="ln-6939"></a>          <span class="c">!  Revision: 6.0.22  (November/04/2005)</span>
<a name="ln-6940"></a>          <span class="c">!   - Added an internal &quot;unshaded&quot; calculation run for glazing systems with</span>
<a name="ln-6941"></a>          <span class="c">!     outdoor and/or indoor SD layer(s). This run is needed for proper calculation</span>
<a name="ln-6942"></a>          <span class="c">!     of Hc modification ratios.</span>
<a name="ln-6943"></a>          <span class="c">!   - Added two new output arguments needed for connection with T6:</span>
<a name="ln-6944"></a>          <span class="c">!      HcUnshadedOut,</span>
<a name="ln-6945"></a>          <span class="c">!      HcUnshadeIn.</span>
<a name="ln-6946"></a>          <span class="c">!   - Changed the way ShadeHcRatioOut and ShadeHcRatioIn are caculated.</span>
<a name="ln-6947"></a>          <span class="c">!</span>
<a name="ln-6948"></a>          <span class="c">!  Revision: 6.0.21  (October/28/2005)</span>
<a name="ln-6949"></a>          <span class="c">!   - Fixed another serious bug in new routine for calculation of U factor.</span>
<a name="ln-6950"></a>          <span class="c">!</span>
<a name="ln-6951"></a>          <span class="c">!  Revision: 6.0.20  (October/20/2005)</span>
<a name="ln-6952"></a>          <span class="c">!   - Fixed a bug in new calculation of U factor.</span>
<a name="ln-6953"></a>          <span class="c">!   - Fixed a bug in formulas for calculation of SD thickness.</span>
<a name="ln-6954"></a>          <span class="c">!   - Forced ventilation calc has been disabled (since v6.0.19)</span>
<a name="ln-6955"></a>          <span class="c">!</span>
<a name="ln-6956"></a>          <span class="c">!  Revision: 6.0.19  (October/19/2005)</span>
<a name="ln-6957"></a>          <span class="c">!   - New input arguments added:</span>
<a name="ln-6958"></a>          <span class="c">!      SlatThick, SlatWidth, SlatAngle, SlatCond, SlatSpacing, SlatCurve, ThermalMod.</span>
<a name="ln-6959"></a>          <span class="c">!   - Argument gltype renamed to LayerType.</span>
<a name="ln-6960"></a>          <span class="c">!   - Thermal_model_1 implemented</span>
<a name="ln-6961"></a>          <span class="c">!   - U factor calculation has been updated.</span>
<a name="ln-6962"></a>          <span class="c">!   - Description of arguments has been updated.</span>
<a name="ln-6963"></a>          <span class="c">!   - Forced ventilation calc has been disabled.</span>
<a name="ln-6964"></a>          <span class="c">!</span>
<a name="ln-6965"></a>          <span class="c">!  Revision: 6.0.18  (September/16/2005)</span>
<a name="ln-6966"></a>          <span class="c">!   - Changed Tvent for outdoor and indoor SD layers to Tout and Tin, respectivelly.</span>
<a name="ln-6967"></a>          <span class="c">!   - Keff is now calculated for each gap.</span>
<a name="ln-6968"></a>          <span class="c">!</span>
<a name="ln-6969"></a>          <span class="c">!  Revision: 6.0.17  (September/08/2005)</span>
<a name="ln-6970"></a>          <span class="c">!   - Fixed a bug involving Al, Ar &amp; Ah values (patch for a case of Al+Ar+Ah = 0).</span>
<a name="ln-6971"></a>          <span class="c">!</span>
<a name="ln-6972"></a>          <span class="c">!  Revision: 6.0.16  (September/07/2005)</span>
<a name="ln-6973"></a>          <span class="c">!   - Added new output arguments needed for connection with T6:</span>
<a name="ln-6974"></a>          <span class="c">!      ShadeEmisRatioOut,</span>
<a name="ln-6975"></a>          <span class="c">!      ShadeEmisRatioIn,</span>
<a name="ln-6976"></a>          <span class="c">!      ShadeHcRatioOut,</span>
<a name="ln-6977"></a>          <span class="c">!      ShadeHcRatioIn,</span>
<a name="ln-6978"></a>          <span class="c">!      Keff,</span>
<a name="ln-6979"></a>          <span class="c">!      ShadeGapKeffConv</span>
<a name="ln-6980"></a>          <span class="c">!</span>
<a name="ln-6981"></a>          <span class="c">!  Revision: 6.0.15  (August/30/2005)</span>
<a name="ln-6982"></a>          <span class="c">!   - Removed CHDIR call; used filepath//filename instead.</span>
<a name="ln-6983"></a>          <span class="c">!</span>
<a name="ln-6984"></a>          <span class="c">!  Revision: 6.0.14  (August/26/2005)</span>
<a name="ln-6985"></a>          <span class="c">!   - New arguments introduced:</span>
<a name="ln-6986"></a>          <span class="c">!      Debug_dir  - character array: target directory for debug output</span>
<a name="ln-6987"></a>          <span class="c">!      Window_ID  - integer: window ID (from W6)</span>
<a name="ln-6988"></a>          <span class="c">!      IGU_ID  - integer: IGU ID (from W6)</span>
<a name="ln-6989"></a>          <span class="c">!</span>
<a name="ln-6990"></a>          <span class="c">!  Revision: 6.0.13  (August/19/2005)</span>
<a name="ln-6991"></a>          <span class="c">!   - Bug fix #9 - allows calculations for Atop=Abot=0, by setting both values to 1e-6</span>
<a name="ln-6992"></a>          <span class="c">!</span>
<a name="ln-6993"></a>          <span class="c">!  Revision: 6.0.12  (August/12/2005)</span>
<a name="ln-6994"></a>          <span class="c">!   - Minor change in Picard coefficients for vented gaps - MaxIter cannot</span>
<a name="ln-6995"></a>          <span class="c">!     be less than 800. This solves issue with theta buffer in Therm1d.</span>
<a name="ln-6996"></a>          <span class="c">!   - Implemented creation of TARCOG debug file w/ i/o arguments/results (Tarcog.dbg)</span>
<a name="ln-6997"></a>          <span class="c">!     (fetaure #8); debug file will be created depending on Debug_mode switch:</span>
<a name="ln-6998"></a>          <span class="c">!      Debug_mode = 0 : debug file will not be created</span>
<a name="ln-6999"></a>          <span class="c">!      Debug_mode = 1 : debug file will be appended</span>
<a name="ln-7000"></a>          <span class="c">!      Debug_mode = 2 : new debug file will be created</span>
<a name="ln-7001"></a>          <span class="c">!   - Bug fix #7- qin result corrected in SHGC run.</span>
<a name="ln-7002"></a>          <span class="c">!</span>
<a name="ln-7003"></a>          <span class="c">!  Revision: 6.0.11  (July/15/2005)</span>
<a name="ln-7004"></a>          <span class="c">!   - Bug fix #4: an issue in original formulas that causes Therm1d</span>
<a name="ln-7005"></a>          <span class="c">!     to fail to converge for in certain cases. Changes were made in Therm1d</span>
<a name="ln-7006"></a>          <span class="c">!     that allow regular calculation outcome in these cases.</span>
<a name="ln-7007"></a>          <span class="c">!</span>
<a name="ln-7008"></a>          <span class="c">!  Revision: 6.0.10  (June/3/2005)</span>
<a name="ln-7009"></a>          <span class="c">!   - Bug fix #00005: added IGU Height in term A in ShadingIn and ShadingEdge</span>
<a name="ln-7010"></a>          <span class="c">!     procedures. This term is used in calculations of free vent air velocity</span>
<a name="ln-7011"></a>          <span class="c">!</span>
<a name="ln-7012"></a>          <span class="c">!  Revision: 6.0.09  (May/16/2005)</span>
<a name="ln-7013"></a>          <span class="c">!   - Bug fix #00001: for fixed combined coef. BC -&gt; Trmout = Tout, Trmin = Tind</span>
<a name="ln-7014"></a>          <span class="c">!</span>
<a name="ln-7015"></a>          <span class="c">!  Revision: 6.0.08  (May/12/2005)</span>
<a name="ln-7016"></a>          <span class="c">!   - Debug flag introduced in Tarcog, Therm1d and dtemp procedures:</span>
<a name="ln-7017"></a>          <span class="c">!     debug info is stored in two files: tarcog.dbg and temps.out</span>
<a name="ln-7018"></a>          <span class="c">!</span>
<a name="ln-7019"></a>          <span class="c">!  Revision: 6.0.07  (April/12/2005)</span>
<a name="ln-7020"></a>          <span class="c">!   - Fixed a bug (#00002) in calculation of</span>
<a name="ln-7021"></a>          <span class="c">!     Picard method coefficients, in Therm1d procedure:</span>
<a name="ln-7022"></a>          <span class="c">!     fixes SD ventilation velocity related calcs.</span>
<a name="ln-7023"></a>          <span class="c">!</span>
<a name="ln-7024"></a>          <span class="c">!  Revision: 6.0.06  (October/22/2004)</span>
<a name="ln-7025"></a>          <span class="c">!   - Fixed a bug in velocity calculations</span>
<a name="ln-7026"></a>          <span class="c">!</span>
<a name="ln-7027"></a>          <span class="c">!  Revision: 6.0.05  (October/01/2004)</span>
<a name="ln-7028"></a>          <span class="c">!   - Changed name from w5cog to TARCOG</span>
<a name="ln-7029"></a>          <span class="c">!   - Changed version numbering</span>
<a name="ln-7030"></a>          <span class="c">!</span>
<a name="ln-7031"></a>          <span class="c">!---------------------------------------------</span>
<a name="ln-7032"></a>          <span class="c">!</span>
<a name="ln-7033"></a>          <span class="c">!  Revision: 5.3.105  (September/07/04)</span>
<a name="ln-7034"></a>          <span class="c">!</span>
<a name="ln-7035"></a>          <span class="c">!   - Changed argument &#39;standard&#39; from string to integer</span>
<a name="ln-7036"></a>          <span class="c">!</span>
<a name="ln-7037"></a>          <span class="c">!  Revision: 5.3.02.03  (January/16/04)</span>
<a name="ln-7038"></a>          <span class="c">!</span>
<a name="ln-7039"></a>          <span class="c">!   - Slice temperatures calculated</span>
<a name="ln-7040"></a>          <span class="c">!   - Write out Nusselt and Rayleigh (in debug mode)</span>
<a name="ln-7041"></a>          <span class="c">!   - sol converted to asol in input format</span>
<a name="ln-7042"></a>          <span class="c">!</span>
<a name="ln-7043"></a>          <span class="c">!  Revision: 5.3.02.02  (11/14/03)</span>
<a name="ln-7044"></a>          <span class="c">!</span>
<a name="ln-7045"></a>          <span class="c">!   - Implemented CEN Standard</span>
<a name="ln-7046"></a>          <span class="c">!</span>
<a name="ln-7047"></a>          <span class="c">!  Revision: 5.3.02.01  (11/06/03)</span>
<a name="ln-7048"></a>          <span class="c">!</span>
<a name="ln-7049"></a>          <span class="c">!   - implemented Laminate procedure</span>
<a name="ln-7050"></a>          <span class="c">!</span>
<a name="ln-7051"></a>          <span class="c">!  Revision: 5.3.01  (09/22/03)</span>
<a name="ln-7052"></a>          <span class="c">!</span>
<a name="ln-7053"></a>          <span class="c">!   - fixed bug in Tgap initial calculation</span>
<a name="ln-7054"></a>          <span class="c">!   - reduce dimension of Tgap</span>
<a name="ln-7055"></a>          <span class="c">!</span>
<a name="ln-7056"></a>          <span class="c">!  Revision: 5.3.00  (08/25/03)</span>
<a name="ln-7057"></a>          <span class="c">!</span>
<a name="ln-7058"></a>          <span class="c">!   - make code more readable and rename version</span>
<a name="ln-7059"></a>          <span class="c">!</span>
<a name="ln-7060"></a>          <span class="c">!  Revision: 6.0.07  (08/10/03)</span>
<a name="ln-7061"></a>          <span class="c">!</span>
<a name="ln-7062"></a>          <span class="c">!   - implemented arrays for ventilation temperature and speed</span>
<a name="ln-7063"></a>          <span class="c">!   - repaired equation 121 in ISO (instead of cos(tilt) now is abs(cos(tilt)))</span>
<a name="ln-7064"></a>          <span class="c">!   - implemented input field for forced ventilation velocity (for all cases)</span>
<a name="ln-7065"></a>          <span class="c">!   - fixed bug in shading edge: coefficients B1, C1 and D1 repaired to calcluate value for gap temperature (not enviroment)</span>
<a name="ln-7066"></a>          <span class="c">!   - fixed bug in routine shading edge: characteristic Height is calculated for gap (not for enviroment)</span>
<a name="ln-7067"></a>          <span class="c">!   - fixed bug in proccesing error messages (this was produced slightly wrong in some cases results)</span>
<a name="ln-7068"></a>          <span class="c">!</span>
<a name="ln-7069"></a>          <span class="c">!  Revision: 6.0.06 rv  (04/22/03)</span>
<a name="ln-7070"></a>          <span class="c">!</span>
<a name="ln-7071"></a>          <span class="c">!   - write out heat flux calculation for shading device panes</span>
<a name="ln-7072"></a>          <span class="c">!   - qv smoothing: make vented heat flux same in adjacent gaps (gaps are divided by shading pane)</span>
<a name="ln-7073"></a>          <span class="c">!   - fixed bug in routine &quot;shadingin&quot;: make that vented heat flow direction is calculated correct, according</span>
<a name="ln-7074"></a>          <span class="c">!     to temeratures in adjecent gaps</span>
<a name="ln-7075"></a>          <span class="c">!</span>
<a name="ln-7076"></a>          <span class="c">!  Revision: 6.0.05  (04/14/03)</span>
<a name="ln-7077"></a>          <span class="c">!</span>
<a name="ln-7078"></a>          <span class="c">!   - implemented &quot;Picard&quot; method in iteration loop</span>
<a name="ln-7079"></a>          <span class="c">!   - number of iterations is increased to 1000</span>
<a name="ln-7080"></a>          <span class="c">!   - alpha coefficient is set to 0.01 (Picard method)</span>
<a name="ln-7081"></a>          <span class="c">!</span>
<a name="ln-7082"></a>          <span class="c">!  Revision: 6.0.04  (03/03/03)</span>
<a name="ln-7083"></a>          <span class="c">!</span>
<a name="ln-7084"></a>          <span class="c">!   - implemented forced ventilation for indoor and outdoor shading devices</span>
<a name="ln-7085"></a>          <span class="c">!   - maximum number of iterations is increased to 100</span>
<a name="ln-7086"></a>          <span class="c">!</span>
<a name="ln-7087"></a>          <span class="c">!  Revision: 6.0.03 (02/25/03)</span>
<a name="ln-7088"></a>          <span class="c">!</span>
<a name="ln-7089"></a>          <span class="c">!   - fixed bug in error message for &quot;nlayer&lt;1&quot;</span>
<a name="ln-7090"></a>          <span class="c">!   - error messages update</span>
<a name="ln-7091"></a>          <span class="c">!   - repaired U-value calculation and Tgap1, Tgap2 calculation for shading inside</span>
<a name="ln-7092"></a>          <span class="c">!   - shading devices implemented</span>
<a name="ln-7093"></a>          <span class="c">!   - error messages and warnings updated and tolerance is decreased to 1e-5</span>
<a name="ln-7094"></a>          <span class="c">!   - write out heat fluxes</span>
<a name="ln-7095"></a>          <span class="c">!   - fixed bug in hrin and hrout calculation</span>
<a name="ln-7096"></a>          <span class="c">!   - fixed bug in nusselt number for gap calculation for angle &gt; 90 degrees</span>
<a name="ln-7097"></a>          <span class="c">!    and new error messages are added</span>
<a name="ln-7098"></a>          <span class="c">!</span>
<a name="ln-7099"></a>          <span class="c">!pr  Revision: 5.13 (01/16/02)</span>
<a name="ln-7100"></a>          <span class="c">!pr</span>
<a name="ln-7101"></a>          <span class="c">!pr   - pi value updated</span>
<a name="ln-7102"></a>          <span class="c">!pr</span>
<a name="ln-7103"></a>          <span class="c">!  Revision: 5.12 (10/27/01)</span>
<a name="ln-7104"></a>          <span class="c">!</span>
<a name="ln-7105"></a>          <span class="c">!   - deleted extra lines in hatter (just cleanup)</span>
<a name="ln-7106"></a>          <span class="c">!</span>
<a name="ln-7107"></a>          <span class="c">!  Revision: 5.11 (10/23/01)</span>
<a name="ln-7108"></a>          <span class="c">!</span>
<a name="ln-7109"></a>          <span class="c">!   - fixed bug in reporting SHGC</span>
<a name="ln-7110"></a>          <span class="c">!</span>
<a name="ln-7111"></a>          <span class="c">!pr  Revision: 5.10 (10/15/01) [Not included here - under testing]</span>
<a name="ln-7112"></a>          <span class="c">!pr</span>
<a name="ln-7113"></a>          <span class="c">!pr  - updated gas properties for Xenon (for EN673 standard)</span>
<a name="ln-7114"></a>          <span class="c">!</span>
<a name="ln-7115"></a>          <span class="c">!pr  Revision: 5.09 (10/12/01) [Not included here - under testing]</span>
<a name="ln-7116"></a>          <span class="c">!pr</span>
<a name="ln-7117"></a>          <span class="c">!pr  - implemented EN673 standard</span>
<a name="ln-7118"></a>          <span class="c">!</span>
<a name="ln-7119"></a>          <span class="c">!  Revision: 5.08 (10/11/01)</span>
<a name="ln-7120"></a>          <span class="c">!</span>
<a name="ln-7121"></a>          <span class="c">!   - corrected reporting for solar conditions</span>
<a name="ln-7122"></a>          <span class="c">!   - corrected array declaration for nmix in filmg</span>
<a name="ln-7123"></a>          <span class="c">!</span>
<a name="ln-7124"></a>          <span class="c">!  Revision: 5.07 (9/21/01) [not included here - under testing]</span>
<a name="ln-7125"></a>          <span class="c">!</span>
<a name="ln-7126"></a>          <span class="c">!   - implemented Laminate procedure</span>
<a name="ln-7127"></a>          <span class="c">!</span>
<a name="ln-7128"></a>          <span class="c">!pr  Revision: 5.06(09/18/00) [not included here - under testing]</span>
<a name="ln-7129"></a>          <span class="c">!pr</span>
<a name="ln-7130"></a>          <span class="c">!pr  - implemented CEN algorithms</span>
<a name="ln-7131"></a>          <span class="c">!</span>
<a name="ln-7132"></a>          <span class="c">! Revised: June, 2001</span>
<a name="ln-7133"></a>          <span class="c">!</span>
<a name="ln-7134"></a>          <span class="c">!   - further implementation of ISO 15099</span>
<a name="ln-7135"></a>          <span class="c">!     * new def. of shgc</span>
<a name="ln-7136"></a>          <span class="c">!     * revised gas constants</span>
<a name="ln-7137"></a>          <span class="c">!     * implemented mean radiant temperature on indoor side</span>
<a name="ln-7138"></a>          <span class="c">!     *</span>
<a name="ln-7139"></a>          <span class="c">!   - cleaned bugs</span>
<a name="ln-7140"></a>          <span class="c">!     * fixed film coefficient didn&#39;t work correctly</span>
<a name="ln-7141"></a>          <span class="c">!   - removed condensation calculations (part of main w5 code now)</span>
<a name="ln-7142"></a>          <span class="c">!   - implemented environmental temperatures</span>
<a name="ln-7143"></a>          <span class="c">!</span>
<a name="ln-7144"></a>          <span class="c">! Revised: January, 2001</span>
<a name="ln-7145"></a>          <span class="c">!</span>
<a name="ln-7146"></a>          <span class="c">!   - revised input format</span>
<a name="ln-7147"></a>          <span class="c">!   - streamlined code</span>
<a name="ln-7148"></a>          <span class="c">!   - implemented dll&#39;s</span>
<a name="ln-7149"></a>          <span class="c">!</span>
<a name="ln-7150"></a>          <span class="c">! Revised: July 2000 (Major revision of the new code)</span>
<a name="ln-7151"></a>          <span class="c">!</span>
<a name="ln-7152"></a>          <span class="c">!   - checked for accuracy, cleaned bunch of bugs</span>
<a name="ln-7153"></a>          <span class="c">!   - implemented gas mixtures</span>
<a name="ln-7154"></a>          <span class="c">!</span>
<a name="ln-7155"></a>          <span class="c">! Initial update of the old &quot;therm&quot; (WINDOW 4.1) code: Around 1998/99</span>
<a name="ln-7156"></a>
<a name="ln-7157"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-7158"></a>          <span class="c">!   Module For Calculation of Thermal Performance Indices For Center</span>
<a name="ln-7159"></a>          <span class="c">!     of Glass According to ISO 15099/ASHRAE SPC142, ISO10292, and EN673</span>
<a name="ln-7160"></a>
<a name="ln-7161"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-7162"></a>          <span class="c">!  Standard ISO 15099/ASHRAE SPC142, ISO10292 and EN673</span>
<a name="ln-7163"></a>
<a name="ln-7164"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-7165"></a>          <span class="c">! ISO 15099/ASHRAE SPC142, ISO10292, EN673, Tarcog technical documentation</span>
<a name="ln-7166"></a>
<a name="ln-7167"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-7168"></a>          <span class="c">! na</span>
<a name="ln-7169"></a>
<a name="ln-7170"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-7171"></a>
<a name="ln-7172"></a>  <span class="k">use </span><span class="n">TarcogOutput</span>
<a name="ln-7173"></a>  <span class="k">use </span><span class="n">TARCOGGassesParams</span>
<a name="ln-7174"></a>  <span class="k">use </span><span class="n">TarcogShading</span>
<a name="ln-7175"></a>  <span class="k">use </span><span class="n">TARCOGArgs</span>
<a name="ln-7176"></a>  <span class="k">use </span><span class="n">ThermalISO15099Calc</span>
<a name="ln-7177"></a>  <span class="k">use </span><span class="n">ThermalEN673Calc</span>
<a name="ln-7178"></a>  <span class="k">use </span><span class="n">TARCOGDeflection</span>
<a name="ln-7179"></a>
<a name="ln-7180"></a>  <span class="k">implicit none</span>
<a name="ln-7181"></a>
<a name="ln-7182"></a><span class="k">  public </span><span class="n">TARCOG90</span>
<a name="ln-7183"></a>
<a name="ln-7184"></a>  <span class="k">contains</span>
<a name="ln-7185"></a>
<a name="ln-7186"></a><span class="k">  subroutine </span><span class="n">TARCOG90</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7187"></a>              <span class="n">VacuumMaxGapThickness</span><span class="p">,</span>  <span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">GapDefMax</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7188"></a>              <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7189"></a>              <span class="n">presure</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7190"></a>              <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7191"></a>              <span class="n">theta</span><span class="p">,</span> <span class="n">LayerDef</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">hflux</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcgas</span><span class="p">,</span> <span class="n">hrgas</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7192"></a>              <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">shgct</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7193"></a>              <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span><span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7194"></a>              <span class="n">sumsol</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">he</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="n">Debug_dir</span><span class="p">,</span> <span class="n">Debug_file</span><span class="p">,</span> <span class="n">win_ID</span><span class="p">,</span> <span class="n">igu_ID</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7195"></a>              <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7196"></a>              <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">SHGCCalc</span><span class="p">,</span> <span class="n">NumOfIterations</span><span class="p">)</span>
<a name="ln-7197"></a>
<a name="ln-7198"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-7199"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-7200"></a>
<a name="ln-7201"></a>    <span class="c">!!! function attributes:</span>
<a name="ln-7202"></a>
<a name="ln-7203"></a>    <span class="c">!!! INPUTS:</span>
<a name="ln-7204"></a>
<a name="ln-7205"></a>    <span class="c">!!! General:</span>
<a name="ln-7206"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nlayer</span>  <span class="c">!Number of layers (glass + SD)</span>
<a name="ln-7207"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">width</span>  <span class="c">! Window width</span>
<a name="ln-7208"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">height</span>  <span class="c">! IGU cavity height</span>
<a name="ln-7209"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">heightt</span>  <span class="c">! Window height</span>
<a name="ln-7210"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">standard</span>  <span class="c">! Calculation standard switch:</span>
<a name="ln-7211"></a>                                      <span class="c">!    1 - ISO15099</span>
<a name="ln-7212"></a>                                      <span class="c">!    2 - ISO10292</span>
<a name="ln-7213"></a>                                      <span class="c">!    3 - EN673</span>
<a name="ln-7214"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ThermalMod</span>  <span class="c">! Thermal model:</span>
<a name="ln-7215"></a>                                        <span class="c">!    0 - ISO15099</span>
<a name="ln-7216"></a>                                        <span class="c">!    1 - Thermal model 1</span>
<a name="ln-7217"></a>                                        <span class="c">!    2 - Thermal model 2 (not implemented)</span>
<a name="ln-7218"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_mode</span> <span class="c">! Switch for debug output files:</span>
<a name="ln-7219"></a>                                        <span class="c">!    0 - don&#39;t create debug output files</span>
<a name="ln-7220"></a>                                        <span class="c">!    1 - append results to existing debug output file</span>
<a name="ln-7221"></a>                                        <span class="c">!    2 - store results in new debug output file</span>
<a name="ln-7222"></a>                                        <span class="c">!   3 - save in-between results (in all iterations) to existing debug file</span>
<a name="ln-7223"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SHGCCalc</span>      <span class="c">! SHGC calculation switch:</span>
<a name="ln-7224"></a>                                          <span class="c">!    0 - do not perform SHGC calculations</span>
<a name="ln-7225"></a>                                          <span class="c">!    1 - perform SHGC calculations</span>
<a name="ln-7226"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_dir</span>  <span class="c">! Target directory for debug files</span>
<a name="ln-7227"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Debug_file</span> <span class="c">! File name template for debug files</span>
<a name="ln-7228"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ErrorMessage</span> <span class="c">! To store error message from tarcog execution</span>
<a name="ln-7229"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">win_ID</span>  <span class="c">! ID of window (passed by W6)</span>
<a name="ln-7230"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">igu_ID</span>  <span class="c">! ID of the IGU (passed by W6)</span>
<a name="ln-7231"></a>
<a name="ln-7232"></a>    <span class="c">!!! Environment related:</span>
<a name="ln-7233"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tout</span>    <span class="c">! Outdoor temperature [K]</span>
<a name="ln-7234"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tind</span>    <span class="c">! Indoor temperature [K]</span>
<a name="ln-7235"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">wso</span>    <span class="c">! Outdoor wind speed [m/s]</span>
<a name="ln-7236"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">wsi</span>    <span class="c">! Inside forced air speed [m/s]</span>
<a name="ln-7237"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">dir</span>    <span class="c">! Direct solar radiation [W/m2]</span>
<a name="ln-7238"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">outir</span>  <span class="c">! IR radiance of window&#39;s exterior surround [W/m2]</span>
<a name="ln-7239"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tsky</span>    <span class="c">! Night sky temperature [K]</span>
<a name="ln-7240"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">fclr</span>    <span class="c">! Fraction of sky that is clear</span>
<a name="ln-7241"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">VacuumPressure</span> <span class="c">!maximal pressure for gas to be considered as vacuum</span>
<a name="ln-7242"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">VacuumMaxGapThickness</span> <span class="c">!maximum allowed thickness without producing warning message</span>
<a name="ln-7243"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">totsol</span>  <span class="c">! Total solar transmittance of the IGU</span>
<a name="ln-7244"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tilt</span>    <span class="c">! Window tilt [degrees]</span>
<a name="ln-7245"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iwd</span>  <span class="c">! Wind direction:</span>
<a name="ln-7246"></a>                                  <span class="c">!    0 - windward</span>
<a name="ln-7247"></a>                                  <span class="c">!    1 - leeward</span>
<a name="ln-7248"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">isky</span>  <span class="c">! Flag for sky temperature(Tsky) and sky emittance(esky)</span>
<a name="ln-7249"></a>                                  <span class="c">!    0 - both Tsky and Esky are specified</span>
<a name="ln-7250"></a>                                  <span class="c">!    1 - Tsky specified; esky = 1</span>
<a name="ln-7251"></a>                                  <span class="c">!    2 - Swinbank model for effective sky emittance</span>
<a name="ln-7252"></a>                                  <span class="c">!    3 - IR radiance is provided from external source</span>
<a name="ln-7253"></a>    <span class="c">!integer, intent(in) :: mgas  ! Flag for gas property constants:</span>
<a name="ln-7254"></a>                                  <span class="c">!    0 - gas constants supplied (through gcon, gvis and gcp arrays)</span>
<a name="ln-7255"></a>                                  <span class="c">!    1 - use internal constants; when internal then first index</span>
<a name="ln-7256"></a>                                  <span class="c">!        in gcon, gciv and gcp is:</span>
<a name="ln-7257"></a>                                  <span class="c">!          1 - Air</span>
<a name="ln-7258"></a>                                  <span class="c">!          2 - Argon</span>
<a name="ln-7259"></a>                                  <span class="c">!          3 - Krypton</span>
<a name="ln-7260"></a>                                  <span class="c">!          4 - Xenon</span>
<a name="ln-7261"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span> <span class="n">ibc</span> <span class="c">! Vector of boundary condition flags (ibc(1) - outdoor, ibc(2) - indoor</span>
<a name="ln-7262"></a>                                            <span class="c">!    0 - h to be calculated</span>
<a name="ln-7263"></a>                                            <span class="c">!    1 - combined film coefficient h prescribed</span>
<a name="ln-7264"></a>                                            <span class="c">!    2 - convective film coefficient (hc) prescibed</span>
<a name="ln-7265"></a>                                            <span class="c">! Also used in old algorithms for calculating h, accessible through negative</span>
<a name="ln-7266"></a>                                            <span class="c">! values for flags:</span>
<a name="ln-7267"></a>                                            <span class="c">!    -1 - old SPC142 correlation</span>
<a name="ln-7268"></a>                                            <span class="c">!    -2 - Klems-Yazdanian correlation (applicable to outdoor only)</span>
<a name="ln-7269"></a>                                            <span class="c">!    -3 - Kimura correlation (applicable to outdoor only)</span>
<a name="ln-7270"></a>
<a name="ln-7271"></a>    <span class="c">!!! Layers:</span>
<a name="ln-7272"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerType</span>      <span class="c">! Glazing layer type flag</span>
<a name="ln-7273"></a>                                                             <span class="c">!    0 - Specular layer</span>
<a name="ln-7274"></a>                                                             <span class="c">!    1 - Venetian blind (SD)</span>
<a name="ln-7275"></a>                                                             <span class="c">!    2 - Woven shade (SD) (not implemented)</span>
<a name="ln-7276"></a>                                                             <span class="c">!    3 - Diffuse shade</span>
<a name="ln-7277"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tir</span>        <span class="c">! Vector of IR transmittances of each surface</span>
<a name="ln-7278"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">emis</span>       <span class="c">! Vector of IR emittances of each surface</span>
<a name="ln-7279"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">asol</span>        <span class="c">! Vector of Absorbed solar energy fractions for each layer</span>
<a name="ln-7280"></a>
<a name="ln-7281"></a>    <span class="c">!!! Venetians:</span>
<a name="ln-7282"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Atop</span>        <span class="c">! Vector with areas of top openings - between SD layers and top of</span>
<a name="ln-7283"></a>                                                             <span class="c">! glazing cavity [m2]</span>
<a name="ln-7284"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Abot</span>        <span class="c">! Vector with areas of bottom openings - between SD layers and</span>
<a name="ln-7285"></a>                                                             <span class="c">! bottom of glazing cavity [m2]</span>
<a name="ln-7286"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Al</span>          <span class="c">! Vector with areas of left-hand side openings - between SD layers and</span>
<a name="ln-7287"></a>                                                             <span class="c">! left end of glazing cavity [m2]</span>
<a name="ln-7288"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ar</span>          <span class="c">! Vector of areas of right-hand side openings - between SD layers and</span>
<a name="ln-7289"></a>                                                             <span class="c">! right end of glazing cavity [m2]</span>
<a name="ln-7290"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">Ah</span>          <span class="c">! Vector of total areas of holes for each SD [m2]</span>
<a name="ln-7291"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatThick</span>   <span class="c">! Thickness of the slat material [m]</span>
<a name="ln-7292"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatWidth</span>   <span class="c">! Slat width [m]</span>
<a name="ln-7293"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatAngle</span>   <span class="c">! Slat tilt angle [deg]</span>
<a name="ln-7294"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatCond</span>    <span class="c">! Conductivity of the slat material [W/m.K]</span>
<a name="ln-7295"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatSpacing</span> <span class="c">! Distance between slats [m]</span>
<a name="ln-7296"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">SlatCurve</span>   <span class="c">! Curvature radius of the slat [m]</span>
<a name="ln-7297"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vvent</span>      <span class="c">! Vector of velocities for forced ventilation, for each gap, and for</span>
<a name="ln-7298"></a>                                                             <span class="c">! outdoor and indoor environment [m/s]</span>
<a name="ln-7299"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tvent</span>      <span class="c">! Vector of temperatures of ventilation gas for forced ventilation,</span>
<a name="ln-7300"></a>                                                             <span class="c">! for each gap, and for outdoor and indoor environment</span>
<a name="ln-7301"></a>
<a name="ln-7302"></a>    <span class="c">!!! Laminates:</span>
<a name="ln-7303"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nslice</span>         <span class="c">! Vector of numbers of slices in a laminated glazing layers</span>
<a name="ln-7304"></a>                                                             <span class="c">! (0 - monolithic layer)</span>
<a name="ln-7305"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateA</span>    <span class="c">! Left-hand side array for creating slice equations</span>
<a name="ln-7306"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateB</span>    <span class="c">! Right-hand side array for creating slice equations</span>
<a name="ln-7307"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sumsol</span>       <span class="c">! Array of absorbed solar energy fractions for each laminated</span>
<a name="ln-7308"></a>                                                             <span class="c">! glazing layer [W/m2]</span>
<a name="ln-7309"></a>
<a name="ln-7310"></a>    <span class="c">!!! Gaps:</span>
<a name="ln-7311"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iprop</span>  <span class="c">! Matrix of gas codes - see mgas definition</span>
<a name="ln-7312"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nmix</span>           <span class="c">! Vector of number of gasses in gas mixture of each gap</span>
<a name="ln-7313"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">frct</span> <span class="c">! Matrix of mass percentages in gap mixtures</span>
<a name="ln-7314"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">presure</span>      <span class="c">! Vector of gas pressures in gaps [N/m2]</span>
<a name="ln-7315"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcon</span>      <span class="c">! Matrix of constants for gas conductivity calc</span>
<a name="ln-7316"></a>                                                              <span class="c">!  (A, B, C for max of 10 gasses)</span>
<a name="ln-7317"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgvis</span>      <span class="c">! Matrix of constants for gas dynamic viscosity calc</span>
<a name="ln-7318"></a>                                                              <span class="c">!  (A, B, C for max of 10 gasses)</span>
<a name="ln-7319"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xgcp</span>       <span class="c">! Matrix of constants for gas specific heat calc at constant pressure</span>
<a name="ln-7320"></a>                                                              <span class="c">!  (A, B, C for max of 10 gasses)</span>
<a name="ln-7321"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">xwght</span>         <span class="c">! Vector of Molecular weights for gasses</span>
<a name="ln-7322"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gama</span>          <span class="c">! Vector of spefic heat ration for low pressure calc</span>
<a name="ln-7323"></a>
<a name="ln-7324"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPillar</span>   <span class="c">! Shows whether or not gap have support pillar</span>
<a name="ln-7325"></a>                                                              <span class="c">!   0 - does not have support pillar</span>
<a name="ln-7326"></a>                                                              <span class="c">!   1 - have support pillar</span>
<a name="ln-7327"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span> <span class="c">! Pillar spacing for each gap (used in case there is support pillar)</span>
<a name="ln-7328"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarRadius</span>  <span class="c">! Pillar radius for each gap (used in case there is support pillar)</span>
<a name="ln-7329"></a>
<a name="ln-7330"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SDScalar</span>  <span class="c">! Factor of Venetian SD layer contribution to convection</span>
<a name="ln-7331"></a>                                       <span class="c">! (used in conjunction with Thermal Model 2; otherwise, this value is ignored by TARCOG)</span>
<a name="ln-7332"></a>                                       <span class="c">!  real(r64) value between 0 (SD contribution to convection is neglected) and</span>
<a name="ln-7333"></a>                                       <span class="c">!  1 (SD treated as &quot;closed&quot;  as if it is a glass layer with thermal</span>
<a name="ln-7334"></a>                                       <span class="c">!  properties of SD slat material)</span>
<a name="ln-7335"></a>
<a name="ln-7336"></a>    <span class="c">!Deflection</span>
<a name="ln-7337"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CalcDeflection</span>   <span class="c">! Deflection calculation flag:</span>
<a name="ln-7338"></a>                                            <span class="c">!    0 - no deflection calculations</span>
<a name="ln-7339"></a>                                            <span class="c">!    1 - perform deflection calculation (input is Pressure/Temp)</span>
<a name="ln-7340"></a>                                            <span class="c">!    2 - perform deflection calculation (input is measured deflection)</span>
<a name="ln-7341"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pa</span>             <span class="c">! Atmospheric (outside/inside) pressure (used onlu if CalcDeflection = 1)</span>
<a name="ln-7342"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pini</span>           <span class="c">! Initial presssure at time of fabrication (used only if CalcDeflection = 1)</span>
<a name="ln-7343"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tini</span>           <span class="c">! Initial temperature at time of fabrication (used only if CalcDeflection = 1)</span>
<a name="ln-7344"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">GapDefMax</span>  <span class="c">! Vector of gap widths in deflected state. It will be used as input</span>
<a name="ln-7345"></a>                                                                <span class="c">! if CalcDeflection = 2. In case CalcDeflection = 1 it will return</span>
<a name="ln-7346"></a>                                                                <span class="c">! recalculated gap widths. [m]</span>
<a name="ln-7347"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">YoungsMod</span>   <span class="c">! Youngs Modulus coefficients used in deflection calculations</span>
<a name="ln-7348"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PoissonsRat</span> <span class="c">! Poissons Ratio coefficients used in deflection calculations</span>
<a name="ln-7349"></a>
<a name="ln-7350"></a>    <span class="c">!!!! INPUTS/OUTPUTS:</span>
<a name="ln-7351"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">trmin</span>                     <span class="c">! Indoor mean radiant temperature [K]</span>
<a name="ln-7352"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">esky</span>                      <span class="c">! Effective night sky emittance</span>
<a name="ln-7353"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scon</span>   <span class="c">! Vector of conductivities of each glazing layer  [W/mK]</span>
<a name="ln-7354"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thick</span>  <span class="c">! Vector of glazing layer thicknesses [m]</span>
<a name="ln-7355"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gap</span>    <span class="c">! Vector of gap widths [m]</span>
<a name="ln-7356"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hin</span>                       <span class="c">! Indoor combined film coefficient (if non-zero) [W/m2K]</span>
<a name="ln-7357"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hout</span>                      <span class="c">! Outdoor combined film coefficient (if non-zero) [W/m2K]</span>
<a name="ln-7358"></a>
<a name="ln-7359"></a>      <span class="c">!!! OUTPUTS:</span>
<a name="ln-7360"></a>      <span class="c">!!! Overall:</span>
<a name="ln-7361"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nperr</span>        <span class="c">! Error code</span>
<a name="ln-7362"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NumOfIterations</span>  <span class="c">! Number of iterations for reacing solution</span>
<a name="ln-7363"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span>    <span class="c">! Center of glass U-value [W/m2 K]</span>
<a name="ln-7364"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sc</span>         <span class="c">! Shading Coefficient</span>
<a name="ln-7365"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hflux</span>      <span class="c">! Net heat flux between room and window [W/m2]</span>
<a name="ln-7366"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">shgc</span>       <span class="c">! Solar heat gain coefficient  per ISO 15099</span>
<a name="ln-7367"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">shgct</span>      <span class="c">! Solar heat gain coefficient  per old procedure</span>
<a name="ln-7368"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">he</span>         <span class="c">! External heat transfer coefficient [W/m2 K]  EN673 and ISO 10292 procedure</span>
<a name="ln-7369"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hi</span>         <span class="c">! Internal heat transfer coefficient [W/m2 K]  EN673 and ISO 10292 procedure</span>
<a name="ln-7370"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcin</span>       <span class="c">! Indoor convective surface heat transfer coefficient  [W/m2 K]</span>
<a name="ln-7371"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hrin</span>       <span class="c">! Indoor radiative surface heat transfer coefficient [W/m2 K]</span>
<a name="ln-7372"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcout</span>      <span class="c">! Outdoor convective surface heat transfer coefficient [W/m2 K]</span>
<a name="ln-7373"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hrout</span>      <span class="c">! Outdoor radiative surface heat transfer coefficient [W/m2 K]</span>
<a name="ln-7374"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tamb</span>       <span class="c">! Outdoor environmental temperature [K]</span>
<a name="ln-7375"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">troom</span>      <span class="c">! Indoor environmental temperature [K]</span>
<a name="ln-7376"></a>
<a name="ln-7377"></a>    <span class="c">!!! Layers:</span>
<a name="ln-7378"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">theta</span> <span class="c">! Vector of average temperatures of glazing surfaces [K]</span>
<a name="ln-7379"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">q</span>     <span class="c">! Vector of various heat fluxes [W/m2]</span>
<a name="ln-7380"></a>                                                        <span class="c">! depending on element index:</span>
<a name="ln-7381"></a>                                                        <span class="c">!    1 - qout (heat flux from outer-most glazing surface to outdoor space)</span>
<a name="ln-7382"></a>                                                        <span class="c">!    2*i = qpane(i) (heat flux through i-th glazing layer</span>
<a name="ln-7383"></a>                                                        <span class="c">!    2*i-1 = qgap(i) (heat flux from i-th glazing cavity to indoor-faced</span>
<a name="ln-7384"></a>                                                        <span class="c">!                      surface of the adjacent glazing layer)</span>
<a name="ln-7385"></a>                                                        <span class="c">!    2*nlayer + 1 = qin (heat flux from indoor space to inner-most glazing</span>
<a name="ln-7386"></a>                                                        <span class="c">!                        surface)</span>
<a name="ln-7387"></a>
<a name="ln-7388"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qv</span>       <span class="c">! Vector of heat fluxes to each gap by ventillation [W/m2]</span>
<a name="ln-7389"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Keff</span>      <span class="c">! Vector of keff values for gaps [W/m.K]</span>
<a name="ln-7390"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerDef</span>  <span class="c">! Vector of layers deflection. [m]</span>
<a name="ln-7391"></a>
<a name="ln-7392"></a>    <span class="c">!!! Gaps:</span>
<a name="ln-7393"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hcgas</span>   <span class="c">! Convective part of gap effective conductivity (including in and out)</span>
<a name="ln-7394"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hrgas</span>   <span class="c">! Radiative part of gap effective conductivity (including in and out)</span>
<a name="ln-7395"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hg</span>       <span class="c">! Gas conductance of the glazing cavity [W/m2 K]</span>
<a name="ln-7396"></a>                                                          <span class="c">!      - EN673 and ISO 10292 procedure</span>
<a name="ln-7397"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hr</span>       <span class="c">! Radiation conductance of the glazing cavity [W/m2 K]</span>
<a name="ln-7398"></a>                                                          <span class="c">!      - EN673 and ISO 10292 procedure</span>
<a name="ln-7399"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hs</span>       <span class="c">! Thermal conductance of the glazing cavity [W/m2 K]</span>
<a name="ln-7400"></a>                                                          <span class="c">!      - EN673 and ISO 10292 procedure</span>
<a name="ln-7401"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ra</span>       <span class="c">! Vector of Rayleigh numbers, for each gap</span>
<a name="ln-7402"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Nu</span>       <span class="c">! Vector of Nusselt numbers, for each gap</span>
<a name="ln-7403"></a>
<a name="ln-7404"></a>    <span class="c">!!! Shading related:</span>
<a name="ln-7405"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeEmisRatioOut</span>   <span class="c">! Ratio of modified to glass emissivity at the outermost glazing surface</span>
<a name="ln-7406"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeEmisRatioIn</span>    <span class="c">! Ratio of modified to glass emissivity at the innermost glazing surface</span>
<a name="ln-7407"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeHcRatioOut</span>     <span class="c">! Ratio of modified to unshaded Hc at the outermost glazing surface</span>
<a name="ln-7408"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeHcRatioIn</span>      <span class="c">! Ratio of modified to unshaded Hc at the innermost glazing surface</span>
<a name="ln-7409"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">HcUnshadedOut</span>       <span class="c">! Hc value at outermost glazing surface of an unshaded subsystem [W/m2 K]</span>
<a name="ln-7410"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">HcUnshadedin</span>        <span class="c">! Hc value at innermost glazing surface of an unshaded subsystem [W/m2 K]</span>
<a name="ln-7411"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ShadeGapKeffConv</span>  <span class="c">! Vector of convective keff values for areas above/below</span>
<a name="ln-7412"></a>                                                                     <span class="c">!  SD layers [W/m.K]</span>
<a name="ln-7413"></a>
<a name="ln-7414"></a>    <span class="c">! temporary variables stored between deflection iterations because tarcog need to produce result with exact same</span>
<a name="ln-7415"></a>    <span class="c">! input variables</span>
<a name="ln-7416"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">eskyTemp</span>
<a name="ln-7417"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">trminTemp</span>
<a name="ln-7418"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hinTemp</span>
<a name="ln-7419"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">houtTemp</span>
<a name="ln-7420"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sconTemp</span>
<a name="ln-7421"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thickTemp</span>
<a name="ln-7422"></a>
<a name="ln-7423"></a>    <span class="c">!real(r64), dimension(maxlay) ::  sol ! Vector of Absorbed solar energy for each layer [W/m2] = dir*asol</span>
<a name="ln-7424"></a>
<a name="ln-7425"></a>    <span class="c">!Internaly used</span>
<a name="ln-7426"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>  <span class="c">!used for convergence check in case of deflection calculations</span>
<a name="ln-7427"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">maxlay2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">told</span>
<a name="ln-7428"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CurGap</span>
<a name="ln-7429"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">MaxGap</span><span class="p">)</span> <span class="kd">::</span> <span class="n">GapDefMean</span>
<a name="ln-7430"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtmax</span>
<a name="ln-7431"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-7432"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">counter</span>
<a name="ln-7433"></a>
<a name="ln-7434"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-7435"></a>    <span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="ln-7436"></a>
<a name="ln-7437"></a>    <span class="c">!!! Body of TARCOG90</span>
<a name="ln-7438"></a>
<a name="ln-7439"></a>    <span class="n">he</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7440"></a>    <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7441"></a>    <span class="n">hcin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7442"></a>    <span class="n">hrin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7443"></a>    <span class="n">hcout</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7444"></a>    <span class="n">hrout</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7445"></a>    <span class="n">LayerDef</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7446"></a>    <span class="n">dtmax</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7447"></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-7448"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-7449"></a>    <span class="n">eskyTemp</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7450"></a>    <span class="n">trminTemp</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7451"></a>    <span class="n">hinTemp</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7452"></a>    <span class="n">houtTemp</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7453"></a>    <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Normal Termination&#39;</span>
<a name="ln-7454"></a>
<a name="ln-7455"></a>    <span class="c">!sol = 0.0d0</span>
<a name="ln-7456"></a>    <span class="c">!if (dir.ne.0) then</span>
<a name="ln-7457"></a>    <span class="c">!  do i= 1, nlayer</span>
<a name="ln-7458"></a>    <span class="c">!    sol(i) = dir * asol(i)</span>
<a name="ln-7459"></a>    <span class="c">!  end do</span>
<a name="ln-7460"></a>    <span class="c">!end if</span>
<a name="ln-7461"></a>
<a name="ln-7462"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-7463"></a>      <span class="n">CurGap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-7464"></a>    <span class="k">end do</span>
<a name="ln-7465"></a>
<a name="ln-7466"></a>    <span class="c">!  Prepare common debug variables:</span>
<a name="ln-7467"></a>    <span class="k">call </span><span class="n">PrepDebugFilesAndVariables</span><span class="p">(</span><span class="n">Debug_dir</span><span class="p">,</span> <span class="n">Debug_file</span><span class="p">,</span> <span class="n">Debug_Mode</span><span class="p">,</span> <span class="n">win_ID</span><span class="p">,</span> <span class="n">igu_ID</span><span class="p">,</span> <span class="n">nperr</span><span class="p">)</span>
<a name="ln-7468"></a>
<a name="ln-7469"></a>    <span class="c">! Check input arguments:</span>
<a name="ln-7470"></a>    <span class="n">nperr</span> <span class="o">=</span> <span class="n">ArgCheck</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">tind</span><span class="p">,</span><span class="n">trmin</span><span class="p">,</span><span class="n">wso</span><span class="p">,</span><span class="n">wsi</span><span class="p">,</span><span class="n">dir</span><span class="p">,</span><span class="n">outir</span><span class="p">,</span><span class="n">isky</span><span class="p">,</span><span class="n">tsky</span><span class="p">,</span><span class="n">esky</span><span class="p">,</span><span class="n">fclr</span><span class="p">,</span><span class="n">VacuumPressure</span><span class="p">,</span> <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7471"></a>          <span class="p">&amp;</span> <span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7472"></a>          <span class="p">&amp;</span> <span class="n">gap</span><span class="p">,</span><span class="n">GapDefMax</span><span class="p">,</span><span class="n">thick</span><span class="p">,</span><span class="n">scon</span><span class="p">,</span><span class="n">YoungsMod</span><span class="p">,</span><span class="n">PoissonsRat</span><span class="p">,</span><span class="n">tir</span><span class="p">,</span><span class="n">emis</span><span class="p">,</span><span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7473"></a>          <span class="p">&amp;</span>  <span class="n">tilt</span><span class="p">,</span><span class="n">asol</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">heightt</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">presure</span><span class="p">,</span><span class="n">iprop</span><span class="p">,</span><span class="n">frct</span><span class="p">,</span><span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span><span class="n">gama</span><span class="p">,</span><span class="n">nmix</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7474"></a>          <span class="p">&amp;</span> <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7475"></a>          <span class="p">&amp;</span>  <span class="n">hin</span><span class="p">,</span><span class="n">hout</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7476"></a>          <span class="p">&amp;</span>  <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span><span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7477"></a>          <span class="p">&amp;</span>  <span class="n">sumsol</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-7478"></a>
<a name="ln-7479"></a>    <span class="c">! in case of provided deflected gap widths just store deflected widhts before temperatures calculation</span>
<a name="ln-7480"></a>    <span class="c">! deflections in this case do not depend of temperatures and it should be calculated before to avoid</span>
<a name="ln-7481"></a>    <span class="c">! one extra call of temperatures calculations</span>
<a name="ln-7482"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">CalcDeflection</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">DEFLECTION_CALC_GAP_WIDTHS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7483"></a><span class="k">      call </span><span class="n">PanesDeflection</span><span class="p">(</span><span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7484"></a>          <span class="n">GapDefMax</span><span class="p">,</span> <span class="n">GapDefMean</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span><span class="p">,</span> <span class="n">LayerDef</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-7485"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-7486"></a>        <span class="n">CurGap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">GapDefMean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-7487"></a>      <span class="k">end do</span> <span class="c">!do i = 1, nlayer - 1</span>
<a name="ln-7488"></a>    <span class="k">end if</span>
<a name="ln-7489"></a>
<a name="ln-7490"></a>    <span class="c">! in case of deflection calculation for temperature &amp; pressure input some variables needs to be stored because</span>
<a name="ln-7491"></a>    <span class="c">! Calc_ISO15099 and EN673 routines will change them and for deflection recalculation everything needs to be</span>
<a name="ln-7492"></a>    <span class="c">! called in same way except for changed gap widths</span>
<a name="ln-7493"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">CalcDeflection</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">DEFLECTION_CALC_TEMPERATURE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7494"></a><span class="k">      </span><span class="n">eskyTemp</span> <span class="o">=</span> <span class="n">esky</span>
<a name="ln-7495"></a>      <span class="n">trminTemp</span> <span class="o">=</span> <span class="n">trmin</span>
<a name="ln-7496"></a>      <span class="n">hinTemp</span> <span class="o">=</span> <span class="n">hin</span>
<a name="ln-7497"></a>      <span class="n">houtTemp</span> <span class="o">=</span> <span class="n">hout</span>
<a name="ln-7498"></a>      <span class="n">sconTemp</span> <span class="o">=</span> <span class="n">scon</span>
<a name="ln-7499"></a>      <span class="n">thickTemp</span> <span class="o">=</span> <span class="n">thick</span>
<a name="ln-7500"></a>    <span class="k">end if</span>
<a name="ln-7501"></a>
<a name="ln-7502"></a><span class="k">    if</span> <span class="p">(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7503"></a>
<a name="ln-7504"></a><span class="k">      select case</span> <span class="p">(</span><span class="n">standard</span><span class="p">)</span>
<a name="ln-7505"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">ISO15099</span><span class="p">)</span>
<a name="ln-7506"></a>          <span class="k">call </span><span class="n">Calc_ISO15099</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">tind</span><span class="p">,</span><span class="n">trmin</span><span class="p">,</span><span class="n">wso</span><span class="p">,</span><span class="n">wsi</span><span class="p">,</span><span class="n">dir</span><span class="p">,</span><span class="n">outir</span><span class="p">,</span><span class="n">isky</span><span class="p">,</span><span class="n">tsky</span><span class="p">,</span><span class="n">esky</span><span class="p">,</span><span class="n">fclr</span><span class="p">,</span><span class="n">VacuumPressure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7507"></a>                    <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">CurGap</span><span class="p">,</span><span class="n">thick</span><span class="p">,</span><span class="n">scon</span><span class="p">,</span><span class="n">tir</span><span class="p">,</span><span class="n">emis</span><span class="p">,</span><span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7508"></a>                    <span class="n">tilt</span><span class="p">,</span><span class="n">asol</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">heightt</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">presure</span><span class="p">,</span><span class="n">iprop</span><span class="p">,</span><span class="n">frct</span><span class="p">,</span><span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span><span class="n">gama</span><span class="p">,</span><span class="n">nmix</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7509"></a>                    <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7510"></a>                    <span class="n">theta</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">qv</span><span class="p">,</span><span class="n">ufactor</span><span class="p">,</span><span class="n">sc</span><span class="p">,</span><span class="n">hflux</span><span class="p">,</span><span class="n">hcin</span><span class="p">,</span><span class="n">hcout</span><span class="p">,</span><span class="n">hrin</span><span class="p">,</span><span class="n">hrout</span><span class="p">,</span><span class="n">hin</span><span class="p">,</span><span class="n">hout</span><span class="p">,</span><span class="n">hcgas</span><span class="p">,</span><span class="n">hrgas</span><span class="p">,</span><span class="n">shgc</span><span class="p">,</span><span class="n">nperr</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7511"></a>                    <span class="n">shgct</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">troom</span><span class="p">,</span><span class="n">ibc</span><span class="p">,</span><span class="n">Atop</span><span class="p">,</span><span class="n">Abot</span><span class="p">,</span><span class="n">Al</span><span class="p">,</span><span class="n">Ar</span><span class="p">,</span><span class="n">Ah</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7512"></a>                    <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span><span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7513"></a>                    <span class="n">sumsol</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span><span class="n">Nu</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7514"></a>                    <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7515"></a>                    <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">SHGCCalc</span><span class="p">,</span> <span class="n">NumOfIterations</span><span class="p">)</span>
<a name="ln-7516"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">EN673</span><span class="p">,</span> <span class="n">EN673Design</span><span class="p">)</span>
<a name="ln-7517"></a>          <span class="k">call </span><span class="n">Calc_EN673</span><span class="p">(</span><span class="n">standard</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">CurGap</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7518"></a>                  <span class="p">&amp;</span>  <span class="n">tilt</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7519"></a>                  <span class="p">&amp;</span> <span class="n">theta</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span><span class="n">Nu</span><span class="p">)</span>
<a name="ln-7520"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-7521"></a>      <span class="k">end select</span>
<a name="ln-7522"></a>
<a name="ln-7523"></a><span class="k">    end if</span>
<a name="ln-7524"></a>
<a name="ln-7525"></a>    <span class="c">!Deflection calculations in case of temperature &amp; pressure inputs</span>
<a name="ln-7526"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7527"></a><span class="k">      if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-7528"></a><span class="k">        return</span>
<a name="ln-7529"></a><span class="k">      end if</span>
<a name="ln-7530"></a>
<a name="ln-7531"></a><span class="k">      if</span> <span class="p">(</span><span class="n">CalcDeflection</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">DEFLECTION_CALC_TEMPERATURE</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7532"></a><span class="k">        </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7533"></a>        <span class="k">do while</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">converged</span><span class="p">))</span>
<a name="ln-7534"></a>          <span class="k">call </span><span class="n">PanesDeflection</span><span class="p">(</span><span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7535"></a>            <span class="n">GapDefMax</span><span class="p">,</span> <span class="n">GapDefMean</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span><span class="p">,</span> <span class="n">LayerDef</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">)</span>
<a name="ln-7536"></a>
<a name="ln-7537"></a>          <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-7538"></a><span class="k">            return</span>
<a name="ln-7539"></a><span class="k">          end if</span>
<a name="ln-7540"></a>
<a name="ln-7541"></a>          <span class="c">!store temperatures before new calculations are performed. This is necessary in order to determine</span>
<a name="ln-7542"></a>          <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-7543"></a>            <span class="n">told</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-7544"></a>          <span class="k">end do</span> <span class="c">!do i=1, 2*nlayer</span>
<a name="ln-7545"></a>
<a name="ln-7546"></a>          <span class="c">!before calling thermal calculations, return back old variables</span>
<a name="ln-7547"></a>          <span class="n">esky</span>  <span class="o">=</span> <span class="n">eskyTemp</span>
<a name="ln-7548"></a>          <span class="n">trmin</span> <span class="o">=</span> <span class="n">trminTemp</span>
<a name="ln-7549"></a>          <span class="n">hin</span>   <span class="o">=</span> <span class="n">hinTemp</span>
<a name="ln-7550"></a>          <span class="n">hout</span>  <span class="o">=</span> <span class="n">houtTemp</span>
<a name="ln-7551"></a>          <span class="n">scon</span>  <span class="o">=</span> <span class="n">sconTemp</span>
<a name="ln-7552"></a>          <span class="n">thick</span> <span class="o">=</span> <span class="n">thickTemp</span>
<a name="ln-7553"></a>
<a name="ln-7554"></a>          <span class="c">!after performed deflection recalculate temperatures with new gap widths</span>
<a name="ln-7555"></a>          <span class="k">select case</span> <span class="p">(</span><span class="n">standard</span><span class="p">)</span>
<a name="ln-7556"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">ISO15099</span><span class="p">)</span>
<a name="ln-7557"></a>            <span class="k">call </span><span class="n">Calc_ISO15099</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span><span class="n">iwd</span><span class="p">,</span><span class="n">tout</span><span class="p">,</span><span class="n">tind</span><span class="p">,</span><span class="n">trmin</span><span class="p">,</span><span class="n">wso</span><span class="p">,</span><span class="n">wsi</span><span class="p">,</span><span class="n">dir</span><span class="p">,</span><span class="n">outir</span><span class="p">,</span><span class="n">isky</span><span class="p">,</span><span class="n">tsky</span><span class="p">,</span><span class="n">esky</span><span class="p">,</span><span class="n">fclr</span><span class="p">,</span><span class="n">VacuumPressure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7558"></a>                        <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">GapDefMean</span><span class="p">,</span><span class="n">thick</span><span class="p">,</span><span class="n">scon</span><span class="p">,</span><span class="n">tir</span><span class="p">,</span><span class="n">emis</span><span class="p">,</span><span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7559"></a>                        <span class="n">tilt</span><span class="p">,</span><span class="n">asol</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">heightt</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">presure</span><span class="p">,</span><span class="n">iprop</span><span class="p">,</span><span class="n">frct</span><span class="p">,</span><span class="n">xgcon</span><span class="p">,</span><span class="n">xgvis</span><span class="p">,</span><span class="n">xgcp</span><span class="p">,</span><span class="n">xwght</span><span class="p">,</span><span class="n">gama</span><span class="p">,</span><span class="n">nmix</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7560"></a>                        <span class="n">SupportPillar</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7561"></a>                        <span class="n">theta</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">qv</span><span class="p">,</span><span class="n">ufactor</span><span class="p">,</span><span class="n">sc</span><span class="p">,</span><span class="n">hflux</span><span class="p">,</span><span class="n">hcin</span><span class="p">,</span><span class="n">hcout</span><span class="p">,</span><span class="n">hrin</span><span class="p">,</span><span class="n">hrout</span><span class="p">,</span><span class="n">hin</span><span class="p">,</span><span class="n">hout</span><span class="p">,</span><span class="n">hcgas</span><span class="p">,</span><span class="n">hrgas</span><span class="p">,</span><span class="n">shgc</span><span class="p">,</span><span class="n">nperr</span><span class="p">,</span><span class="n">ErrorMessage</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7562"></a>                        <span class="n">shgct</span><span class="p">,</span><span class="n">tamb</span><span class="p">,</span><span class="n">troom</span><span class="p">,</span><span class="n">ibc</span><span class="p">,</span><span class="n">Atop</span><span class="p">,</span><span class="n">Abot</span><span class="p">,</span><span class="n">Al</span><span class="p">,</span><span class="n">Ar</span><span class="p">,</span><span class="n">Ah</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7563"></a>                        <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span><span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7564"></a>                        <span class="n">sumsol</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span><span class="n">Nu</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7565"></a>                        <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7566"></a>                        <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">SHGCCalc</span><span class="p">,</span> <span class="n">NumOfIterations</span><span class="p">)</span>
<a name="ln-7567"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">EN673</span><span class="p">,</span> <span class="n">EN673Design</span><span class="p">)</span>
<a name="ln-7568"></a>              <span class="k">call </span><span class="n">Calc_EN673</span><span class="p">(</span><span class="n">standard</span><span class="p">,</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">GapDefMean</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-7569"></a>                      <span class="p">&amp;</span>  <span class="n">tilt</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">presure</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="n">xgcon</span><span class="p">,</span> <span class="n">xgvis</span><span class="p">,</span> <span class="n">xgcp</span><span class="p">,</span> <span class="n">xwght</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-7570"></a>                      <span class="p">&amp;</span> <span class="n">theta</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Nu</span><span class="p">)</span>
<a name="ln-7571"></a>            <span class="k">case </span><span class="n">default</span>
<a name="ln-7572"></a>          <span class="k">end select</span> <span class="c">!select case (standard)</span>
<a name="ln-7573"></a>
<a name="ln-7574"></a>          <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">GoAhead</span><span class="p">(</span><span class="n">nperr</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-7575"></a><span class="k">            return</span>
<a name="ln-7576"></a><span class="k">          end if</span>
<a name="ln-7577"></a>
<a name="ln-7578"></a>          <span class="c">!calc error</span>
<a name="ln-7579"></a>          <span class="n">dtmax</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-7580"></a>          <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-7581"></a>            <span class="n">dtmax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">told</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-7582"></a>          <span class="k">end do</span> <span class="c">!do i=1, 2*nlayer</span>
<a name="ln-7583"></a>
<a name="ln-7584"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">dtmax</span> <span class="o">&lt;</span> <span class="n">DeflectionErrorMargin</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7585"></a><span class="k">            </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7586"></a>          <span class="k">end if</span>
<a name="ln-7587"></a><span class="k">          </span><span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-7588"></a>
<a name="ln-7589"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="n">DeflectionMaxIterations</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7590"></a><span class="k">            </span><span class="n">converged</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7591"></a>            <span class="n">nperr</span> <span class="o">=</span> <span class="mi">41</span>  <span class="c">! Deflection calculations failed to converge</span>
<a name="ln-7592"></a>            <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;Deflection calculations failed to converge&#39;</span>
<a name="ln-7593"></a>          <span class="k">end if</span>
<a name="ln-7594"></a><span class="k">        end do</span> <span class="c">!do while (.not.(converged))</span>
<a name="ln-7595"></a>      <span class="k">end if</span> <span class="c">! if ((CalcDeflection.eq.DEFLECTION_CALC_TEMPERATURE).or.(CalcDeflection.eq.DEFLECTION_CALC_GAP_WIDTHS)) then</span>
<a name="ln-7596"></a>    <span class="k">end if</span>  <span class="c">! if (GoAhead(nperr)) then</span>
<a name="ln-7597"></a>
<a name="ln-7598"></a>    <span class="k">call </span><span class="n">FinishDebugOutputFiles</span><span class="p">(</span><span class="n">nperr</span><span class="p">)</span>
<a name="ln-7599"></a>
<a name="ln-7600"></a>  <span class="k">end subroutine </span><span class="n">TARCOG90</span>
<a name="ln-7601"></a><span class="c">!     NOTICE</span>
<a name="ln-7602"></a><span class="c">!</span>
<a name="ln-7603"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-7604"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-7605"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-7606"></a><span class="c">!</span>
<a name="ln-7607"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-7608"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-7609"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-7610"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-7611"></a><span class="c">!</span>
<a name="ln-7612"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-7613"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-7614"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-7615"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-7616"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-7617"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-7618"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-7619"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-7620"></a><span class="c">!     permit others to do so.</span>
<a name="ln-7621"></a><span class="c">!</span>
<a name="ln-7622"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-7623"></a><span class="c">!</span>
<a name="ln-7624"></a>
<a name="ln-7625"></a><span class="k">end module </span><span class="n">TARCOGMain</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>


<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../sourcefile/airflownetworkbalancemanager.f90.html">AirflowNetworkBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html">AirflowNetworkSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiator.f90.html">BaseboardRadiator.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorelectric.f90.html">BaseboardRadiatorElectric.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorsteam.f90.html">BaseboardRadiatorSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorwater.f90.html">BaseboardRadiatorWater.f90</a>

      <a class="list-group-item" href="../sourcefile/branchinputmanager.f90.html">BranchInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/branchnodeconnections.f90.html">BranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/conductiontransferfunctioncalc.f90.html">ConductionTransferFunctionCalc.f90</a>

      <a class="list-group-item" href="../sourcefile/cooltower.f90.html">CoolTower.f90</a>

      <a class="list-group-item" href="../sourcefile/costestimatemanager.f90.html">CostEstimateManager.f90</a>

      <a class="list-group-item" href="../sourcefile/curvemanager.f90.html">CurveManager.f90</a>

      <a class="list-group-item" href="../sourcefile/cvfonlyroutines.f90.html">CVFOnlyRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairflownetwork.f90.html">DataAirflowNetwork.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairloop.f90.html">DataAirLoop.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairsystems.f90.html">DataAirSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchairloopplant.f90.html">DataBranchAirLoopPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchnodeconnections.f90.html">DataBranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/databsdfwindow.f90.html">DataBSDFWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/datacomplexfenestration.f90.html">DataComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/datacontaminantbalance.f90.html">DataContaminantBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconvergparams.f90.html">DataConvergParams.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconversions.f90.html">DataConversions.f90</a>

      <a class="list-group-item" href="../sourcefile/datacostestimate.f90.html">DataCostEstimate.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylighting.f90.html">DataDaylighting.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylightingdevices.f90.html">DataDaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/datadefineequip.f90.html">Datadefineequip.f90</a>

      <a class="list-group-item" href="../sourcefile/datadelight.f90.html">DataDElight.f90</a>

      <a class="list-group-item" href="../sourcefile/dataenvironment.f90.html">DataEnvironment.f90</a>

      <a class="list-group-item" href="../sourcefile/dataequivalentlayerwindow.f90.html">DataEquivalentLayerWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/dataerrortracking.f90.html">DataErrorTracking.f90</a>

      <a class="list-group-item" href="../sourcefile/datagenerators.f90.html">DataGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobalconstants.f90.html">DataGlobalConstants.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobals.f90.html">DataGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalance.f90.html">DataHeatBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalfansys.f90.html">DataHeatBalFanSys.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalsurface.f90.html">DataHeatBalSurface.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvaccontrollers.f90.html">DataHVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvacglobals.f90.html">DataHVACGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datainterfaces.f90.html">DataInterfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/dataipshortcuts.f90.html">DataIPShortCuts.f90</a>

      <a class="list-group-item" href="../sourcefile/dataloopnode.f90.html">DataLoopNode.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalance.f90.html">DataMoistureBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalanceempd.f90.html">DataMoistureBalanceEMPD.f90</a>

      <a class="list-group-item" href="../sourcefile/dataoutputs.f90.html">DataOutputs.f90</a>

      <a class="list-group-item" href="../sourcefile/dataphotovoltaics.f90.html">DataPhotovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplant.f90.html">DataPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplantpipingsystems.f90.html">DataPlantPipingSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/dataprecisionglobals.f90.html">DataPrecisionGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datareportingflags.f90.html">DataReportingFlags.f90</a>

      <a class="list-group-item" href="../sourcefile/dataroomair.f90.html">DataRoomAir.f90</a>

      <a class="list-group-item" href="../sourcefile/datarootfinder.f90.html">DataRootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/dataruntimelanguage.f90.html">DataRuntimeLanguage.f90</a>

      <a class="list-group-item" href="../sourcefile/datashadowingcombinations.f90.html">DataShadowingCombinations.f90</a>

      <a class="list-group-item" href="../sourcefile/datasizing.f90.html">DataSizing.f90</a>

      <a class="list-group-item" href="../sourcefile/datastringglobals.f90.html">DataStringGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacecolors.f90.html">DataSurfaceColors.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacelists.f90.html">DataSurfaceLists.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfaces.f90.html">DataSurfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/datasystemvariables.f90.html">DataSystemVariables.f90</a>

      <a class="list-group-item" href="../sourcefile/datatimings.f90.html">DataTimings.f90</a>

      <a class="list-group-item" href="../sourcefile/dataucsdshareddata.f90.html">DataUCSDSharedData.f90</a>

      <a class="list-group-item" href="../sourcefile/datavectortypes.f90.html">DataVectorTypes.f90</a>

      <a class="list-group-item" href="../sourcefile/dataviewfactorinformation.f90.html">DataViewFactorInformation.f90</a>

      <a class="list-group-item" href="../sourcefile/datawater.f90.html">DataWater.f90</a>

      <a class="list-group-item" href="../sourcefile/datazonecontrols.f90.html">DataZoneControls.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneenergydemands.f90.html">DataZoneEnergyDemands.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneequipment.f90.html">DataZoneEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingdevices.f90.html">DaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingmanager.f90.html">DaylightingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf.f90.html">DElightManagerF.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf_no.f90.html">DElightManagerF_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/demandmanager.f90.html">DemandManager.f90</a>

      <a class="list-group-item" href="../sourcefile/desiccantdehumidifiers.f90.html">DesiccantDehumidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/directair.f90.html">DirectAir.f90</a>

      <a class="list-group-item" href="../sourcefile/displayroutines.f90.html">DisplayRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dxcoil.f90.html">DXCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/earthtube.f90.html">EarthTube.f90</a>

      <a class="list-group-item" href="../sourcefile/economiclifecyclecost.f90.html">EconomicLifeCycleCost.f90</a>

      <a class="list-group-item" href="../sourcefile/economictariff.f90.html">EconomicTariff.f90</a>

      <a class="list-group-item" href="../sourcefile/ecoroof.f90.html">EcoRoof.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowergenerators.f90.html">ElectricPowerGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowermanager.f90.html">ElectricPowerManager.f90</a>

      <a class="list-group-item" href="../sourcefile/emsmanager.f90.html">EMSManager.f90</a>

      <a class="list-group-item" href="../sourcefile/energyplus.f90.html">EnergyPlus.f90</a>

      <a class="list-group-item" href="../sourcefile/exteriorenergyusemanager.f90.html">ExteriorEnergyUseManager.f90</a>

      <a class="list-group-item" href="../sourcefile/externalinterface_no.f90.html">ExternalInterface_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/fancoilunits.f90.html">FanCoilUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/faultsmanager.f90.html">FaultsManager.f90</a>

      <a class="list-group-item" href="../sourcefile/fluidproperties.f90.html">FluidProperties.f90</a>

      <a class="list-group-item" href="../sourcefile/general.f90.html">General.f90</a>

      <a class="list-group-item" href="../sourcefile/generalroutines.f90.html">GeneralRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/globalnames.f90.html">GlobalNames.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceairmanager.f90.html">HeatBalanceAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceconvectioncoeffs.f90.html">HeatBalanceConvectionCoeffs.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancehamtmanager.f90.html">HeatBalanceHAMTManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceinternalheatgains.f90.html">HeatBalanceInternalHeatGains.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceintradexchange.f90.html">HeatBalanceIntRadExchange.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemanager.f90.html">HeatBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemovableinsulation.f90.html">HeatBalanceMovableInsulation.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancesurfacemanager.f90.html">HeatBalanceSurfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalfinitedifferencemanager.f90.html">HeatBalFiniteDifferenceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatrecovery.f90.html">HeatRecovery.f90</a>

      <a class="list-group-item" href="../sourcefile/humidifiers.f90.html">Humidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccontrollers.f90.html">HVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccooledbeam.f90.html">HVACCooledBeam.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdualductsystem.f90.html">HVACDualDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacduct.f90.html">HVACDuct.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdxsystem.f90.html">HVACDXSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacevapcomponent.f90.html">HVACEvapComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfancomponent.f90.html">HVACFanComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfurnace.f90.html">HVACFurnace.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacheatingcoils.f90.html">HVACHeatingCoils.f90</a>

      <a class="list-group-item" href="../sourcefile/hvachxassistedcoolingcoil.f90.html">HVACHXAssistedCoolingCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacinterfacemanager.f90.html">HVACInterfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmanager.f90.html">HVACManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmixercomponent.f90.html">HVACMixerComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmultispeedheatpump.f90.html">HVACMultiSpeedHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductinduc.f90.html">HVACSingleDuctInduc.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductsystem.f90.html">HVACSingleDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsplittercomponent.f90.html">HVACSplitterComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacstandaloneerv.f90.html">HVACStandAloneERV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsteamcoilcomponent.f90.html">HVACSteamCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvactranspiredcollector.f90.html">HVACTranspiredCollector.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarybypassvav.f90.html">HVACUnitaryBypassVAV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarysystem.f90.html">HVACUnitarySystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacvariablerefrigerantflow.f90.html">HVACVariableRefrigerantFlow.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatercoilcomponent.f90.html">HVACWaterCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoair.f90.html">HVACWatertoAir.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoairmultispeedhp.f90.html">HVACWatertoAirMultiSpeedHP.f90</a>

      <a class="list-group-item" href="../sourcefile/inputprocessor.f90.html">InputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/matrixdatamanager.f90.html">MatrixDataManager.f90</a>

      <a class="list-group-item" href="../sourcefile/mixedair.f90.html">MixedAir.f90</a>

      <a class="list-group-item" href="../sourcefile/moisturebalanceempdmanager.f90.html">MoistureBalanceEMPDManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nodeinputmanager.f90.html">NodeInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nonzoneequipmentmanager.f90.html">NonZoneEquipmentManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outairnodemanager.f90.html">OutAirNodeManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outdoorairunit.f90.html">OutdoorAirUnit.f90</a>

      <a class="list-group-item" href="../sourcefile/outputprocessor.f90.html">OutputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreportpredefined.f90.html">OutputReportPredefined.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreports.f90.html">OutputReports.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreporttabular.f90.html">OutputReportTabular.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedterminalheatpump.f90.html">PackagedTerminalHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedthermalstoragecoil.f90.html">PackagedThermalStorageCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaics.f90.html">Photovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaicthermalcollectors.f90.html">PhotovoltaicThermalCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantabsorptionchillers.f90.html">PlantAbsorptionChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilers.f90.html">PlantBoilers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilerssteam.f90.html">PlantBoilersSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcentralgshp.f90.html">PlantCentralGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantchillers.f90.html">PlantChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondloopoperation.f90.html">PlantCondLoopOperation.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondlooptowers.f90.html">PlantCondLoopTowers.f90</a>

      <a class="list-group-item" href="../sourcefile/planteirchillers.f90.html">PlantEIRChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantevapfluidcoolers.f90.html">PlantEvapFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantexhaustabsorptionchiller.f90.html">PlantExhaustAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantfluidcoolers.f90.html">PlantFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgasabsorptionchiller.f90.html">PlantGasAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgroundheatexchangers.f90.html">PlantGroundHeatExchangers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantheatexchanger.f90.html">PlantHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/planticethermalstorage.f90.html">PlantIceThermalStorage.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloadprofile.f90.html">PlantLoadProfile.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopequipment.f90.html">PlantLoopEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopsolver.f90.html">PlantLoopSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/plantmanager.f90.html">PlantManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantoutsideenergysources.f90.html">PlantOutsideEnergySources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipeheattransfer.f90.html">PlantPipeHeatTransfer.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipes.f90.html">PlantPipes.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipingsystemmanager.f90.html">PlantPipingSystemManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpondgroundheatexchanger.f90.html">PlantPondGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpressuresystem.f90.html">PlantPressureSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpumps.f90.html">PlantPumps.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsolarcollectors.f90.html">PlantSolarCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsurfacegroundheatexchanger.f90.html">PlantSurfaceGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantutilities.f90.html">PlantUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/plantvalves.f90.html">PlantValves.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatersources.f90.html">PlantWaterSources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwaterthermaltank.f90.html">PlantWaterThermalTank.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatertowatergshp.f90.html">PlantWatertoWaterGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwateruse.f90.html">PlantWaterUse.f90</a>

      <a class="list-group-item" href="../sourcefile/pollutionanalysismodule.f90.html">PollutionAnalysisModule.f90</a>

      <a class="list-group-item" href="../sourcefile/poweredinductionunits.f90.html">PoweredInductionUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/psychroutines.f90.html">PsychRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/purchasedairmanager.f90.html">Purchasedairmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemhightemp.f90.html">RadiantSystemHighTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemlowtemp.f90.html">RadiantSystemLowTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/refrigeratedcase.f90.html">RefrigeratedCase.f90</a>

      <a class="list-group-item" href="../sourcefile/reportsizingmanager.f90.html">ReportSizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/returnairpath.f90.html">ReturnAirPath.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmanager.f90.html">RoomAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelcrossvent.f90.html">RoomAirModelCrossVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodeldisplacementvent.f90.html">RoomAirModelDisplacementVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelmundt.f90.html">RoomAirModelMundt.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelufad.f90.html">RoomAirModelUFAD.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelusertemppattern.f90.html">RoomAirModelUserTempPattern.f90</a>

      <a class="list-group-item" href="../sourcefile/rootfinder.f90.html">RootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/runtimelanguageprocessor.f90.html">RuntimeLanguageProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/schedulemanager.f90.html">ScheduleManager.f90</a>

      <a class="list-group-item" href="../sourcefile/setpointmanager.f90.html">SetPointManager.f90</a>

      <a class="list-group-item" href="../sourcefile/simairservingzones.f90.html">SimAirServingZones.f90</a>

      <a class="list-group-item" href="../sourcefile/simulationmanager.f90.html">SimulationManager.f90</a>

      <a class="list-group-item" href="../sourcefile/sizingmanager.f90.html">SizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarreflectionmanager.f90.html">SolarReflectionManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarshading.f90.html">SolarShading.f90</a>

      <a class="list-group-item" href="../sourcefile/sortandstringutilities.f90.html">SortAndStringUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlite3.c.html">sqlite3.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitecroutines.c.html">SQLiteCRoutines.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines.f90.html">SQLiteFortranRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines_no.f90.html">SQLiteFortranRoutines_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/standardratings.f90.html">StandardRatings.f90</a>

      <a class="list-group-item" href="../sourcefile/surfacegeometry.f90.html">SurfaceGeometry.f90</a>

      <a class="list-group-item" href="../sourcefile/systemavailabilitymanager.f90.html">SystemAvailabilityManager.f90</a>

      <a class="list-group-item" href="../sourcefile/systemreports.f90.html">SystemReports.f90</a>

      <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html">TarcogComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalchimney.f90.html">ThermalChimney.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalcomfort.f90.html">ThermalComfort.f90</a>

      <a class="list-group-item" href="../sourcefile/unitheater.f90.html">UnitHeater.f90</a>

      <a class="list-group-item" href="../sourcefile/unitventilator.f90.html">UnitVentilator.f90</a>

      <a class="list-group-item" href="../sourcefile/userdefinedcomponents.f90.html">UserDefinedComponents.f90</a>

      <a class="list-group-item" href="../sourcefile/utilityroutines.f90.html">UtilityRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/vectorutilities.f90.html">VectorUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/ventilatedslab.f90.html">VentilatedSlab.f90</a>

      <a class="list-group-item" href="../sourcefile/watermanager.f90.html">WaterManager.f90</a>

      <a class="list-group-item" href="../sourcefile/weathermanager.f90.html">WeatherManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowac.f90.html">WindowAC.f90</a>

      <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html">WindowComplexManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowequivalentlayer.f90.html">WindowEquivalentLayer.f90</a>

      <a class="list-group-item" href="../sourcefile/windowmanager.f90.html">WindowManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windturbine.f90.html">WindTurbine.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneairloopequipmentmanager.f90.html">Zoneairloopequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zonecontaminantpredictorcorrector.f90.html">ZoneContaminantPredictorCorrector.f90</a>

      <a class="list-group-item" href="../sourcefile/zonedehumidifier.f90.html">ZoneDehumidifier.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneequipmentmanager.f90.html">Zoneequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneplenumcomponent.f90.html">ZonePlenumComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/zonetemppredictorcorrector.f90.html">ZoneTempPredictorCorrector.f90</a>

    </div>
  </div>
</div>


  </section>

    <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by
            <a href="https://github.com/cmacmackin/ford">FORD</a>

          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> EnergyPlusFortran</p></div>
      </div>
      <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': {
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>
