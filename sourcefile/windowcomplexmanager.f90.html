<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	 <meta name="description" content="">

    <meta name="author" content="dmey (forked from NREL)" >
    <link rel="icon" href="../favicon.png">

    <title>WindowComplexManager.f90 &ndash; EnergyPlusFortran</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>


    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">EnergyPlusFortran <small>8.1.0.009</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">

            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">

            <li><a href="../lists/files.html">Source Files</a></li>


            <li><a href="../lists/modules.html">Modules</a></li>


            <li><a href="../lists/procedures.html">Procedures</a></li>


            <li><a href="../lists/types.html">Derived Types</a></li>


            <li><a href="../program/energyplus.html">Program</a></li>

            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/energyplus.html">Program</a></li>

          </ul>


        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">


  <div class="row">
    <h1>WindowComplexManager.f90
    <small>Source File</small>

    </h1>

<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">


     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 0.7% of total for source files.">2487 statements</a>
     </li>


    <li><i class="fa fa-code"></i><a href="../src/WindowComplexManager.f90"> Source File</a></li>

  </ul>
  <ol class="breadcrumb in-well text-right">

     <li class="active">WindowComplexManager.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">

<div id="sidebar">


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../module/windowcomplexmanager.html">WindowComplexManager</a>

    </div>
  </div>
</div>


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html#src">WindowComplexManager.f90</a>
  </div>
</div>


  <hr>


<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../sourcefile/airflownetworkbalancemanager.f90.html">AirflowNetworkBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html">AirflowNetworkSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiator.f90.html">BaseboardRadiator.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorelectric.f90.html">BaseboardRadiatorElectric.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorsteam.f90.html">BaseboardRadiatorSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorwater.f90.html">BaseboardRadiatorWater.f90</a>

      <a class="list-group-item" href="../sourcefile/branchinputmanager.f90.html">BranchInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/branchnodeconnections.f90.html">BranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/conductiontransferfunctioncalc.f90.html">ConductionTransferFunctionCalc.f90</a>

      <a class="list-group-item" href="../sourcefile/cooltower.f90.html">CoolTower.f90</a>

      <a class="list-group-item" href="../sourcefile/costestimatemanager.f90.html">CostEstimateManager.f90</a>

      <a class="list-group-item" href="../sourcefile/curvemanager.f90.html">CurveManager.f90</a>

      <a class="list-group-item" href="../sourcefile/cvfonlyroutines.f90.html">CVFOnlyRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairflownetwork.f90.html">DataAirflowNetwork.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairloop.f90.html">DataAirLoop.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairsystems.f90.html">DataAirSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchairloopplant.f90.html">DataBranchAirLoopPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchnodeconnections.f90.html">DataBranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/databsdfwindow.f90.html">DataBSDFWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/datacomplexfenestration.f90.html">DataComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/datacontaminantbalance.f90.html">DataContaminantBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconvergparams.f90.html">DataConvergParams.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconversions.f90.html">DataConversions.f90</a>

      <a class="list-group-item" href="../sourcefile/datacostestimate.f90.html">DataCostEstimate.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylighting.f90.html">DataDaylighting.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylightingdevices.f90.html">DataDaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/datadefineequip.f90.html">Datadefineequip.f90</a>

      <a class="list-group-item" href="../sourcefile/datadelight.f90.html">DataDElight.f90</a>

      <a class="list-group-item" href="../sourcefile/dataenvironment.f90.html">DataEnvironment.f90</a>

      <a class="list-group-item" href="../sourcefile/dataequivalentlayerwindow.f90.html">DataEquivalentLayerWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/dataerrortracking.f90.html">DataErrorTracking.f90</a>

      <a class="list-group-item" href="../sourcefile/datagenerators.f90.html">DataGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobalconstants.f90.html">DataGlobalConstants.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobals.f90.html">DataGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalance.f90.html">DataHeatBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalfansys.f90.html">DataHeatBalFanSys.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalsurface.f90.html">DataHeatBalSurface.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvaccontrollers.f90.html">DataHVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvacglobals.f90.html">DataHVACGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datainterfaces.f90.html">DataInterfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/dataipshortcuts.f90.html">DataIPShortCuts.f90</a>

      <a class="list-group-item" href="../sourcefile/dataloopnode.f90.html">DataLoopNode.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalance.f90.html">DataMoistureBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalanceempd.f90.html">DataMoistureBalanceEMPD.f90</a>

      <a class="list-group-item" href="../sourcefile/dataoutputs.f90.html">DataOutputs.f90</a>

      <a class="list-group-item" href="../sourcefile/dataphotovoltaics.f90.html">DataPhotovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplant.f90.html">DataPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplantpipingsystems.f90.html">DataPlantPipingSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/dataprecisionglobals.f90.html">DataPrecisionGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datareportingflags.f90.html">DataReportingFlags.f90</a>

      <a class="list-group-item" href="../sourcefile/dataroomair.f90.html">DataRoomAir.f90</a>

      <a class="list-group-item" href="../sourcefile/datarootfinder.f90.html">DataRootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/dataruntimelanguage.f90.html">DataRuntimeLanguage.f90</a>

      <a class="list-group-item" href="../sourcefile/datashadowingcombinations.f90.html">DataShadowingCombinations.f90</a>

      <a class="list-group-item" href="../sourcefile/datasizing.f90.html">DataSizing.f90</a>

      <a class="list-group-item" href="../sourcefile/datastringglobals.f90.html">DataStringGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacecolors.f90.html">DataSurfaceColors.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacelists.f90.html">DataSurfaceLists.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfaces.f90.html">DataSurfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/datasystemvariables.f90.html">DataSystemVariables.f90</a>

      <a class="list-group-item" href="../sourcefile/datatimings.f90.html">DataTimings.f90</a>

      <a class="list-group-item" href="../sourcefile/dataucsdshareddata.f90.html">DataUCSDSharedData.f90</a>

      <a class="list-group-item" href="../sourcefile/datavectortypes.f90.html">DataVectorTypes.f90</a>

      <a class="list-group-item" href="../sourcefile/dataviewfactorinformation.f90.html">DataViewFactorInformation.f90</a>

      <a class="list-group-item" href="../sourcefile/datawater.f90.html">DataWater.f90</a>

      <a class="list-group-item" href="../sourcefile/datazonecontrols.f90.html">DataZoneControls.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneenergydemands.f90.html">DataZoneEnergyDemands.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneequipment.f90.html">DataZoneEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingdevices.f90.html">DaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingmanager.f90.html">DaylightingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf.f90.html">DElightManagerF.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf_no.f90.html">DElightManagerF_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/demandmanager.f90.html">DemandManager.f90</a>

      <a class="list-group-item" href="../sourcefile/desiccantdehumidifiers.f90.html">DesiccantDehumidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/directair.f90.html">DirectAir.f90</a>

      <a class="list-group-item" href="../sourcefile/displayroutines.f90.html">DisplayRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dxcoil.f90.html">DXCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/earthtube.f90.html">EarthTube.f90</a>

      <a class="list-group-item" href="../sourcefile/economiclifecyclecost.f90.html">EconomicLifeCycleCost.f90</a>

      <a class="list-group-item" href="../sourcefile/economictariff.f90.html">EconomicTariff.f90</a>

      <a class="list-group-item" href="../sourcefile/ecoroof.f90.html">EcoRoof.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowergenerators.f90.html">ElectricPowerGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowermanager.f90.html">ElectricPowerManager.f90</a>

      <a class="list-group-item" href="../sourcefile/emsmanager.f90.html">EMSManager.f90</a>

      <a class="list-group-item" href="../sourcefile/energyplus.f90.html">EnergyPlus.f90</a>

      <a class="list-group-item" href="../sourcefile/exteriorenergyusemanager.f90.html">ExteriorEnergyUseManager.f90</a>

      <a class="list-group-item" href="../sourcefile/externalinterface_no.f90.html">ExternalInterface_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/fancoilunits.f90.html">FanCoilUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/faultsmanager.f90.html">FaultsManager.f90</a>

      <a class="list-group-item" href="../sourcefile/fluidproperties.f90.html">FluidProperties.f90</a>

      <a class="list-group-item" href="../sourcefile/general.f90.html">General.f90</a>

      <a class="list-group-item" href="../sourcefile/generalroutines.f90.html">GeneralRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/globalnames.f90.html">GlobalNames.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceairmanager.f90.html">HeatBalanceAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceconvectioncoeffs.f90.html">HeatBalanceConvectionCoeffs.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancehamtmanager.f90.html">HeatBalanceHAMTManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceinternalheatgains.f90.html">HeatBalanceInternalHeatGains.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceintradexchange.f90.html">HeatBalanceIntRadExchange.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemanager.f90.html">HeatBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemovableinsulation.f90.html">HeatBalanceMovableInsulation.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancesurfacemanager.f90.html">HeatBalanceSurfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalfinitedifferencemanager.f90.html">HeatBalFiniteDifferenceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatrecovery.f90.html">HeatRecovery.f90</a>

      <a class="list-group-item" href="../sourcefile/humidifiers.f90.html">Humidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccontrollers.f90.html">HVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccooledbeam.f90.html">HVACCooledBeam.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdualductsystem.f90.html">HVACDualDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacduct.f90.html">HVACDuct.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdxsystem.f90.html">HVACDXSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacevapcomponent.f90.html">HVACEvapComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfancomponent.f90.html">HVACFanComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfurnace.f90.html">HVACFurnace.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacheatingcoils.f90.html">HVACHeatingCoils.f90</a>

      <a class="list-group-item" href="../sourcefile/hvachxassistedcoolingcoil.f90.html">HVACHXAssistedCoolingCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacinterfacemanager.f90.html">HVACInterfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmanager.f90.html">HVACManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmixercomponent.f90.html">HVACMixerComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmultispeedheatpump.f90.html">HVACMultiSpeedHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductinduc.f90.html">HVACSingleDuctInduc.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductsystem.f90.html">HVACSingleDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsplittercomponent.f90.html">HVACSplitterComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacstandaloneerv.f90.html">HVACStandAloneERV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsteamcoilcomponent.f90.html">HVACSteamCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvactranspiredcollector.f90.html">HVACTranspiredCollector.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarybypassvav.f90.html">HVACUnitaryBypassVAV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarysystem.f90.html">HVACUnitarySystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacvariablerefrigerantflow.f90.html">HVACVariableRefrigerantFlow.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatercoilcomponent.f90.html">HVACWaterCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoair.f90.html">HVACWatertoAir.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoairmultispeedhp.f90.html">HVACWatertoAirMultiSpeedHP.f90</a>

      <a class="list-group-item" href="../sourcefile/inputprocessor.f90.html">InputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/matrixdatamanager.f90.html">MatrixDataManager.f90</a>

      <a class="list-group-item" href="../sourcefile/mixedair.f90.html">MixedAir.f90</a>

      <a class="list-group-item" href="../sourcefile/moisturebalanceempdmanager.f90.html">MoistureBalanceEMPDManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nodeinputmanager.f90.html">NodeInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nonzoneequipmentmanager.f90.html">NonZoneEquipmentManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outairnodemanager.f90.html">OutAirNodeManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outdoorairunit.f90.html">OutdoorAirUnit.f90</a>

      <a class="list-group-item" href="../sourcefile/outputprocessor.f90.html">OutputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreportpredefined.f90.html">OutputReportPredefined.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreports.f90.html">OutputReports.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreporttabular.f90.html">OutputReportTabular.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedterminalheatpump.f90.html">PackagedTerminalHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedthermalstoragecoil.f90.html">PackagedThermalStorageCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaics.f90.html">Photovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaicthermalcollectors.f90.html">PhotovoltaicThermalCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantabsorptionchillers.f90.html">PlantAbsorptionChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilers.f90.html">PlantBoilers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilerssteam.f90.html">PlantBoilersSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcentralgshp.f90.html">PlantCentralGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantchillers.f90.html">PlantChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondloopoperation.f90.html">PlantCondLoopOperation.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondlooptowers.f90.html">PlantCondLoopTowers.f90</a>

      <a class="list-group-item" href="../sourcefile/planteirchillers.f90.html">PlantEIRChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantevapfluidcoolers.f90.html">PlantEvapFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantexhaustabsorptionchiller.f90.html">PlantExhaustAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantfluidcoolers.f90.html">PlantFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgasabsorptionchiller.f90.html">PlantGasAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgroundheatexchangers.f90.html">PlantGroundHeatExchangers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantheatexchanger.f90.html">PlantHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/planticethermalstorage.f90.html">PlantIceThermalStorage.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloadprofile.f90.html">PlantLoadProfile.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopequipment.f90.html">PlantLoopEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopsolver.f90.html">PlantLoopSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/plantmanager.f90.html">PlantManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantoutsideenergysources.f90.html">PlantOutsideEnergySources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipeheattransfer.f90.html">PlantPipeHeatTransfer.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipes.f90.html">PlantPipes.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipingsystemmanager.f90.html">PlantPipingSystemManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpondgroundheatexchanger.f90.html">PlantPondGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpressuresystem.f90.html">PlantPressureSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpumps.f90.html">PlantPumps.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsolarcollectors.f90.html">PlantSolarCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsurfacegroundheatexchanger.f90.html">PlantSurfaceGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantutilities.f90.html">PlantUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/plantvalves.f90.html">PlantValves.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatersources.f90.html">PlantWaterSources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwaterthermaltank.f90.html">PlantWaterThermalTank.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatertowatergshp.f90.html">PlantWatertoWaterGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwateruse.f90.html">PlantWaterUse.f90</a>

      <a class="list-group-item" href="../sourcefile/pollutionanalysismodule.f90.html">PollutionAnalysisModule.f90</a>

      <a class="list-group-item" href="../sourcefile/poweredinductionunits.f90.html">PoweredInductionUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/psychroutines.f90.html">PsychRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/purchasedairmanager.f90.html">Purchasedairmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemhightemp.f90.html">RadiantSystemHighTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemlowtemp.f90.html">RadiantSystemLowTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/refrigeratedcase.f90.html">RefrigeratedCase.f90</a>

      <a class="list-group-item" href="../sourcefile/reportsizingmanager.f90.html">ReportSizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/returnairpath.f90.html">ReturnAirPath.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmanager.f90.html">RoomAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelcrossvent.f90.html">RoomAirModelCrossVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodeldisplacementvent.f90.html">RoomAirModelDisplacementVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelmundt.f90.html">RoomAirModelMundt.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelufad.f90.html">RoomAirModelUFAD.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelusertemppattern.f90.html">RoomAirModelUserTempPattern.f90</a>

      <a class="list-group-item" href="../sourcefile/rootfinder.f90.html">RootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/runtimelanguageprocessor.f90.html">RuntimeLanguageProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/schedulemanager.f90.html">ScheduleManager.f90</a>

      <a class="list-group-item" href="../sourcefile/setpointmanager.f90.html">SetPointManager.f90</a>

      <a class="list-group-item" href="../sourcefile/simairservingzones.f90.html">SimAirServingZones.f90</a>

      <a class="list-group-item" href="../sourcefile/simulationmanager.f90.html">SimulationManager.f90</a>

      <a class="list-group-item" href="../sourcefile/sizingmanager.f90.html">SizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarreflectionmanager.f90.html">SolarReflectionManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarshading.f90.html">SolarShading.f90</a>

      <a class="list-group-item" href="../sourcefile/sortandstringutilities.f90.html">SortAndStringUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlite3.c.html">sqlite3.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitecroutines.c.html">SQLiteCRoutines.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines.f90.html">SQLiteFortranRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines_no.f90.html">SQLiteFortranRoutines_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/standardratings.f90.html">StandardRatings.f90</a>

      <a class="list-group-item" href="../sourcefile/surfacegeometry.f90.html">SurfaceGeometry.f90</a>

      <a class="list-group-item" href="../sourcefile/systemavailabilitymanager.f90.html">SystemAvailabilityManager.f90</a>

      <a class="list-group-item" href="../sourcefile/systemreports.f90.html">SystemReports.f90</a>

      <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html">TarcogComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalchimney.f90.html">ThermalChimney.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalcomfort.f90.html">ThermalComfort.f90</a>

      <a class="list-group-item" href="../sourcefile/unitheater.f90.html">UnitHeater.f90</a>

      <a class="list-group-item" href="../sourcefile/unitventilator.f90.html">UnitVentilator.f90</a>

      <a class="list-group-item" href="../sourcefile/userdefinedcomponents.f90.html">UserDefinedComponents.f90</a>

      <a class="list-group-item" href="../sourcefile/utilityroutines.f90.html">UtilityRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/vectorutilities.f90.html">VectorUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/ventilatedslab.f90.html">VentilatedSlab.f90</a>

      <a class="list-group-item" href="../sourcefile/watermanager.f90.html">WaterManager.f90</a>

      <a class="list-group-item" href="../sourcefile/weathermanager.f90.html">WeatherManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowac.f90.html">WindowAC.f90</a>

      <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html">WindowComplexManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowequivalentlayer.f90.html">WindowEquivalentLayer.f90</a>

      <a class="list-group-item" href="../sourcefile/windowmanager.f90.html">WindowManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windturbine.f90.html">WindTurbine.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneairloopequipmentmanager.f90.html">Zoneairloopequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zonecontaminantpredictorcorrector.f90.html">ZoneContaminantPredictorCorrector.f90</a>

      <a class="list-group-item" href="../sourcefile/zonedehumidifier.f90.html">ZoneDehumidifier.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneequipmentmanager.f90.html">Zoneequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneplenumcomponent.f90.html">ZonePlenumComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/zonetemppredictorcorrector.f90.html">ZoneTempPredictorCorrector.f90</a>

    </div>
  </div>
</div>


</div>

    </div>
    <div class="col-md-9" id='text'>


    <h3>This File Depends On</h3>

                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~windowcomplexmanager.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilewindowcomplexmanagerf90EfferentGraph" width="641pt" height="694pt"
 viewBox="0.00 0.00 641.00 693.93" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph" class="graph" transform="scale(.3069 .3069) rotate(0) translate(4 2256.8199)">
<title>sourcefile~~windowcomplexmanager.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2256.8199 2084.3726,-2256.8199 2084.3726,4 -4,4"/>
<!-- sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~windowcomplexmanager.f90</title>
<polygon fill="none" stroke="#000000" points="2080.4508,-1793.2102 1931.1381,-1793.2102 1931.1381,-1771.1993 2080.4508,-1771.1993 2080.4508,-1793.2102"/>
<text text-anchor="middle" x="2005.7944" y="-1779.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">WindowComplexManager.f90</text>
</g>
<!-- sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~databsdfwindow.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/databsdfwindow.f90.html" xlink:title="DataBSDFWindow.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="457.5516,-2011.2102 340.6161,-2011.2102 340.6161,-1989.1993 457.5516,-1989.1993 457.5516,-2011.2102"/>
<text text-anchor="middle" x="399.0839" y="-1997.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataBSDFWindow.f90</text>
</a>
</g>
</g>
<!-- sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge163" class="edge">
<title>sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1474.2096,-2166.2048C1545.2683,-2179.0905 1559.7319,-2205.2048 1631.9495,-2205.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1631.9495,-2205.2048C1849.0619,-2205.2048 1970.3609,-1888.4615 1999.0934,-1803.1521"/>
<polygon fill="#ff0000" stroke="#ff0000" points="2002.4621,-1804.1121 2002.2723,-1793.519 1995.8147,-1801.9184 2002.4621,-1804.1121"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-2186.2048C1096.0627,-2193.6687 1122.727,-2155.1198 1238.9897,-2146.2048 1299.6551,-2141.553 1315.35,-2140.1101 1375.8875,-2146.2048 1420.2568,-2150.6717 1430.3316,-2158.248 1474.2096,-2166.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M421.0156,-2011.2499C496.3479,-2048.3008 752.4136,-2166.9247 979.6978,-2186.2048"/>
</g>
<!-- sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~datasurfaces.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node7"><a xlink:href="../sourcefile/datasurfaces.f90.html" xlink:title="DataSurfaces.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="647.8111,-1930.2102 554.5531,-1930.2102 554.5531,-1908.1993 647.8111,-1908.1993 647.8111,-1930.2102"/>
<text text-anchor="middle" x="601.1821" y="-1916.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataSurfaces.f90</text>
</a>
</g>
</g>
<!-- sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#6bff00" stroke-dasharray="5,2" d="M439.4446,-1989.1013C452.7969,-1985.1058 467.6423,-1980.3131 480.9653,-1975.2048 512.2805,-1963.1979 546.8806,-1946.7242 570.8886,-1934.7543"/>
<polygon fill="#6bff00" stroke="#6bff00" points="572.4939,-1937.8647 579.857,-1930.2466 569.3503,-1931.6103 572.4939,-1937.8647"/>
</g>
<!-- sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~dataheatbalance.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node18"><a xlink:href="../sourcefile/dataheatbalance.f90.html" xlink:title="DataHeatBalance.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1201.7241,-1623.2102 1090.0905,-1623.2102 1090.0905,-1601.1993 1201.7241,-1601.1993 1201.7241,-1623.2102"/>
<text text-anchor="middle" x="1145.9073" y="-1609.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataHeatBalance.f90</text>
</a>
</g>
</g>
<!-- sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge146" class="edge">
<title>sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M457.5291,-2009.1018C589.3745,-2027.751 904.3127,-2063.8826 979.6978,-1996.2048"/>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M979.6978,-1996.2048C1003.6345,-1972.6536 1029.1338,-2001.0029 1052.825,-1977.2048 1102.4227,-1927.3832 1134.3658,-1703.802 1143.3258,-1633.4608"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1146.7988,-1633.8941 1144.5656,-1623.5373 1139.8528,-1633.0262 1146.7988,-1633.8941"/>
</g>
<!-- sourcefile~dataloopnode.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~dataloopnode.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/dataloopnode.f90.html" xlink:title="DataLoopNode.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="846.1377,-98.2102 745.8318,-98.2102 745.8318,-76.1993 846.1377,-76.1993 846.1377,-98.2102"/>
<text text-anchor="middle" x="795.9847" y="-84.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataLoopNode.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataloopnode.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge164" class="edge">
<title>sourcefile~dataloopnode.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M846.3828,-84.4026C883.3553,-82.9613 934.7409,-82.2374 979.6978,-86.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-86.2048C1053.2827,-92.6985 1072.5024,-77.9205 1145.9073,-86.2048"/>
</g>
<!-- sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~datazoneequipment.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node12"><a xlink:href="../sourcefile/datazoneequipment.f90.html" xlink:title="DataZoneEquipment.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1874.1154,-844.2102 1748.4681,-844.2102 1748.4681,-822.1993 1874.1154,-822.1993 1874.1154,-844.2102"/>
<text text-anchor="middle" x="1811.2917" y="-830.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataZoneEquipment.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataloopnode.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge118" class="edge">
<title>sourcefile~dataloopnode.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1307.4386,-162.2048C1411.4937,-179.496 1450.6996,-162.8917 1536.5317,-224.2048 1636.5038,-295.6185 1637.9151,-342.5829 1691.3672,-453.2048 1754.1389,-583.1141 1794.2274,-753.5624 1806.9299,-812.2752"/>
<polygon fill="#00d6ff" stroke="#00d6ff" points="1803.5361,-813.1431 1809.0433,-822.1941 1810.3824,-811.6842 1803.5361,-813.1431"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M979.6978,-86.2048C1013.6989,-89.9484 1022.6286,-94.134 1052.825,-110.2048 1070.7184,-119.7278 1070.0404,-130.5886 1088.825,-138.2048 1179.4081,-174.9315 1212.9509,-137.1803 1307.4386,-162.2048"/>
</g>
<!-- sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node26" class="node">
<title>sourcefile~nodeinputmanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node26"><a xlink:href="../sourcefile/nodeinputmanager.f90.html" xlink:title="NodeInputManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1691.285,-844.2102 1572.6139,-844.2102 1572.6139,-822.1993 1691.285,-822.1993 1691.285,-844.2102"/>
<text text-anchor="middle" x="1631.9495" y="-830.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">NodeInputManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataloopnode.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge95" class="edge">
<title>sourcefile~dataloopnode.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1307.4386,-162.2048C1406.3695,-178.6445 1405.6147,-241.0451 1474.2096,-314.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1474.2096,-314.2048C1545.637,-390.3855 1611.6923,-724.0899 1628.076,-811.9455"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1624.6821,-812.841 1629.9404,-822.0389 1631.5657,-811.5695 1624.6821,-812.841"/>
</g>
<!-- sourcefile~branchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node28" class="node">
<title>sourcefile~branchnodeconnections.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node28"><a xlink:href="../sourcefile/branchnodeconnections.f90.html" xlink:title="BranchNodeConnections.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1052.9524,-862.2102 906.4431,-862.2102 906.4431,-840.1993 1052.9524,-840.1993 1052.9524,-862.2102"/>
<text text-anchor="middle" x="979.6978" y="-848.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">BranchNodeConnections.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataloopnode.f90&#45;&gt;sourcefile~branchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge111" class="edge">
<title>sourcefile~dataloopnode.f90&#45;&gt;sourcefile~branchnodeconnections.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M798.3707,-98.4276C808.3998,-145.9203 847.6768,-335.1459 870.5706,-492.2048 881.3385,-566.0762 859.957,-767.8943 906.5706,-826.2048 909.1363,-829.4143 912.1346,-832.2137 915.4254,-834.6551"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="913.778,-837.7511 924.1279,-840.0164 917.4497,-831.7913 913.778,-837.7511"/>
</g>
<!-- sourcefile~vectorutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~vectorutilities.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node4"><a xlink:href="../sourcefile/vectorutilities.f90.html" xlink:title="VectorUtilities.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1026.3216,-1968.2102 933.0739,-1968.2102 933.0739,-1946.1993 1026.3216,-1946.1993 1026.3216,-1968.2102"/>
<text text-anchor="middle" x="979.6978" y="-1954.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">VectorUtilities.f90</text>
</a>
</g>
</g>
<!-- sourcefile~vectorutilities.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge165" class="edge">
<title>sourcefile~vectorutilities.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1026.2662,-1957.2048C1059.5878,-1957.2048 1105.5092,-1957.2048 1145.9073,-1957.2048"/>
</g>
<!-- sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~general.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node5"><a xlink:href="../sourcefile/general.f90.html" xlink:title="General.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="829.3535,-556.2102 762.616,-556.2102 762.616,-534.1993 829.3535,-534.1993 829.3535,-556.2102"/>
<text text-anchor="middle" x="795.9847" y="-542.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">General.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge166" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M829.517,-541.5548C844.1143,-538.2588 860.2171,-532.0145 870.5706,-520.2048 925.7902,-457.2184 849.2047,-396.2428 906.5706,-335.2048 929.5678,-310.7354 952.3006,-335.6218 979.6978,-316.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-316.2048C1007.0949,-296.7878 1024.1287,-314.6446 1052.825,-297.2048 1073.264,-284.7832 1067.8995,-268.7882 1088.825,-257.2048 1142.4241,-227.5345 1575.5535,-138.2737 1631.9495,-162.2048"/>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~vectorutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~vectorutilities.f90</title>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M799.7909,-556.3973C812.6462,-594.7978 854.5429,-724.9618 870.5706,-836.2048 902.9146,-1060.6945 832.8656,-1641.7068 906.5706,-1856.2048 917.7737,-1888.8085 943.3367,-1919.9327 961.0586,-1938.8014"/>
<polygon fill="#ffa100" stroke="#ffa100" points="958.6459,-1941.3416 968.1089,-1946.1063 963.6826,-1936.4803 958.6459,-1941.3416"/>
</g>
<!-- sourcefile~psychroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~psychroutines.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node10"><a xlink:href="../sourcefile/psychroutines.f90.html" xlink:title="PsychRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1195.4562,-288.2102 1096.3585,-288.2102 1096.3585,-266.1993 1195.4562,-266.1993 1195.4562,-288.2102"/>
<text text-anchor="middle" x="1145.9073" y="-274.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">PsychRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff86" stroke-dasharray="5,2" d="M979.6978,-316.2048C984.2317,-312.9914 1040.5117,-300.155 1086.3438,-290.0753"/>
<polygon fill="#00ff86" stroke="#00ff86" points="1087.2208,-293.4662 1096.2393,-287.9059 1085.7217,-286.6286 1087.2208,-293.4662"/>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge120" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M829.5343,-536.3256C842.6923,-532.2412 857.6932,-526.8183 870.5706,-520.2048 888.1271,-511.1881 888.0194,-500.9417 906.5706,-494.2048 951.7998,-477.7795 1608.0861,-438.831 1631.9495,-467.2048"/>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge147" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M799.4196,-556.284C812.4083,-597.9592 860.1433,-749.1503 906.5706,-871.2048 965.9268,-1027.2487 1000.9934,-1058.5027 1052.825,-1217.2048 1098.4436,-1356.8835 1131.5123,-1531.1389 1142.2021,-1590.9273"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1138.7991,-1591.7834 1143.9874,-1601.0209 1145.6921,-1590.5641 1138.7991,-1591.7834"/>
</g>
<!-- sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~dataenvironment.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node20"><a xlink:href="../sourcefile/dataenvironment.f90.html" xlink:title="DataEnvironment.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1034.8358,-366.2102 924.5597,-366.2102 924.5597,-344.1993 1034.8358,-344.1993 1034.8358,-366.2102"/>
<text text-anchor="middle" x="979.6978" y="-352.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataEnvironment.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge159" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#ff0050" stroke-dasharray="5,2" d="M829.5074,-540.651C843.7508,-537.1697 859.5719,-531.0301 870.5706,-520.2048 904.8328,-486.4822 879.4468,-457.8962 906.5706,-418.2048 919.1748,-399.7604 938.4825,-383.4414 954.0939,-372.036"/>
<polygon fill="#ff0050" stroke="#ff0050" points="956.1736,-374.8522 962.3206,-366.2229 952.1339,-369.1354 956.1736,-374.8522"/>
</g>
<!-- sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node25" class="node">
<title>sourcefile~schedulemanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node25"><a xlink:href="../sourcefile/schedulemanager.f90.html" xlink:title="ScheduleManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1203.0723,-633.2102 1088.7424,-633.2102 1088.7424,-611.1993 1203.0723,-611.1993 1203.0723,-633.2102"/>
<text text-anchor="middle" x="1145.9073" y="-619.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ScheduleManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-508.2048C1013.8362,-510.3624 1023.5357,-514.5346 1052.825,-532.2048 1084.4867,-551.3062 1113.8925,-583.0209 1130.8682,-603.2518"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1128.3018,-605.6416 1137.3529,-611.1488 1133.7116,-601.1993 1128.3018,-605.6416"/>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge98" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M979.6978,-508.2048C1125.073,-517.3928 1172.428,-451.5191 1307.4386,-506.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M827.1529,-534.1105C863.4091,-522.3363 925.2576,-505.7339 979.6978,-508.2048"/>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~branchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge112" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~branchnodeconnections.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M803.1536,-556.2862C817.7418,-579.2704 851.1404,-634.1671 870.5706,-684.2048 894.1381,-744.8973 862.4372,-778.3377 906.5706,-826.2048 909.7253,-829.6264 913.3677,-832.5798 917.3078,-835.129"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="915.8851,-838.3409 926.3348,-840.0889 919.256,-832.2059 915.8851,-838.3409"/>
</g>
<!-- sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node29" class="node">
<title>sourcefile~outputprocessor.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node29"><a xlink:href="../sourcefile/outputprocessor.f90.html" xlink:title="OutputProcessor.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1527.9353,-940.2102 1420.4839,-940.2102 1420.4839,-918.1993 1527.9353,-918.1993 1527.9353,-940.2102"/>
<text text-anchor="middle" x="1474.2096" y="-926.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">OutputProcessor.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge72" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M829.3736,-536.6358C867.975,-528.6256 932.2736,-521.2615 979.6978,-546.2048"/>
</g>
<!-- sourcefile~fluidproperties.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node30" class="node">
<title>sourcefile~fluidproperties.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node30"><a xlink:href="../sourcefile/fluidproperties.f90.html" xlink:title="FluidProperties.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1029.825,-288.2102 929.5705,-288.2102 929.5705,-266.1993 1029.825,-266.1993 1029.825,-288.2102"/>
<text text-anchor="middle" x="979.6978" y="-274.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">FluidProperties.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~fluidproperties.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge85" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~fluidproperties.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M829.6713,-541.6881C844.3011,-538.4202 860.3866,-532.161 870.5706,-520.2048 934.2471,-445.4468 843.1185,-377.1534 906.5706,-302.2048 910.4582,-297.6127 915.2278,-293.8623 920.451,-290.7996"/>
<polygon fill="#7fff00" stroke="#7fff00" points="922.1888,-293.8447 929.5939,-286.2674 919.0798,-287.573 922.1888,-293.8447"/>
</g>
<!-- sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node35" class="node">
<title>sourcefile~sqlitefortranroutines.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node35"><a xlink:href="../sourcefile/sqlitefortranroutines.f90.html" xlink:title="SQLiteFortranRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1375.8363,-940.2102 1239.0409,-940.2102 1239.0409,-918.1993 1375.8363,-918.1993 1375.8363,-940.2102"/>
<text text-anchor="middle" x="1307.4386" y="-926.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SQLiteFortranRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M829.4905,-556.1266C882.6397,-574.8889 986.9826,-617.7568 1052.825,-684.2048 1076.8944,-708.4956 1068.5925,-724.6361 1088.825,-752.2048 1145.0104,-828.763 1159.0827,-852.8936 1238.9897,-904.2048 1245.0643,-908.1055 1251.8317,-911.5094 1258.6812,-914.4441"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1257.4295,-917.7129 1268.015,-918.1578 1260.0174,-911.2088 1257.4295,-917.7129"/>
</g>
<!-- sourcefile~tarcogcomplexfenestration.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~tarcogcomplexfenestration.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node6"><a xlink:href="../sourcefile/tarcogcomplexfenestration.f90.html" xlink:title="TarcogComplexFenestration.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="479.4092,-2178.2102 318.7586,-2178.2102 318.7586,-2156.1993 479.4092,-2156.1993 479.4092,-2178.2102"/>
<text text-anchor="middle" x="399.0839" y="-2164.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">TarcogComplexFenestration.f90</text>
</a>
</g>
</g>
<!-- sourcefile~tarcogcomplexfenestration.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge167" class="edge">
<title>sourcefile~tarcogcomplexfenestration.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M434.1011,-2178.239C474.0918,-2189.8348 541.6856,-2206.3868 601.1821,-2206.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M601.1821,-2206.2048C769.6452,-2205.6893 811.2622,-2189.2898 979.6978,-2186.2048"/>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge168" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M795.9847,-1918.2048C859.8885,-1920.1688 846.4463,-1988.4649 906.5706,-2010.2048 967.6992,-2032.3078 989.9878,-2026.8403 1052.825,-2010.2048 1098.8456,-1998.0212 1098.3013,-1957.2048 1145.9073,-1957.2048"/>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~vectorutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~vectorutilities.f90</title>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M795.9847,-1918.2048C843.9058,-1920.6499 897.4416,-1933.1719 934.3005,-1943.3772"/>
<polygon fill="#ffa100" stroke="#ffa100" points="933.661,-1946.8334 944.2359,-1946.1838 935.564,-1940.097 933.661,-1946.8334"/>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M610.8412,-1907.9207C629.4171,-1885.4256 669.6717,-1832.6352 685.3989,-1780.2048 745.7152,-1579.126 691.1669,-1043.9468 721.3989,-836.2048 736.4148,-733.022 773.4672,-613.521 788.9784,-566.1214"/>
<polygon fill="#fff100" stroke="#fff100" points="792.3767,-566.9922 792.1904,-556.399 785.73,-564.7963 792.3767,-566.9922"/>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge148" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M795.9847,-1918.2048C884.2311,-1922.7075 905.5217,-1890.2215 979.6978,-1842.2048"/>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M648.0559,-1917.4918C687.5357,-1916.4021 745.489,-1915.6283 795.9847,-1918.2048"/>
</g>
<!-- sourcefile~datacontaminantbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node31" class="node">
<title>sourcefile~datacontaminantbalance.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node31"><a xlink:href="../sourcefile/datacontaminantbalance.f90.html" xlink:title="DataContaminantBalance.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="870.6565,-1738.2102 721.313,-1738.2102 721.313,-1716.1993 870.6565,-1716.1993 870.6565,-1738.2102"/>
<text text-anchor="middle" x="795.9847" y="-1724.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataContaminantBalance.f90</text>
</a>
</g>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~datacontaminantbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge91" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~datacontaminantbalance.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M612.4975,-1908.0521C644.7755,-1876.2386 737.5305,-1784.818 777.4024,-1745.5198"/>
<polygon fill="#00ffff" stroke="#00ffff" points="779.9728,-1747.9006 784.6381,-1738.3882 775.0591,-1742.9151 779.9728,-1747.9006"/>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M795.9847,-1918.2048C1016.7831,-1929.4708 1130.317,-1841.0049 1202.9897,-1632.2048 1269.3784,-1441.4598 1204.1686,-1378.1485 1238.9897,-1179.2048 1254.1526,-1092.5745 1286.0575,-992.5106 1300.3045,-950.0144"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1303.636,-951.088 1303.5252,-940.4938 1297.0052,-948.8448 1303.636,-951.088"/>
</g>
<!-- sourcefile~datashadowingcombinations.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~datashadowingcombinations.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node8"><a xlink:href="../sourcefile/datashadowingcombinations.f90.html" xlink:title="DataShadowingCombinations.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1895.1409,-1832.2102 1727.4426,-1832.2102 1727.4426,-1810.1993 1895.1409,-1810.1993 1895.1409,-1832.2102"/>
<text text-anchor="middle" x="1811.2917" y="-1818.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataShadowingCombinations.f90</text>
</a>
</g>
</g>
<!-- sourcefile~datashadowingcombinations.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge169" class="edge">
<title>sourcefile~datashadowingcombinations.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1866.2485,-1810.1853C1889.451,-1805.533 1916.6425,-1800.0808 1940.8288,-1795.2311"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1941.5197,-1798.6623 1950.6364,-1793.2646 1940.1434,-1791.799 1941.5197,-1798.6623"/>
</g>
<!-- sourcefile~dataheatbalsurface.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~dataheatbalsurface.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node9"><a xlink:href="../sourcefile/dataheatbalsurface.f90.html" xlink:title="DataHeatBalSurface.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1370.1727,-2177.2102 1244.7045,-2177.2102 1244.7045,-2155.1993 1370.1727,-2155.1993 1370.1727,-2177.2102"/>
<text text-anchor="middle" x="1307.4386" y="-2163.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataHeatBalSurface.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataheatbalsurface.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge170" class="edge">
<title>sourcefile~dataheatbalsurface.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1370.0812,-2160.9393C1401.5656,-2159.6213 1440.1656,-2160.0313 1474.2096,-2166.2048"/>
</g>
<!-- sourcefile~psychroutines.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge171" class="edge">
<title>sourcefile~psychroutines.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1307.4386,-277.2048C1531.0503,-289.2373 1648.4263,-122.5109 1811.2917,-276.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1195.7587,-276.6654C1227.6892,-276.4533 1270.0086,-276.4196 1307.4386,-277.2048"/>
</g>
<!-- sourcefile~psychroutines.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge101" class="edge">
<title>sourcefile~psychroutines.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1307.4386,-277.2048C1326.3919,-278.2246 1461.2272,-300.3584 1474.2096,-314.2048"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~dataprecisionglobals.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node11"><a xlink:href="../sourcefile/dataprecisionglobals.f90.html" xlink:title="DataPrecisionGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="130.719,-1434.2102 -.2403,-1434.2102 -.2403,-1412.1993 130.719,-1412.1993 130.719,-1434.2102"/>
<text text-anchor="middle" x="65.2394" y="-1420.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataPrecisionGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge172" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1307.4386,-2244.2048C1452.4575,-2235.7553 1491.2024,-2241.1514 1631.9495,-2205.2048"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-1766.2048C297.1747,-1812.2469 260.9333,-1871.3903 317.2024,-1937.2048 332.8847,-1955.5474 354.7005,-1972.0116 371.8708,-1983.5051"/>
<polygon fill="#ff0000" stroke="#ff0000" points="370.0807,-1986.5162 380.3691,-1989.046 373.9039,-1980.6524 370.0807,-1986.5162"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataloopnode.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataloopnode.f90</title>
<path fill="none" stroke="#ff5000" stroke-dasharray="5,2" d="M601.1821,-50.2048C656.7956,-39.8722 721.2727,-58.0473 760.323,-72.3909"/>
<polygon fill="#ff5000" stroke="#ff5000" points="759.5669,-75.8474 770.1582,-76.1214 762.0495,-69.3024 759.5669,-75.8474"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~vectorutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~vectorutilities.f90</title>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M223.8406,-2167.2048C228.841,-2171.5593 679.0165,-2047.002 685.3989,-2045.2048 773.7745,-2020.3191 876.386,-1989.1053 934.116,-1971.3299"/>
<polygon fill="#ffa100" stroke="#ffa100" points="935.4913,-1974.5685 944.0164,-1968.2778 933.429,-1967.8792 935.4913,-1974.5685"/>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M65.8332,-1434.2525C70.629,-1518.9921 105.9285,-2065.3064 223.8406,-2167.2048"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M399.0839,-562.2048C523.5375,-597.1713 678.5147,-571.8222 752.6036,-555.7351"/>
<polygon fill="#fff100" stroke="#fff100" points="753.5069,-559.1199 762.5095,-553.5339 751.9883,-552.2865 753.5069,-559.1199"/>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M223.8406,-477.2048C285.5224,-416.4699 316.1287,-537.47 399.0839,-562.2048"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90</title>
<path fill="none" stroke="#bbff00" stroke-dasharray="5,2" d="M223.8406,-2167.2048C260.144,-2198.8187 318.5164,-2191.3532 357.809,-2181.0392"/>
<polygon fill="#bbff00" stroke="#bbff00" points="358.9177,-2184.3636 367.6092,-2178.3049 357.0365,-2177.6211 358.9177,-2184.3636"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#6bff00" stroke-dasharray="5,2" d="M399.0839,-1885.2048C446.4932,-1901.66 503.0101,-1910.3038 544.2071,-1914.7487"/>
<polygon fill="#6bff00" stroke="#6bff00" points="544.0303,-1918.2489 554.3359,-1915.7905 544.7465,-1911.2856 544.0303,-1918.2489"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataheatbalsurface.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataheatbalsurface.f90</title>
<path fill="none" stroke="#00ff35" stroke-dasharray="5,2" d="M223.8406,-2167.2048C353.3456,-2279.1216 430.0187,-2244.2048 601.1821,-2244.2048 601.1821,-2244.2048 601.1821,-2244.2048 795.9847,-2244.2048 951.5059,-2244.2048 991.476,-2262.5836 1145.9073,-2244.2048"/>
<path fill="none" stroke="#00ff35" stroke-dasharray="5,2" d="M1145.9073,-2244.2048C1199.0312,-2236.9083 1253.7689,-2204.1399 1283.9162,-2183.4657"/>
<polygon fill="#00ff35" stroke="#00ff35" points="1286.2753,-2186.0863 1292.4538,-2177.4794 1282.2566,-2180.3548 1286.2753,-2186.0863"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff86" stroke-dasharray="5,2" d="M399.0839,-126.2048C482.733,-63.0362 766.7527,-125.7378 870.5706,-140.2048 953.3132,-151.7349 979.9409,-145.3734 1052.825,-186.2048 1085.4311,-204.4715 1114.7547,-237.1131 1131.4298,-257.9344"/>
<polygon fill="#00ff86" stroke="#00ff86" points="1128.8607,-260.3312 1137.7746,-266.0577 1134.3774,-256.0223 1128.8607,-260.3312"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge121" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M65.3824,-1412.1992C66.8685,-1315.87 82.4861,-616.3891 223.8406,-477.2048"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M601.1821,-50.2048C688.0804,-34.0598 708.115,-19.7375 795.9847,-10.2048"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M399.0839,-126.2048C474.2042,-66.4907 506.834,-67.7339 601.1821,-50.2048"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M795.9847,-10.2048C1130.8405,26.1227 1225.6778,-41.521 1536.5317,-171.2048 1607.8313,-200.9499 1644.5555,-188.747 1691.3672,-250.2048 1761.3125,-342.0341 1800.5123,-717.6225 1809.3575,-811.7399"/>
<polygon fill="#00d6ff" stroke="#00d6ff" points="1805.8802,-812.1488 1810.2857,-821.7843 1812.8505,-811.5046 1805.8802,-812.1488"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M223.8406,-477.2048C321.2279,-381.3126 236.5185,-294.5211 317.2024,-184.2048 343.5296,-148.2085 364.1733,-153.9556 399.0839,-126.2048"/>
</g>
<!-- sourcefile~dataglobals.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~dataglobals.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node13"><a xlink:href="../sourcefile/dataglobals.f90.html" xlink:title="DataGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="267.6355,-1091.2102 180.0456,-1091.2102 180.0456,-1069.1993 267.6355,-1069.1993 267.6355,-1091.2102"/>
<text text-anchor="middle" x="223.8406" y="-1077.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataglobals.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge129" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataglobals.f90</title>
<path fill="none" stroke="#0086ff" stroke-dasharray="5,2" d="M70.3367,-1412.181C92.9847,-1363.2011 184.6842,-1164.8866 214.4561,-1100.5002"/>
<polygon fill="#0086ff" stroke="#0086ff" points="217.6623,-1101.9055 218.6825,-1091.3598 211.3087,-1098.9675 217.6623,-1101.9055"/>
</g>
<!-- sourcefile~datavectortypes.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~datavectortypes.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node14"><a xlink:href="../sourcefile/datavectortypes.f90.html" xlink:title="DataVectorTypes.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="278.8255,-2011.2102 168.8556,-2011.2102 168.8556,-1989.1993 278.8255,-1989.1993 278.8255,-2011.2102"/>
<text text-anchor="middle" x="223.8406" y="-1997.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataVectorTypes.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datavectortypes.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge130" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datavectortypes.f90</title>
<path fill="none" stroke="#0035ff" stroke-dasharray="5,2" d="M68.266,-1434.2159C87.4626,-1504.0541 192.2921,-1885.4295 218.0987,-1979.3153"/>
<polygon fill="#0035ff" stroke="#0035ff" points="214.7568,-1980.3633 220.7821,-1989.078 221.5065,-1978.508 214.7568,-1980.3633"/>
</g>
<!-- sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~inputprocessor.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node15"><a xlink:href="../sourcefile/inputprocessor.f90.html" xlink:title="InputProcessor.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="650.7412,-898.2102 551.623,-898.2102 551.623,-876.1993 650.7412,-876.1993 650.7412,-898.2102"/>
<text text-anchor="middle" x="601.1821" y="-884.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">InputProcessor.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge133" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M66.9588,-1412.0711C77.7014,-1344.1302 137.9364,-986.298 223.8406,-926.2048"/>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M223.8406,-926.2048C264.0616,-898.0687 270.053,-880.8542 317.2024,-867.2048 387.1153,-846.9654 408.4289,-861.2122 480.9653,-867.2048 500.7157,-868.8365 522.1069,-871.9515 541.2942,-875.2461"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="540.9471,-878.7389 551.4036,-877.0322 542.1651,-871.8456 540.9471,-878.7389"/>
</g>
<!-- sourcefile~dataheatbalfansys.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~dataheatbalfansys.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node16"><a xlink:href="../sourcefile/dataheatbalfansys.f90.html" xlink:title="DataHeatBalFanSys.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1536.3544,-2216.2102 1412.0648,-2216.2102 1412.0648,-2194.1993 1536.3544,-2194.1993 1536.3544,-2216.2102"/>
<text text-anchor="middle" x="1474.2096" y="-2202.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataHeatBalFanSys.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataheatbalfansys.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge140" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataheatbalfansys.f90</title>
<path fill="none" stroke="#6b00ff" stroke-dasharray="5,2" d="M1145.9073,-2244.2048C1217.0313,-2234.436 1235.7685,-2248.3806 1307.4386,-2244.2048"/>
<path fill="none" stroke="#6b00ff" stroke-dasharray="5,2" d="M1307.4386,-2244.2048C1350.6151,-2241.6891 1398.5656,-2229.442 1431.9267,-2219.3339"/>
<polygon fill="#6b00ff" stroke="#6b00ff" points="1433.2737,-2222.5808 1441.7903,-2216.2787 1431.2025,-2215.8942 1433.2737,-2222.5808"/>
</g>
<!-- sourcefile~datainterfaces.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~datainterfaces.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node17"><a xlink:href="../sourcefile/datainterfaces.f90.html" xlink:title="DataInterfaces.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="447.8836,-488.2102 350.2841,-488.2102 350.2841,-466.1993 447.8836,-466.1993 447.8836,-488.2102"/>
<text text-anchor="middle" x="399.0839" y="-474.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataInterfaces.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datainterfaces.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge141" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datainterfaces.f90</title>
<path fill="none" stroke="#bb00ff" stroke-dasharray="5,2" d="M223.8406,-477.2048C259.0146,-442.5707 319.996,-451.838 359.943,-463.2704"/>
<polygon fill="#bb00ff" stroke="#bb00ff" points="359.0321,-466.6515 369.6172,-466.1982 361.0598,-459.9516 359.0321,-466.6515"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge149" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M223.8406,-1766.2048C275.232,-1798.7008 264.553,-1835.7892 317.2024,-1866.2048 349.551,-1884.8926 363.7906,-1872.9549 399.0839,-1885.2048"/>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M979.6978,-1842.2048C1013.6137,-1820.2498 1030.7505,-1822.0431 1052.825,-1788.2048 1090.8603,-1729.8995 1043.3042,-1685.2378 1087.7748,-1630.9458"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1090.6261,-1633.0077 1094.679,-1623.2186 1085.4062,-1628.3437 1090.6261,-1633.0077"/>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M399.0839,-1885.2048C429.6403,-1895.8105 952.5455,-1859.7813 979.6978,-1842.2048"/>
</g>
<!-- sourcefile~datasystemvariables.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~datasystemvariables.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node19"><a xlink:href="../sourcefile/datasystemvariables.f90.html" xlink:title="DataSystemVariables.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="463.7837,-898.2102 334.3841,-898.2102 334.3841,-876.1993 463.7837,-876.1993 463.7837,-898.2102"/>
<text text-anchor="middle" x="399.0839" y="-884.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataSystemVariables.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge158" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90</title>
<path fill="none" stroke="#ff00a1" stroke-dasharray="5,2" d="M223.8406,-926.2048C253.0038,-905.804 291.0165,-895.8432 324.182,-891.068"/>
<polygon fill="#ff00a1" stroke="#ff00a1" points="324.8412,-894.5117 334.3039,-889.7466 323.935,-887.5706 324.8412,-894.5117"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge162" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#ff0050" stroke-dasharray="5,2" d="M601.1821,-354.2048C654.9071,-356.864 667.6985,-365.0884 721.3989,-368.2048 787.5861,-372.0457 804.3885,-372.1329 870.5706,-368.2048 884.6706,-367.3679 899.7417,-365.9279 914.0431,-364.3035"/>
<polygon fill="#ff0050" stroke="#ff0050" points="914.7746,-367.7416 924.2957,-363.0942 913.9546,-360.7898 914.7746,-367.7416"/>
<path fill="none" stroke="#ff0050" stroke-dasharray="5,2" d="M399.0839,-354.2048C483.8443,-324.48 511.3622,-354.7342 601.1821,-354.2048"/>
</g>
<!-- sourcefile~datahvacglobals.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~datahvacglobals.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node21"><a xlink:href="../sourcefile/datahvacglobals.f90.html" xlink:title="DataHVACGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="658.8752,-1052.2102 543.4891,-1052.2102 543.4891,-1030.1993 658.8752,-1030.1993 658.8752,-1052.2102"/>
<text text-anchor="middle" x="601.1821" y="-1038.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataHVACGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-926.2048C293.4043,-877.5423 314.5516,-994.3663 399.0839,-1002.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M399.0839,-1002.2048C449.9261,-1006.9192 506.9751,-1018.5212 547.4622,-1027.8532"/>
<polygon fill="#ff0000" stroke="#ff0000" points="546.8508,-1031.3045 557.3849,-1030.1712 548.4433,-1024.4881 546.8508,-1031.3045"/>
</g>
<!-- sourcefile~dataipshortcuts.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node22" class="node">
<title>sourcefile~dataipshortcuts.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node22"><a xlink:href="../sourcefile/dataipshortcuts.f90.html" xlink:title="DataIPShortCuts.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="453.3838,-744.2102 344.7839,-744.2102 344.7839,-722.1993 453.3838,-722.1993 453.3838,-744.2102"/>
<text text-anchor="middle" x="399.0839" y="-730.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataIPShortCuts.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M223.8406,-477.2048C291.7377,-410.35 257.0814,-596.2787 317.2024,-670.2048 332.3325,-688.8091 353.9918,-705.164 371.234,-716.5449"/>
<polygon fill="#7fff00" stroke="#7fff00" points="369.4821,-719.5792 379.79,-722.0285 373.2593,-713.6858 369.4821,-719.5792"/>
</g>
<!-- sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node23" class="node">
<title>sourcefile~dataruntimelanguage.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node23"><a xlink:href="../sourcefile/dataruntimelanguage.f90.html" xlink:title="DataRuntimeLanguage.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="669.6908,-612.2102 532.6734,-612.2102 532.6734,-590.1993 669.6908,-590.1993 669.6908,-612.2102"/>
<text text-anchor="middle" x="601.1821" y="-598.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataRuntimeLanguage.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M399.0839,-562.2048C439.1902,-573.4731 484.6805,-582.5663 522.3335,-589.1287"/>
<polygon fill="#00ffff" stroke="#00ffff" points="521.7826,-592.5853 532.2306,-590.8271 522.9666,-585.6861 521.7826,-592.5853"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M399.0839,-354.2048C435.5077,-343.6482 447.2077,-360.9259 480.9653,-378.2048 499.0089,-387.4403 498.189,-398.5683 516.9653,-406.2048 738.956,-496.4897 851.3451,-336.4469 1052.825,-466.2048 1102.3513,-498.1009 1129.1592,-566.5004 1140.0349,-601.1551"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1136.7992,-602.5518 1143.0147,-611.1319 1143.5064,-600.5485 1136.7992,-602.5518"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge102" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M795.9847,-10.2048C912.8132,1.6659 947.032,-21.2375 1052.825,-72.2048 1071.086,-81.0023 1070.2624,-92.0626 1088.825,-100.2048 1207.2848,-152.1651 1260.0777,-90.5791 1375.8875,-148.2048 1463.8873,-191.9926 1489.8319,-213.715 1536.5317,-300.2048 1542.8079,-311.8285 1611.6597,-714.1609 1628.3305,-811.9473"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1624.8888,-812.5863 1630.0188,-821.8564 1631.7894,-811.4105 1624.8888,-812.5863"/>
</g>
<!-- sourcefile~datasizing.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node27" class="node">
<title>sourcefile~datasizing.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node27"><a xlink:href="../sourcefile/datasizing.f90.html" xlink:title="DataSizing.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="439.3754,-1624.2102 358.7923,-1624.2102 358.7923,-1602.1993 439.3754,-1602.1993 439.3754,-1624.2102"/>
<text text-anchor="middle" x="399.0839" y="-1610.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataSizing.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasizing.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge109" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasizing.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M223.8406,-1766.2048C283.4751,-1803.6458 259.8317,-1679.0302 317.2024,-1638.2048 326.6625,-1631.4729 337.9735,-1626.5216 349.1249,-1622.891"/>
<polygon fill="#00ffff" stroke="#00ffff" points="350.2309,-1626.2139 358.833,-1620.0289 348.2514,-1619.4996 350.2309,-1626.2139"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge74" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-1766.2048C275.6584,-1798.9704 423.972,-1688.7976 480.9653,-1666.2048 735.7865,-1565.1907 803.2352,-1548.53 1052.825,-1435.2048 1120.9339,-1404.2802 1150.7937,-1412.7839 1202.9897,-1359.2048 1229.0705,-1332.4329 1213.426,-1310.4708 1238.9897,-1283.2048 1286.5875,-1232.4375 1335.8855,-1264.1495 1375.8875,-1207.2048 1433.3437,-1125.413 1363.9863,-1072.935 1411.8875,-985.2048 1420.4077,-969.6001 1434.9987,-956.1307 1447.9213,-946.3148"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1450.0396,-949.1023 1456.0918,-940.4062 1445.9376,-943.43 1450.0396,-949.1023"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~fluidproperties.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge86" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~fluidproperties.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M223.8406,-477.2048C266.9355,-434.7714 265.6393,-409.812 317.2024,-378.2048 349.5343,-358.3859 363.2978,-366.7546 399.0839,-354.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M399.0839,-354.2048C581.0445,-290.3927 812.021,-278.8676 919.5515,-277.1806"/>
<polygon fill="#7fff00" stroke="#7fff00" points="919.6142,-280.6801 929.5665,-277.0466 919.5205,-273.6808 919.6142,-280.6801"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datacontaminantbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge92" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datacontaminantbalance.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M223.8406,-1766.2048C259.3491,-1788.4984 559.3074,-1768.2954 601.1821,-1766.2048"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M601.1821,-1766.2048C651.0775,-1762.5993 706.965,-1750.5606 746.039,-1740.802"/>
<polygon fill="#00ffff" stroke="#00ffff" points="747.2643,-1744.102 756.0951,-1738.2481 745.5412,-1737.3173 747.2643,-1744.102"/>
</g>
<!-- sourcefile~dataerrortracking.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node32" class="node">
<title>sourcefile~dataerrortracking.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node32"><a xlink:href="../sourcefile/dataerrortracking.f90.html" xlink:title="DataErrorTracking.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1364.8417,-1471.2102 1250.0355,-1471.2102 1250.0355,-1449.1993 1364.8417,-1449.1993 1364.8417,-1471.2102"/>
<text text-anchor="middle" x="1307.4386" y="-1457.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataErrorTracking.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataerrortracking.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge93" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataerrortracking.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M601.1821,-1766.2048C720.8956,-1757.5541 756.2926,-1783.9022 870.5706,-1747.2048 961.0921,-1718.1361 980.8733,-1697.3506 1052.825,-1635.2048 1071.6877,-1618.9127 1069.6924,-1608.1791 1088.825,-1592.2048 1133.6444,-1554.7839 1157.9539,-1564.365 1202.9897,-1527.2048 1221.9531,-1511.5576 1218.7846,-1499.2118 1238.9897,-1485.2048 1244.5783,-1481.3306 1250.8375,-1477.9811 1257.2395,-1475.1069"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="1258.7442,-1478.2725 1266.6597,-1471.2301 1256.0802,-1471.7993 1258.7442,-1478.2725"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M223.8406,-926.2048C258.8901,-903.1963 559.7221,-919.966 601.1821,-926.2048"/>
</g>
<!-- sourcefile~outputreportpredefined.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node37" class="node">
<title>sourcefile~outputreportpredefined.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node37"><a xlink:href="../sourcefile/outputreportpredefined.f90.html" xlink:title="OutputReportPredefined.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="470.9214,-1511.2102 327.2463,-1511.2102 327.2463,-1489.1993 470.9214,-1489.1993 470.9214,-1511.2102"/>
<text text-anchor="middle" x="399.0839" y="-1497.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">OutputReportPredefined.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~outputreportpredefined.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge68" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~outputreportpredefined.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M223.8406,-1766.2048C297.8363,-1812.6623 267.2659,-1664.8986 317.2024,-1593.2048 336.501,-1565.4978 362.916,-1536.8055 380.466,-1518.752"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="383.3306,-1520.8308 387.8483,-1511.2475 378.3403,-1515.9219 383.3306,-1520.8308"/>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M66.2201,-1434.2801C71.2962,-1484.0599 99.3792,-1688.0628 223.8406,-1766.2048"/>
</g>
<!-- sourcefile~dataroomair.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node38" class="node">
<title>sourcefile~dataroomair.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node38"><a xlink:href="../sourcefile/dataroomair.f90.html" xlink:title="DataRoomAir.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="445.0438,-1052.2102 353.1239,-1052.2102 353.1239,-1030.1993 445.0438,-1030.1993 445.0438,-1052.2102"/>
<text text-anchor="middle" x="399.0839" y="-1038.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataRoomAir.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataroomair.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataroomair.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-926.2048C271.067,-893.1681 267.5243,-986.9841 317.2024,-1016.2048 325.1995,-1020.9087 334.165,-1024.805 343.1511,-1028.008"/>
<polygon fill="#ff0000" stroke="#ff0000" points="342.2721,-1031.4035 352.8653,-1031.2167 344.4677,-1024.7568 342.2721,-1031.4035"/>
</g>
<!-- sourcefile~datacomplexfenestration.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node40" class="node">
<title>sourcefile~datacomplexfenestration.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node40"><a xlink:href="../sourcefile/datacomplexfenestration.f90.html" xlink:title="DataComplexFenestration.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="475.0737,-1857.2102 323.0941,-1857.2102 323.0941,-1835.1993 475.0737,-1835.1993 475.0737,-1857.2102"/>
<text text-anchor="middle" x="399.0839" y="-1843.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataComplexFenestration.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datacomplexfenestration.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge143" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datacomplexfenestration.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-1766.2048C265.4117,-1792.3048 272.1329,-1805.7597 317.2024,-1825.2048 323.2682,-1827.8219 329.7326,-1830.1679 336.2678,-1832.2573"/>
<polygon fill="#ff0000" stroke="#ff0000" points="335.271,-1835.6123 345.8552,-1835.1365 337.2845,-1828.9081 335.271,-1835.6123"/>
</g>
<!-- sourcefile~dataequivalentlayerwindow.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node41" class="node">
<title>sourcefile~dataequivalentlayerwindow.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node41"><a xlink:href="../sourcefile/dataequivalentlayerwindow.f90.html" xlink:title="DataEquivalentLayerWindow.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="480.847,-1816.2102 317.3208,-1816.2102 317.3208,-1794.1993 480.847,-1794.1993 480.847,-1816.2102"/>
<text text-anchor="middle" x="399.0839" y="-1802.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataEquivalentLayerWindow.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataequivalentlayerwindow.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge145" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataequivalentlayerwindow.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M223.8406,-1766.2048C248.6342,-1781.7712 278.8246,-1791.165 307.114,-1796.8202"/>
<polygon fill="#00ffff" stroke="#00ffff" points="306.557,-1800.2766 317.0291,-1798.6686 307.8399,-1793.3951 306.557,-1800.2766"/>
</g>
<!-- sourcefile~datazoneequipment.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge173" class="edge">
<title>sourcefile~datazoneequipment.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1813.6116,-844.5236C1833.4772,-941.4502 1974.8676,-1631.3093 2001.481,-1761.1589"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1998.073,-1761.9633 2003.5096,-1771.0569 2004.9304,-1760.5578 1998.073,-1761.9633"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge174" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1145.9073,-1957.2048C1217.6898,-1958.3562 1235.6643,-1958.7827 1307.4386,-1957.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M399.0839,-1652.2048C422.2197,-1680.9764 454.0471,-1640.9365 480.9653,-1666.2048 531.5827,-1713.7194 467.5069,-1769.485 516.9653,-1818.2048 518.5586,-1819.7743 1143.6711,-1957.1689 1145.9073,-1957.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M224.81,-1091.433C233.3116,-1189.5375 295.3752,-1898.3429 317.2024,-1937.2048 328.4967,-1957.3136 349.1032,-1973.1161 366.8176,-1983.8649"/>
<polygon fill="#ff0000" stroke="#ff0000" points="365.3422,-1987.0544 375.7528,-1989.0213 368.841,-1980.9915 365.3422,-1987.0544"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataloopnode.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataloopnode.f90</title>
<path fill="none" stroke="#ff5000" stroke-dasharray="5,2" d="M601.1821,-164.2048C664.6403,-157.994 732.5517,-124.1718 769.0498,-103.4732"/>
<polygon fill="#ff5000" stroke="#ff5000" points="771.1498,-106.302 778.0562,-98.2676 767.6469,-100.2415 771.1498,-106.302"/>
<path fill="none" stroke="#ff5000" stroke-dasharray="5,2" d="M229.9286,-1069.0097C242.2081,-1045.7976 269.7466,-990.3966 281.2024,-940.2048 310.9247,-809.9805 254.3228,-458.0518 317.2024,-340.2048 387.1029,-209.1994 453.4009,-178.6683 601.1821,-164.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~vectorutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~vectorutilities.f90</title>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M795.9847,-1958.2048C838.1754,-1954.1704 886.0651,-1954.0549 922.3696,-1954.8768"/>
<polygon fill="#ffa100" stroke="#ffa100" points="922.6786,-1958.3859 932.7655,-1955.1448 922.859,-1951.3882 922.6786,-1958.3859"/>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M224.733,-1091.3175C232.4563,-1186.9199 288.3899,-1867.8607 317.2024,-1899.2048 367.6614,-1954.0974 794.6803,-1958.3295 795.9847,-1958.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M229.5284,-1068.9081C241.0696,-1045.5085 267.318,-989.7797 281.2024,-940.2048 308.7513,-841.84 262.9439,-799.7529 317.2024,-713.2048 340.7549,-675.636 359.7571,-676.6876 399.0839,-656.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~tarcogcomplexfenestration.f90</title>
<path fill="none" stroke="#bbff00" stroke-dasharray="5,2" d="M224.7543,-1091.258C233.7085,-1199.4196 305.7014,-2065.4546 317.2024,-2089.2048 329.5944,-2114.7949 354.1698,-2136.3938 373.1785,-2150.3278"/>
<polygon fill="#bbff00" stroke="#bbff00" points="371.2701,-2153.2649 381.4568,-2156.1774 375.3097,-2147.5481 371.2701,-2153.2649"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#6bff00" stroke-dasharray="5,2" d="M224.4734,-1091.5315C228.6984,-1164.1104 254.5854,-1564.1189 317.2024,-1666.2048 364.2439,-1742.8975 422.6044,-1716.7309 480.9653,-1785.2048 503.9153,-1812.1316 494.2026,-1829.1195 516.9653,-1856.2048 532.6713,-1874.8933 554.9419,-1891.2445 572.6368,-1902.6026"/>
<polygon fill="#6bff00" stroke="#6bff00" points="571.076,-1905.7539 581.414,-1908.0729 574.7786,-1899.8132 571.076,-1905.7539"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff86" stroke-dasharray="5,2" d="M979.6978,-200.2048C1013.1423,-207.3848 1021.5546,-210.3391 1052.825,-224.2048 1076.5298,-234.7158 1102.0276,-249.5009 1120.3321,-260.7854"/>
<polygon fill="#00ff86" stroke="#00ff86" points="1118.6146,-263.8392 1128.9504,-266.1676 1122.3225,-257.9019 1118.6146,-263.8392"/>
<path fill="none" stroke="#00ff86" stroke-dasharray="5,2" d="M601.1821,-164.2048C761.1993,-109.8765 814.4741,-164.7339 979.6978,-200.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge122" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M224.6455,-1091.2897C229.3577,-1153.1661 255.3213,-1455.3952 317.2024,-1520.2048 375.5382,-1581.3013 971.5545,-1689.162 1052.825,-1712.2048 1119.9789,-1731.2451 1137.2757,-1734.6708 1202.9897,-1758.2048 1250.252,-1775.1307 1257.8335,-1793.4885 1307.4386,-1801.2048"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1307.4386,-1801.2048C1747.2234,-1859.3849 1804.0256,-1001.3259 1810.5181,-854.428"/>
<polygon fill="#00d6ff" stroke="#00d6ff" points="1814.0156,-854.5591 1810.929,-844.4238 1807.0215,-854.2717 1814.0156,-854.5591"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge134" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M232.483,-1069.0723C247.7272,-1050.1007 281.2033,-1011.3195 317.2024,-988.2048 387.7551,-942.9034 481.2393,-914.7435 541.3102,-900.0141"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="542.484,-903.3318 551.3893,-897.5919 540.8483,-896.5256 542.484,-903.3318"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge150" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M399.0839,-1460.2048C413.6332,-1469.4664 900.1414,-1564.5196 1079.9647,-1599.4327"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1079.3458,-1602.8778 1089.8295,-1601.3474 1080.6796,-1596.0061 1079.3458,-1602.8778"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge160" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#ff0050" stroke-dasharray="5,2" d="M399.0839,-392.2048C414.3254,-375.1823 578.3612,-353.0752 601.1821,-354.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M236.6401,-1069.0701C264.5021,-1046.1061 333.428,-996.1167 399.0839,-1002.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M229.3736,-1068.8631C240.6293,-1045.3806 266.3786,-989.507 281.2024,-940.2048 304.9446,-861.2407 261.9161,-819.3802 317.2024,-758.2048 322.204,-752.6704 328.3915,-748.3452 335.1077,-744.9677"/>
<polygon fill="#7fff00" stroke="#7fff00" points="336.7218,-748.0838 344.5322,-740.9249 333.9622,-741.6507 336.7218,-748.0838"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M229.6802,-1068.9491C241.5013,-1045.6251 268.2389,-990.0285 281.2024,-940.2048 297.9986,-875.6504 270.5852,-689.9145 317.2024,-642.2048 370.2398,-587.9244 460.7255,-583.7295 525.3034,-589.2309"/>
<polygon fill="#00ffff" stroke="#00ffff" points="525.15,-592.732 535.4356,-590.191 525.8104,-585.7632 525.15,-592.732"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M228.5265,-1068.9382C246.3839,-1026.0812 309.5522,-875.2171 317.2024,-867.2048 373.2769,-808.4758 411.4201,-828.1203 480.9653,-786.2048 497.869,-776.0168 499.302,-769.0103 516.9653,-760.2048 552.0233,-742.7276 563.3699,-744.4392 601.1821,-734.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge103" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M795.9847,-1460.2048C913.4204,-1455.37 940.1938,-1430.8013 1052.825,-1397.2048 1089.3019,-1386.3241 1347.6196,-1308.6976 1375.8875,-1283.2048 1403.6432,-1258.1737 1394.3929,-1240.2332 1411.8875,-1207.2048 1485.2387,-1068.7233 1584.6783,-908.3619 1619.3822,-853.1061"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1622.5491,-854.6451 1624.9135,-844.3174 1616.6248,-850.9165 1622.5491,-854.6451"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasizing.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge108" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasizing.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M224.3659,-1091.5807C227.7236,-1159.4795 248.2802,-1510.8963 317.2024,-1588.2048 325.4706,-1597.4791 337.0699,-1603.3622 348.9431,-1607.08"/>
<polygon fill="#00ffff" stroke="#00ffff" points="348.3511,-1610.5439 358.9139,-1609.7206 350.1432,-1603.7771 348.3511,-1610.5439"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~branchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge114" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~branchnodeconnections.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M237.878,-1091.2179C255.4563,-1104.4857 286.9497,-1126.5638 317.2024,-1139.2048 351.6729,-1153.6081 364.5196,-1144.028 399.0839,-1158.2048"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M399.0839,-1158.2048C458.0798,-1182.4023 624.2087,-1157.1433 685.3989,-1139.2048 739.2628,-1123.414 749.5243,-1109.7021 795.9847,-1078.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge75" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M399.0839,-1460.2048C474.7478,-1505.5285 707.7849,-1460.4448 795.9847,-1460.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M795.9847,-1460.2048C852.5023,-1457.878 853.5027,-1416.7867 906.5706,-1397.2048 937.6157,-1385.7492 948.7821,-1395.0053 979.6978,-1383.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~fluidproperties.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge87" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~fluidproperties.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M229.8689,-1068.9959C242.038,-1045.7582 269.3838,-990.3124 281.2024,-940.2048 305.9107,-835.4482 266.8228,-552.317 317.2024,-457.2048 338.9512,-416.1449 368.0894,-426.8208 399.0839,-392.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M399.0839,-392.2048C424.3807,-363.9521 447.2077,-385.4836 480.9653,-368.2048 499.0089,-358.9692 497.7927,-346.7831 516.9653,-340.2048 587.7728,-315.9102 610.6879,-335.4944 685.3989,-340.2048 734.8423,-343.3221 746.9982,-361.5999 795.9847,-354.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M795.9847,-354.2048C829.9471,-346.5099 839.7826,-346.4759 870.5706,-330.2048 888.4916,-320.7337 888.736,-311.8376 906.5706,-302.2048 913.9525,-298.2176 922.0912,-294.6867 930.1766,-291.627"/>
<polygon fill="#7fff00" stroke="#7fff00" points="931.3616,-294.9204 939.5952,-288.2525 929.0006,-288.3305 931.3616,-294.9204"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datacontaminantbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge90" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datacontaminantbalance.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M224.0954,-1091.2453C225.9535,-1161.9386 239.6347,-1550.7751 317.2024,-1633.2048 342.8044,-1660.4115 374.6096,-1623.9792 399.0839,-1652.2048"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M399.0839,-1652.2048C411.1772,-1666.1518 462.8047,-1662.8943 480.9653,-1666.2048 567.5798,-1681.9934 667.3147,-1701.5368 730.9579,-1714.1812"/>
<polygon fill="#00ffff" stroke="#00ffff" points="730.3642,-1717.6315 740.8548,-1716.1496 731.7298,-1710.766 730.3642,-1717.6315"/>
</g>
<!-- sourcefile~sortandstringutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node33" class="node">
<title>sourcefile~sortandstringutilities.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node33"><a xlink:href="../sourcefile/sortandstringutilities.f90.html" xlink:title="SortAndStringUtilities.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="463.3044,-1208.2102 334.8633,-1208.2102 334.8633,-1186.1993 463.3044,-1186.1993 463.3044,-1208.2102"/>
<text text-anchor="middle" x="399.0839" y="-1194.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SortAndStringUtilities.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~sortandstringutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~sortandstringutilities.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M232.0851,-1091.2888C246.9732,-1110.5392 280.2515,-1150.1962 317.2024,-1172.2048 324.1021,-1176.3144 331.7368,-1179.8029 339.4889,-1182.7494"/>
<polygon fill="#ff0000" stroke="#ff0000" points="338.3667,-1186.0648 348.9615,-1186.08 340.6886,-1179.4611 338.3667,-1186.0648"/>
</g>
<!-- sourcefile~dataoutputs.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node34" class="node">
<title>sourcefile~dataoutputs.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node34"><a xlink:href="../sourcefile/dataoutputs.f90.html" xlink:title="DataOutputs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="443.5485,-1130.2102 354.6193,-1130.2102 354.6193,-1108.1993 443.5485,-1108.1993 443.5485,-1130.2102"/>
<text text-anchor="middle" x="399.0839" y="-1116.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataOutputs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataoutputs.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataoutputs.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M267.6098,-1089.9455C290.9546,-1095.1408 319.8949,-1101.5814 344.6753,-1107.0963"/>
<polygon fill="#cbff00" stroke="#cbff00" points="344.134,-1110.5614 354.6555,-1109.3173 345.6547,-1103.7285 344.134,-1110.5614"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M399.0839,-1158.2048C447.8056,-1177.8793 464.4592,-1165.2033 516.9653,-1167.2048 828.7473,-1179.0894 928.1363,-1165.8693 1202.9897,-1018.2048 1237.8211,-999.4917 1271.3902,-967.6347 1290.6937,-947.542"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1293.2831,-949.8977 1297.5964,-940.2206 1288.1898,-945.0957 1293.2831,-949.8977"/>
</g>
<!-- sourcefile~dataglobalconstants.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node36" class="node">
<title>sourcefile~dataglobalconstants.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node36"><a xlink:href="../sourcefile/dataglobalconstants.f90.html" xlink:title="DataGlobalConstants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="860.8052,-1204.2102 731.1643,-1204.2102 731.1643,-1182.1993 860.8052,-1182.1993 860.8052,-1204.2102"/>
<text text-anchor="middle" x="795.9847" y="-1190.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataGlobalConstants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataglobalconstants.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge65" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataglobalconstants.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M399.0839,-1460.2048C458.3483,-1498.2748 629.6053,-1367.201 685.3989,-1324.2048 727.5485,-1291.723 764.7628,-1240.7155 783.3767,-1212.902"/>
<polygon fill="#0066ff" stroke="#0066ff" points="786.3852,-1214.6971 788.9564,-1204.419 780.5369,-1210.8503 786.3852,-1214.6971"/>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M224.8253,-1091.355C230.1798,-1144.3953 260.8838,-1372.2313 399.0839,-1460.2048"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~outputreportpredefined.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge67" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~outputreportpredefined.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M225.032,-1091.5877C231.3611,-1149.9967 262.8138,-1415.588 317.2024,-1474.2048 320.8498,-1478.1357 325.0877,-1481.4753 329.6783,-1484.3121"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="328.4015,-1487.5959 338.8786,-1489.1712 331.6706,-1481.4062 328.4015,-1487.5959"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataroomair.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataroomair.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M267.6098,-1070.464C290.5091,-1065.3678 318.7923,-1059.0735 343.2521,-1053.63"/>
<polygon fill="#ff0000" stroke="#ff0000" points="344.1195,-1057.0227 353.1204,-1051.4338 342.5988,-1050.1898 344.1195,-1057.0227"/>
</g>
<!-- sourcefile~databranchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node39" class="node">
<title>sourcefile~databranchnodeconnections.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node39"><a xlink:href="../sourcefile/databranchnodeconnections.f90.html" xlink:title="DataBranchNodeConnections.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="685.6163,-1130.2102 516.748,-1130.2102 516.748,-1108.1993 685.6163,-1108.1993 685.6163,-1130.2102"/>
<text text-anchor="middle" x="601.1821" y="-1116.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataBranchNodeConnections.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~databranchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge110" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~databranchnodeconnections.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M267.633,-1082.2237C318.899,-1084.8686 406.3007,-1090.2542 480.9653,-1099.2048 497.3183,-1101.1651 514.8417,-1103.7825 531.3118,-1106.4762"/>
<polygon fill="#ff0000" stroke="#ff0000" points="530.9716,-1109.9676 541.4107,-1108.158 532.1215,-1103.0627 530.9716,-1109.9676"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datacomplexfenestration.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge142" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datacomplexfenestration.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M224.4798,-1091.2267C229.6834,-1179.327 266.2018,-1767.3137 317.2024,-1825.2048 318.4029,-1826.5675 319.6787,-1827.8475 321.0197,-1829.0497"/>
<polygon fill="#ff0000" stroke="#ff0000" points="319.1999,-1832.0544 329.3424,-1835.117 323.3235,-1826.3978 319.1999,-1832.0544"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataequivalentlayerwindow.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge144" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataequivalentlayerwindow.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M224.2759,-1091.4319C227.4476,-1168.9297 248.8387,-1624.8681 317.2024,-1742.2048 328.8899,-1762.2646 349.6913,-1778.1451 367.4026,-1788.9443"/>
<polygon fill="#00ffff" stroke="#00ffff" points="365.9132,-1792.1267 376.3181,-1794.1236 369.4294,-1786.0739 365.9132,-1792.1267"/>
</g>
<!-- sourcefile~datavectortypes.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge175" class="edge">
<title>sourcefile~datavectortypes.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M225.5726,-2011.5752C231.3709,-2045.2542 253.4658,-2144.7808 317.2024,-2187.2048 422.5041,-2257.295 474.7263,-2203.0413 601.1821,-2206.2048"/>
</g>
<!-- sourcefile~datavectortypes.f90&#45;&gt;sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~datavectortypes.f90&#45;&gt;sourcefile~databsdfwindow.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M278.8078,-2000.2048C295.1003,-2000.2048 313.1505,-2000.2048 330.2066,-2000.2048"/>
<polygon fill="#ff0000" stroke="#ff0000" points="330.6733,-2003.7049 340.6733,-2000.2048 330.6733,-1996.7049 330.6733,-2003.7049"/>
</g>
<!-- sourcefile~datavectortypes.f90&#45;&gt;sourcefile~vectorutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~datavectortypes.f90&#45;&gt;sourcefile~vectorutilities.f90</title>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M242.4372,-2011.2887C273.5485,-2029.0977 338.694,-2063.2914 399.0839,-2075.2048"/>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M399.0839,-2075.2048C579.5117,-2110.7985 612.9809,-1976.3902 795.9847,-1958.2048"/>
</g>
<!-- sourcefile~datavectortypes.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~datavectortypes.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#6bff00" stroke-dasharray="5,2" d="M275.1232,-1989.1965C345.4659,-1974.0967 471.4579,-1947.0513 544.5171,-1931.3685"/>
<polygon fill="#6bff00" stroke="#6bff00" points="545.4208,-1934.7543 554.4635,-1929.2334 543.9516,-1927.9102 545.4208,-1934.7543"/>
</g>
<!-- sourcefile~datavectortypes.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge151" class="edge">
<title>sourcefile~datavectortypes.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M399.0839,-2075.2048C654.7731,-2124.6608 794.058,-2178.8541 979.6978,-1996.2048"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge176" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M634.7262,-898.3622C652.6891,-906.1134 673.5085,-918.3125 685.3989,-936.2048 754.112,-1039.6014 648.4694,-1112.7377 721.3989,-1213.2048 764.5323,-1272.6249 805.981,-1249.2844 870.5706,-1284.2048 954.0003,-1329.311 975.9904,-1339.6031 1052.825,-1395.2048 1173.2785,-1482.3714 1164.6129,-1570.878 1307.4386,-1612.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1307.4386,-1612.2048C1529.9415,-1691.8782 1575.6625,-1763.9216 1811.2917,-1782.2048"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M651.1553,-880.6209C663.5833,-876.9155 676.0189,-871.1533 685.3989,-862.2048 772.5965,-779.0191 791.0788,-623.428 794.9627,-566.6471"/>
<polygon fill="#fff100" stroke="#fff100" points="798.4737,-566.5652 795.5753,-556.3746 791.4862,-566.1485 798.4737,-566.5652"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge128" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M632.8197,-898.2674C650.8356,-906.1459 672.349,-918.5051 685.3989,-936.2048 727.6252,-993.4765 678.3325,-1035.5621 721.3989,-1092.2048 767.0597,-1152.2596 809.4846,-1128.9329 870.5706,-1173.2048 888.3905,-1186.1197 888.5171,-1194.6184 906.5706,-1207.2048 1097.6041,-1340.388 1171.5907,-1328.4263 1375.8875,-1440.2048 1420.5956,-1464.6663 1426.3728,-1516.7782 1474.2096,-1499.2048"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1474.2096,-1499.2048C1602.2396,-1447.1402 1516.8275,-1307.6856 1631.9495,-1231.2048"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge155" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M795.9847,-926.2048C913.6464,-990.7696 847.6696,-1086.6081 906.5706,-1207.2048 981.7764,-1361.1848 1094.4796,-1534.8196 1132.694,-1592.4539"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1129.9114,-1594.5901 1138.3643,-1600.9775 1135.7395,-1590.7129 1129.9114,-1594.5901"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M795.9847,-850.2048C816.824,-849.7324 960.5028,-820.3322 979.6978,-812.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-812.2048C1059.1118,-778.5798 1114.6434,-684.3893 1136.0872,-642.6077"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1139.347,-643.9143 1140.6905,-633.405 1133.0865,-640.7827 1139.347,-643.9143"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M639.2233,-876.122C678.2015,-865.6826 740.7476,-851.4569 795.9847,-850.2048"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge106" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M979.6978,-812.2048C1182.7473,-726.2309 1254.0765,-839.4747 1474.2096,-852.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1474.2096,-852.2048C1503.3199,-851.9817 1535.2376,-848.7134 1562.7002,-844.9485"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1563.1937,-848.4136 1572.603,-843.5437 1562.2105,-841.483 1563.1937,-848.4136"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~branchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge116" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~branchnodeconnections.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M795.9847,-850.2048C828.7859,-849.4612 864.8893,-849.4767 896.345,-849.7612"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="896.3496,-853.2613 906.3844,-849.8624 896.4203,-846.2617 896.3496,-853.2613"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge83" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M795.9847,-850.2048C830.7989,-849.4156 840.061,-857.4173 870.5706,-874.2048 888.818,-884.2452 888.0405,-894.6962 906.5706,-904.2048 1004.3336,-954.3713 1036.6586,-977.9947 1145.9073,-966.2048"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~fluidproperties.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge89" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~fluidproperties.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M650.9144,-882.5381C663.9525,-878.8893 676.7627,-872.677 685.3989,-862.2048 737.9588,-798.4713 682.729,-565.2057 721.3989,-492.2048 761.7553,-416.0202 815.8047,-434.7887 870.5706,-368.2048 891.7959,-342.3992 881.024,-323.7412 906.5706,-302.2048 911.0393,-298.4375 916.1047,-295.2284 921.4343,-292.4967"/>
<polygon fill="#7fff00" stroke="#7fff00" points="922.9372,-295.6583 930.5943,-288.3357 920.0421,-289.285 922.9372,-295.6583"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M795.9847,-926.2048C825.4792,-944.7177 840.061,-933.4173 870.5706,-950.2048 888.818,-960.2452 888.3524,-970.1114 906.5706,-980.2048 936.4919,-996.782 945.7869,-999.7163 979.6978,-1004.2048"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M651.1168,-893.1104C700.5985,-899.6799 772.3221,-911.3523 795.9847,-926.2048"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~dataglobalconstants.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge66" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~dataglobalconstants.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M624.2525,-898.3283C643.6743,-908.9246 670.5867,-926.7337 685.3989,-950.2048 728.9401,-1019.1988 679.9161,-1059.954 721.3989,-1130.2048 732.6703,-1149.2928 751.891,-1165.3199 767.9973,-1176.4319"/>
<polygon fill="#0066ff" stroke="#0066ff" points="766.2822,-1179.4937 776.5546,-1182.0878 770.142,-1173.654 766.2822,-1179.4937"/>
</g>
<!-- sourcefile~dataheatbalfansys.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge177" class="edge">
<title>sourcefile~dataheatbalfansys.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1536.3922,-2205.2048C1565.4262,-2205.2048 1600.4563,-2205.2048 1631.9495,-2205.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge178" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1145.9073,-86.2048C1363.1717,-110.7247 1429.5371,-79.5351 1631.9495,-162.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1811.2917,-276.2048C1912.3961,-395.4186 1993.108,-1586.3597 2004.4335,-1760.8982"/>
<polygon fill="#ff0000" stroke="#ff0000" points="2000.955,-1761.3452 2005.0912,-1771.0992 2007.9405,-1760.8947 2000.955,-1761.3452"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M418.5639,-466.1235C437.8383,-454.0382 466.4932,-432.8171 480.9653,-406.2048 535.8565,-305.2674 446.3005,-240.8021 516.9653,-150.2048 577.2762,-72.882 625.1542,-85.9975 721.3989,-67.2048 906.7577,-31.0116 959.1535,-58.0831 1145.9073,-86.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1631.9495,-162.2048C1720.9438,-193.8343 1750.2024,-204.1734 1811.2917,-276.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~vectorutilities.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~vectorutilities.f90</title>
<path fill="none" stroke="#ffa100" stroke-dasharray="5,2" d="M419.3687,-488.2817C438.9841,-500.2253 467.6369,-521.2113 480.9653,-548.2048 539.2189,-666.1834 477.5315,-1013.6762 516.9653,-1139.2048 569.2402,-1305.6099 628.9407,-1326.3034 721.3989,-1474.2048 786.5779,-1578.4686 822.3176,-1594.1079 870.5706,-1707.2048 897.3057,-1769.8675 878.0543,-1794.3323 906.5706,-1856.2048 921.0152,-1887.5458 945.8257,-1919.0177 962.4916,-1938.3051"/>
<polygon fill="#ffa100" stroke="#ffa100" points="960.0583,-1940.8378 969.2953,-1946.0272 965.3106,-1936.2102 960.0583,-1940.8378"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M601.1821,-524.2048C651.6911,-538.9416 712.2805,-543.5366 752.3297,-544.8654"/>
<polygon fill="#fff100" stroke="#fff100" points="752.4594,-548.3703 762.5524,-545.1483 752.6531,-541.3729 752.4594,-548.3703"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff86" stroke-dasharray="5,2" d="M415.0656,-466.0693C432.7634,-453.1636 461.3769,-430.5324 480.9653,-406.2048 501.9207,-380.1795 491.0393,-361.2828 516.9653,-340.2048 558.645,-306.3189 926.6676,-191.6462 979.6978,-200.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge125" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1631.9495,-467.2048C1726.0882,-581.2541 1786.0479,-753.017 1804.8939,-812.2512"/>
<polygon fill="#00d6ff" stroke="#00d6ff" points="1801.6062,-813.4646 1807.9333,-821.9627 1808.2866,-811.3737 1801.6062,-813.4646"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M417.5719,-465.978C436.3307,-453.6306 464.8359,-432.0686 480.9653,-406.2048 514.0518,-353.1499 472.6399,-314.3046 516.9653,-270.2048 642.5391,-145.2702 730.0427,-200.8791 906.5706,-186.2048 971.3491,-180.8199 988.2578,-178.699 1052.825,-186.2048 1272.2182,-211.7087 1361.7315,-165.191 1536.5317,-300.2048 1563.5951,-321.1082 1555.7269,-338.4226 1572.5317,-368.2048 1597.7499,-412.8973 1599.2826,-427.6288 1631.9495,-467.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge139" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M418.7049,-488.2105C438.0915,-500.2357 466.8344,-521.4097 480.9653,-548.2048 546.4911,-672.455 426.6668,-754.604 516.9653,-862.2048 523.5096,-870.0031 532.3668,-875.4343 541.8858,-879.2027"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="540.9703,-882.5871 551.5642,-882.443 543.1927,-875.9493 540.9703,-882.5871"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge153" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M419.1944,-488.3695C438.6741,-500.3813 467.2236,-521.4193 480.9653,-548.2048 520.8958,-626.0373 467.0631,-868.3569 516.9653,-940.2048 564.3508,-1008.429 636.5088,-954.0506 685.3989,-1021.2048 754.8379,-1116.5842 655.571,-1186.2982 721.3989,-1284.2048 764.0984,-1347.7122 808.3762,-1325.6146 870.5706,-1370.2048 924.4401,-1408.8265 1072.9442,-1544.8246 1126.4078,-1594.1576"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1124.1436,-1596.8309 1133.8643,-1601.045 1128.8933,-1591.6888 1124.1436,-1596.8309"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge161" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#ff0050" stroke-dasharray="5,2" d="M795.9847,-506.2048C806.1724,-504.3888 913.1133,-412.7751 958.9874,-373.1513"/>
<polygon fill="#ff0050" stroke="#ff0050" points="961.5304,-375.5794 966.8054,-366.391 956.9518,-370.2844 961.5304,-375.5794"/>
<path fill="none" stroke="#ff0050" stroke-dasharray="5,2" d="M601.1821,-524.2048C684.6497,-548.5579 710.3862,-521.4626 795.9847,-506.2048"/>
<path fill="none" stroke="#ff0050" stroke-dasharray="5,2" d="M448.0705,-487.0079C489.2442,-495.6257 549.4836,-509.1208 601.1821,-524.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataruntimelanguage.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M417.3752,-488.4276C453.2221,-510.422 532.8442,-559.2752 574.5435,-584.8603"/>
<polygon fill="#00ffff" stroke="#00ffff" points="572.7238,-587.8501 583.0778,-590.0966 576.3846,-581.8836 572.7238,-587.8501"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M795.9847,-506.2048C908.4872,-486.1514 950.9933,-442.3468 1052.825,-494.2048 1097.0678,-516.7355 1125.2285,-571.2311 1137.9677,-601.3422"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1134.8339,-602.9286 1141.8316,-610.8836 1141.3221,-600.301 1134.8339,-602.9286"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge104" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M423.0005,-466.1004C460.4764,-448.9401 535.5458,-415.5256 601.1821,-392.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M601.1821,-392.2048C741.0165,-342.521 761.3741,-287.8664 906.5706,-257.2048 970.1699,-243.7743 993.4457,-230.7595 1052.825,-257.2048 1074.6736,-266.9354 1067.196,-286.995 1088.825,-297.2048 1127.5857,-315.5015 1444.8927,-282.9369 1474.2096,-314.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~branchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge115" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~branchnodeconnections.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M601.1821,-524.2048C644.57,-536.8639 653.6875,-549 685.3989,-581.2048 705.8972,-602.0219 703.1185,-613.4153 721.3989,-636.2048 758.2894,-682.1947 856.7392,-794.6958 906.5706,-826.2048 912.8077,-830.1486 919.7402,-833.5517 926.7814,-836.4645"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="925.8047,-839.838 936.3953,-840.1372 928.3028,-833.299 925.8047,-839.838"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge84" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M795.9847,-506.2048C816.5878,-502.7491 961.2084,-536.4801 979.6978,-546.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-546.2048C1012.2978,-563.3511 1025.8415,-560.1319 1052.825,-585.2048 1074.7748,-605.6004 1069.8996,-618.9752 1088.825,-642.2048 1133.3294,-696.8309 1156.2159,-699.5088 1202.9897,-752.2048 1254.052,-809.7321 1236.4522,-860.579 1307.4386,-890.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~fluidproperties.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge88" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~fluidproperties.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M601.1821,-392.2048C684.3022,-362.6718 708.7622,-367.3721 795.9847,-354.2048"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M601.1821,-524.2048C663.2306,-542.997 815.6085,-601.8197 870.5706,-636.2048 884.2925,-644.7894 1075.4082,-820.1506 1088.825,-829.2048 1145.7119,-867.5942 1219.7145,-897.9246 1265.375,-914.7104"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1264.3561,-918.0639 1274.9503,-918.1845 1266.7436,-911.4837 1264.3561,-918.0639"/>
</g>
<!-- sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge179" class="edge">
<title>sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1811.2917,-1782.2048C1846.9889,-1784.9746 1886.4823,-1785.45 1920.5035,-1785.0564"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1920.9271,-1788.5508 1930.8759,-1784.908 1920.8268,-1781.5515 1920.9271,-1788.5508"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1201.9321,-1604.6352C1233.5201,-1602.2289 1273.3613,-1602.3445 1307.4386,-1612.2048"/>
</g>
<!-- sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge127" class="edge">
<title>sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1307.4386,-1499.2048C1332.5617,-1471.9598 1439.4225,-1511.9843 1474.2096,-1499.2048"/>
</g>
<!-- sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge82" class="edge">
<title>sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1307.4386,-1499.2048C1328.8413,-1475.9945 1354.6383,-1503.5556 1375.8875,-1480.2048 1448.7135,-1400.1755 1469.2414,-1042.3735 1473.3486,-950.6729"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1476.8477,-950.7677 1473.7795,-940.6269 1469.8541,-950.4677 1476.8477,-950.7677"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1175.4722,-1601.1692C1184.5767,-1597.2717 1194.4462,-1592.5192 1202.9897,-1587.2048 1254.5329,-1555.143 1266.2891,-1543.8296 1307.4386,-1499.2048"/>
</g>
<!-- sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge62" class="edge">
<title>sourcefile~dataheatbalance.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M1148.056,-1601.1127C1157.6907,-1551.6308 1198.2242,-1346.151 1238.9897,-1179.2048 1259.8521,-1093.7677 1288.7541,-993.0752 1301.2614,-950.2147"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1304.623,-951.189 1304.0731,-940.6085 1297.9049,-949.2226 1304.623,-951.189"/>
</g>
<!-- sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge180" class="edge">
<title>sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M407.3511,-898.4877C423.442,-920.883 459.2869,-972.9607 480.9653,-1021.2048 503.4389,-1071.2184 487.1017,-1093.2202 516.9653,-1139.2048 630.3204,-1313.7508 723.9661,-1298.4793 870.5706,-1446.2048 1081.0449,-1658.2885 1010.1467,-1927.2631 1307.4386,-1957.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1307.4386,-1957.2048C1544.105,-1943.5976 1574.356,-1789.7935 1811.2917,-1782.2048"/>
</g>
<!-- sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge138" class="edge">
<title>sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M463.8629,-887.2048C488.7146,-887.2048 516.9409,-887.2048 541.312,-887.2048"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="541.4997,-890.7049 551.4997,-887.2048 541.4996,-883.7049 541.4997,-890.7049"/>
</g>
<!-- sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M445.7231,-876.1697C457.5586,-872.5128 470.0154,-867.8872 480.9653,-862.2048 498.9568,-852.8682 499.0489,-843.6845 516.9653,-834.2048 738.1732,-717.1617 818.1244,-748.0821 1052.825,-661.2048 1072.5121,-653.9173 1094.1602,-644.9086 1111.6215,-637.386"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1113.0723,-640.5718 1120.8524,-633.3801 1110.2856,-634.1504 1113.0723,-640.5718"/>
</g>
<!-- sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge76" class="edge">
<title>sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1307.4386,-1193.2048C1397.1001,-1128.9036 1449.6044,-999.9828 1467.3622,-949.8306"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1470.6713,-950.9706 1470.625,-940.3759 1464.0542,-948.687 1470.6713,-950.9706"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M421.8004,-898.3404C445.305,-909.6427 483.2334,-927.2709 516.9653,-940.2048 603.072,-973.2207 1232.4985,-1246.9484 1307.4386,-1193.2048"/>
</g>
<!-- sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge63" class="edge">
<title>sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M449.5277,-898.2833C490.279,-906.9077 549.2002,-918.6449 601.1821,-926.2048"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M601.1821,-926.2048C638.7305,-931.6655 648.1343,-933.06 685.3989,-940.2048 816.861,-965.4101 846.9985,-986.6406 979.6978,-1004.2048"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge181" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~windowcomplexmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1145.9073,-429.2048C1265.521,-522.5434 1706.6208,-166.3707 1811.2917,-276.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1017.4579,-366.2154C1053.0783,-377.875 1106.7118,-398.8244 1145.9073,-429.2048"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff86" stroke-dasharray="5,2" d="M1016.2998,-344.1934C1028.1386,-340.2363 1041.2048,-335.443 1052.825,-330.2048 1076.3197,-319.6136 1101.6555,-304.9573 1119.9536,-293.741"/>
<polygon fill="#00ff86" stroke="#00ff86" points="1121.9307,-296.6333 1128.5825,-288.3868 1118.24,-290.6853 1121.9307,-296.6333"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge154" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M987.6798,-366.4136C1003.414,-389.1957 1038.1754,-443.0905 1052.825,-494.2048 1112.4985,-702.414 1071.0827,-764.3409 1088.825,-980.2048 1108.5224,-1219.8574 1136.1265,-1510.2721 1143.8362,-1590.6795"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1140.3862,-1591.3683 1144.826,-1600.988 1147.3541,-1590.6992 1140.3862,-1591.3683"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1030.9608,-366.2476C1038.9763,-369.7081 1046.6395,-374.2487 1052.825,-380.2048 1086.0489,-412.1967 1125.7272,-548.0379 1140.2376,-600.9695"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1136.9456,-602.2033 1142.9406,-610.9389 1143.7017,-600.3715 1136.9456,-602.2033"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge107" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1145.9073,-429.2048C1208.6077,-478.132 1228.4511,-496.9217 1307.4386,-506.2048"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1307.4386,-506.2048C1478.5724,-526.3174 1591.4945,-744.1692 1622.9805,-812.6954"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1619.8834,-814.3418 1627.1825,-822.0212 1626.2654,-811.4661 1619.8834,-814.3418"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge80" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1145.9073,-429.2048C1319.9386,-575.5256 1271.8787,-687.0562 1411.8875,-866.2048 1424.597,-882.4674 1441.1011,-898.9866 1453.9322,-911.0275"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1451.6583,-913.6917 1461.38,-917.9035 1456.4067,-908.5484 1451.6583,-913.6917"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge64" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M1145.9073,-429.2048C1207.88,-481.3097 1185.4251,-523.1667 1202.9897,-602.2048 1217.6518,-668.1815 1197.0393,-851.2136 1238.9897,-904.2048 1241.64,-907.5525 1244.7811,-910.4521 1248.2377,-912.9634"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1246.4264,-915.9583 1256.7928,-918.147 1250.0539,-909.9715 1246.4264,-915.9583"/>
</g>
<!-- sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M609.7087,-1029.9633C626.2998,-1007.6405 663.2361,-955.6842 685.3989,-907.2048 742.007,-783.3789 779.421,-622.8708 791.6306,-566.1634"/>
<polygon fill="#fff100" stroke="#fff100" points="795.0827,-566.7562 793.7347,-556.2475 788.2351,-565.3032 795.0827,-566.7562"/>
</g>
<!-- sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge119" class="edge">
<title>sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M625.5442,-1052.3836C644.4162,-1062.213 669.8814,-1078.2227 685.3989,-1099.2048 716.9926,-1141.9242 680.4974,-1179.2906 721.3989,-1213.2048 1001.7238,-1445.6407 1188.5346,-1403.4731 1536.5317,-1296.2048 1585.5677,-1281.0897 1589.209,-1259.5993 1631.9495,-1231.2048"/>
</g>
<!-- sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M427.4589,-722.1694C466.4947,-707.0393 539.0001,-679.1206 601.1821,-656.2048"/>
</g>
<!-- sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge135" class="edge">
<title>sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M453.2357,-741.8753C463.4116,-745.552 473.2598,-750.7785 480.9653,-758.2048 516.1846,-792.1473 481.6146,-828.3992 516.9653,-862.2048 523.9191,-868.8546 532.5599,-873.7452 541.634,-877.3398"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="540.5998,-880.6853 551.1945,-880.636 542.8814,-874.0676 540.5998,-880.6853"/>
</g>
<!-- sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M601.1821,-734.2048C768.7123,-679.0919 974.5063,-645.6057 1078.6611,-630.9435"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1079.3017,-634.3881 1088.7228,-629.5412 1078.3354,-627.4551 1079.3017,-634.3881"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M453.2801,-741.1914C494.563,-745.4387 552.4118,-747.4052 601.1821,-734.2048"/>
</g>
<!-- sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge77" class="edge">
<title>sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M453.3237,-740.4932C473.3113,-743.0771 496.1514,-745.9101 516.9653,-748.2048 754.7192,-774.4162 819.3899,-746.032 1052.825,-798.2048 1170.2502,-824.4493 1194.8073,-847.8769 1307.4386,-890.2048"/>
</g>
<!-- sourcefile~dataruntimelanguage.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~dataruntimelanguage.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M639.6689,-590.141C672.2659,-580.7703 718.9645,-567.3458 752.8243,-557.6121"/>
<polygon fill="#fff100" stroke="#fff100" points="753.8065,-560.9716 762.4502,-554.845 751.8724,-554.2441 753.8065,-560.9716"/>
</g>
<!-- sourcefile~datastringglobals.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node24" class="node">
<title>sourcefile~datastringglobals.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~EfferentGraph_node24"><a xlink:href="../sourcefile/datastringglobals.f90.html" xlink:title="DataStringGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="281.0645,-744.2102 166.6166,-744.2102 166.6166,-722.1993 281.0645,-722.1993 281.0645,-744.2102"/>
<text text-anchor="middle" x="223.8406" y="-730.0548" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataStringGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M601.1821,-656.2048C639.215,-642.1886 653.7543,-646.5341 685.3989,-621.2048 707.0594,-603.867 699.1411,-586.7689 721.3989,-570.2048 730.5421,-563.4005 741.6502,-558.3757 752.4706,-554.6934"/>
<polygon fill="#fff100" stroke="#fff100" points="753.7361,-557.9659 762.2622,-551.6765 751.6749,-551.2762 753.7361,-557.9659"/>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M399.0839,-656.2048C478.7476,-614.7129 516.9017,-687.2645 601.1821,-656.2048"/>
<path fill="none" stroke="#fff100" stroke-dasharray="5,2" d="M240.7769,-721.995C259.0279,-710.3019 289.2287,-692.0556 317.2024,-680.2048 352.121,-665.4118 365.4497,-673.7227 399.0839,-656.2048"/>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge137" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M399.0839,-772.2048C434.9578,-784.5009 451.4368,-772.4098 480.9653,-796.2048 506.9825,-817.1702 490.9843,-841.1945 516.9653,-862.2048 524.1938,-868.0503 532.7545,-872.5295 541.6031,-875.9616"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="540.6737,-879.3432 551.2684,-879.2899 542.9529,-872.7246 540.6737,-879.3432"/>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge157" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90</title>
<path fill="none" stroke="#ff00a1" stroke-dasharray="5,2" d="M236.4436,-744.2801C266.358,-770.5681 341.8738,-836.9298 378.5128,-869.1274"/>
<polygon fill="#ff00a1" stroke="#ff00a1" points="376.3001,-871.8423 386.1222,-875.8143 380.9209,-866.5841 376.3001,-871.8423"/>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~schedulemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~schedulemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M271.1704,-722.1562C285.8663,-718.9711 302.1559,-715.6893 317.2024,-713.2048 479.7563,-686.3636 522.3823,-694.0757 685.3989,-670.2048 734.7798,-662.9738 856.9435,-636.4882 906.5706,-631.2048 964.3517,-625.0533 1030.3689,-622.9359 1078.4123,-622.2814"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1078.7293,-625.7779 1088.6872,-622.1599 1078.6465,-618.7784 1078.7293,-625.7779"/>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge70" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1145.9073,-966.2048C1225.0849,-961.1162 1234.9116,-858.0361 1307.4386,-890.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M274.9566,-744.2902C324.5227,-755.0843 393.1132,-770.1583 399.0839,-772.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M601.1821,-848.2048C653.8837,-858.4868 667.7701,-838.8747 721.3989,-836.2048 787.6154,-832.9081 809.1416,-811.2654 870.5706,-836.2048 891.2469,-844.5991 886.9509,-860.5725 906.5706,-871.2048 965.157,-902.9537 991.5732,-877.9639 1052.825,-904.2048 1098.5155,-923.7791 1096.3027,-969.3927 1145.9073,-966.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M399.0839,-772.2048C489.8621,-803.3199 507.4699,-827.5443 601.1821,-848.2048"/>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M601.1821,-848.2048C666.861,-860.4946 869.5116,-911.3336 870.5706,-912.2048 900.0564,-936.4609 876.4965,-966.6818 906.5706,-990.2048 932.6356,-1010.5921 946.9066,-999.7588 979.6978,-1004.2048"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M979.6978,-1004.2048C1078.6555,-1017.239 1107.0823,-1007.8507 1202.9897,-980.2048 1230.9025,-972.1587 1260.4504,-957.0353 1280.9685,-945.3382"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1282.8404,-948.2983 1289.722,-940.2426 1279.3188,-942.2487 1282.8404,-948.2983"/>
</g>
<!-- sourcefile~schedulemanager.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge117" class="edge">
<title>sourcefile~schedulemanager.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1631.9495,-1231.2048C1770.9148,-1146.7653 1802.9187,-924.2994 1809.6389,-854.4816"/>
<polygon fill="#00d6ff" stroke="#00d6ff" points="1813.1456,-854.5603 1810.5403,-844.2907 1806.1728,-853.9435 1813.1456,-854.5603"/>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1474.2096,-814.2048C1510.8271,-848.9768 1515.282,-863.3966 1536.5317,-909.2048 1599.3432,-1044.6076 1504.3895,-1308.714 1631.9495,-1231.2048"/>
</g>
<!-- sourcefile~schedulemanager.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge94" class="edge">
<title>sourcefile~schedulemanager.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1474.2096,-814.2048C1487.7685,-825.3048 1526.7233,-830.0668 1562.5258,-832.0479"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1562.3577,-835.5438 1572.5166,-832.5359 1562.6993,-828.5521 1562.3577,-835.5438"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1170.6367,-633.3422C1227.6947,-659.7185 1371.5156,-730.1345 1474.2096,-814.2048"/>
</g>
<!-- sourcefile~schedulemanager.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge69" class="edge">
<title>sourcefile~schedulemanager.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1153.098,-633.4862C1164.6555,-651.9378 1187.6226,-689.9524 1202.9897,-724.2048 1223.0116,-768.8323 1212.02,-787.3988 1238.9897,-828.2048 1261.6218,-862.4477 1269.0161,-875.7652 1307.4386,-890.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1307.4386,-890.2048C1326.2183,-897.2623 1371.5372,-907.7158 1410.199,-916.0241"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1409.8702,-919.5326 1420.3804,-918.1961 1411.3307,-912.6867 1409.8702,-919.5326"/>
</g>
<!-- sourcefile~schedulemanager.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~schedulemanager.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M1149.4496,-633.3797C1165.8638,-685.1056 1233.9442,-898.9984 1238.9897,-904.2048 1242.3877,-907.711 1246.3168,-910.7283 1250.5397,-913.3243"/>
<polygon fill="#00ff66" stroke="#00ff66" points="1249.0676,-916.505 1259.5443,-918.083 1252.3384,-910.3161 1249.0676,-916.505"/>
</g>
<!-- sourcefile~nodeinputmanager.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge123" class="edge">
<title>sourcefile~nodeinputmanager.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1691.6678,-833.2048C1706.6298,-833.2048 1722.8488,-833.2048 1738.3731,-833.2048"/>
<polygon fill="#00d6ff" stroke="#00d6ff" points="1738.4544,-836.7049 1748.4543,-833.2048 1738.4543,-829.7049 1738.4544,-836.7049"/>
</g>
<!-- sourcefile~datasizing.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge124" class="edge">
<title>sourcefile~datasizing.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M439.3892,-1621.2195C494.8133,-1632.2427 597.6714,-1652.7077 685.3989,-1670.2048 767.7032,-1686.6202 788.3953,-1690.1551 870.5706,-1707.2048 1065.0363,-1747.5524 1110.1551,-1778.3119 1307.4386,-1801.2048"/>
</g>
<!-- sourcefile~datasizing.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge136" class="edge">
<title>sourcefile~datasizing.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M413.5231,-1602.1607C432.8766,-1586.3937 466.4707,-1555.4144 480.9653,-1520.2048 532.4885,-1395.0474 432.8436,-1018.2356 516.9653,-912.2048 523.2927,-904.2295 532.0461,-898.7135 541.5301,-894.9166"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="542.8329,-898.1711 551.1949,-891.6652 540.6009,-891.5365 542.8329,-898.1711"/>
</g>
<!-- sourcefile~branchnodeconnections.f90&#45;&gt;sourcefile~datazoneequipment.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge126" class="edge">
<title>sourcefile~branchnodeconnections.f90&#45;&gt;sourcefile~datazoneequipment.f90</title>
<path fill="none" stroke="#00d6ff" stroke-dasharray="5,2" d="M1046.3293,-862.253C1048.629,-863.7226 1050.8075,-865.3668 1052.825,-867.2048 1091.7885,-902.7028 1066.0681,-932.6611 1088.825,-980.2048 1141.0512,-1089.3157 1134.2352,-1146.713 1238.9897,-1207.2048 1390.5145,-1294.7046 1482.416,-1322.0658 1631.9495,-1231.2048"/>
</g>
<!-- sourcefile~branchnodeconnections.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge105" class="edge">
<title>sourcefile~branchnodeconnections.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1053.0708,-849.0632C1149.6855,-846.7678 1324.8137,-844.4173 1474.2096,-852.2048"/>
</g>
<!-- sourcefile~outputprocessor.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge96" class="edge">
<title>sourcefile~outputprocessor.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1492.3044,-918.1923C1519.8508,-901.4277 1572.4942,-869.389 1604.6878,-849.7962"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1606.8571,-852.5732 1613.5798,-844.3845 1603.2179,-846.5935 1606.8571,-852.5732"/>
</g>
<!-- sourcefile~fluidproperties.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge97" class="edge">
<title>sourcefile~fluidproperties.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1019.8004,-288.2525C1030.8189,-291.9932 1042.5544,-296.6574 1052.825,-302.2048 1070.6595,-311.8376 1071.6006,-319.5189 1088.825,-330.2048 1276.5595,-446.674 1390.6682,-380.2735 1536.5317,-546.2048 1606.9538,-626.3154 1625.6951,-759.9986 1630.4323,-811.793"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1626.9707,-812.4034 1631.2831,-822.0809 1633.9469,-811.8264 1626.9707,-812.4034"/>
</g>
<!-- sourcefile~datacontaminantbalance.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge99" class="edge">
<title>sourcefile~datacontaminantbalance.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M816.7577,-1716.0405C878.1879,-1682.654 1063.4069,-1579.3028 1202.9897,-1473.2048 1220.2696,-1460.0702 1222.4328,-1454.2397 1238.9897,-1440.2048 1303.0518,-1385.9009 1490.6396,-1277.538 1536.5317,-1207.2048 1613.0743,-1089.8973 1628.2353,-914.8112 1631.2219,-854.5097"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1634.7269,-854.4686 1631.6609,-844.3272 1627.7334,-854.1671 1634.7269,-854.4686"/>
</g>
<!-- sourcefile~dataerrortracking.f90&#45;&gt;sourcefile~nodeinputmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge100" class="edge">
<title>sourcefile~dataerrortracking.f90&#45;&gt;sourcefile~nodeinputmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M1344.4496,-1449.1792C1396.827,-1431.4698 1491.2332,-1391.3568 1536.5317,-1321.2048 1562.5221,-1280.9545 1615.1931,-943.5158 1628.7235,-854.6063"/>
<polygon fill="#7fff00" stroke="#7fff00" points="1632.2012,-855.0165 1630.2396,-844.6049 1625.2803,-853.9673 1632.2012,-855.0165"/>
</g>
<!-- sourcefile~sortandstringutilities.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge131" class="edge">
<title>sourcefile~sortandstringutilities.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M462.6495,-1186.0843C469.5948,-1182.6096 475.9507,-1178.0861 480.9653,-1172.2048 556.6548,-1083.4344 440.9319,-1000.6807 516.9653,-912.2048 523.526,-904.5705 532.3015,-899.2109 541.7137,-895.4606"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="542.9302,-898.744 551.2797,-892.2221 540.6855,-892.1137 542.9302,-898.744"/>
</g>
<!-- sourcefile~sortandstringutilities.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge71" class="edge">
<title>sourcefile~sortandstringutilities.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-1383.2048C1055.3734,-1346.3224 1241.8426,-1245.9711 1307.4386,-1193.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M412.4778,-1208.4422C476.7787,-1260.9653 759.7347,-1475.87 979.6978,-1383.2048"/>
</g>
<!-- sourcefile~dataoutputs.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge132" class="edge">
<title>sourcefile~dataoutputs.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#1a00ff" stroke-dasharray="5,2" d="M423.1603,-1108.1423C441.7297,-1098.3788 466.5952,-1082.4009 480.9653,-1061.2048 519.1955,-1004.8148 470.0481,-961.6027 516.9653,-912.2048 523.8187,-904.989 532.6496,-899.8275 542.0048,-896.1418"/>
<polygon fill="#1a00ff" stroke="#1a00ff" points="543.1357,-899.4541 551.4809,-892.9266 540.8865,-892.8253 543.1357,-899.4541"/>
</g>
<!-- sourcefile~dataoutputs.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge73" class="edge">
<title>sourcefile~dataoutputs.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M435.9234,-1130.2521C517.418,-1154.6488 706.9371,-1211.139 721.3989,-1213.2048 787.0312,-1222.58 804.5442,-1219.2052 870.5706,-1213.2048 919.677,-1208.742 930.3977,-1192.2764 979.6978,-1193.2048"/>
</g>
<!-- sourcefile~sqlitefortranroutines.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge78" class="edge">
<title>sourcefile~sqlitefortranroutines.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1376.2336,-929.2048C1387.4996,-929.2048 1399.1324,-929.2048 1410.2745,-929.2048"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1410.3445,-932.7049 1420.3445,-929.2048 1410.3445,-925.7049 1410.3445,-932.7049"/>
</g>
<!-- sourcefile~dataglobalconstants.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge79" class="edge">
<title>sourcefile~dataglobalconstants.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M860.6449,-1194.8719C895.8669,-1195.3602 940.2037,-1195.2949 979.6978,-1193.2048"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M979.6978,-1193.2048C1125.1568,-1185.5066 1187.5856,-1275.9868 1307.4386,-1193.2048"/>
</g>
<!-- sourcefile~outputreportpredefined.f90&#45;&gt;sourcefile~outputprocessor.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge81" class="edge">
<title>sourcefile~outputreportpredefined.f90&#45;&gt;sourcefile~outputprocessor.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M471.0021,-1509.5282C565.9802,-1518.9157 736.8306,-1525.5558 870.5706,-1474.2048 889.7509,-1466.8402 888.5167,-1455.0119 906.5706,-1445.2048 966.6867,-1412.5488 990.5281,-1425.4796 1052.825,-1397.2048 1123.4702,-1365.1408 1146.4671,-1361.3465 1202.9897,-1308.2048 1223.736,-1288.6995 1220.305,-1276.693 1238.9897,-1255.2048 1265.9229,-1224.2306 1275.8949,-1219.4685 1307.4386,-1193.2048"/>
</g>
<!-- sourcefile~dataroomair.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~dataroomair.f90&#45;&gt;sourcefile~sqlitefortranroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M445.3245,-1050.8995C466.9738,-1054.9617 493.1779,-1059.2012 516.9653,-1061.2048 591.5606,-1067.4879 610.8818,-1068.3546 685.3989,-1061.2048 818.02,-1048.4799 847.5974,-986.8905 979.6978,-1004.2048"/>
</g>
<!-- sourcefile~databranchnodeconnections.f90&#45;&gt;sourcefile~branchnodeconnections.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge113" class="edge">
<title>sourcefile~databranchnodeconnections.f90&#45;&gt;sourcefile~branchnodeconnections.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M795.9847,-1078.2048C879.6696,-1021.4716 944.4552,-915.3814 969.0054,-871.2561"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="972.1456,-872.8085 973.876,-862.3559 966.005,-869.4481 972.1456,-872.8085"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M685.8525,-1115.5656C722.285,-1110.5824 763.8022,-1100.0225 795.9847,-1078.2048"/>
</g>
<!-- sourcefile~datacomplexfenestration.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge152" class="edge">
<title>sourcefile~datacomplexfenestration.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M443.6446,-1835.1292C493.4649,-1823.0706 571.101,-1805.3363 601.1821,-1804.2048"/>
</g>
<!-- sourcefile~dataequivalentlayerwindow.f90&#45;&gt;sourcefile~dataheatbalance.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~EfferentGraph_edge156" class="edge">
<title>sourcefile~dataequivalentlayerwindow.f90&#45;&gt;sourcefile~dataheatbalance.f90</title>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M481.2416,-1806.5853C517.9625,-1806.7419 561.7647,-1806.2956 601.1821,-1804.2048"/>
<path fill="none" stroke="#ff00f1" stroke-dasharray="5,2" d="M601.1821,-1804.2048C803.6958,-1793.463 890.9352,-1861.3476 1052.825,-1739.2048 1079.4981,-1719.0804 1069.2536,-1700.2862 1088.825,-1673.2048 1099.9753,-1657.7757 1114.6967,-1642.1332 1126.3964,-1630.5518"/>
<polygon fill="#ff00f1" stroke="#ff00f1" points="1128.8481,-1633.0498 1133.5806,-1623.5706 1123.9697,-1628.0296 1128.8481,-1633.0498"/>
</g>
</g>
</svg>
</div>
                <script>var pansourcefilewindowcomplexmanagerf90EfferentGraph = svgPanZoom('#sourcefilewindowcomplexmanagerf90EfferentGraph', {
                    zoomEnabled: true,
                    controlIconsEnabled: true,
                    fit: true,
                    center: true,});
                    </script>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">

    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="186pt" height="31pt"
 viewBox="0.00 0.00 186.41 30.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 26.5)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-26.5 182.4064,-26.5 182.4064,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65.1576,-22.2554 -.0526,-22.2554 -.0526,-.2446 65.1576,-.2446 65.1576,-22.2554"/>
<text text-anchor="middle" x="32.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="178.2607,-22.2554 82.8443,-22.2554 82.8443,-.2446 178.2607,-.2446 178.2607,-22.2554"/>
<text text-anchor="middle" x="130.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>


    <p>Solid arrows point from a file to a file which depends upon it. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>

                      </div>
                    </div>
                  </div>
                </div>


      <h3>Files Dependent On This One</h3>

                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~windowcomplexmanager.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilewindowcomplexmanagerf90AfferentGraph" width="641pt" height="111pt"
 viewBox="0.00 0.00 641.00 110.67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph" class="graph" transform="scale(.4306 .4306) rotate(0) translate(4 252.9927)">
<title>sourcefile~~windowcomplexmanager.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-252.9927 1484.5403,-252.9927 1484.5403,4 -4,4"/>
<!-- sourcefile~windowcomplexmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~windowcomplexmanager.f90</title>
<polygon fill="none" stroke="#000000" points="149.2345,-119.2554 -.0782,-119.2554 -.0782,-97.2446 149.2345,-97.2446 149.2345,-119.2554"/>
<text text-anchor="middle" x="74.5781" y="-105.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">WindowComplexManager.f90</text>
</g>
<!-- sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~heatbalancemanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/heatbalancemanager.f90.html" xlink:title="HeatBalanceManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1057.2898,-138.2554 927.2791,-138.2554 927.2791,-116.2446 1057.2898,-116.2446 1057.2898,-138.2554"/>
<text text-anchor="middle" x="992.2844" y="-124.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M414.275,-245.25C589.6632,-255.8264 635.5884,-241.6754 807.687,-206.25"/>
</g>
<!-- sourcefile~windowmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~windowmanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/windowmanager.f90.html" xlink:title="WindowManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="658.43,-217.2554 550.9787,-217.2554 550.9787,-195.2446 658.43,-195.2446 658.43,-217.2554"/>
<text text-anchor="middle" x="604.7043" y="-203.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">WindowManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~windowmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~windowmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M414.275,-245.25C463.9309,-242.7142 519.5059,-230.1794 557.7395,-219.9948"/>
<polygon fill="#ff0000" stroke="#ff0000" points="558.8235,-223.3273 567.5573,-217.3296 556.9896,-216.5718 558.8235,-223.3273"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M88.9797,-119.3696C134.3503,-153.195 279.3206,-252.1417 414.275,-245.25"/>
</g>
<!-- sourcefile~daylightingmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~daylightingmanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node4"><a xlink:href="../sourcefile/daylightingmanager.f90.html" xlink:title="DaylightingManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="307.647,-119.2554 184.9924,-119.2554 184.9924,-97.2446 307.647,-97.2446 307.647,-119.2554"/>
<text text-anchor="middle" x="246.3197" y="-105.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DaylightingManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~daylightingmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~daylightingmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M149.4069,-108.25C157.8896,-108.25 166.5185,-108.25 174.9551,-108.25"/>
<polygon fill="#ff0000" stroke="#ff0000" points="175.1277,-111.7501 185.1276,-108.25 175.1276,-104.7501 175.1277,-111.7501"/>
</g>
<!-- sourcefile~solarshading.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~solarshading.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node5"><a xlink:href="../sourcefile/solarshading.f90.html" xlink:title="SolarShading.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="650.7652,-61.2554 558.6435,-61.2554 558.6435,-39.2446 650.7652,-39.2446 650.7652,-61.2554"/>
<text text-anchor="middle" x="604.7043" y="-47.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SolarShading.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~solarshading.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~windowcomplexmanager.f90&#45;&gt;sourcefile~solarshading.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M130.1122,-97.2125C147.6674,-93.9906 167.177,-90.6853 185.1563,-88.25 314.5134,-70.7286 467.4362,-59.1675 548.1829,-53.7727"/>
<polygon fill="#ff0000" stroke="#ff0000" points="548.8665,-57.2353 558.6139,-53.0834 548.4048,-50.2505 548.8665,-57.2353"/>
</g>
<!-- sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~sizingmanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node6"><a xlink:href="../sourcefile/sizingmanager.f90.html" xlink:title="SizingManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1192.5048,-138.2554 1093.5472,-138.2554 1093.5472,-116.2446 1192.5048,-116.2446 1192.5048,-138.2554"/>
<text text-anchor="middle" x="1143.026" y="-124.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SizingManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~sizingmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1057.5252,-127.25C1066.0105,-127.25 1074.6703,-127.25 1083.0638,-127.25"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1083.1404,-130.7501 1093.1403,-127.25 1083.1403,-123.7501 1083.1404,-130.7501"/>
</g>
<!-- sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~simulationmanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node7"><a xlink:href="../sourcefile/simulationmanager.f90.html" xlink:title="SimulationManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1348.1229,-61.2554 1228.3124,-61.2554 1228.3124,-39.2446 1348.1229,-39.2446 1348.1229,-61.2554"/>
<text text-anchor="middle" x="1288.2177" y="-47.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SimulationManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1029.7833,-116.1906C1060.1075,-107.577 1104.0214,-95.845 1143.026,-88.25"/>
</g>
<!-- sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M658.7196,-212.1015C699.9641,-215.1666 757.975,-216.4403 807.687,-206.25"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~heatbalancesurfacemanager.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node10"><a xlink:href="../sourcefile/heatbalancesurfacemanager.f90.html" xlink:title="HeatBalanceSurfaceManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="890.8777,-119.2554 724.4963,-119.2554 724.4963,-97.2446 890.8777,-97.2446 890.8777,-119.2554"/>
<text text-anchor="middle" x="807.687" y="-105.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceSurfaceManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~windowmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M627.5945,-195.1987C663.8578,-177.6907 734.6169,-143.5282 775.8202,-123.6353"/>
<polygon fill="#7fff00" stroke="#7fff00" points="777.3969,-126.7607 784.8805,-119.261 774.3534,-120.4569 777.3969,-126.7607"/>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~solarshading.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~solarshading.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M414.275,-88.25C459.6607,-81.0308 510.7074,-70.7251 548.517,-62.6669"/>
<polygon fill="#00ffff" stroke="#00ffff" points="549.2787,-66.0833 558.3226,-60.5643 547.811,-59.2388 549.2787,-66.0833"/>
</g>
<!-- sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~utilityroutines.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node9"><a xlink:href="../sourcefile/utilityroutines.f90.html" xlink:title="UtilityRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1480.3512,-22.2554 1384.109,-22.2554 1384.109,-.2446 1480.3512,-.2446 1480.3512,-22.2554"/>
<text text-anchor="middle" x="1432.2301" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">UtilityRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1288.2177,-11.25C1316.2971,-9.3728 1347.525,-9.1464 1373.7044,-9.4819"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1373.7895,-12.9836 1383.8438,-9.6427 1373.9006,-5.9845 1373.7895,-12.9836"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M307.5099,-102.1302C339.4177,-98.6443 379.0396,-93.8547 414.275,-88.25"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M414.275,-88.25C467.6159,-79.7654 469.1869,-45.2732 521.0669,-30.25 643.6952,5.2602 680.0207,-11.25 807.687,-11.25 807.687,-11.25 807.687,-11.25 992.2844,-11.25 1123.8103,-11.25 1156.9847,-20.0233 1288.2177,-11.25"/>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M604.7043,-89.25C641.7506,-89.1849 682.4352,-92.3492 717.5901,-96.113"/>
<polygon fill="#00ffff" stroke="#00ffff" points="717.5069,-99.625 727.8304,-97.2426 718.2745,-92.6672 717.5069,-99.625"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M414.275,-88.25C497.8606,-74.9546 520.0681,-89.3987 604.7043,-89.25"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~windowequivalentlayer.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node11"><a xlink:href="../sourcefile/windowequivalentlayer.f90.html" xlink:title="WindowEquivalentLayer.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="484.8594,-138.2554 343.6907,-138.2554 343.6907,-116.2446 484.8594,-116.2446 484.8594,-138.2554"/>
<text text-anchor="middle" x="414.275" y="-124.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">WindowEquivalentLayer.f90</text>
</a>
</g>
</g>
<!-- sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~windowequivalentlayer.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~daylightingmanager.f90&#45;&gt;sourcefile~windowequivalentlayer.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M307.9064,-115.217C316.2504,-116.1609 324.9126,-117.1408 333.5294,-118.1156"/>
<polygon fill="#00ffff" stroke="#00ffff" points="333.272,-121.6087 343.6021,-119.2551 334.0589,-114.6531 333.272,-121.6087"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M807.687,-50.25C867.991,-56.4716 931.8979,-90.0193 966.4467,-110.728"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="965.0282,-113.9631 975.3853,-116.195 968.6806,-107.9915 965.0282,-113.9631"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1143.026,-50.25C1167.5637,-48.6096 1194.4862,-48.2195 1218.412,-48.365"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="1218.4347,-51.8653 1228.4667,-48.4581 1218.4995,-44.8656 1218.4347,-51.8653"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1143.026,-50.25C1209.6942,-45.7931 1221.5494,-15.7069 1288.2177,-11.25"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M650.7938,-47.5628C692.0256,-45.7974 754.0544,-44.7167 807.687,-50.25"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M807.687,-50.25C955.9396,-65.5454 994.3184,-60.1915 1143.026,-50.25"/>
</g>
<!-- sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~solarshading.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M643.3616,-61.2959C676.2709,-70.6993 723.7116,-84.255 759.1679,-94.3862"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="758.2517,-97.7644 768.8285,-97.1466 760.1749,-91.0338 758.2517,-97.7644"/>
</g>
<!-- sourcefile~sizingmanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~sizingmanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1165.2707,-116.1906C1173.8182,-111.8946 1183.6484,-106.8972 1192.5154,-102.25 1215.0098,-90.4605 1240.2432,-76.7286 1259.1501,-66.3374"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1261.0765,-69.2722 1268.1475,-61.3822 1257.6996,-63.1406 1261.0765,-69.2722"/>
</g>
<!-- sourcefile~energyplus.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~energyplus.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node8"><a xlink:href="../sourcefile/energyplus.f90.html" xlink:title="EnergyPlus.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1473.9386,-63.2554 1390.5216,-63.2554 1390.5216,-41.2446 1473.9386,-41.2446 1473.9386,-63.2554"/>
<text text-anchor="middle" x="1432.2301" y="-49.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">EnergyPlus.f90</text>
</a>
</g>
</g>
<!-- sourcefile~simulationmanager.f90&#45;&gt;sourcefile~energyplus.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~simulationmanager.f90&#45;&gt;sourcefile~energyplus.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1348.0408,-51.0808C1358.7054,-51.2289 1369.7372,-51.3821 1380.1636,-51.5269"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1380.3044,-55.0291 1390.352,-51.6684 1380.4016,-48.0298 1380.3044,-55.0291"/>
</g>
<!-- sourcefile~simulationmanager.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~simulationmanager.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1329.1006,-39.1785C1345.3669,-34.7734 1364.2571,-29.6578 1381.392,-25.0174"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1382.5075,-28.3415 1391.2449,-22.3492 1380.6777,-21.5849 1382.5075,-28.3415"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M891.0747,-116.8328C899.7963,-117.7305 908.625,-118.6392 917.2454,-119.5265"/>
<polygon fill="#ff0000" stroke="#ff0000" points="916.9446,-123.0139 927.2505,-120.5563 917.6614,-116.0507 916.9446,-123.0139"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M890.9807,-105.8062C974.3094,-102.9071 1096.5845,-97.2931 1143.026,-88.25"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1143.026,-88.25C1175.458,-81.2223 1211.5558,-71.782 1239.6449,-64.069"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1240.9043,-67.3522 1249.6095,-61.3132 1239.0384,-60.6054 1240.9043,-67.3522"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M463.8777,-138.2816C565.8328,-160.8086 790.839,-209.7036 807.687,-206.25"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M807.687,-206.25C866.2049,-194.2045 929.1068,-162.8794 964.2948,-143.4881"/>
<polygon fill="#ff0000" stroke="#ff0000" points="966.4402,-146.2984 973.4581,-138.3612 963.0222,-140.1896 966.4402,-146.2984"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~windowmanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~windowmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M433.4755,-138.2715C454.4907,-150.0205 489.4165,-168.6338 521.0669,-181.25 531.1986,-185.2886 542.2439,-189.0323 552.8882,-192.3278"/>
<polygon fill="#ff0000" stroke="#ff0000" points="551.9288,-195.694 562.5132,-195.2237 553.9457,-188.9909 551.9288,-195.694"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~solarshading.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~solarshading.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M452.2907,-116.2032C463.1673,-112.4144 474.8396,-107.7247 485.0669,-102.25 502.6995,-92.8112 503.2082,-84.2538 521.0669,-75.25 529.7045,-70.8952 539.2342,-67.1578 548.6742,-64.0007"/>
<polygon fill="#ff0000" stroke="#ff0000" points="549.9551,-67.2667 558.438,-60.9192 547.8482,-60.5913 549.9551,-67.2667"/>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M448.6131,-116.194C486.4318,-105.0101 549.2474,-89.3474 604.7043,-89.25"/>
</g>
<!-- sourcefile~heatbalanceintradexchange.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~heatbalanceintradexchange.f90</title>
<g id="a_sourcefile~~windowcomplexmanager.f90~~AfferentGraph_node12"><a xlink:href="../sourcefile/heatbalanceintradexchange.f90.html" xlink:title="HeatBalanceIntRadExchange.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="688.4795,-139.2554 520.9292,-139.2554 520.9292,-117.2446 688.4795,-117.2446 688.4795,-139.2554"/>
<text text-anchor="middle" x="604.7043" y="-125.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceIntRadExchange.f90</text>
</a>
</g>
</g>
<!-- sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalanceintradexchange.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~windowequivalentlayer.f90&#45;&gt;sourcefile~heatbalanceintradexchange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M484.9133,-127.6209C493.358,-127.6653 502.0795,-127.7111 510.7866,-127.7568"/>
<polygon fill="#ff0000" stroke="#ff0000" points="510.9656,-131.2577 520.9839,-127.8104 511.0024,-124.2578 510.9656,-131.2577"/>
</g>
<!-- sourcefile~heatbalanceintradexchange.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~windowcomplexmanager.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~heatbalanceintradexchange.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M688.4371,-119.9998C696.9927,-119.1568 705.7222,-118.2967 714.3719,-117.4444"/>
<polygon fill="#ff0000" stroke="#ff0000" points="714.8656,-120.9128 724.4741,-116.449 714.1791,-113.9465 714.8656,-120.9128"/>
</g>
</g>
</svg>
</div>
                <script>var pansourcefilewindowcomplexmanagerf90AfferentGraph = svgPanZoom('#sourcefilewindowcomplexmanagerf90AfferentGraph', {
                    zoomEnabled: true,
                    controlIconsEnabled: true,
                    fit: true,
                    center: true,});
                    </script>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">

    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="186pt" height="31pt"
 viewBox="0.00 0.00 186.41 30.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 26.5)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-26.5 182.4064,-26.5 182.4064,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65.1576,-22.2554 -.0526,-22.2554 -.0526,-.2446 65.1576,-.2446 65.1576,-22.2554"/>
<text text-anchor="middle" x="32.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="178.2607,-22.2554 82.8443,-22.2554 82.8443,-.2446 178.2607,-.2446 178.2607,-22.2554"/>
<text text-anchor="middle" x="130.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>


    <p>Solid arrows point from a file to a file which depends upon it. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>

                      </div>
                    </div>
                  </div>
                </div>


      <br>

    <section class="visible-xs visible-sm hidden-md">


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../module/windowcomplexmanager.html">WindowComplexManager</a>

    </div>
  </div>
</div>


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html#src">WindowComplexManager.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="k">MODULE </span><span class="n">WindowComplexManager</span>
<a name="ln-2"></a>
<a name="ln-3"></a>          <span class="c">! Module containing the routines dealing with complex fenestration</span>
<a name="ln-4"></a>
<a name="ln-5"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-6"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-7"></a>          <span class="c">!       DATE WRITTEN   ???</span>
<a name="ln-8"></a>          <span class="c">!       MODIFIED       November 2011, Simon Vidanovic</span>
<a name="ln-9"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-10"></a>
<a name="ln-11"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-12"></a>          <span class="c">!  Initialize data for solar and thermal calculations and also performs thermal calculations for BSDF window</span>
<a name="ln-13"></a>
<a name="ln-14"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-15"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-16"></a>
<a name="ln-17"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-18"></a>          <span class="c">! na</span>
<a name="ln-19"></a>
<a name="ln-20"></a>          <span class="c">! OTHER NOTES:</span>
<a name="ln-21"></a>          <span class="c">! na</span>
<a name="ln-22"></a>
<a name="ln-23"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-24"></a><span class="k">USE </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-25"></a><span class="k">USE </span><span class="n">DataVectorTypes</span>
<a name="ln-26"></a><span class="k">USE </span><span class="n">DataInterfaces</span>
<a name="ln-27"></a><span class="k">USE </span><span class="n">DataBSDFWindow</span>
<a name="ln-28"></a><span class="k">USE </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">MaxNameLength</span><span class="p">,</span> <span class="n">Pi</span><span class="p">,</span> <span class="n">DegToRadians</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">,</span> <span class="n">NumOfZones</span><span class="p">,</span> <span class="n">rTinyValue</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-29"></a>                        <span class="n">KelvinConv</span><span class="p">,</span> <span class="n">SecInHour</span><span class="p">,</span> <span class="n">TimeStepZone</span>
<a name="ln-30"></a><span class="k">USE </span><span class="n">DataSurfaces</span>  <span class="c">!, ONLY: TotSurfaces,TotWindows,Surface,SurfaceWindow   !update this later</span>
<a name="ln-31"></a><span class="k">USE </span><span class="n">DataEnvironment</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">SunIsUpValue</span><span class="p">,</span> <span class="n">SkyTempKelvin</span><span class="p">,</span> <span class="n">IsRain</span><span class="p">,</span> <span class="n">SunIsUp</span><span class="p">,</span> <span class="n">CloudFraction</span><span class="p">,</span> <span class="n">OutBaroPress</span><span class="p">,</span> <span class="n">OutHumRat</span>
<a name="ln-32"></a><span class="k">USE </span><span class="n">DataHeatBalance</span>
<a name="ln-33"></a><span class="k">USE </span><span class="n">DataShadowingCombinations</span>
<a name="ln-34"></a><span class="k">USE </span><span class="n">vectors</span>
<a name="ln-35"></a><span class="k">USE </span><span class="n">DataHeatBalFanSys</span>
<a name="ln-36"></a>
<a name="ln-37"></a><span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables</span>
<a name="ln-38"></a>
<a name="ln-39"></a><span class="k">PRIVATE</span> <span class="c">! Everything private unless explicitly made public</span>
<a name="ln-40"></a>
<a name="ln-41"></a>          <span class="c">! MODULE PARAMETER DEFINITIONS:</span>
<a name="ln-42"></a>
<a name="ln-43"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PRIVATE</span><span class="p">,</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">5.6697d-8</span>    <span class="c">! Stefan-Boltzmann constant</span>
<a name="ln-44"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PRIVATE</span><span class="p">,</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">PressureDefault</span> <span class="o">=</span> <span class="mi">10132</span><span class="mf">5.0d0</span>
<a name="ln-45"></a>
<a name="ln-46"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">Calculate_Geometry</span>    <span class="o">=</span><span class="mi">1</span>
<a name="ln-47"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">Copy_Geometry</span>      <span class="o">=</span><span class="mi">2</span>
<a name="ln-48"></a>
<a name="ln-49"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>  <span class="kd">::</span>  <span class="n">TmpLen</span>      <span class="o">=</span><span class="mi">20</span>  <span class="c">!Length increment of temporary arrays</span>
<a name="ln-50"></a>
<a name="ln-51"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>  <span class="kd">::</span>  <span class="n">Front_Incident</span>      <span class="o">=</span><span class="mi">1</span>  <span class="c">!Ray identification types</span>
<a name="ln-52"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>  <span class="kd">::</span>  <span class="n">Front_Transmitted</span>    <span class="o">=</span><span class="mi">2</span>
<a name="ln-53"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>  <span class="kd">::</span>  <span class="n">Front_Reflected</span>    <span class="o">=</span><span class="mi">3</span>
<a name="ln-54"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>  <span class="kd">::</span>  <span class="n">Back_Incident</span>      <span class="o">=</span><span class="mi">4</span>
<a name="ln-55"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>  <span class="kd">::</span>  <span class="n">Back_Transmitted</span>    <span class="o">=</span><span class="mi">5</span>
<a name="ln-56"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>  <span class="kd">::</span>  <span class="n">Back_Reflected</span>      <span class="o">=</span><span class="mi">6</span>
<a name="ln-57"></a>
<a name="ln-58"></a>
<a name="ln-59"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-60"></a><span class="k">TYPE </span><span class="n">WindowIndex</span>
<a name="ln-61"></a>    <span class="kt">INTEGER</span>   <span class="kd">::</span>  <span class="n">NumStates</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!No States for this window</span>
<a name="ln-62"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">SurfNo</span>    <span class="c">!Surface number of window</span>
<a name="ln-63"></a>    <span class="c">!REAL(r64)  ::  Azimuth    !Window surface azimuth</span>
<a name="ln-64"></a>    <span class="c">!REAL(r64)  ::  Tilt    !Window surface tilt</span>
<a name="ln-65"></a><span class="k">END TYPE </span><span class="n">WindowIndex</span>
<a name="ln-66"></a>
<a name="ln-67"></a><span class="k">TYPE </span><span class="n">WindowStateIndex</span>
<a name="ln-68"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">InitInc</span>    <span class="c">!Flag indicating initialization needed on Incoming basis</span>
<a name="ln-69"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">IncBasisIndx</span>  <span class="c">!Index of basis list entry for Incoming basis</span>
<a name="ln-70"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">CopyIncState</span>  <span class="c">!Pointer to state from which geometry can be copied (Incident)</span>
<a name="ln-71"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">InitTrn</span>    <span class="c">!Flag indicating initialization needed on Outgoing basis</span>
<a name="ln-72"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">TrnBasisIndx</span>  <span class="c">!Index of basis list entry for Outgoing basis</span>
<a name="ln-73"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">CopyTrnState</span>  <span class="c">!Pointer to state from which geometry can be copied (Outgoing)</span>
<a name="ln-74"></a>    <span class="kt">INTEGER</span>  <span class="kd">::</span>  <span class="n">Konst</span>    <span class="c">!Index of state descript in Construct array</span>
<a name="ln-75"></a>    <span class="c">!INTEGER  ::  ThermConst  !Index of state thermal description in Construct array</span>
<a name="ln-76"></a><span class="k">END TYPE </span><span class="n">WindowStateIndex</span>
<a name="ln-77"></a>
<a name="ln-78"></a>          <span class="c">! MODULE VARIABLE DECLARATIONS:</span>
<a name="ln-79"></a>
<a name="ln-80"></a><span class="kt">INTEGER</span>                  <span class="kd">::</span>  <span class="n">NumComplexWind</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Total number of complex windows</span>
<a name="ln-81"></a><span class="k">TYPE</span> <span class="p">(</span><span class="n">BasisStruct</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>          <span class="kd">::</span>  <span class="n">BasisList</span>
<a name="ln-82"></a><span class="k">TYPE</span> <span class="p">(</span><span class="n">WindowIndex</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>        <span class="kd">::</span>  <span class="n">WindowList</span>
<a name="ln-83"></a><span class="k">TYPE</span> <span class="p">(</span><span class="n">WindowStateIndex</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:</span> <span class="p">,</span> <span class="p">:),</span> <span class="k">ALLOCATABLE</span>        <span class="kd">::</span>  <span class="n">WindowStateList</span>
<a name="ln-84"></a><span class="c">!Debug</span>
<a name="ln-85"></a><span class="kt">INTEGER</span><span class="p">,</span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">DbgIBm</span>
<a name="ln-86"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">DbgTheta</span><span class="p">,</span><span class="n">DbgPhi</span>
<a name="ln-87"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                  <span class="kd">::</span>  <span class="n">DdbgTheta</span><span class="p">,</span><span class="n">DdbgPhi</span>
<a name="ln-88"></a><span class="c">!EndDebug</span>
<a name="ln-89"></a>
<a name="ln-90"></a>          <span class="c">! SUBROUTINE SPECIFICATIONS FOR MODULE WindowComplexManager:</span>
<a name="ln-91"></a><span class="k">PUBLIC </span><span class="n">CalcComplexWindowThermal</span>
<a name="ln-92"></a><span class="k">PUBLIC </span><span class="n">CalculateBasisLength</span>
<a name="ln-93"></a><span class="k">PUBLIC </span><span class="n">InitComplexWindows</span>
<a name="ln-94"></a><span class="k">PUBLIC </span><span class="n">UpdateComplexWindows</span>
<a name="ln-95"></a><span class="k">PUBLIC </span><span class="n">DetermineMaxBackSurfaces</span>
<a name="ln-96"></a><span class="k">PUBLIC </span><span class="n">CheckCFSStates</span>
<a name="ln-97"></a><span class="k">PUBLIC </span><span class="n">PierceSurfaceVector</span>
<a name="ln-98"></a><span class="k">PUBLIC </span><span class="n">DaylghtAltAndAzimuth</span>
<a name="ln-99"></a><span class="k">PRIVATE </span><span class="n">CalculateWindowBeamProperties</span>
<a name="ln-100"></a><span class="k">PRIVATE </span><span class="n">CalcStaticProperties</span>
<a name="ln-101"></a><span class="k">PRIVATE </span><span class="n">InitBSDFWindows</span>
<a name="ln-102"></a><span class="k">PRIVATE </span><span class="n">ConstructBasis</span>
<a name="ln-103"></a><span class="k">PRIVATE </span><span class="n">FillBasisElement</span>
<a name="ln-104"></a><span class="k">PRIVATE </span><span class="n">SetupComplexWindowStateGeometry</span>
<a name="ln-105"></a><span class="k">PRIVATE </span><span class="n">CalcWindowStaticProperties</span>
<a name="ln-106"></a><span class="k">PRIVATE </span><span class="n">SkyWeight</span>
<a name="ln-107"></a><span class="k">PRIVATE </span><span class="n">SkyGndWeight</span>
<a name="ln-108"></a><span class="k">PRIVATE </span><span class="n">WorldVectFromW6</span>
<a name="ln-109"></a><span class="k">PRIVATE </span><span class="n">W6CoordsFromWorldVect</span>
<a name="ln-110"></a><span class="k">PRIVATE </span><span class="n">FindInBasis</span>
<a name="ln-111"></a><span class="k">PRIVATE </span><span class="n">SearchAscTable</span>
<a name="ln-112"></a><span class="k">PRIVATE </span><span class="n">CrossProduct</span>
<a name="ln-113"></a><span class="k">PRIVATE </span><span class="n">ExpandComplexState</span>
<a name="ln-114"></a>
<a name="ln-115"></a><span class="k">CONTAINS</span>
<a name="ln-116"></a>
<a name="ln-117"></a>
<a name="ln-118"></a><span class="k">SUBROUTINE </span><span class="n">InitBSDFWindows</span>
<a name="ln-119"></a>
<a name="ln-120"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-121"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-122"></a>          <span class="c">!       DATE WRITTEN   August 2011</span>
<a name="ln-123"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-124"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-125"></a>
<a name="ln-126"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-127"></a>          <span class="c">! Set up the overall optical geometry for a BSDF window</span>
<a name="ln-128"></a>
<a name="ln-129"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-130"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-131"></a>
<a name="ln-132"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-133"></a>          <span class="c">! na</span>
<a name="ln-134"></a>
<a name="ln-135"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-136"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-137"></a>
<a name="ln-138"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-139"></a>
<a name="ln-140"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-141"></a>      <span class="c">! na</span>
<a name="ln-142"></a>
<a name="ln-143"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-144"></a>          <span class="c">! na</span>
<a name="ln-145"></a>
<a name="ln-146"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-147"></a>          <span class="c">! na</span>
<a name="ln-148"></a>
<a name="ln-149"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-150"></a>   <span class="k">TYPE </span><span class="n">TempBasisIdx</span>
<a name="ln-151"></a>       <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">Basis</span>    <span class="c">!Basis no in basis table</span>
<a name="ln-152"></a>       <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">State</span>    <span class="c">!State in which basis first occurs</span>
<a name="ln-153"></a>   <span class="k">END TYPE </span><span class="n">TempBasisIdx</span>
<a name="ln-154"></a>
<a name="ln-155"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-156"></a>   <span class="kt">LOGICAL</span>    <span class="kd">::</span>  <span class="n">BasisFound</span>  <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>    <span class="c">!Flag for sorting Basis List</span>
<a name="ln-157"></a>   <span class="kt">LOGICAL</span>    <span class="kd">::</span>  <span class="n">Once</span>  <span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>  <span class="c">!Flag for insuring things happen once</span>
<a name="ln-158"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IBasis</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index for identifying basis in BasisList</span>
<a name="ln-159"></a>   <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">ISurf</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index for sorting thru Surface array</span>
<a name="ln-160"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IConst</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index for accessing Construct array</span>
<a name="ln-161"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IState</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index identifying the window state for a particular window</span>
<a name="ln-162"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IWind</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index identifying a window in the WindowList</span>
<a name="ln-163"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">I</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-164"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">J</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-165"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">JSurf</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!back surface number</span>
<a name="ln-166"></a>   <span class="kt">INTEGER</span>      <span class="kd">::</span>  <span class="n">BaseSurf</span>    <span class="c">!base surface number (used in finding back surface)</span>
<a name="ln-167"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">K</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-168"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">KBkSurf</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!back surface index</span>
<a name="ln-169"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">KBasis</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!secondary reference to a basis index</span>
<a name="ln-170"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NThetas</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Current number of theta values</span>
<a name="ln-171"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NumBasis</span> <span class="o">=</span><span class="mi">0</span>  <span class="c">!Number of unique bases (No. in BasisList)</span>
<a name="ln-172"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NumElem</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Number of elements in current basis</span>
<a name="ln-173"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NBkSurf</span>   <span class="o">=</span><span class="mi">0</span>  <span class="c">!Local variable for the number of back surfaces</span>
<a name="ln-174"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NumStates</span>    <span class="c">!Local variable for the number of states</span>
<a name="ln-175"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">ElemNo</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Current basis element number</span>
<a name="ln-176"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">ThConst</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Construct array index of thermal construction of state</span>
<a name="ln-177"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Theta</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Current theta value</span>
<a name="ln-178"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Phi</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Current phi value</span>
<a name="ln-179"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">DPhi</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Increment for phi value (Window6 type input)</span>
<a name="ln-180"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Lamda</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Current &#39;Lamda&#39; value (element weight)</span>
<a name="ln-181"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">MatrixNo</span>  <span class="o">=</span><span class="mi">0</span> <span class="c">!Index of Basis matrix</span>
<a name="ln-182"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">NextTheta</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Next theta in the W6 basis after current</span>
<a name="ln-183"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">LastTheta</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Previous theta in the W6 basis before current</span>
<a name="ln-184"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">LowerTheta</span> <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Lower theta boundary of the element</span>
<a name="ln-185"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">UpperTheta</span> <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Upper theta boundary of the element</span>
<a name="ln-186"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Azimuth</span>    <span class="c">!Azimuth of window surface (radians)</span>
<a name="ln-187"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Tilt</span>    <span class="c">!Tilt of window surface (radians)</span>
<a name="ln-188"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>     <span class="kd">::</span> <span class="n">Thetas</span>  <span class="c">!temp array holding theta values</span>
<a name="ln-189"></a>   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>    <span class="kd">::</span> <span class="n">NPhis</span>  <span class="c">!temp array holding number of phis for a given theta</span>
<a name="ln-190"></a>   <span class="k">TYPE</span> <span class="p">(</span><span class="n">BasisStruct</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span> <span class="n">TempList</span>    <span class="c">!Temporary Basis List</span>
<a name="ln-191"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="kd">::</span>     <span class="n">V</span>    <span class="c">!vector array</span>
<a name="ln-192"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>     <span class="n">VLen</span>    <span class="c">!Length of vector array</span>
<a name="ln-193"></a>   <span class="k">TYPE</span> <span class="p">(</span><span class="n">TempBasisIdx</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span> <span class="n">IHold</span>    <span class="c">!Temporary array</span>
<a name="ln-194"></a>   <span class="kt">INTEGER</span>          <span class="kd">::</span> <span class="n">NHold</span>  <span class="c">!No. values in the Temporary array</span>
<a name="ln-195"></a>
<a name="ln-196"></a>
<a name="ln-197"></a>                  <span class="k">IF</span> <span class="p">(</span><span class="n">TotComplexFenStates</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">RETURN</span>  <span class="c">!Nothing to do if no complex fenestration states</span>
<a name="ln-198"></a>    <span class="c">!</span>
<a name="ln-199"></a>    <span class="c">!Construct Basis List</span>
<a name="ln-200"></a>    <span class="c">!</span>
<a name="ln-201"></a>                 <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TempList</span><span class="p">(</span><span class="n">TotComplexFenStates</span><span class="p">))</span>
<a name="ln-202"></a>
<a name="ln-203"></a>    <span class="c">!Note:  Construction of the basis list contains the assumption of identical incoming and outgoing bases in</span>
<a name="ln-204"></a>    <span class="c">!            that the complex fenestration state definition contains only one basis description, hence</span>
<a name="ln-205"></a>    <span class="c">!            assumes square property matrices.  If this assumption were relaxed through change of the</span>
<a name="ln-206"></a>    <span class="c">!            definition or additional definition of a state type with non-square matrices, then the loop</span>
<a name="ln-207"></a>    <span class="c">!            below should be modified to enter both of the bases into the basis list.</span>
<a name="ln-208"></a>
<a name="ln-209"></a>  <span class="n">BsLoop</span><span class="p">:</span>        <span class="k">DO </span><span class="n">IConst</span> <span class="o">=</span> <span class="n">FirstBSDF</span><span class="p">,</span> <span class="n">FirstBSDF</span><span class="o">+</span><span class="n">TotComplexFenStates</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-210"></a>                       <span class="n">MatrixNo</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMatIndex</span>
<a name="ln-211"></a>                       <span class="k">IF</span> <span class="p">(</span><span class="n">NumBasis</span> <span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-212"></a><span class="k">                           </span><span class="n">NumBasis</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-213"></a>                           <span class="k">CALL </span><span class="n">ConstructBasis</span> <span class="p">(</span><span class="n">IConst</span><span class="p">,</span> <span class="n">TempList</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-214"></a>                       <span class="k">ELSE</span>
<a name="ln-215"></a><span class="k">  </span><span class="n">BLsLp</span><span class="p">:</span>                   <span class="k">DO </span><span class="n">IBasis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">NumBasis</span>
<a name="ln-216"></a>                                 <span class="k">IF</span> <span class="p">(</span><span class="n">MatrixNo</span> <span class="o">==</span> <span class="n">TempList</span><span class="p">(</span><span class="n">IBasis</span><span class="p">)%</span><span class="n">BasisMatIndex</span><span class="p">)</span> <span class="k">CYCLE </span><span class="n">BsLoop</span>
<a name="ln-217"></a>                           <span class="k">END DO </span><span class="n">BLsLp</span>
<a name="ln-218"></a>                           <span class="n">NumBasis</span><span class="o">=</span><span class="n">NumBasis</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-219"></a>                           <span class="k">CALL </span><span class="n">ConstructBasis</span> <span class="p">(</span><span class="n">IConst</span><span class="p">,</span> <span class="n">TempList</span><span class="p">(</span><span class="n">NumBasis</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-220"></a>                       <span class="n">ENDIF</span>
<a name="ln-221"></a>                 <span class="k">END DO </span><span class="n">BsLoop</span>
<a name="ln-222"></a>                 <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">BasisList</span><span class="p">(</span><span class="n">NumBasis</span><span class="p">))</span>
<a name="ln-223"></a>                 <span class="n">BasisList</span><span class="o">=</span><span class="n">TempList</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NumBasis</span><span class="p">)</span>
<a name="ln-224"></a>                 <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">TempList</span><span class="p">)</span>
<a name="ln-225"></a>                   <span class="c">!</span>
<a name="ln-226"></a>                   <span class="c">!  Proceed to set up geometry for complex fenestration states</span>
<a name="ln-227"></a>                   <span class="c">!</span>
<a name="ln-228"></a>                 <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">TotSurfaces</span><span class="p">))</span>  <span class="c">!Set up companion array to SurfaceWindow to hold window</span>
<a name="ln-229"></a>                           <span class="c">!     geometry for each state.  This is an allocatable array of</span>
<a name="ln-230"></a>                           <span class="c">!     geometries for the window states but only the complex</span>
<a name="ln-231"></a>                           <span class="c">!     fenestration surfaces will have the arrays allocated</span>
<a name="ln-232"></a>      <span class="c">!</span>
<a name="ln-233"></a>      <span class="c">!  Search Thru Surfaces for Complex Fenestration State references</span>
<a name="ln-234"></a>      <span class="c">!  This will define the first complex fenestration state for that window, others will follow if there are</span>
<a name="ln-235"></a>      <span class="c">!     control specifications</span>
<a name="ln-236"></a>      <span class="c">!</span>
<a name="ln-237"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">WindowList</span><span class="p">(</span><span class="n">TotSurfaces</span><span class="p">))</span>  <span class="c">!Temporary allocation</span>
<a name="ln-238"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">WindowStateList</span><span class="p">(</span><span class="n">TotSurfaces</span><span class="p">,</span> <span class="n">TotComplexFenStates</span><span class="p">))</span>  <span class="c">!Temporary allocation</span>
<a name="ln-239"></a>  <span class="n">SfLoop</span><span class="p">:</span>   <span class="k">DO </span><span class="n">ISurf</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">TotSurfaces</span>
<a name="ln-240"></a>                       <span class="n">IConst</span><span class="o">=</span><span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Construction</span>
<a name="ln-241"></a>                       <span class="k">IF</span> <span class="p">(</span><span class="n">IConst</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span> <span class="c">! This is true for overhangs (Shading:Zone:Detailed)</span>
<a name="ln-242"></a>                       <span class="k">IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">TypeIsWindow</span><span class="p">.</span><span class="nb">AND</span><span class="p">.(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">WindowTypeBSDF</span><span class="p">)))</span> <span class="k">CYCLE</span>  <span class="c">!Only BSDF windows</span>
<a name="ln-243"></a>                       <span class="c">!Simon Check: Thermal construction removed</span>
<a name="ln-244"></a>                       <span class="c">!ThConst = Construct(IConst)%BSDFInput%ThermalConstruction</span>
<a name="ln-245"></a>                       <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">WindowModelType</span> <span class="o">=</span> <span class="n">WindowBSDFModel</span>
<a name="ln-246"></a>                       <span class="n">NumComplexWind</span> <span class="o">=</span> <span class="n">NumComplexWind</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-247"></a>                       <span class="n">NumStates</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-248"></a>                       <span class="n">WindowList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">)%</span><span class="n">NumStates</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c">!Having found the construction reference in</span>
<a name="ln-249"></a>                                 <span class="c">! the Surface array defines the first state for this window</span>
<a name="ln-250"></a>                       <span class="n">WindowList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">)%</span><span class="n">SurfNo</span> <span class="o">=</span> <span class="n">ISurf</span>
<a name="ln-251"></a>                       <span class="c">!WindowList(NumComplexWind)%Azimuth=DegToRadians*Surface(ISurf)%Azimuth</span>
<a name="ln-252"></a>         <span class="c">!WindowList(NumComplexWind)%Tilt=DegToRadians*Surface(ISurf)%Tilt</span>
<a name="ln-253"></a>         <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">InitInc</span> <span class="o">=</span> <span class="n">Calculate_Geometry</span>
<a name="ln-254"></a>         <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">InitTrn</span> <span class="o">=</span> <span class="n">Calculate_Geometry</span>
<a name="ln-255"></a>         <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">CopyIncState</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-256"></a>         <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">CopyTrnState</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-257"></a>         <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">Konst</span> <span class="o">=</span><span class="n">IConst</span>
<a name="ln-258"></a>         <span class="c">!Simon Check: ThermalConstruction assigned to current construction</span>
<a name="ln-259"></a>        <span class="c">!WindowStateList(NumComplexWind, NumStates)%ThermConst = ThConst</span>
<a name="ln-260"></a>         <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NumBasis</span>    <span class="c">!Find basis in Basis List</span>
<a name="ln-261"></a>               <span class="k">IF</span><span class="p">(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMatIndex</span> <span class="o">==</span> <span class="n">BasisList</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">BasisMatIndex</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-262"></a><span class="k">                     </span><span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">IncBasisIndx</span> <span class="o">=</span> <span class="n">I</span>    <span class="c">!Note: square property matrices</span>
<a name="ln-263"></a>                     <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">TrnBasisIndx</span> <span class="o">=</span> <span class="n">I</span>    <span class="c">!   assumption</span>
<a name="ln-264"></a>               <span class="n">ENDIF</span>
<a name="ln-265"></a>         <span class="k">END DO</span>
<a name="ln-266"></a><span class="k">         IF</span><span class="p">(</span><span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">NumStates</span><span class="p">)%</span><span class="n">IncBasisIndx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-267"></a><span class="k">               CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Complex Window Init: Window Basis not in BasisList.&#39;</span><span class="p">)</span>
<a name="ln-268"></a>         <span class="n">ENDIF</span>
<a name="ln-269"></a>                 <span class="k">END DO </span><span class="n">SfLoop</span>
<a name="ln-270"></a>      <span class="c">!</span>
<a name="ln-271"></a>      <span class="c">!  Should now have a WindowList with NumComplexWind entries containing all the complex fenestrations</span>
<a name="ln-272"></a>      <span class="c">!    with a first state defined for each.</span>
<a name="ln-273"></a>      <span class="c">!</span>
<a name="ln-274"></a>      <span class="c">!  *  *  *</span>
<a name="ln-275"></a>      <span class="c">!</span>
<a name="ln-276"></a>      <span class="c">!  Here a search should be made for control specifications, which will give additional states for</span>
<a name="ln-277"></a>      <span class="c">!    controlled complex fenestrations.  These should be added to the WindowStateList, and</span>
<a name="ln-278"></a>      <span class="c">!     WindowList( )%NumStates incremented for each window for which states are added.</span>
<a name="ln-279"></a>      <span class="c">!      Added states should have WindowStateList ( , )%InitInc set to Calculate_Geometry</span>
<a name="ln-280"></a>      <span class="c">!</span>
<a name="ln-281"></a>      <span class="c">!  *  *  *</span>
<a name="ln-282"></a>
<a name="ln-283"></a>      <span class="c">! At this point, we have a complete WindowList and WindowStateList, with NumComplexWind</span>
<a name="ln-284"></a>      <span class="c">!   defined, and NumStates for each complex window defined</span>
<a name="ln-285"></a>      <span class="c">!</span>
<a name="ln-286"></a>      <span class="c">! Now sort through the window list to see that geometry will only be done once for each</span>
<a name="ln-287"></a>      <span class="c">!  window, basis combination</span>
<a name="ln-288"></a>      <span class="c">!</span>
<a name="ln-289"></a>      <span class="c">! Note:  code below assumes identical incoming and outgoing bases; following code will</span>
<a name="ln-290"></a>      <span class="c">!   need revision if this assumption relaxed</span>
<a name="ln-291"></a>      <span class="c">!</span>
<a name="ln-292"></a>
<a name="ln-293"></a>                 <span class="k">DO   </span><span class="n">IWind</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NumComplexWind</span>     <span class="c">!Search window list for repeated bases</span>
<a name="ln-294"></a>                       <span class="k">IF</span> <span class="p">(</span><span class="n">WindowList</span><span class="p">(</span><span class="n">IWind</span><span class="p">)%</span><span class="n">NumStates</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-295"></a><span class="k">                             ALLOCATE</span> <span class="p">(</span><span class="n">IHold</span><span class="p">(</span><span class="n">WindowList</span><span class="p">(</span><span class="n">IWind</span><span class="p">)%</span><span class="n">NumStates</span><span class="p">))</span>
<a name="ln-296"></a>                             <span class="n">NHold</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-297"></a>                             <span class="n">IHold</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">State</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-298"></a>                             <span class="n">IHold</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">Basis</span> <span class="o">=</span> <span class="n">WindowStateList</span><span class="p">(</span><span class="n">IWind</span><span class="p">,</span> <span class="mi">1</span><span class="p">)%</span><span class="n">IncBasisIndx</span>
<a name="ln-299"></a>                                  <span class="c">! If the Mth new basis found is basis B in the basis list, and it</span>
<a name="ln-300"></a>                                  <span class="c">! first occurs in the WindowStateList  in state N, then IHold(M)%Basis=B</span>
<a name="ln-301"></a>                                  <span class="c">! and IHold(M)%State=N</span>
<a name="ln-302"></a>                             <span class="k">DO </span><span class="n">K</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumBasis</span>
<a name="ln-303"></a>                                 <span class="k">IF</span><span class="p">(</span><span class="n">K</span> <span class="o">&gt;</span> <span class="n">NHold</span> <span class="p">)</span>  <span class="k">EXIT</span>
<a name="ln-304"></a><span class="k">                                 </span><span class="n">KBasis</span> <span class="o">=</span> <span class="n">IHold</span><span class="p">(</span><span class="n">K</span><span class="p">)%</span><span class="n">Basis</span>
<a name="ln-305"></a>                                 <span class="n">J</span> <span class="o">=</span> <span class="n">IHold</span><span class="p">(</span><span class="n">K</span><span class="p">)%</span><span class="n">State</span>
<a name="ln-306"></a>                                 <span class="n">Once</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-307"></a>                                 <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span> <span class="p">,</span> <span class="n">WindowList</span><span class="p">(</span><span class="n">IWind</span><span class="p">)%</span><span class="n">NumStates</span>    <span class="c">!See if subsequent states have the same basis</span>
<a name="ln-308"></a>                                         <span class="k">IF</span><span class="p">((</span> <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span><span class="p">)%</span><span class="n">InitInc</span> <span class="o">==</span> <span class="n">Calculate_Geometry</span><span class="p">)</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-309"></a>     <span class="p">&amp;</span>                                       <span class="p">(</span><span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span><span class="p">)%</span><span class="n">IncBasisIndx</span> <span class="o">==</span> <span class="n">KBasis</span> <span class="p">))</span> <span class="k">THEN</span>
<a name="ln-310"></a>           <span class="c">!Note:  square property matrices (same inc &amp; trn bases) assumption</span>
<a name="ln-311"></a>            <span class="c">!If same incident and outgoing basis assumption removed, following code will need to</span>
<a name="ln-312"></a>            <span class="c">!  be extended to treat the two bases separately</span>
<a name="ln-313"></a>                                             <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">InitInc</span> <span class="o">=</span> <span class="n">Copy_Geometry</span>
<a name="ln-314"></a>                                             <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">InitTrn</span> <span class="o">=</span> <span class="n">Copy_Geometry</span>
<a name="ln-315"></a>                                             <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">CopyIncState</span> <span class="o">=</span> <span class="n">J</span>
<a name="ln-316"></a>                                             <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">CopyTrnState</span> <span class="o">=</span> <span class="n">J</span>
<a name="ln-317"></a>                                         <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">Once</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-318"></a><span class="k">                                             </span><span class="n">Once</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>  <span class="c">!First occurrence of a different basis</span>
<a name="ln-319"></a>                                             <span class="n">NHold</span> <span class="o">=</span> <span class="n">NHold</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-320"></a>                                             <span class="n">IHold</span><span class="p">(</span><span class="n">NHold</span><span class="p">)%</span><span class="n">State</span> <span class="o">=</span> <span class="n">I</span>
<a name="ln-321"></a>                                             <span class="n">IHold</span><span class="p">(</span><span class="n">NHold</span><span class="p">)%</span><span class="n">Basis</span> <span class="o">=</span> <span class="n">WindowStateList</span><span class="p">(</span><span class="n">IWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">IncBasisIndx</span>
<a name="ln-322"></a>                                             <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">InitTrn</span> <span class="o">=</span> <span class="n">Calculate_Geometry</span>
<a name="ln-323"></a>                                             <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">CopyIncState</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-324"></a>                                             <span class="n">WindowStateList</span><span class="p">(</span><span class="n">NumComplexWind</span><span class="p">,</span> <span class="n">I</span> <span class="p">)%</span><span class="n">CopyTrnState</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-325"></a>                                         <span class="n">ENDIF</span>
<a name="ln-326"></a>                                 <span class="k">END DO</span>
<a name="ln-327"></a><span class="k">                             END DO</span>
<a name="ln-328"></a><span class="k">                             DEALLOCATE</span><span class="p">(</span> <span class="n">IHold</span> <span class="p">)</span>
<a name="ln-329"></a>                       <span class="n">ENDIF</span>
<a name="ln-330"></a>                 <span class="k">END DO</span>
<a name="ln-331"></a>
<a name="ln-332"></a>      <span class="c">!</span>
<a name="ln-333"></a>      <span class="c">!  Now go through window list and window state list and calculate or copy the</span>
<a name="ln-334"></a>      <span class="c">!   geometry information for each window, state</span>
<a name="ln-335"></a>                 <span class="k">DO  </span><span class="n">IWind</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NumComplexWind</span>
<a name="ln-336"></a>                       <span class="n">ISurf</span> <span class="o">=</span> <span class="n">WindowList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">)%</span><span class="n">SurfNo</span>
<a name="ln-337"></a>                       <span class="n">NumStates</span> <span class="o">=</span> <span class="n">WindowList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">)%</span><span class="n">NumStates</span>
<a name="ln-338"></a>                       <span class="c">!ALLOCATE (SurfaceWindow( ISurf )%ComplexFen)    !activate the BSDF window description</span>
<a name="ln-339"></a>                 <span class="c">!  for this surface</span>
<a name="ln-340"></a>                       <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">NumStates</span> <span class="o">=</span> <span class="n">NumStates</span>
<a name="ln-341"></a>                       <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span> <span class="n">ISurf</span> <span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">NumStates</span><span class="p">))</span>  <span class="c">!Allocate space for the states</span>
<a name="ln-342"></a>                       <span class="n">ComplexWind</span><span class="p">(</span> <span class="n">ISurf</span> <span class="p">)%</span><span class="n">NumStates</span> <span class="o">=</span> <span class="n">NumStates</span>
<a name="ln-343"></a>                       <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">Geom</span><span class="p">(</span> <span class="n">NumStates</span> <span class="p">))</span>  <span class="c">!Allocate space for the geometries</span>
<a name="ln-344"></a>                       <span class="c">!Azimuth = WindowList ( IWind )%Azimuth</span>
<a name="ln-345"></a>                       <span class="c">!Tilt = WindowList ( IWind )%Tilt</span>
<a name="ln-346"></a>                       <span class="c">! Get the number of back surfaces for this window</span>
<a name="ln-347"></a>                       <span class="n">BaseSurf</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">BaseSurf</span>     <span class="c">!ShadowComb is organized by base surface</span>
<a name="ln-348"></a>                       <span class="n">NBkSurf</span> <span class="o">=</span> <span class="n">ShadowComb</span><span class="p">(</span><span class="n">BaseSurf</span><span class="p">)%</span><span class="n">NumBackSurf</span>
<a name="ln-349"></a>                       <span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">NBkSurf</span> <span class="o">=</span> <span class="n">NBkSurf</span>
<a name="ln-350"></a>                       <span class="c">! Define the back surface directions</span>
<a name="ln-351"></a>                       <span class="k">ALLOCATE</span><span class="p">(</span> <span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">sWinSurf</span><span class="p">(</span><span class="n">NBkSurf</span><span class="p">))</span>
<a name="ln-352"></a>                       <span class="k">ALLOCATE</span><span class="p">(</span> <span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">sdotN</span><span class="p">(</span><span class="n">NBkSurf</span><span class="p">))</span>
<a name="ln-353"></a>                       <span class="c">!Define the unit vectors pointing from the window center to the back surface centers</span>
<a name="ln-354"></a>                       <span class="k">DO </span><span class="n">KBkSurf</span>  <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NBkSurf</span>
<a name="ln-355"></a>                           <span class="n">BaseSurf</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">BaseSurf</span>     <span class="c">!ShadowComb is organized by base surface</span>
<a name="ln-356"></a>                           <span class="n">JSurf</span> <span class="o">=</span> <span class="n">ShadowComb</span><span class="p">(</span><span class="n">BaseSurf</span><span class="p">)%</span><span class="n">BackSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)</span>    <span class="c">!these are all proper back surfaces</span>
<a name="ln-357"></a>                           <span class="n">V</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">Centroid</span> <span class="o">-</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span>
<a name="ln-358"></a>                           <span class="n">VLen</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span> <span class="n">V</span> <span class="p">,</span> <span class="n">V</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-359"></a>                           <span class="c">!Define the unit vector from the window center to the back</span>
<a name="ln-360"></a>                           <span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">sWinSurf</span><span class="p">(</span> <span class="n">KBkSurf</span> <span class="p">)</span> <span class="o">=</span> <span class="n">V</span> <span class="o">/</span> <span class="n">VLen</span>
<a name="ln-361"></a>                          <span class="c">!surface center</span>
<a name="ln-362"></a>                          <span class="c">!Define the back surface cosine(incident angle)</span>
<a name="ln-363"></a>                           <span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">sdotN</span><span class="p">(</span> <span class="n">KBkSurf</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span> <span class="p">(</span> <span class="n">V</span> <span class="p">,</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">OutNormVec</span> <span class="p">)</span><span class="o">/</span><span class="n">VLen</span>
<a name="ln-364"></a>                       <span class="n">ENDDO</span>
<a name="ln-365"></a>                       <span class="k">DO  </span><span class="n">IState</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumStates</span>
<a name="ln-366"></a>                         <span class="c">!The following assumes identical incoming and outgoing bases.  The logic will need to be</span>
<a name="ln-367"></a>                         <span class="c">!  redesigned if this assumption is relaxed</span>
<a name="ln-368"></a>                             <span class="n">IConst</span> <span class="o">=</span> <span class="n">WindowStateList</span> <span class="p">(</span> <span class="n">IWind</span> <span class="p">,</span> <span class="n">IState</span> <span class="p">)%</span><span class="n">Konst</span>
<a name="ln-369"></a>                             <span class="c">!ThConst = WindowStateList ( IWind , IState )%ThermConst</span>
<a name="ln-370"></a>                             <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Konst</span> <span class="o">=</span> <span class="n">IConst</span>
<a name="ln-371"></a>                             <span class="c">!SurfaceWindow(ISurf)%ComplexFen%State(IState)%ThermConst = ThConst</span>
<a name="ln-372"></a>                             <span class="k">IF</span> <span class="p">(</span> <span class="n">WindowStateList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">,</span> <span class="n">IState</span> <span class="p">)%</span><span class="n">InitInc</span> <span class="o">==</span> <span class="n">Calculate_Geometry</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-373"></a><span class="k">                                  </span><span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Inc</span> <span class="o">=</span> <span class="n">BasisList</span><span class="p">(</span><span class="n">WindowStateList</span><span class="p">(</span><span class="n">IWind</span> <span class="p">,</span> <span class="n">IState</span><span class="p">)&amp;</span>
<a name="ln-374"></a>     <span class="p">&amp;</span>      <span class="p">%</span><span class="n">IncBasisIndx</span><span class="p">)</span>    <span class="c">!Put in the basis structure from the BasisList</span>
<a name="ln-375"></a>                                  <span class="n">ComplexWind</span> <span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Trn</span> <span class="o">=</span> <span class="n">BasisList</span><span class="p">(</span><span class="n">WindowStateList</span><span class="p">(</span><span class="n">IWind</span> <span class="p">,</span> <span class="n">IState</span><span class="p">)&amp;</span>
<a name="ln-376"></a>     <span class="p">&amp;</span>      <span class="p">%</span><span class="n">TrnBasisIndx</span><span class="p">)</span>
<a name="ln-377"></a>
<a name="ln-378"></a>                                  <span class="k">CALL </span><span class="n">SetupComplexWindowStateGeometry</span> <span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span><span class="n">IConst</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-379"></a>     <span class="p">&amp;</span>                             <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">),</span><span class="n">ComplexWind</span><span class="p">(</span> <span class="n">ISurf</span> <span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">),&amp;</span>
<a name="ln-380"></a>     <span class="p">&amp;</span>                             <span class="n">SurfaceWindow</span><span class="p">(</span> <span class="n">ISurf</span> <span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">))</span>
<a name="ln-381"></a>         <span class="c">!Note--setting up the state geometry will include constructing outgoing basis/surface</span>
<a name="ln-382"></a>         <span class="c">!  maps and those incoming maps that will not depend on shading.</span>
<a name="ln-383"></a>                             <span class="k">ELSE</span>
<a name="ln-384"></a><span class="k">                                  </span><span class="n">SurfaceWindow</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)</span><span class="o">=</span><span class="n">SurfaceWindow</span><span class="p">(</span> <span class="n">ISurf</span> <span class="p">)%</span><span class="n">ComplexFen</span> <span class="p">&amp;</span>
<a name="ln-385"></a>     <span class="p">&amp;</span>                                <span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">WindowStateList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">,</span> <span class="n">IState</span> <span class="p">)%</span><span class="n">CopyIncState</span><span class="p">)</span>   <span class="c">!Note this overwrites Konst</span>
<a name="ln-386"></a>                                  <span class="n">SurfaceWindow</span> <span class="p">(</span><span class="n">ISurf</span> <span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Konst</span> <span class="o">=</span> <span class="n">IConst</span>    <span class="c">!  so it has to be put back</span>
<a name="ln-387"></a>                                  <span class="c">!SurfaceWindow (ISurf )%ComplexFen%State(IState)%ThermConst = ThConst  !same for ThermConst</span>
<a name="ln-388"></a>                                  <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)</span> <span class="o">=</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-389"></a>     <span class="p">&amp;</span>                                <span class="p">%</span><span class="n">Geom</span><span class="p">(</span><span class="n">WindowStateList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">,</span> <span class="n">IState</span> <span class="p">)%</span><span class="n">CopyIncState</span><span class="p">)</span>
<a name="ln-390"></a>                             <span class="n">ENDIF</span>
<a name="ln-391"></a>
<a name="ln-392"></a>                       <span class="k">END DO</span>    <span class="c">!State loop</span>
<a name="ln-393"></a>                 <span class="k">END DO</span>       <span class="c">!Complex Window loop</span>
<a name="ln-394"></a>                 <span class="c">!</span>
<a name="ln-395"></a>                 <span class="c">!  Allocate all beam-dependent complex fenestration quantities</span>
<a name="ln-396"></a>                 <span class="k">DO  </span><span class="n">IWind</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NumComplexWind</span>
<a name="ln-397"></a>                       <span class="n">ISurf</span> <span class="o">=</span> <span class="n">WindowList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">)%</span><span class="n">SurfNo</span>
<a name="ln-398"></a>                       <span class="n">NumStates</span> <span class="o">=</span> <span class="n">WindowList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">)%</span><span class="n">NumStates</span>
<a name="ln-399"></a>                       <span class="k">DO  </span><span class="n">IState</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumStates</span>
<a name="ln-400"></a>                         <span class="k">CALL </span><span class="n">AllocateCFSStateHourlyData</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">)</span>
<a name="ln-401"></a>                       <span class="k">END DO</span>    <span class="c">!State loop</span>
<a name="ln-402"></a>                 <span class="k">END DO</span>       <span class="c">!Complex Window loop</span>
<a name="ln-403"></a>
<a name="ln-404"></a>
<a name="ln-405"></a>
<a name="ln-406"></a>
<a name="ln-407"></a>
<a name="ln-408"></a>  <span class="k">RETURN</span>
<a name="ln-409"></a>
<a name="ln-410"></a><span class="k">END SUBROUTINE </span><span class="n">InitBSDFWindows</span>
<a name="ln-411"></a>
<a name="ln-412"></a><span class="k">SUBROUTINE </span><span class="n">AllocateCFSStateHourlyData</span><span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">iState</span><span class="p">)</span>
<a name="ln-413"></a>
<a name="ln-414"></a>  <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-415"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-416"></a>          <span class="c">!       DATE WRITTEN   May 2013</span>
<a name="ln-417"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-418"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-419"></a>
<a name="ln-420"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-421"></a>          <span class="c">! Allocate hourly data arrays for complex fenestration state</span>
<a name="ln-422"></a>
<a name="ln-423"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-424"></a>          <span class="c">! na</span>
<a name="ln-425"></a>
<a name="ln-426"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-427"></a>          <span class="c">! na</span>
<a name="ln-428"></a>
<a name="ln-429"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-430"></a>          <span class="c">! na</span>
<a name="ln-431"></a>
<a name="ln-432"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-433"></a>
<a name="ln-434"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-435"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iSurf</span> <span class="c">! Surface number</span>
<a name="ln-436"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iState</span> <span class="c">! Complex fenestration state number</span>
<a name="ln-437"></a>
<a name="ln-438"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-439"></a>          <span class="c">! na</span>
<a name="ln-440"></a>
<a name="ln-441"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-442"></a>          <span class="c">! na</span>
<a name="ln-443"></a>
<a name="ln-444"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-445"></a>          <span class="c">! na</span>
<a name="ln-446"></a>
<a name="ln-447"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-448"></a>          <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">NLayers</span> <span class="c">! Number of complex fenestration layers</span>
<a name="ln-449"></a>          <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">NBkSurf</span> <span class="c">! Number of back surfaces</span>
<a name="ln-450"></a>          <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">KBkSurf</span> <span class="c">! Back surfaces counter</span>
<a name="ln-451"></a>
<a name="ln-452"></a>          <span class="n">NLayers</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">NLayers</span>
<a name="ln-453"></a>          <span class="n">NBkSurf</span> <span class="o">=</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">NBkSurf</span>
<a name="ln-454"></a>
<a name="ln-455"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">SolBmGndWt</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">NGnd</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-456"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">SolBmIndex</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-457"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">ThetaBm</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-458"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">PhiBm</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-459"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">WinDirHemiTrans</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-460"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">WinDirSpecTrans</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-461"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">WinBmGndTrans</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-462"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">WinBmFtAbs</span><span class="p">(</span><span class="n">NLayers</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-463"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">WinBmGndAbs</span><span class="p">(</span><span class="n">NLayers</span> <span class="p">,</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-464"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">WinToSurfBmTrans</span> <span class="p">(</span><span class="n">NBkSurf</span> <span class="p">,</span><span class="mi">24</span> <span class="p">,</span><span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-465"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">NBkSurf</span><span class="p">))</span>
<a name="ln-466"></a>          <span class="k">DO </span><span class="n">KBkSurf</span>  <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NBkSurf</span>
<a name="ln-467"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDHBkRefl</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-468"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">iState</span><span class="p">)%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDirBkAbs</span><span class="p">(</span><span class="n">NLayers</span> <span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span><span class="p">))</span>
<a name="ln-469"></a>          <span class="k">END DO</span>
<a name="ln-470"></a>
<a name="ln-471"></a><span class="k">  RETURN</span>
<a name="ln-472"></a><span class="k">END SUBROUTINE </span><span class="n">AllocateCFSStateHourlyData</span>
<a name="ln-473"></a>
<a name="ln-474"></a><span class="k">SUBROUTINE </span><span class="n">ExpandComplexState</span><span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">iConst</span><span class="p">)</span>
<a name="ln-475"></a>
<a name="ln-476"></a>  <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-477"></a>  <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-478"></a>  <span class="c">!       DATE WRITTEN   May 2013</span>
<a name="ln-479"></a>  <span class="c">!       MODIFIED       Simon Vidanovic (July 2013)</span>
<a name="ln-480"></a>  <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-481"></a>
<a name="ln-482"></a>  <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-483"></a>  <span class="c">! When complex fenestration is controlled by EMS, program does not know in advance how many states are assigned to</span>
<a name="ln-484"></a>  <span class="c">! ceratin surface. This information can be obtain only at runtime. Purpose of this routine is to extend number of states</span>
<a name="ln-485"></a>  <span class="c">! used by complex fenestration in case that is necessary.</span>
<a name="ln-486"></a>
<a name="ln-487"></a>  <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-488"></a>  <span class="c">! na</span>
<a name="ln-489"></a>
<a name="ln-490"></a>  <span class="c">! REFERENCES:</span>
<a name="ln-491"></a>  <span class="c">! na</span>
<a name="ln-492"></a>
<a name="ln-493"></a>  <span class="c">! USE STATEMENTS:</span>
<a name="ln-494"></a>  <span class="c">! na</span>
<a name="ln-495"></a>
<a name="ln-496"></a>  <span class="k">implicit none</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-497"></a>
<a name="ln-498"></a>  <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-499"></a>  <span class="kt">Integer</span><span class="p">,</span> <span class="k">Intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iSurf</span>  <span class="c">! Surface number</span>
<a name="ln-500"></a>  <span class="kt">Integer</span><span class="p">,</span> <span class="k">Intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iConst</span> <span class="c">! Construction number</span>
<a name="ln-501"></a>
<a name="ln-502"></a>  <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-503"></a>  <span class="c">! na</span>
<a name="ln-504"></a>
<a name="ln-505"></a>  <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-506"></a>  <span class="c">! na</span>
<a name="ln-507"></a>
<a name="ln-508"></a>  <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-509"></a>  <span class="c">! na</span>
<a name="ln-510"></a>
<a name="ln-511"></a>  <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-512"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">NumOfStates</span>
<a name="ln-513"></a>  <span class="k">type</span><span class="p">(</span><span class="n">BSDFGeomDescr</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tempGeom</span>
<a name="ln-514"></a>  <span class="k">type</span><span class="p">(</span><span class="n">BSDFDaylghtGeomDescr</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tempDaylightGeom</span>
<a name="ln-515"></a>  <span class="k">type</span><span class="p">(</span><span class="n">BSDFStateDescr</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tempState</span>
<a name="ln-516"></a>
<a name="ln-517"></a>  <span class="c">! Read all previous states into temporary locations and then expands them by one</span>
<a name="ln-518"></a>  <span class="n">NumOfStates</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">NumStates</span>
<a name="ln-519"></a>
<a name="ln-520"></a>  <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tempGeom</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">tempGeom</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">))</span>
<a name="ln-521"></a>  <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tempState</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">tempState</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">))</span>
<a name="ln-522"></a>
<a name="ln-523"></a>  <span class="n">tempGeom</span> <span class="o">=</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span>
<a name="ln-524"></a>  <span class="n">tempState</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span>
<a name="ln-525"></a>
<a name="ln-526"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">)</span>
<a name="ln-527"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">)</span>
<a name="ln-528"></a>
<a name="ln-529"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">NumOfStates</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-530"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">NumOfStates</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-531"></a>
<a name="ln-532"></a>  <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NumOfStates</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempGeom</span>
<a name="ln-533"></a>  <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NumOfStates</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempState</span>
<a name="ln-534"></a>
<a name="ln-535"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tempGeom</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">tempGeom</span><span class="p">)</span>
<a name="ln-536"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tempState</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">tempState</span><span class="p">)</span>
<a name="ln-537"></a>
<a name="ln-538"></a>  <span class="c">! Do daylighting geometry only in case it is initialized. If daylighting is not used then no need to expand state for that</span>
<a name="ln-539"></a>  <span class="c">!if (ComplexWind(iSurf)%DaylightingInitialized) then</span>
<a name="ln-540"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tempDaylightGeom</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">tempDaylightGeom</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">))</span>
<a name="ln-541"></a>    <span class="n">tempDaylightGeom</span> <span class="o">=</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">DaylghtGeom</span>
<a name="ln-542"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">DaylghtGeom</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">DaylghtGeom</span><span class="p">)</span>
<a name="ln-543"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">DaylghtGeom</span><span class="p">(</span><span class="n">NumOfStates</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-544"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">DaylightingInitialized</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-545"></a><span class="k">      </span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">DaylghtGeom</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NumOfStates</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempDaylightGeom</span>
<a name="ln-546"></a>    <span class="k">end if</span>
<a name="ln-547"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tempDaylightGeom</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">tempDaylightGeom</span><span class="p">)</span>
<a name="ln-548"></a>    <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">DaylightingInitialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-549"></a>  <span class="c">!end if</span>
<a name="ln-550"></a>
<a name="ln-551"></a>  <span class="c">! Increase number of states and insert new state</span>
<a name="ln-552"></a>  <span class="n">NumOfStates</span> <span class="o">=</span> <span class="n">NumOfStates</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-553"></a>  <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">NumStates</span> <span class="o">=</span> <span class="n">NumOfStates</span>
<a name="ln-554"></a>  <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">NumStates</span> <span class="o">=</span> <span class="n">NumOfStates</span>
<a name="ln-555"></a>
<a name="ln-556"></a>  <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">)%</span><span class="n">Konst</span> <span class="o">=</span> <span class="n">iConst</span>
<a name="ln-557"></a>
<a name="ln-558"></a>  <span class="c">! load basis and setup window state geometry</span>
<a name="ln-559"></a>  <span class="k">call </span><span class="n">ConstructBasis</span><span class="p">(</span><span class="n">iConst</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">)%</span><span class="n">Inc</span><span class="p">)</span>
<a name="ln-560"></a>  <span class="k">call </span><span class="n">ConstructBasis</span><span class="p">(</span><span class="n">iConst</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">)%</span><span class="n">Trn</span><span class="p">)</span>
<a name="ln-561"></a>
<a name="ln-562"></a>  <span class="k">call </span><span class="n">SetupComplexWindowStateGeometry</span> <span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">NumOfStates</span><span class="p">,</span> <span class="n">iConst</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-563"></a>    <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">),</span> <span class="n">ComplexWind</span><span class="p">(</span> <span class="n">iSurf</span> <span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-564"></a>    <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">))</span>
<a name="ln-565"></a>
<a name="ln-566"></a>  <span class="c">! allocation of memory for hourly data can be performed only after window state geometry has been setup</span>
<a name="ln-567"></a>  <span class="k">call </span><span class="n">AllocateCFSStateHourlyData</span><span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">NumOfStates</span><span class="p">)</span>
<a name="ln-568"></a>
<a name="ln-569"></a>  <span class="c">! calculate static properties for complex fenestration</span>
<a name="ln-570"></a>  <span class="k">call </span><span class="n">CalcWindowStaticProperties</span><span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">NumOfStates</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-571"></a>    <span class="n">ComplexWind</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">),</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">))</span>
<a name="ln-572"></a>
<a name="ln-573"></a>  <span class="c">! calculate hourly data from complex fenestration</span>
<a name="ln-574"></a>  <span class="k">call </span><span class="n">CFSShadeAndBeamInitialization</span><span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">NumOfStates</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-575"></a>    <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">),</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">NumOfStates</span><span class="p">))</span>
<a name="ln-576"></a>
<a name="ln-577"></a><span class="k">END SUBROUTINE </span><span class="n">ExpandComplexState</span>
<a name="ln-578"></a>
<a name="ln-579"></a><span class="k">SUBROUTINE </span><span class="n">CheckCFSStates</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)</span>
<a name="ln-580"></a>
<a name="ln-581"></a>  <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-582"></a>  <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-583"></a>  <span class="c">!       DATE WRITTEN   May 2013</span>
<a name="ln-584"></a>  <span class="c">!       MODIFIED       na</span>
<a name="ln-585"></a>  <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-586"></a>
<a name="ln-587"></a>  <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-588"></a>  <span class="c">! Check if there are new states available for complex fenestration and performs proper initialization</span>
<a name="ln-589"></a>
<a name="ln-590"></a>  <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-591"></a>  <span class="c">! na</span>
<a name="ln-592"></a>
<a name="ln-593"></a>  <span class="c">! REFERENCES:</span>
<a name="ln-594"></a>  <span class="c">! na</span>
<a name="ln-595"></a>
<a name="ln-596"></a>  <span class="c">! USE STATEMENTS:</span>
<a name="ln-597"></a>  <span class="c">! na</span>
<a name="ln-598"></a>
<a name="ln-599"></a>  <span class="k">implicit none</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-600"></a>
<a name="ln-601"></a>  <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-602"></a>  <span class="kt">Integer</span><span class="p">,</span> <span class="k">Intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iSurf</span> <span class="c">! Surface number</span>
<a name="ln-603"></a>
<a name="ln-604"></a>  <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-605"></a>  <span class="c">! na</span>
<a name="ln-606"></a>
<a name="ln-607"></a>  <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-608"></a>  <span class="c">! na</span>
<a name="ln-609"></a>
<a name="ln-610"></a>  <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-611"></a>  <span class="c">! na</span>
<a name="ln-612"></a>
<a name="ln-613"></a>  <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-614"></a>  <span class="kt">Integer</span> <span class="kd">::</span> <span class="n">NumOfStates</span>   <span class="c">! number of states for current surface</span>
<a name="ln-615"></a>  <span class="kt">Logical</span> <span class="kd">::</span> <span class="n">StateFound</span>    <span class="c">! variable to indicate if state has been found</span>
<a name="ln-616"></a>  <span class="kt">Integer</span> <span class="kd">::</span> <span class="n">i</span>             <span class="c">! Local counter</span>
<a name="ln-617"></a>  <span class="kt">Integer</span> <span class="kd">::</span> <span class="n">CurrentCFSState</span>
<a name="ln-618"></a>
<a name="ln-619"></a>  <span class="n">StateFound</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-620"></a>  <span class="n">CurrentCFSState</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">CurrentState</span>
<a name="ln-621"></a>
<a name="ln-622"></a>  <span class="c">! Check if EMS changed construction number</span>
<a name="ln-623"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Construction</span> <span class="o">/=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">CurrentCFSState</span><span class="p">)%</span><span class="n">Konst</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-624"></a>
<a name="ln-625"></a>    <span class="c">! If construction number changed then take new state</span>
<a name="ln-626"></a>    <span class="c">! First search for existing states. Maybe state is already added in previous timestep</span>
<a name="ln-627"></a>    <span class="n">NumOfStates</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">NumStates</span>
<a name="ln-628"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumOfStates</span>
<a name="ln-629"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Construction</span> <span class="o">==</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">Konst</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-630"></a><span class="k">        </span><span class="n">StateFound</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-631"></a>        <span class="n">CurrentCFSState</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-632"></a>        <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">CurrentState</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-633"></a>      <span class="k">end if</span>
<a name="ln-634"></a><span class="k">    end do</span>
<a name="ln-635"></a><span class="k">  else</span>
<a name="ln-636"></a><span class="k">    </span><span class="n">StateFound</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-637"></a>  <span class="k">end if</span>
<a name="ln-638"></a>
<a name="ln-639"></a>  <span class="c">! If new state is not found in the list of current states, then create new one, initialize and make it active</span>
<a name="ln-640"></a>  <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">StateFound</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-641"></a><span class="k">    call </span><span class="n">ExpandComplexState</span><span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">Surface</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">Construction</span><span class="p">)</span>
<a name="ln-642"></a>    <span class="n">CurrentCFSState</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">NumStates</span>
<a name="ln-643"></a>    <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">iSurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">CurrentState</span> <span class="o">=</span> <span class="n">CurrentCFSState</span>
<a name="ln-644"></a>  <span class="k">end if</span>
<a name="ln-645"></a>
<a name="ln-646"></a><span class="k">END SUBROUTINE </span><span class="n">CheckCFSStates</span>
<a name="ln-647"></a>
<a name="ln-648"></a><span class="k">SUBROUTINE </span><span class="n">InitComplexWindows</span>
<a name="ln-649"></a>
<a name="ln-650"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-651"></a>          <span class="c">!       AUTHOR         Linda Lawrie</span>
<a name="ln-652"></a>          <span class="c">!       DATE WRITTEN   November 2012</span>
<a name="ln-653"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-654"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-655"></a>
<a name="ln-656"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-657"></a>          <span class="c">! Extract simple init for Complex Windows</span>
<a name="ln-658"></a>
<a name="ln-659"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-660"></a>          <span class="c">! na</span>
<a name="ln-661"></a>
<a name="ln-662"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-663"></a>          <span class="c">! na</span>
<a name="ln-664"></a>
<a name="ln-665"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-666"></a>          <span class="c">! na</span>
<a name="ln-667"></a>
<a name="ln-668"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-669"></a>
<a name="ln-670"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-671"></a>          <span class="c">! na</span>
<a name="ln-672"></a>
<a name="ln-673"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-674"></a>          <span class="c">! na</span>
<a name="ln-675"></a>
<a name="ln-676"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-677"></a>          <span class="c">! na</span>
<a name="ln-678"></a>
<a name="ln-679"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-680"></a>          <span class="c">! na</span>
<a name="ln-681"></a>
<a name="ln-682"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-683"></a>  <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">SAVE</span>    <span class="kd">::</span>  <span class="n">Once</span>  <span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>  <span class="c">!Flag for insuring things happen once</span>
<a name="ln-684"></a>
<a name="ln-685"></a> <span class="c">!One-time initialization</span>
<a name="ln-686"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">Once</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-687"></a><span class="k">    </span><span class="n">ONCE</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-688"></a>    <span class="k">CALL </span><span class="n">InitBSDFWindows</span>
<a name="ln-689"></a>    <span class="k">CALL </span><span class="n">CalcStaticProperties</span>
<a name="ln-690"></a>  <span class="n">ENDIF</span>
<a name="ln-691"></a>
<a name="ln-692"></a>
<a name="ln-693"></a>  <span class="k">RETURN</span>
<a name="ln-694"></a>
<a name="ln-695"></a><span class="k">END SUBROUTINE </span><span class="n">InitComplexWindows</span>
<a name="ln-696"></a>
<a name="ln-697"></a><span class="k">SUBROUTINE </span><span class="n">UpdateComplexWindows</span>
<a name="ln-698"></a>
<a name="ln-699"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-700"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-701"></a>          <span class="c">!       DATE WRITTEN   August 2011</span>
<a name="ln-702"></a>          <span class="c">!       MODIFIED       B. Griffith, Nov. 2012 revised for detailed timestep integration mode</span>
<a name="ln-703"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-704"></a>
<a name="ln-705"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-706"></a>          <span class="c">! Performs the shading-dependent initialization of the Complex Fenestration data;</span>
<a name="ln-707"></a>          <span class="c">! On first call, calls the one-time initializition</span>
<a name="ln-708"></a>
<a name="ln-709"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-710"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-711"></a>
<a name="ln-712"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-713"></a>          <span class="c">! na</span>
<a name="ln-714"></a>
<a name="ln-715"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-716"></a>  <span class="k">USE </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">KickoffSizing</span><span class="p">,</span> <span class="n">KickoffSimulation</span>
<a name="ln-717"></a>
<a name="ln-718"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-719"></a>
<a name="ln-720"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-721"></a>      <span class="c">! na</span>
<a name="ln-722"></a>
<a name="ln-723"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-724"></a>          <span class="c">! na</span>
<a name="ln-725"></a>
<a name="ln-726"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-727"></a>          <span class="c">! na</span>
<a name="ln-728"></a>
<a name="ln-729"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-730"></a>          <span class="c">! na</span>
<a name="ln-731"></a>
<a name="ln-732"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-733"></a>  <span class="c">! LOGICAL,SAVE    ::  Once  =.TRUE.  !Flag for insuring things happen once</span>
<a name="ln-734"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NumStates</span>    <span class="c">! Number of states for a given complex fen</span>
<a name="ln-735"></a>  <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">ISurf</span>    <span class="c">!Index for sorting thru Surface array</span>
<a name="ln-736"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IConst</span>    <span class="c">!Index for accessing Construct array</span>
<a name="ln-737"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IState</span>    <span class="c">!Index identifying the window state for a particular window</span>
<a name="ln-738"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IWind</span>    <span class="c">!Index identifying a window in the WindowList</span>
<a name="ln-739"></a>
<a name="ln-740"></a><span class="c">!</span>
<a name="ln-741"></a><span class="c">!</span>
<a name="ln-742"></a><span class="c">! !One-time initialization</span>
<a name="ln-743"></a><span class="c">!  IF (Once) THEN</span>
<a name="ln-744"></a><span class="c">!    ONCE = .FALSE.</span>
<a name="ln-745"></a><span class="c">!    CALL InitBSDFWindows</span>
<a name="ln-746"></a><span class="c">!    CALL CalcStaticProperties</span>
<a name="ln-747"></a><span class="c">!  ENDIF</span>
<a name="ln-748"></a>
<a name="ln-749"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">NumComplexWind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-750"></a>
<a name="ln-751"></a><span class="k">  IF</span> <span class="p">(</span><span class="n">KickoffSizing</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">KickoffSimulation</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-752"></a>
<a name="ln-753"></a>   <span class="c">!Shading-dependent initialization; performed once for each shading period</span>
<a name="ln-754"></a>
<a name="ln-755"></a>   <span class="c">! Initialize the geometric quantities</span>
<a name="ln-756"></a>
<a name="ln-757"></a>  <span class="k">DO </span><span class="n">IWind</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NumComplexWind</span>
<a name="ln-758"></a>    <span class="n">ISurf</span> <span class="o">=</span> <span class="n">WindowList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">)%</span><span class="n">SurfNo</span>
<a name="ln-759"></a>    <span class="n">NumStates</span> <span class="o">=</span> <span class="n">ComplexWind</span><span class="p">(</span> <span class="n">ISurf</span> <span class="p">)%</span><span class="n">NumStates</span>
<a name="ln-760"></a>    <span class="k">DO  </span><span class="n">IState</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NumStates</span>
<a name="ln-761"></a>      <span class="k">CALL </span><span class="n">CFSShadeAndBeamInitialization</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-762"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">),</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">))</span>
<a name="ln-763"></a>    <span class="k">END DO</span>    <span class="c">!State loop</span>
<a name="ln-764"></a>  <span class="k">END DO</span>    <span class="c">!window loop</span>
<a name="ln-765"></a>
<a name="ln-766"></a>  <span class="k">RETURN</span>
<a name="ln-767"></a>
<a name="ln-768"></a><span class="k">END SUBROUTINE </span><span class="n">UpdateComplexWindows</span>
<a name="ln-769"></a>
<a name="ln-770"></a><span class="k">SUBROUTINE </span><span class="n">CFSShadeAndBeamInitialization</span><span class="p">(</span><span class="n">iSurf</span><span class="p">,</span> <span class="n">iState</span><span class="p">,</span> <span class="n">Window</span><span class="p">,</span> <span class="n">Geom</span><span class="p">,</span> <span class="n">State</span><span class="p">)</span>
<a name="ln-771"></a>
<a name="ln-772"></a>  <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-773"></a>  <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-774"></a>  <span class="c">!       DATE WRITTEN   May 2013</span>
<a name="ln-775"></a>  <span class="c">!       MODIFIED       na</span>
<a name="ln-776"></a>  <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-777"></a>
<a name="ln-778"></a>  <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-779"></a>  <span class="c">! Calculates shading properties of complex fenestration</span>
<a name="ln-780"></a>  <span class="c">! Refactoring from Klems code</span>
<a name="ln-781"></a>
<a name="ln-782"></a>  <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-783"></a>  <span class="c">! na</span>
<a name="ln-784"></a>
<a name="ln-785"></a>  <span class="c">! REFERENCES:</span>
<a name="ln-786"></a>  <span class="c">! na</span>
<a name="ln-787"></a>
<a name="ln-788"></a>  <span class="c">! USE STATEMENTS:</span>
<a name="ln-789"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-790"></a>  <span class="k">USE </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">HourOfDay</span><span class="p">,</span> <span class="n">TimeStep</span><span class="p">,</span> <span class="n">KickoffSizing</span><span class="p">,</span> <span class="n">KickoffSimulation</span>
<a name="ln-791"></a>  <span class="k">USE </span><span class="n">DataSystemVariables</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">DetailedSolarTimestepIntegration</span>
<a name="ln-792"></a>
<a name="ln-793"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-794"></a>
<a name="ln-795"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-796"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span>  <span class="n">ISurf</span>    <span class="c">!Window surface number</span>
<a name="ln-797"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span>  <span class="n">IState</span>    <span class="c">!Window state number</span>
<a name="ln-798"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFWindowGeomDescr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Window</span>  <span class="c">!Window Geometry</span>
<a name="ln-799"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFGeomDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Geom</span>    <span class="c">!State Geometry</span>
<a name="ln-800"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFStateDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">State</span>    <span class="c">!State Description</span>
<a name="ln-801"></a>
<a name="ln-802"></a>  <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-803"></a>  <span class="c">! na</span>
<a name="ln-804"></a>
<a name="ln-805"></a>  <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-806"></a>  <span class="c">! na</span>
<a name="ln-807"></a>
<a name="ln-808"></a>  <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-809"></a>  <span class="c">! na</span>
<a name="ln-810"></a>
<a name="ln-811"></a>  <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-812"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">SunDir</span> <span class="o">=</span><span class="n">vector</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">1.0d0</span><span class="p">)</span>    <span class="c">!unit vector pointing toward sun (world CS)</span>
<a name="ln-813"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Posit</span>  <span class="o">=</span><span class="n">vector</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">1.0d0</span><span class="p">)</span>    <span class="c">!vector location of current ground point</span>
<a name="ln-814"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">HitPt</span>  <span class="o">=</span><span class="n">vector</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">1.0d0</span><span class="p">)</span>       <span class="c">!vector location of ray intersection with a surface</span>
<a name="ln-815"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">DotProd</span> <span class="o">=</span><span class="mf">0.0d0</span>                  <span class="c">!temporary variable for testing dot products</span>
<a name="ln-816"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">I</span>    <span class="c">!general purpose index</span>
<a name="ln-817"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">IncRay</span>    <span class="c">!Index of incident ray corresponding to beam direction</span>
<a name="ln-818"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Theta</span>  <span class="c">!Theta angle of incident ray correspongind to beam direction</span>
<a name="ln-819"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Phi</span>  <span class="c">!Phi angle of incident ray correspongind to beam direction</span>
<a name="ln-820"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">IHit</span>  <span class="o">=</span><span class="mi">0</span>    <span class="c">!hit flag</span>
<a name="ln-821"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">J</span>    <span class="c">!general purpose index</span>
<a name="ln-822"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">JSurf</span>    <span class="c">!general purpose surface number</span>
<a name="ln-823"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">K</span>    <span class="c">!general purpose index</span>
<a name="ln-824"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">Hour</span>    <span class="c">!hour of day</span>
<a name="ln-825"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">TotHits</span>    <span class="c">!hit counter</span>
<a name="ln-826"></a>  <span class="kt">INTEGER</span>          <span class="kd">::</span>  <span class="n">TS</span>    <span class="c">!time step</span>
<a name="ln-827"></a>
<a name="ln-828"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">KickoffSizing</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">KickoffSimulation</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-829"></a>
<a name="ln-830"></a><span class="k">  IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="n">DetailedSolarTimestepIntegration</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-831"></a><span class="k">    DO </span><span class="n">Hour</span> <span class="o">=</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">24</span>
<a name="ln-832"></a>      <span class="k">DO </span><span class="n">TS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span>
<a name="ln-833"></a>        <span class="n">SunDir</span> <span class="o">=</span> <span class="n">SUNCOSTS</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span>
<a name="ln-834"></a>        <span class="n">Theta</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-835"></a>        <span class="n">Phi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-836"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">SUNCOSTS</span><span class="p">(</span><span class="mi">3</span> <span class="p">,</span><span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">SunIsUpValue</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-837"></a><span class="k">          </span><span class="n">IncRay</span> <span class="o">=</span> <span class="n">FindInBasis</span><span class="p">(</span><span class="n">SunDir</span><span class="p">,</span> <span class="n">Front_Incident</span><span class="p">,</span> <span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Inc</span><span class="p">,</span> <span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">)</span>
<a name="ln-838"></a>          <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">ThetaBm</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="n">Theta</span>
<a name="ln-839"></a>          <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">PhiBm</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="n">Phi</span>
<a name="ln-840"></a>        <span class="k">ELSE</span>
<a name="ln-841"></a><span class="k">          </span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">ThetaBm</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-842"></a>          <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">PhiBm</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-843"></a>          <span class="n">IncRay</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c">!sundown can&#39;t have ray incident on window</span>
<a name="ln-844"></a>        <span class="n">ENDIF</span>
<a name="ln-845"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">IncRay</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-846"></a>          <span class="c">!Sun may be incident on the window</span>
<a name="ln-847"></a>          <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmIndex</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="n">IncRay</span>
<a name="ln-848"></a>        <span class="k">ELSE</span>
<a name="ln-849"></a>          <span class="c">!Window can&#39;t be sunlit, set front incidence ray index to zero</span>
<a name="ln-850"></a>          <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmIndex</span><span class="p">(</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-851"></a>        <span class="n">ENDIF</span>
<a name="ln-852"></a>        <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">NGnd</span>   <span class="c">!Gnd pt loop</span>
<a name="ln-853"></a>          <span class="n">IHit</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-854"></a>          <span class="n">TotHits</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-855"></a>          <span class="k">DO </span><span class="n">JSurf</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">TotSurfaces</span>
<a name="ln-856"></a>            <span class="c">! the following test will cycle on anything except exterior surfaces and shading surfaces</span>
<a name="ln-857"></a>            <span class="k">IF</span><span class="p">(</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">HeatTransSurf</span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">ExtBoundCond</span> <span class="o">/=</span> <span class="n">ExternalEnvironment</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-858"></a>            <span class="c">!  skip surfaces that face away from the ground point</span>
<a name="ln-859"></a>            <span class="n">DotProd</span> <span class="o">=</span> <span class="n">SunDir</span> <span class="p">.</span><span class="n">dot</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">NewellSurfaceNormalVector</span>
<a name="ln-860"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">DotProd</span> <span class="o">&gt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-861"></a>            <span class="c">!Looking for surfaces between GndPt and sun</span>
<a name="ln-862"></a>            <span class="k">CALL </span><span class="n">PierceSurfaceVector</span><span class="p">(</span><span class="n">JSurf</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">GndPt</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="n">SunDir</span><span class="p">,</span> <span class="n">IHit</span><span class="p">,</span> <span class="n">HitPt</span><span class="p">)</span>
<a name="ln-863"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">IHit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-864"></a>            <span class="c">!  Are not going into the details of whether a hit surface is transparent</span>
<a name="ln-865"></a>            <span class="c">!  Since this is ultimately simply weighting the transmittance, so great</span>
<a name="ln-866"></a>            <span class="c">!  detail is not warranted</span>
<a name="ln-867"></a>            <span class="n">TotHits</span> <span class="o">=</span> <span class="n">TotHits</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-868"></a>            <span class="k">EXIT</span>
<a name="ln-869"></a><span class="k">          END DO</span>
<a name="ln-870"></a><span class="k">          IF</span> <span class="p">(</span><span class="n">TotHits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-871"></a><span class="k">            </span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmGndWt</span><span class="p">(</span><span class="n">I</span> <span class="p">,</span><span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-872"></a>          <span class="k">ELSE</span>
<a name="ln-873"></a><span class="k">            </span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmGndWt</span><span class="p">(</span><span class="n">I</span> <span class="p">,</span><span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-874"></a>          <span class="n">ENDIF</span>
<a name="ln-875"></a>        <span class="k">END DO</span>  <span class="c">! Gnd pt loop</span>
<a name="ln-876"></a>
<a name="ln-877"></a>        <span class="c">! update window beam properties</span>
<a name="ln-878"></a>        <span class="k">CALL </span><span class="n">CalculateWindowBeamProperties</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-879"></a>          <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">),</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">),</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span>
<a name="ln-880"></a>      <span class="k">END DO</span>  <span class="c">! Timestep loop</span>
<a name="ln-881"></a>    <span class="k">END DO</span>     <span class="c">! Hour loop</span>
<a name="ln-882"></a>    <span class="k">ELSE</span> <span class="c">! detailed timestep integration</span>
<a name="ln-883"></a>      <span class="n">SunDir</span> <span class="o">=</span> <span class="n">SUNCOSTS</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">HourOfDay</span><span class="p">,</span> <span class="n">TimeStep</span><span class="p">)</span>
<a name="ln-884"></a>      <span class="n">Theta</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-885"></a>      <span class="n">Phi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-886"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">SUNCOSTS</span><span class="p">(</span><span class="mi">3</span> <span class="p">,</span> <span class="n">HourOfDay</span><span class="p">,</span> <span class="n">TimeStep</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">SunIsUpValue</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-887"></a><span class="k">        </span><span class="n">IncRay</span> <span class="o">=</span> <span class="n">FindInBasis</span> <span class="p">(</span> <span class="n">SunDir</span><span class="p">,</span> <span class="n">Front_Incident</span><span class="p">,</span> <span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Inc</span><span class="p">,</span> <span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">)</span>
<a name="ln-888"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">ThetaBm</span><span class="p">(</span><span class="n">HourOfDay</span><span class="p">,</span><span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="n">Theta</span>
<a name="ln-889"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">PhiBm</span><span class="p">(</span><span class="n">HourOfDay</span><span class="p">,</span><span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="n">Phi</span>
<a name="ln-890"></a>      <span class="k">ELSE</span>
<a name="ln-891"></a><span class="k">        </span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">ThetaBm</span><span class="p">(</span><span class="n">HourOfDay</span><span class="p">,</span><span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-892"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">PhiBm</span><span class="p">(</span><span class="n">HourOfDay</span><span class="p">,</span><span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-893"></a>        <span class="n">IncRay</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c">!sundown can&#39;t have ray incident on window</span>
<a name="ln-894"></a>      <span class="n">ENDIF</span>
<a name="ln-895"></a>
<a name="ln-896"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">IncRay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-897"></a>        <span class="c">!Sun may be incident on the window</span>
<a name="ln-898"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmIndex</span><span class="p">(</span><span class="n">HourOfDay</span><span class="p">,</span><span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="n">IncRay</span>
<a name="ln-899"></a>      <span class="k">ELSE</span>
<a name="ln-900"></a>        <span class="c">!Window can&#39;t be sunlit, set front incidence ray index to zero</span>
<a name="ln-901"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmIndex</span><span class="p">(</span><span class="n">HourOfDay</span><span class="p">,</span><span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-902"></a>      <span class="n">ENDIF</span>
<a name="ln-903"></a>      <span class="k">DO   </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">NGnd</span>   <span class="c">!Gnd pt loop</span>
<a name="ln-904"></a>        <span class="n">IHit</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-905"></a>        <span class="n">TotHits</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-906"></a>        <span class="k">DO </span><span class="n">JSurf</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">TotSurfaces</span>
<a name="ln-907"></a>          <span class="c">! the following test will cycle on anything except exterior surfaces and shading surfaces</span>
<a name="ln-908"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">HeatTransSurf</span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">ExtBoundCond</span> <span class="o">/=</span> <span class="n">ExternalEnvironment</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-909"></a>          <span class="c">!  skip surfaces that face away from the ground point</span>
<a name="ln-910"></a>          <span class="n">DotProd</span> <span class="o">=</span> <span class="n">SunDir</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">NewellSurfaceNormalVector</span>
<a name="ln-911"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">DotProd</span> <span class="o">&gt;=</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-912"></a>          <span class="c">!Looking for surfaces between GndPt and sun</span>
<a name="ln-913"></a>          <span class="k">CALL </span><span class="n">PierceSurfaceVector</span><span class="p">(</span><span class="n">JSurf</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">GndPt</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="n">SunDir</span><span class="p">,</span> <span class="n">IHit</span><span class="p">,</span> <span class="n">HitPt</span><span class="p">)</span>
<a name="ln-914"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">IHit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-915"></a>          <span class="c">!  Are not going into the details of whether a hit surface is transparent</span>
<a name="ln-916"></a>          <span class="c">!  Since this is ultimately simply weighting the transmittance, so great</span>
<a name="ln-917"></a>          <span class="c">!  detail is not warranted</span>
<a name="ln-918"></a>          <span class="n">TotHits</span> <span class="o">=</span> <span class="n">TotHits</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-919"></a>          <span class="k">EXIT</span>
<a name="ln-920"></a><span class="k">        END DO</span>
<a name="ln-921"></a><span class="k">        IF</span> <span class="p">(</span><span class="n">TotHits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-922"></a><span class="k">          </span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmGndWt</span> <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">HourOfDay</span><span class="p">,</span> <span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-923"></a>        <span class="k">ELSE</span>
<a name="ln-924"></a><span class="k">          </span><span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">SolBmGndWt</span> <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">HourOfDay</span><span class="p">,</span> <span class="n">TimeStep</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-925"></a>        <span class="n">ENDIF</span>
<a name="ln-926"></a>      <span class="k">END DO</span>  <span class="c">! Gnd pt loop</span>
<a name="ln-927"></a>
<a name="ln-928"></a>      <span class="c">! Update window beam properties</span>
<a name="ln-929"></a>      <span class="k">CALL </span><span class="n">CalculateWindowBeamProperties</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">),&amp;</span>
<a name="ln-930"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">),</span> <span class="n">SurfaceWindow</span><span class="p">(</span> <span class="n">ISurf</span> <span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">),</span> <span class="n">HourOfDay</span><span class="p">,</span> <span class="n">TimeStep</span><span class="p">)</span>
<a name="ln-931"></a>    <span class="n">ENDIF</span> <span class="c">! solar calculation mode, average over days or detailed</span>
<a name="ln-932"></a>
<a name="ln-933"></a>  <span class="k">RETURN</span>
<a name="ln-934"></a>
<a name="ln-935"></a><span class="k">END SUBROUTINE </span><span class="n">CFSShadeAndBeamInitialization</span>
<a name="ln-936"></a>
<a name="ln-937"></a><span class="k">SUBROUTINE </span><span class="n">CalculateWindowBeamProperties</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">Window</span><span class="p">,</span> <span class="n">Geom</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span>
<a name="ln-938"></a>
<a name="ln-939"></a>  <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-940"></a>  <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-941"></a>  <span class="c">!       DATE WRITTEN   August 2011</span>
<a name="ln-942"></a>  <span class="c">!       MODIFIED       na</span>
<a name="ln-943"></a>  <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-944"></a>
<a name="ln-945"></a>  <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-946"></a>  <span class="c">! Calculates those optical properties of all the Complex Fenestrations that</span>
<a name="ln-947"></a>  <span class="c">!  depend on the beam direction (hence, on hour and time step)</span>
<a name="ln-948"></a>
<a name="ln-949"></a>  <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-950"></a>  <span class="c">! Locate the bidirectional property matrices in the BSDFInput structure</span>
<a name="ln-951"></a>  <span class="c">! and use them to calculate the desired average properties.</span>
<a name="ln-952"></a>
<a name="ln-953"></a>  <span class="c">! REFERENCES:</span>
<a name="ln-954"></a>  <span class="c">! na</span>
<a name="ln-955"></a>
<a name="ln-956"></a>  <span class="c">! USE STATEMENTS:</span>
<a name="ln-957"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-958"></a>
<a name="ln-959"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-960"></a>
<a name="ln-961"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-962"></a>  <span class="c">! INTEGER, INTENT(IN)     ::  IWind    !Window number (in WindowList)</span>
<a name="ln-963"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span>  <span class="n">ISurf</span>    <span class="c">!Window surface number</span>
<a name="ln-964"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span>  <span class="n">IState</span>    <span class="c">!Window state number</span>
<a name="ln-965"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFWindowGeomDescr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Window</span>  <span class="c">!Window Geometry</span>
<a name="ln-966"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFGeomDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Geom</span>    <span class="c">!State Geometry</span>
<a name="ln-967"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFStateDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">State</span>    <span class="c">!State Description</span>
<a name="ln-968"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span>  <span class="n">Hour</span>    <span class="c">!Hour number</span>
<a name="ln-969"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span>  <span class="n">TS</span>    <span class="c">!Timestep number</span>
<a name="ln-970"></a>
<a name="ln-971"></a>  <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-972"></a>  <span class="c">! na</span>
<a name="ln-973"></a>
<a name="ln-974"></a>  <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-975"></a>  <span class="c">! na</span>
<a name="ln-976"></a>
<a name="ln-977"></a>  <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-978"></a>  <span class="c">! na</span>
<a name="ln-979"></a>
<a name="ln-980"></a>  <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-981"></a>
<a name="ln-982"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IConst</span>    <span class="c">!State construction number</span>
<a name="ln-983"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">I</span>    <span class="c">!general purpose index--Back surface</span>
<a name="ln-984"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">J</span>    <span class="c">!general purpose index--ray</span>
<a name="ln-985"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">JRay</span>    <span class="c">!ray index number</span>
<a name="ln-986"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Theta</span>
<a name="ln-987"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Phi</span>
<a name="ln-988"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">JSurf</span>    <span class="c">!gen purpose surface no</span>
<a name="ln-989"></a>  <span class="kt">INTEGER</span>              <span class="kd">::</span>  <span class="n">BaseSurf</span>    <span class="c">!base surface no</span>
<a name="ln-990"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">K</span>    <span class="c">!general purpose index</span>
<a name="ln-991"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">M</span>    <span class="c">!general purpose index--ray</span>
<a name="ln-992"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">L</span>    <span class="c">!general purpose index--layer</span>
<a name="ln-993"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">KBkSurf</span>    <span class="c">!general purpose index--back surface</span>
<a name="ln-994"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Sum1</span>    <span class="c">!general purpose sum</span>
<a name="ln-995"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Sum2</span>    <span class="c">!general purpose sum</span>
<a name="ln-996"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Sum3</span>    <span class="c">!general purpose sum</span>
<a name="ln-997"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IBm</span>    <span class="c">!index of beam ray in incoming basis</span>
<a name="ln-998"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">BkIncRay</span>    <span class="c">!index of sun dir in back incidence basis</span>
<a name="ln-999"></a>  <span class="kt">LOGICAL</span>        <span class="kd">::</span>  <span class="n">RegWindFnd</span>  <span class="c">!flag for regular exterior back surf window</span>
<a name="ln-1000"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">RegWinIndex</span>  <span class="c">!bk surf nos of reg windows</span>
<a name="ln-1001"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">NRegWin</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!no reg windows found as back surfaces</span>
<a name="ln-1002"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">KRegWin</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!index of reg window as back surface</span>
<a name="ln-1003"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">SunDir</span>    <span class="c">!current sun direction</span>
<a name="ln-1004"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Refl</span>    <span class="c">!temporary reflectance</span>
<a name="ln-1005"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span><span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">Absorb</span>    <span class="c">!temporary layer absorptance</span>
<a name="ln-1006"></a>
<a name="ln-1007"></a>  <span class="n">IConst</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Konst</span>
<a name="ln-1008"></a>
<a name="ln-1009"></a>  <span class="c">!  Begin calculation</span>
<a name="ln-1010"></a>  <span class="c">!  Calculate the Transmittance from a given beam direction to a given zone surface</span>
<a name="ln-1011"></a>
<a name="ln-1012"></a>                 <span class="n">IBm</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolBmIndex</span><span class="p">(</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span> <span class="p">)</span>
<a name="ln-1013"></a>                 <span class="k">IF</span><span class="p">(</span><span class="n">IBm</span> <span class="o">&lt;=</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>    <span class="c">!Beam cannot be incident on window for this Hour, TS</span>
<a name="ln-1014"></a>                     <span class="n">State</span><span class="p">%</span><span class="n">WinToSurfBmTrans</span><span class="p">(</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span> <span class="p">,</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1015"></a>                     <span class="n">State</span><span class="p">%</span><span class="n">WinDirHemiTrans</span><span class="p">(</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1016"></a>                     <span class="n">State</span><span class="p">%</span><span class="n">WinDirSpecTrans</span><span class="p">(</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1017"></a>                     <span class="n">State</span><span class="p">%</span><span class="n">WinBmFtAbs</span><span class="p">(</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span> <span class="p">,</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1018"></a>                 <span class="k">ELSE</span>
<a name="ln-1019"></a><span class="k">                     DO  </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span>   <span class="c">!Back surface loop</span>
<a name="ln-1020"></a>                         <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1021"></a>                         <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span> <span class="p">(</span> <span class="n">I</span> <span class="p">)</span>   <span class="c">!Ray loop</span>
<a name="ln-1022"></a>                             <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span> <span class="n">I</span> <span class="p">,</span> <span class="n">J</span> <span class="p">))</span>  <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1023"></a>                                <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span> <span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span> <span class="n">I</span> <span class="p">,</span> <span class="n">J</span> <span class="p">)</span> <span class="p">,</span> <span class="n">IBm</span> <span class="p">)</span>
<a name="ln-1024"></a>                         <span class="k">END DO</span>    <span class="c">!Ray loop</span>
<a name="ln-1025"></a>                         <span class="n">State</span><span class="p">%</span><span class="n">WinToSurfBmTrans</span><span class="p">(</span> <span class="n">I</span> <span class="p">,</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span>
<a name="ln-1026"></a>                     <span class="k">END DO</span>    <span class="c">!Back surface loop</span>
<a name="ln-1027"></a>                     <span class="c">!</span>
<a name="ln-1028"></a>                     <span class="c">!Calculate the directional-hemispherical transmittance</span>
<a name="ln-1029"></a>                     <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1030"></a>                     <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-1031"></a>                         <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span> <span class="p">(</span> <span class="n">J</span> <span class="p">,</span> <span class="n">IBm</span> <span class="p">)</span>
<a name="ln-1032"></a>                     <span class="k">END DO</span>
<a name="ln-1033"></a><span class="k">                     </span><span class="n">State</span><span class="p">%</span><span class="n">WinDirHemiTrans</span><span class="p">(</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span>
<a name="ln-1034"></a>                     <span class="c">!Calculate the directional specular transmittance</span>
<a name="ln-1035"></a>                     <span class="c">!Note:  again using assumption that Inc and Trn basis have same structure</span>
<a name="ln-1036"></a>                     <span class="n">State</span><span class="p">%</span><span class="n">WinDirSpecTrans</span><span class="p">(</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">IBm</span><span class="p">)</span><span class="o">*</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span> <span class="p">(</span> <span class="n">IBm</span> <span class="p">,</span> <span class="n">IBm</span> <span class="p">)</span>
<a name="ln-1037"></a>                     <span class="c">!Calculate the layer front absorptance for beam radiation</span>
<a name="ln-1038"></a>                     <span class="k">FORALL</span> <span class="p">(</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span> <span class="p">)</span>
<a name="ln-1039"></a>                         <span class="n">State</span><span class="p">%</span><span class="n">WinBmFtAbs</span><span class="p">(</span> <span class="n">L</span> <span class="p">,</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">FrtAbs</span><span class="p">(</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">IBm</span><span class="p">)</span>
<a name="ln-1040"></a>                     <span class="k">END FORALL</span>
<a name="ln-1041"></a><span class="k">                 </span><span class="n">ENDIF</span>
<a name="ln-1042"></a>                 <span class="c">!Calculate,  for a given beam direction, the transmittance into the zone</span>
<a name="ln-1043"></a>                 <span class="c">! for ground-reflected radiation (transmitted radiation assumed uniformly diffuse)</span>
<a name="ln-1044"></a>
<a name="ln-1045"></a>                 <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1046"></a>                 <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1047"></a>                 <span class="k">DO   </span><span class="n">J</span>  <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NGnd</span>   <span class="c">!Incident ray loop</span>
<a name="ln-1048"></a>                     <span class="n">JRay</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">GndIndex</span><span class="p">(</span> <span class="n">J</span> <span class="p">)</span>
<a name="ln-1049"></a>                     <span class="k">IF</span> <span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolBmGndWt</span><span class="p">(</span> <span class="n">J</span> <span class="p">,</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span> <span class="p">)</span>  <span class="k">THEN</span>
<a name="ln-1050"></a><span class="k">                         </span><span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolBmGndWt</span><span class="p">(</span> <span class="n">J</span> <span class="p">,</span><span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">JRay</span><span class="p">)</span>
<a name="ln-1051"></a>                         <span class="k">DO  </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">!Outgoing ray loop</span>
<a name="ln-1052"></a>                             <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolBmGndWt</span><span class="p">(</span> <span class="n">J</span> <span class="p">,</span><span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1053"></a>                               <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">JRay</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1054"></a>                                   <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span> <span class="p">(</span> <span class="n">M</span> <span class="p">,</span> <span class="n">JRay</span> <span class="p">)</span>
<a name="ln-1055"></a>                         <span class="k">END DO</span>  <span class="c">!Outgoing ray loop</span>
<a name="ln-1056"></a>                     <span class="n">ENDIF</span>
<a name="ln-1057"></a>                 <span class="k">END DO</span>  <span class="c">!Indcident ray loop</span>
<a name="ln-1058"></a>                 <span class="k">IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1059"></a><span class="k">                     </span><span class="n">State</span><span class="p">%</span><span class="n">WinBmGndTrans</span><span class="p">(</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-1060"></a>                 <span class="k">ELSE</span>
<a name="ln-1061"></a><span class="k">                     </span><span class="n">State</span><span class="p">%</span><span class="n">WinBmGndTrans</span><span class="p">(</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>  <span class="c">!No unshaded ground =&gt; no transmittance</span>
<a name="ln-1062"></a>                 <span class="n">ENDIF</span>
<a name="ln-1063"></a>
<a name="ln-1064"></a>                 <span class="c">!Calculate,  for a given beam direction, the layer front absorptance</span>
<a name="ln-1065"></a>                 <span class="c">! for ground-reflected radiation</span>
<a name="ln-1066"></a>
<a name="ln-1067"></a>                 <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>     <span class="c">!layer loop</span>
<a name="ln-1068"></a>                     <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1069"></a>                     <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1070"></a>                     <span class="k">DO  </span><span class="n">J</span>  <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NGnd</span>   <span class="c">!Incident ray loop</span>
<a name="ln-1071"></a>                         <span class="n">JRay</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">GndIndex</span><span class="p">(</span> <span class="n">J</span> <span class="p">)</span>
<a name="ln-1072"></a>                         <span class="k">IF</span> <span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolBmGndWt</span><span class="p">(</span> <span class="n">J</span> <span class="p">,</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1073"></a><span class="k">                             </span><span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolBmGndWt</span><span class="p">(</span> <span class="n">J</span> <span class="p">,</span><span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1074"></a>                               <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">JRay</span><span class="p">)</span>
<a name="ln-1075"></a>                             <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolBmGndWt</span><span class="p">(</span> <span class="n">J</span> <span class="p">,</span><span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1076"></a>                               <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">JRay</span><span class="p">)</span>  <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">FrtAbs</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">JRay</span> <span class="p">)</span>
<a name="ln-1077"></a>                          <span class="k">END IF</span>
<a name="ln-1078"></a><span class="k">                     END DO</span>  <span class="c">!Incident ray loop</span>
<a name="ln-1079"></a>                     <span class="k">IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1080"></a><span class="k">                         </span><span class="n">State</span><span class="p">%</span><span class="n">WinBmGndAbs</span><span class="p">(</span> <span class="n">L</span> <span class="p">,</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-1081"></a>                     <span class="k">ELSE</span>
<a name="ln-1082"></a><span class="k">                         </span><span class="n">State</span><span class="p">%</span><span class="n">WinBmGndAbs</span><span class="p">(</span> <span class="n">L</span> <span class="p">,</span> <span class="n">Hour</span> <span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>  <span class="c">!No unshaded ground =&gt; no absorptance</span>
<a name="ln-1083"></a>                     <span class="n">ENDIF</span>
<a name="ln-1084"></a>                 <span class="k">END DO</span>      <span class="c">!layer loop</span>
<a name="ln-1085"></a>
<a name="ln-1086"></a>                 <span class="c">!Check the back surfaces for exterior windows</span>
<a name="ln-1087"></a>                 <span class="n">RegWindFnd</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1088"></a>                 <span class="n">NRegWin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1089"></a>                 <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">RegWinIndex</span><span class="p">(</span> <span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1090"></a>                 <span class="k">DO </span><span class="n">KBkSurf</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span>
<a name="ln-1091"></a>                     <span class="n">BaseSurf</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">BaseSurf</span>     <span class="c">!ShadowComb is organized by base surface</span>
<a name="ln-1092"></a>                     <span class="n">JSurf</span> <span class="o">=</span> <span class="n">ShadowComb</span><span class="p">(</span><span class="n">BaseSurf</span><span class="p">)%</span><span class="n">BackSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)</span>
<a name="ln-1093"></a>                     <span class="k">IF</span> <span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">WindowModelType</span> <span class="o">==</span> <span class="n">WindowBSDFModel</span> <span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1094"></a><span class="k">                     IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="k">Class</span> <span class="o">==</span> <span class="n">SurfaceClass_Window</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="k">Class</span> <span class="o">==</span> <span class="p">&amp;</span>
<a name="ln-1095"></a>                           <span class="n">SurfaceClass_GlassDoor</span> <span class="p">)</span> <span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1096"></a><span class="k">                     IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">HeatTransSurf</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">ExtBoundCond</span> <span class="o">==</span> <span class="n">ExternalEnvironment</span> <span class="p">&amp;</span>
<a name="ln-1097"></a>                           <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">ExtSolar</span> <span class="p">)</span> <span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1098"></a>                     <span class="c">! Back surface is an exterior window or door</span>
<a name="ln-1099"></a>                     <span class="n">RegWindFnd</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1100"></a>                     <span class="n">NRegWin</span> <span class="o">=</span> <span class="n">NRegWin</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1101"></a>                     <span class="n">RegWinIndex</span><span class="p">(</span><span class="n">NRegWin</span><span class="p">)</span> <span class="o">=</span> <span class="n">KBkSurf</span>
<a name="ln-1102"></a>                 <span class="k">END DO</span>
<a name="ln-1103"></a><span class="k">                 IF</span> <span class="p">(</span><span class="n">RegWindFnd</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1104"></a><span class="k">                     ALLOCATE</span><span class="p">(</span><span class="n">Absorb</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">NLayers</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1105"></a>                     <span class="n">SunDir</span> <span class="o">=</span> <span class="n">SUNCOSTS</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">Hour</span><span class="p">,</span><span class="n">TS</span><span class="p">)</span>
<a name="ln-1106"></a>                     <span class="n">BkIncRay</span> <span class="o">=</span> <span class="n">FindInBasis</span> <span class="p">(</span> <span class="n">SunDir</span><span class="p">,</span> <span class="n">Back_Incident</span><span class="p">,</span><span class="n">ISurf</span><span class="p">,</span><span class="n">IState</span><span class="p">,&amp;</span>
<a name="ln-1107"></a>                                         <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Trn</span><span class="p">,</span> <span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">)</span>
<a name="ln-1108"></a>                     <span class="k">IF</span> <span class="p">(</span> <span class="n">BkIncRay</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1109"></a>                         <span class="c">!Here calculate the back incidence properties for the solar ray</span>
<a name="ln-1110"></a>                         <span class="c">!this does not say whether or not the ray can pass through the</span>
<a name="ln-1111"></a>                         <span class="c">!back surface window and hit this one!</span>
<a name="ln-1112"></a>                         <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1113"></a>                         <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-1114"></a>                             <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1115"></a>                                       <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolBkRefl</span><span class="p">(</span> <span class="n">J</span><span class="p">,</span> <span class="n">BkIncRay</span> <span class="p">)</span>
<a name="ln-1116"></a>                         <span class="k">END DO</span>
<a name="ln-1117"></a><span class="k">                         </span><span class="n">Refl</span> <span class="o">=</span> <span class="n">Sum1</span>
<a name="ln-1118"></a>                         <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>
<a name="ln-1119"></a>                             <span class="n">Absorb</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">BkAbs</span><span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="n">BkIncRay</span> <span class="p">)</span>
<a name="ln-1120"></a>                         <span class="k">END DO</span>
<a name="ln-1121"></a><span class="k">                     ELSE</span>
<a name="ln-1122"></a>                         <span class="c">!solar ray can&#39;t be incident on back, so set properties equal to zero</span>
<a name="ln-1123"></a>                         <span class="n">Refl</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1124"></a>                         <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>
<a name="ln-1125"></a>                             <span class="n">Absorb</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-1126"></a>                         <span class="k">END DO</span>
<a name="ln-1127"></a><span class="k">                     </span><span class="n">ENDIF</span>
<a name="ln-1128"></a>                     <span class="k">DO </span><span class="n">KRegWin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NRegWin</span>
<a name="ln-1129"></a>                         <span class="n">KBkSurf</span> <span class="o">=</span> <span class="n">RegWinIndex</span><span class="p">(</span> <span class="n">KRegWin</span> <span class="p">)</span>
<a name="ln-1130"></a>                         <span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDHBkRefl</span><span class="p">(</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span> <span class="p">)</span><span class="o">=</span> <span class="n">Refl</span>
<a name="ln-1131"></a>                         <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>
<a name="ln-1132"></a>                             <span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDirBkAbs</span> <span class="p">(</span><span class="n">L</span> <span class="p">,</span> <span class="n">Hour</span><span class="p">,</span> <span class="n">TS</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Absorb</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<a name="ln-1133"></a>                         <span class="k">END DO</span>
<a name="ln-1134"></a><span class="k">                     </span><span class="n">ENDDO</span>
<a name="ln-1135"></a>                 <span class="n">ENDIF</span>
<a name="ln-1136"></a>                 <span class="k">IF</span> <span class="p">(</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">Absorb</span><span class="p">)</span> <span class="p">)</span> <span class="k">DEALLOCATE</span> <span class="p">(</span><span class="n">Absorb</span><span class="p">)</span>
<a name="ln-1137"></a>                 <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">RegWinIndex</span><span class="p">)</span>
<a name="ln-1138"></a>
<a name="ln-1139"></a><span class="c">!</span>
<a name="ln-1140"></a><span class="c">!</span>
<a name="ln-1141"></a>
<a name="ln-1142"></a>  <span class="k">RETURN</span>
<a name="ln-1143"></a>
<a name="ln-1144"></a><span class="k">END SUBROUTINE </span><span class="n">CalculateWindowBeamProperties</span>
<a name="ln-1145"></a>
<a name="ln-1146"></a>
<a name="ln-1147"></a><span class="k">SUBROUTINE </span><span class="n">CalcStaticProperties</span>
<a name="ln-1148"></a>
<a name="ln-1149"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1150"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-1151"></a>          <span class="c">!       DATE WRITTEN   &lt;date_written&gt;</span>
<a name="ln-1152"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-1153"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1154"></a>
<a name="ln-1155"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1156"></a>          <span class="c">! Calculates those optical properties of all the Complex Fenestrations that</span>
<a name="ln-1157"></a>          <span class="c">! do not depend on the beam direction (hence, on hour and time step)</span>
<a name="ln-1158"></a>
<a name="ln-1159"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1160"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-1161"></a>
<a name="ln-1162"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1163"></a>          <span class="c">! na</span>
<a name="ln-1164"></a>
<a name="ln-1165"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1166"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-1167"></a>
<a name="ln-1168"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1169"></a>
<a name="ln-1170"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1171"></a>      <span class="c">! na</span>
<a name="ln-1172"></a>
<a name="ln-1173"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1174"></a>          <span class="c">! na</span>
<a name="ln-1175"></a>
<a name="ln-1176"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-1177"></a>          <span class="c">! na</span>
<a name="ln-1178"></a>
<a name="ln-1179"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-1180"></a>          <span class="c">! na</span>
<a name="ln-1181"></a>
<a name="ln-1182"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1183"></a>   <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">ISurf</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index for sorting thru Surface array</span>
<a name="ln-1184"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IConst</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index for accessing Construct array</span>
<a name="ln-1185"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IState</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index identifying the window state for a particular window</span>
<a name="ln-1186"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IWind</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Index identifying a window in the WindowList</span>
<a name="ln-1187"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">I</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-1188"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">J</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-1189"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">K</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-1190"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NumStates</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!local copy of no of states</span>
<a name="ln-1191"></a>
<a name="ln-1192"></a>
<a name="ln-1193"></a><span class="c">!</span>
<a name="ln-1194"></a><span class="c">!</span>
<a name="ln-1195"></a>  <span class="k">DO </span><span class="n">IWind</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NumComplexWind</span>
<a name="ln-1196"></a>    <span class="n">ISurf</span> <span class="o">=</span> <span class="n">WindowList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">)%</span><span class="n">SurfNo</span>
<a name="ln-1197"></a>    <span class="n">NumStates</span> <span class="o">=</span> <span class="n">WindowList</span><span class="p">(</span> <span class="n">IWind</span> <span class="p">)%</span><span class="n">NumStates</span>
<a name="ln-1198"></a>    <span class="k">DO </span><span class="n">IState</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumStates</span>
<a name="ln-1199"></a>      <span class="c">! IConst = WindowStateList ( IWind , IState )%Konst</span>
<a name="ln-1200"></a>      <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Konst</span> <span class="o">=</span> <span class="n">WindowStateList</span> <span class="p">(</span><span class="n">IWind</span> <span class="p">,</span><span class="n">IState</span><span class="p">)%</span><span class="n">Konst</span>
<a name="ln-1201"></a>      <span class="k">CALL </span><span class="n">CalcWindowStaticProperties</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1202"></a>        <span class="n">ComplexWind</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Geom</span><span class="p">(</span><span class="n">IState</span><span class="p">),</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">))</span>
<a name="ln-1203"></a>    <span class="k">END DO</span>
<a name="ln-1204"></a><span class="k">  END DO</span>
<a name="ln-1205"></a>
<a name="ln-1206"></a><span class="k">  RETURN</span>
<a name="ln-1207"></a>
<a name="ln-1208"></a><span class="k">END SUBROUTINE </span><span class="n">CalcStaticProperties</span>
<a name="ln-1209"></a>
<a name="ln-1210"></a><span class="k">SUBROUTINE </span><span class="n">CalculateBasisLength</span> <span class="p">(</span> <span class="n">Input</span><span class="p">,</span><span class="n">IConst</span><span class="p">,</span><span class="n">NBasis</span> <span class="p">)</span>
<a name="ln-1211"></a>
<a name="ln-1212"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1213"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-1214"></a>          <span class="c">!       DATE WRITTEN   August 2011</span>
<a name="ln-1215"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-1216"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1217"></a>
<a name="ln-1218"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1219"></a>          <span class="c">! Calculates the basis length for a Window6 Non-Symmetric or Axisymmetric basis</span>
<a name="ln-1220"></a>          <span class="c">! from the input basis matrix</span>
<a name="ln-1221"></a>
<a name="ln-1222"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1223"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-1224"></a>
<a name="ln-1225"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1226"></a>          <span class="c">! na</span>
<a name="ln-1227"></a>
<a name="ln-1228"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1229"></a>          <span class="c">! na</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1232"></a>
<a name="ln-1233"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1234"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFWindowInputStruct</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">Input</span>           <span class="c">! BSDF data input struct for this construction</span>
<a name="ln-1235"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">IConst</span>          <span class="c">!Construction number of input</span>
<a name="ln-1236"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">NBasis</span>     <span class="c">! Calculated Basis length</span>
<a name="ln-1237"></a>
<a name="ln-1238"></a>
<a name="ln-1239"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1240"></a>          <span class="c">! na</span>
<a name="ln-1241"></a>
<a name="ln-1242"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-1243"></a>          <span class="c">! na</span>
<a name="ln-1244"></a>
<a name="ln-1245"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-1246"></a>          <span class="c">! na</span>
<a name="ln-1247"></a>
<a name="ln-1248"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1249"></a>          <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">I</span>     <span class="c">!gen purpose index</span>
<a name="ln-1250"></a>
<a name="ln-1251"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">Input</span><span class="p">%</span><span class="n">BasisMatNcols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1252"></a>              <span class="c">!Axisymmetric basis, No. rows is no. of thetas = basis length</span>
<a name="ln-1253"></a>              <span class="n">NBasis</span> <span class="o">=</span> <span class="n">Input</span><span class="p">%</span><span class="n">BasisMatNrows</span>
<a name="ln-1254"></a>              <span class="k">RETURN</span>
<a name="ln-1255"></a><span class="k">          </span><span class="n">ENDIF</span>
<a name="ln-1256"></a>          <span class="n">NBasis</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1257"></a>          <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Input</span><span class="p">%</span><span class="n">BasisMatNrows</span>
<a name="ln-1258"></a>          <span class="n">NBasis</span> <span class="o">=</span> <span class="n">NBasis</span> <span class="o">+</span> <span class="nb">FLOOR</span><span class="p">(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMat</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
<a name="ln-1259"></a>          <span class="k">END DO</span>
<a name="ln-1260"></a><span class="k">  RETURN</span>
<a name="ln-1261"></a>
<a name="ln-1262"></a><span class="k">END SUBROUTINE </span><span class="n">CalculateBasisLength</span>
<a name="ln-1263"></a>
<a name="ln-1264"></a><span class="k">SUBROUTINE </span><span class="n">DetermineMaxBackSurfaces</span>
<a name="ln-1265"></a>
<a name="ln-1266"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1267"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-1268"></a>          <span class="c">!       DATE WRITTEN   September 2011</span>
<a name="ln-1269"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-1270"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1271"></a>
<a name="ln-1272"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1273"></a>          <span class="c">! Calculates the basis length for a Window6 Non-Symmetric or Axisymmetric basis</span>
<a name="ln-1274"></a>          <span class="c">! from the input basis matrix</span>
<a name="ln-1275"></a>
<a name="ln-1276"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1277"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-1278"></a>
<a name="ln-1279"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1280"></a>          <span class="c">! na</span>
<a name="ln-1281"></a>
<a name="ln-1282"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1283"></a>          <span class="c">! na</span>
<a name="ln-1284"></a>
<a name="ln-1285"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1286"></a>
<a name="ln-1287"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1288"></a>          <span class="c">! na</span>
<a name="ln-1289"></a>
<a name="ln-1290"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1291"></a>          <span class="c">! na</span>
<a name="ln-1292"></a>
<a name="ln-1293"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-1294"></a>          <span class="c">! na</span>
<a name="ln-1295"></a>
<a name="ln-1296"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-1297"></a>          <span class="c">! na</span>
<a name="ln-1298"></a>
<a name="ln-1299"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1300"></a>          <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">I</span>     <span class="c">!gen purpose index</span>
<a name="ln-1301"></a>          <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">ZoneNum</span>   <span class="c">!Zone Number</span>
<a name="ln-1302"></a>          <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">SurfNum</span>   <span class="c">!Surface Number</span>
<a name="ln-1303"></a>          <span class="kt">INTEGER</span>     <span class="kd">::</span>  <span class="n">NumSurfInZone</span> <span class="o">=</span><span class="mi">0</span>  <span class="c">!Number of zone surfaces</span>
<a name="ln-1304"></a>          <span class="kt">LOGICAL</span>     <span class="kd">::</span>  <span class="n">ComplexFenInZone</span>  <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1305"></a>
<a name="ln-1306"></a>      <span class="k">DO </span><span class="n">ZoneNum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumOfZones</span>
<a name="ln-1307"></a>          <span class="n">ComplexFenInZone</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1308"></a>          <span class="k">DO </span><span class="n">SurfNum</span> <span class="o">=</span> <span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">SurfaceFirst</span> <span class="p">,</span> <span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">SurfaceLast</span>
<a name="ln-1309"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">WindowModelType</span> <span class="o">==</span> <span class="n">WindowBSDFModel</span><span class="p">)</span> <span class="n">ComplexFenInZone</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1310"></a>          <span class="k">END DO</span>
<a name="ln-1311"></a><span class="k">          IF</span><span class="p">(</span><span class="n">ComplexFenInZone</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1312"></a><span class="k">              </span><span class="n">NumSurfInZone</span> <span class="o">=</span> <span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">SurfaceLast</span> <span class="o">-</span> <span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">SurfaceFirst</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1313"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">MaxBkSurf</span> <span class="o">&lt;</span> <span class="n">NumSurfInZone</span><span class="p">)</span> <span class="n">MaxBkSurf</span> <span class="o">=</span> <span class="n">NumSurfInZone</span>
<a name="ln-1314"></a>          <span class="k">END IF</span>
<a name="ln-1315"></a><span class="k">      END DO</span>
<a name="ln-1316"></a>
<a name="ln-1317"></a><span class="k">  RETURN</span>
<a name="ln-1318"></a>
<a name="ln-1319"></a><span class="k">END SUBROUTINE </span><span class="n">DetermineMaxBackSurfaces</span>
<a name="ln-1320"></a>
<a name="ln-1321"></a><span class="k">SUBROUTINE </span><span class="n">ConstructBasis</span> <span class="p">(</span><span class="n">IConst</span><span class="p">,</span> <span class="n">Basis</span><span class="p">)</span>
<a name="ln-1322"></a>         <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1323"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-1324"></a>          <span class="c">!       DATE WRITTEN  June 2011</span>
<a name="ln-1325"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-1326"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1327"></a>
<a name="ln-1328"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1329"></a>          <span class="c">! Set up a basis from the matrix information pointed to in Construction by ICons</span>
<a name="ln-1330"></a>
<a name="ln-1331"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1332"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-1333"></a>
<a name="ln-1334"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1335"></a>          <span class="c">! na</span>
<a name="ln-1336"></a>
<a name="ln-1337"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1338"></a>          <span class="c">! na</span>
<a name="ln-1339"></a>
<a name="ln-1340"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1341"></a>
<a name="ln-1342"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1343"></a>   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">IConst</span>    <span class="c">!Index for accessing Construct array</span>
<a name="ln-1344"></a>   <span class="k">TYPE</span> <span class="p">(</span><span class="n">BasisStruct</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Basis</span>
<a name="ln-1345"></a>
<a name="ln-1346"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1347"></a>          <span class="c">! na</span>
<a name="ln-1348"></a>
<a name="ln-1349"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-1350"></a>          <span class="c">! na</span>
<a name="ln-1351"></a>
<a name="ln-1352"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-1353"></a>          <span class="c">! na</span>
<a name="ln-1354"></a>
<a name="ln-1355"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1356"></a>
<a name="ln-1357"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">I</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-1358"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">J</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-1359"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NThetas</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Current number of theta values</span>
<a name="ln-1360"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">NumElem</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Number of elements in current basis</span>
<a name="ln-1361"></a>   <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">ElemNo</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!Current basis element number</span>
<a name="ln-1362"></a>   <span class="kt">INTEGER</span>      <span class="kd">::</span>  <span class="n">MaxNPhis</span>    <span class="c">!Max no of NPhis for any theta</span>
<a name="ln-1363"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Theta</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Current theta value</span>
<a name="ln-1364"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Phi</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Current phi value</span>
<a name="ln-1365"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">DTheta</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Increment for theta value (Window6 type input)</span>
<a name="ln-1366"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">DPhi</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Increment for phi value (Window6 type input)</span>
<a name="ln-1367"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">HalfDTheta</span> <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Half-width of all theta bins except first and last (W6 input)</span>
<a name="ln-1368"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Lamda</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Current &#39;Lamda&#39; value (element weight)</span>
<a name="ln-1369"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">SolAng</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Current element solid angle</span>
<a name="ln-1370"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">NextTheta</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Next theta in the W6 basis after current</span>
<a name="ln-1371"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">LastTheta</span>  <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Previous theta in the W6 basis before current</span>
<a name="ln-1372"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">LowerTheta</span> <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Lower theta boundary of the element</span>
<a name="ln-1373"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">UpperTheta</span> <span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Upper theta boundary of the element</span>
<a name="ln-1374"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Azimuth</span>    <span class="c">!Azimuth of window surface (radians)</span>
<a name="ln-1375"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Tilt</span>    <span class="c">!Tilt of window surface (radians)</span>
<a name="ln-1376"></a>   <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span> <span class="kd">::</span> <span class="n">Thetas</span>  <span class="c">!temp array holding theta values</span>
<a name="ln-1377"></a>   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span> <span class="n">NPhis</span>  <span class="c">!temp array holding number of phis for a given theta</span>
<a name="ln-1378"></a>   <span class="c">!</span>
<a name="ln-1379"></a>   <span class="c">!</span>
<a name="ln-1380"></a>   <span class="c">!</span>
<a name="ln-1381"></a>
<a name="ln-1382"></a>            <span class="n">NThetas</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMatNrows</span>  <span class="c">!Note here assuming row by row input</span>
<a name="ln-1383"></a>            <span class="n">Basis</span><span class="p">%</span><span class="n">NThetas</span> <span class="o">=</span> <span class="n">NThetas</span>
<a name="ln-1384"></a>            <span class="n">Basis</span><span class="p">%</span><span class="n">BasisMatIndex</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMatIndex</span>
<a name="ln-1385"></a>            <span class="n">Basis</span><span class="p">%</span><span class="n">NBasis</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-1386"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1387"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Thetas</span><span class="p">(</span><span class="n">NThetas</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>    <span class="c">!Temp array</span>
<a name="ln-1388"></a>                  <span class="c">!By convention the Thetas array contains a final point at Pi/2 which is not a basis element</span>
<a name="ln-1389"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">NPhis</span><span class="p">(</span><span class="n">NThetas</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>    <span class="c">!Temp array</span>
<a name="ln-1390"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">Thetas</span><span class="p">(</span><span class="n">NThetas</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1391"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">NPhis</span><span class="p">(</span><span class="n">NThetas</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1392"></a>
<a name="ln-1393"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1394"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">SolAng</span><span class="p">(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1395"></a>  <span class="n">BTW</span><span class="p">:</span>    <span class="k">IF</span><span class="p">(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisType</span> <span class="o">==</span> <span class="n">BasisType_WINDOW</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1396"></a>    <span class="c">!</span>
<a name="ln-1397"></a>    <span class="c">!   WINDOW6 Basis</span>
<a name="ln-1398"></a>    <span class="c">!</span>
<a name="ln-1399"></a>    <span class="n">Basis</span><span class="p">%</span><span class="n">BasisType</span> <span class="o">=</span> <span class="n">BasisType_WINDOW</span>
<a name="ln-1400"></a>    <span class="n">BST</span><span class="p">:</span>      <span class="k">IF</span><span class="p">(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisSymmetryType</span> <span class="o">==</span> <span class="n">BasisSymmetry_None</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1401"></a>            <span class="c">!</span>
<a name="ln-1402"></a>            <span class="c">! No basis symmetry</span>
<a name="ln-1403"></a>            <span class="c">!</span>
<a name="ln-1404"></a>            <span class="n">Basis</span><span class="p">%</span><span class="n">BasisSymmetryType</span> <span class="o">=</span>   <span class="n">BasisSymmetry_None</span>
<a name="ln-1405"></a>            <span class="n">Thetas</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>      <span class="c">!By convention, the first basis point is at the center (theta=0,phi=0)</span>
<a name="ln-1406"></a>            <span class="n">Thetas</span><span class="p">(</span><span class="n">NThetas</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">Pi</span>    <span class="c">!and there is an N+1st point (not a basis element) at Pi/2</span>
<a name="ln-1407"></a>            <span class="n">NPhis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1408"></a>            <span class="n">NumElem</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1409"></a>            <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">NThetas</span>
<a name="ln-1410"></a>              <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMat</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">DegToRadians</span>
<a name="ln-1411"></a>              <span class="n">NPhis</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="nb">FLOOR</span><span class="p">(</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMat</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
<a name="ln-1412"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">NPhis</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">Call </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;WindowComplexManager: incorrect input, no. phis must be positive.&#39;</span><span class="p">)</span>
<a name="ln-1413"></a>              <span class="n">NumElem</span><span class="o">=</span><span class="n">NumElem</span><span class="o">+</span><span class="n">NPhis</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1414"></a>            <span class="k">END DO</span>
<a name="ln-1415"></a><span class="k">            </span><span class="n">MaxNPhis</span> <span class="o">=</span><span class="nb">MAXVAL</span><span class="p">(</span><span class="n">NPhis</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NThetas</span><span class="p">))</span>
<a name="ln-1416"></a>            <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span><span class="p">(</span> <span class="n">MaxNPhis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NThetas</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>  <span class="c">!N+1st Phi point (not basis element) at 2Pi</span>
<a name="ln-1417"></a>          <span class="k">ALLOCATE</span><span class="p">(</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span> <span class="p">(</span> <span class="n">NThetas</span><span class="o">+</span><span class="mi">1</span> <span class="p">,</span> <span class="n">MaxNPhis</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-1418"></a>          <span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span> <span class="o">=</span><span class="mf">0.0d0</span>   <span class="c">!Initialize so undefined elements will contain zero</span>
<a name="ln-1419"></a>          <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!Initialize so undefined elements will contain zero</span>
<a name="ln-1420"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">NumElem</span> <span class="o">/=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">NBasis</span><span class="p">)</span> <span class="k">THEN</span>  <span class="c">!Constructed Basis must match property matrices</span>
<a name="ln-1421"></a>           <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;WindowComplexManager: Constructed basis length does not match property matrices.&#39;</span><span class="p">)</span>
<a name="ln-1422"></a>            <span class="n">ENDIF</span>
<a name="ln-1423"></a>               <span class="n">Basis</span><span class="p">%</span><span class="n">Thetas</span> <span class="o">=</span> <span class="n">Thetas</span>
<a name="ln-1424"></a>               <span class="n">Basis</span><span class="p">%</span><span class="n">NPhis</span> <span class="o">=</span> <span class="n">NPhis</span>
<a name="ln-1425"></a>               <span class="n">ElemNo</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1426"></a>   <span class="n">ThLoop</span><span class="p">:</span> <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NThetas</span>
<a name="ln-1427"></a>              <span class="n">Theta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1428"></a>              <span class="k">IF</span> <span class="p">(</span> <span class="n">I</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">THEN</span>  <span class="c">!First theta value must always be zero</span>
<a name="ln-1429"></a>              <span class="n">HalfDTheta</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1430"></a>               <span class="n">LastTheta</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1431"></a>               <span class="n">NextTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1432"></a>               <span class="n">LowerTheta</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1433"></a>               <span class="n">UpperTheta</span> <span class="o">=</span> <span class="n">HalfDTheta</span>
<a name="ln-1434"></a>              <span class="k">ELSE IF</span><span class="p">(</span><span class="n">I</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">I</span> <span class="o">&lt;</span> <span class="n">NThetas</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1435"></a><span class="k">               </span><span class="n">LastTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1436"></a>               <span class="n">NextTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1437"></a>               <span class="n">LowerTheta</span><span class="o">=</span><span class="n">UpperTheta</span>
<a name="ln-1438"></a>               <span class="n">HalfDTheta</span> <span class="o">=</span> <span class="n">Theta</span> <span class="o">-</span> <span class="n">LowerTheta</span>
<a name="ln-1439"></a>               <span class="n">UpperTheta</span> <span class="o">=</span> <span class="n">Theta</span> <span class="o">+</span> <span class="n">HalfDTheta</span>
<a name="ln-1440"></a>             <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="n">NThetas</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1441"></a><span class="k">               </span><span class="n">LastTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1442"></a>               <span class="n">NextTheta</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">Pi</span>
<a name="ln-1443"></a>               <span class="n">LowerTheta</span> <span class="o">=</span> <span class="n">UpperTheta</span>  <span class="c">!It is assumed that Thetas(N) is the mean between the previous</span>
<a name="ln-1444"></a>                     <span class="c">!UpperTheta and pi/2.</span>
<a name="ln-1445"></a>               <span class="n">UpperTheta</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">Pi</span>
<a name="ln-1446"></a>             <span class="n">ENDIF</span>
<a name="ln-1447"></a>             <span class="n">DPhi</span><span class="o">=</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span><span class="o">/</span><span class="n">NPhis</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1448"></a>             <span class="k">IF</span> <span class="p">(</span><span class="n">I</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1449"></a><span class="k">               </span><span class="n">Lamda</span> <span class="o">=</span> <span class="n">Pi</span><span class="o">*</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-1450"></a>               <span class="n">SolAng</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="nb">COS</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span>
<a name="ln-1451"></a>             <span class="k">ELSE</span>
<a name="ln-1452"></a><span class="k">               </span><span class="n">Lamda</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">DPhi</span><span class="o">*</span><span class="p">((</span><span class="nb">SIN</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">LowerTheta</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c">!For W6 basis, lamda is funct of Theta and</span>
<a name="ln-1453"></a>                    <span class="c">! NPhis, not individual Phi</span>
<a name="ln-1454"></a>               <span class="n">SolAng</span> <span class="o">=</span> <span class="n">DPhi</span><span class="o">*</span><span class="p">(</span><span class="nb">COS</span><span class="p">(</span><span class="n">LowerTheta</span><span class="p">)</span> <span class="o">-</span> <span class="nb">COS</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span>
<a name="ln-1455"></a>             <span class="k">END IF</span>
<a name="ln-1456"></a><span class="k">             </span><span class="n">DTheta</span> <span class="o">=</span> <span class="n">UpperTheta</span><span class="o">-</span><span class="n">LowerTheta</span>
<a name="ln-1457"></a>             <span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span> <span class="p">(</span> <span class="n">NPhis</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">I</span> <span class="p">)</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span>  <span class="c">!Non-basis-element Phi point for table searching in Phi</span>
<a name="ln-1458"></a>             <span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NPhis</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1459"></a>               <span class="n">ElemNo</span> <span class="o">=</span> <span class="n">ElemNo</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1460"></a>               <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">ElemNo</span>
<a name="ln-1461"></a>               <span class="n">Phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">DPhi</span>
<a name="ln-1462"></a>               <span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span><span class="p">(</span> <span class="n">J</span> <span class="p">,</span> <span class="n">I</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Phi</span>  <span class="c">!Note: this ordering of I &amp; J are necessary to allow Phis(Theta) to</span>
<a name="ln-1463"></a>                     <span class="c">!  be searched as a one-dimensional table</span>
<a name="ln-1464"></a>               <span class="k">Call </span><span class="n">FillBasisElement</span> <span class="p">(</span><span class="n">Theta</span><span class="p">,</span><span class="n">Phi</span><span class="p">,</span><span class="n">ElemNo</span><span class="p">,</span><span class="n">Basis</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1465"></a>                      <span class="p">&amp;</span>    <span class="p">,</span><span class="n">LowerTheta</span><span class="p">,</span><span class="n">UpperTheta</span><span class="p">,</span><span class="n">DPhi</span><span class="p">,</span><span class="n">BasisType_WINDOW</span><span class="p">)</span>  <span class="c">!This gets all the simple grid characteristics</span>
<a name="ln-1466"></a>                                         <span class="n">Basis</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="o">=</span> <span class="n">Lamda</span>
<a name="ln-1467"></a>                                         <span class="n">Basis</span><span class="p">%</span><span class="n">SolAng</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="o">=</span> <span class="n">SolAng</span>
<a name="ln-1468"></a>                           <span class="k">END DO</span>
<a name="ln-1469"></a><span class="k">             END DO </span><span class="n">ThLoop</span>
<a name="ln-1470"></a>          <span class="k">ELSE </span><span class="n">BST</span>
<a name="ln-1471"></a>              <span class="c">!</span>
<a name="ln-1472"></a>              <span class="c">!  Axisymmetric basis symmetry (Note this only useful specular systems, where it allows shorter data input)</span>
<a name="ln-1473"></a>              <span class="c">!</span>
<a name="ln-1474"></a>              <span class="n">Basis</span><span class="p">%</span><span class="n">BasisSymmetryType</span> <span class="o">=</span>   <span class="n">BasisSymmetry_Axisymmetric</span>
<a name="ln-1475"></a>            <span class="n">Thetas</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>      <span class="c">!By convention, the first basis point is at the center (theta=0,phi=0)</span>
<a name="ln-1476"></a>            <span class="n">Thetas</span><span class="p">(</span><span class="n">NThetas</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">Pi</span>    <span class="c">!and there is an N+1st point (not a basis element) at Pi/2</span>
<a name="ln-1477"></a>            <span class="n">NPhis</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c">!As insurance, define one phi for each theta</span>
<a name="ln-1478"></a>            <span class="n">NumElem</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1479"></a>            <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">NThetas</span>
<a name="ln-1480"></a>              <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">BasisMat</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">DegToRadians</span>
<a name="ln-1481"></a>              <span class="n">NumElem</span><span class="o">=</span><span class="n">NumElem</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1482"></a>            <span class="k">END DO</span>
<a name="ln-1483"></a><span class="k">            ALLOCATE</span><span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span><span class="p">(</span> <span class="n">NThetas</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-1484"></a>          <span class="k">ALLOCATE</span><span class="p">(</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span> <span class="p">(</span> <span class="n">NThetas</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-1485"></a>          <span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span> <span class="o">=</span><span class="mf">0.0d0</span>   <span class="c">!Initialize so undefined elements will contain zero</span>
<a name="ln-1486"></a>          <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!Initialize so undefined elements will contain zero</span>
<a name="ln-1487"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">NumElem</span> <span class="o">/=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">NBasis</span><span class="p">)</span> <span class="k">THEN</span>  <span class="c">!Constructed Basis must match property matrices</span>
<a name="ln-1488"></a>               <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;WindowComplexManager: Constructed basis length does not match property matrices.&#39;</span><span class="p">)</span>
<a name="ln-1489"></a>            <span class="n">ENDIF</span>
<a name="ln-1490"></a>               <span class="n">Basis</span><span class="p">%</span><span class="n">Thetas</span> <span class="o">=</span> <span class="n">Thetas</span>
<a name="ln-1491"></a>               <span class="n">Basis</span><span class="p">%</span><span class="n">NPhis</span> <span class="o">=</span> <span class="n">NPhis</span>
<a name="ln-1492"></a>               <span class="n">ElemNo</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1493"></a>               <span class="n">DPhi</span><span class="o">=</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span>
<a name="ln-1494"></a>   <span class="n">ThLoop2</span><span class="p">:</span>   <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NThetas</span>
<a name="ln-1495"></a>                   <span class="n">Theta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1496"></a>                   <span class="k">IF</span> <span class="p">(</span> <span class="n">I</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">THEN</span>  <span class="c">!First theta value must always be zero</span>
<a name="ln-1497"></a>                       <span class="n">HalfDTheta</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1498"></a>                       <span class="n">LastTheta</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1499"></a>                       <span class="n">NextTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1500"></a>                       <span class="n">LowerTheta</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1501"></a>                       <span class="n">UpperTheta</span> <span class="o">=</span> <span class="n">HalfDTheta</span>
<a name="ln-1502"></a>                   <span class="k">ELSE IF</span><span class="p">(</span><span class="n">I</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">I</span> <span class="o">&lt;</span> <span class="n">NThetas</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1503"></a><span class="k">                       </span><span class="n">LastTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1504"></a>                       <span class="n">NextTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1505"></a>                       <span class="n">LowerTheta</span><span class="o">=</span><span class="n">UpperTheta</span>
<a name="ln-1506"></a>                       <span class="n">HalfDTheta</span> <span class="o">=</span> <span class="n">Theta</span> <span class="o">-</span> <span class="n">LowerTheta</span>
<a name="ln-1507"></a>                       <span class="n">UpperTheta</span> <span class="o">=</span> <span class="n">Theta</span> <span class="o">+</span> <span class="n">HalfDTheta</span>
<a name="ln-1508"></a>                   <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="n">NThetas</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1509"></a><span class="k">                       </span><span class="n">LastTheta</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1510"></a>                       <span class="n">NextTheta</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">Pi</span>
<a name="ln-1511"></a>                       <span class="n">LowerTheta</span> <span class="o">=</span> <span class="n">UpperTheta</span>  <span class="c">!It is assumed that Thetas(N) is the mean between the previous</span>
<a name="ln-1512"></a>                     <span class="c">!UpperTheta and pi/2.</span>
<a name="ln-1513"></a>                       <span class="n">UpperTheta</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">Pi</span>
<a name="ln-1514"></a>                  <span class="n">ENDIF</span>
<a name="ln-1515"></a>                  <span class="k">IF</span> <span class="p">(</span><span class="n">I</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1516"></a><span class="k">                       </span><span class="n">Lamda</span> <span class="o">=</span> <span class="n">Pi</span><span class="o">*</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-1517"></a>                       <span class="n">SolAng</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="nb">COS</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span>
<a name="ln-1518"></a>                  <span class="k">ELSE</span>
<a name="ln-1519"></a><span class="k">                       </span><span class="n">Lamda</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">DPhi</span><span class="o">*</span><span class="p">((</span><span class="nb">SIN</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">LowerTheta</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c">!For W6 basis, lamda is funct of Theta and</span>
<a name="ln-1520"></a>                    <span class="c">! NPhis, not individual Phi</span>
<a name="ln-1521"></a>                       <span class="n">SolAng</span> <span class="o">=</span> <span class="n">DPhi</span><span class="o">*</span><span class="p">(</span><span class="nb">COS</span><span class="p">(</span><span class="n">LowerTheta</span><span class="p">)</span> <span class="o">-</span> <span class="nb">COS</span><span class="p">(</span><span class="n">UpperTheta</span><span class="p">))</span>
<a name="ln-1522"></a>                  <span class="k">END IF</span>
<a name="ln-1523"></a><span class="k">                       </span><span class="n">DTheta</span> <span class="o">=</span> <span class="n">UpperTheta</span><span class="o">-</span><span class="n">LowerTheta</span>
<a name="ln-1524"></a>                       <span class="n">ElemNo</span> <span class="o">=</span> <span class="n">ElemNo</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1525"></a>                       <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ElemNo</span>
<a name="ln-1526"></a>                       <span class="n">Phi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1527"></a>                       <span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span><span class="p">(</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">I</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Phi</span>  <span class="c">!Note: this ordering of I &amp; J are necessary to allow Phis(Theta) to</span>
<a name="ln-1528"></a>                     <span class="c">!  be searched as a one-dimensional table</span>
<a name="ln-1529"></a>                       <span class="k">Call </span><span class="n">FillBasisElement</span> <span class="p">(</span><span class="n">Theta</span><span class="p">,</span><span class="n">Phi</span><span class="p">,</span><span class="n">ElemNo</span><span class="p">,</span><span class="n">Basis</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)&amp;</span>
<a name="ln-1530"></a>                        <span class="p">,</span><span class="n">LowerTheta</span><span class="p">,</span><span class="n">UpperTheta</span><span class="p">,</span><span class="n">DPhi</span><span class="p">,</span><span class="n">BasisType_WINDOW</span><span class="p">)</span>  <span class="c">!This gets all the simple grid characteristics</span>
<a name="ln-1531"></a>                       <span class="n">Basis</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="o">=</span> <span class="n">Lamda</span>
<a name="ln-1532"></a>                       <span class="n">Basis</span><span class="p">%</span><span class="n">SolAng</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="o">=</span> <span class="n">SolAng</span>
<a name="ln-1533"></a>
<a name="ln-1534"></a>          <span class="k">END DO </span><span class="n">ThLoop2</span>
<a name="ln-1535"></a>            <span class="k">END IF </span><span class="n">BST</span>
<a name="ln-1536"></a>          <span class="k">ELSE </span><span class="n">BTW</span>
<a name="ln-1537"></a>            <span class="k">Call </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;WindowComplexManager: Non-Window6 basis type not yet implemented.&#39;</span><span class="p">)</span>
<a name="ln-1538"></a>          <span class="k">END IF </span><span class="n">BTW</span>
<a name="ln-1539"></a>    <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">Thetas</span><span class="p">,</span><span class="n">NPhis</span><span class="p">)</span>
<a name="ln-1540"></a>
<a name="ln-1541"></a>   <span class="k">RETURN</span>
<a name="ln-1542"></a>
<a name="ln-1543"></a><span class="k">END SUBROUTINE </span><span class="n">ConstructBasis</span>
<a name="ln-1544"></a>
<a name="ln-1545"></a><span class="k">SUBROUTINE </span><span class="n">FillBasisElement</span> <span class="p">(</span><span class="n">Theta</span><span class="p">,</span><span class="n">Phi</span><span class="p">,</span><span class="n">Elem</span><span class="p">,</span><span class="n">BasisElem</span><span class="p">,</span><span class="n">LowerTheta</span><span class="p">,</span><span class="n">UpperTheta</span><span class="p">,</span><span class="n">DPhi</span><span class="p">,</span><span class="n">InputType</span><span class="p">)</span>
<a name="ln-1546"></a>
<a name="ln-1547"></a>
<a name="ln-1548"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1549"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-1550"></a>          <span class="c">!       DATE WRITTEN   August 2010</span>
<a name="ln-1551"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-1552"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1553"></a>
<a name="ln-1554"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1555"></a>          <span class="c">! fill in values for all the components of a basis element</span>
<a name="ln-1556"></a>
<a name="ln-1557"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1558"></a>          <span class="c">! &lt;n/a&gt;</span>
<a name="ln-1559"></a>
<a name="ln-1560"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1561"></a>          <span class="c">! na</span>
<a name="ln-1562"></a>
<a name="ln-1563"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1564"></a>          <span class="c">! na</span>
<a name="ln-1565"></a>
<a name="ln-1566"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1567"></a>
<a name="ln-1568"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1569"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Theta</span>       <span class="c">!Central polar angle of element</span>
<a name="ln-1570"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Phi</span>         <span class="c">!Central azimuthal angle of element</span>
<a name="ln-1571"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LowerTheta</span>  <span class="c">!Lower edge of element (polar angle)</span>
<a name="ln-1572"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">UpperTheta</span>  <span class="c">!Upper edge of element (polar angle)</span>
<a name="ln-1573"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DPhi</span>        <span class="c">!Width of element (azimuthal angle)</span>
<a name="ln-1574"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">Elem</span>        <span class="c">!Index number of element in basis</span>
<a name="ln-1575"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">InputType</span>   <span class="c">!Basis type</span>
<a name="ln-1576"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BasisElemDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">BasisElem</span>
<a name="ln-1577"></a>
<a name="ln-1578"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1579"></a>          <span class="c">! na</span>
<a name="ln-1580"></a>
<a name="ln-1581"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-1582"></a>          <span class="c">! na</span>
<a name="ln-1583"></a>
<a name="ln-1584"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-1585"></a>          <span class="c">! na</span>
<a name="ln-1586"></a>
<a name="ln-1587"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1588"></a>
<a name="ln-1589"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">InputType</span> <span class="o">==</span> <span class="n">BasisType_WINDOW</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1590"></a>    <span class="c">!</span>
<a name="ln-1591"></a>    <span class="c">!WINDOW6 Type BASIS</span>
<a name="ln-1592"></a>    <span class="c">!</span>
<a name="ln-1593"></a>    <span class="k">IF</span><span class="p">(</span><span class="n">Elem</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1594"></a>  <span class="c">!first element, theta=0, is special case</span>
<a name="ln-1595"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">Theta</span> <span class="o">=</span> <span class="n">Theta</span>
<a name="ln-1596"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">Phi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1597"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">dPhi</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span>
<a name="ln-1598"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">UpprTheta</span> <span class="o">=</span><span class="n">UpperTheta</span>
<a name="ln-1599"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">dTheta</span> <span class="o">=</span> <span class="n">BasisElem</span><span class="p">%</span><span class="n">UpprTheta</span><span class="o">-</span><span class="n">Theta</span>
<a name="ln-1600"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">LwrTheta</span> <span class="o">=</span> <span class="n">Theta</span>
<a name="ln-1601"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">LwrPhi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1602"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">UpprPhi</span> <span class="o">=</span>  <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span>
<a name="ln-1603"></a>    <span class="k">ELSE</span>
<a name="ln-1604"></a><span class="k">      </span><span class="n">BasisElem</span><span class="p">%</span><span class="n">Theta</span> <span class="o">=</span><span class="n">Theta</span>
<a name="ln-1605"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Phi</span>
<a name="ln-1606"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">dPhi</span> <span class="o">=</span> <span class="n">DPhi</span>
<a name="ln-1607"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">LwrPhi</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">-</span><span class="n">DPhi</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-1608"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">UpprPhi</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">+</span><span class="n">DPhi</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-1609"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">LwrTheta</span> <span class="o">=</span> <span class="n">LowerTheta</span>
<a name="ln-1610"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">UpprTheta</span> <span class="o">=</span> <span class="n">UpperTheta</span>
<a name="ln-1611"></a>      <span class="n">BasisElem</span><span class="p">%</span><span class="n">dTheta</span> <span class="o">=</span> <span class="n">BasisElem</span><span class="p">%</span><span class="n">UpprTheta</span><span class="o">-</span><span class="n">BasisElem</span><span class="p">%</span><span class="n">LwrTheta</span>
<a name="ln-1612"></a>    <span class="k">END IF</span>
<a name="ln-1613"></a><span class="k">  ELSE</span>
<a name="ln-1614"></a>    <span class="c">!</span>
<a name="ln-1615"></a>    <span class="c">!Non-WINDOW6 Type Basis</span>
<a name="ln-1616"></a>    <span class="c">!</span>
<a name="ln-1617"></a>    <span class="c">!Currently not implemented</span>
<a name="ln-1618"></a>    <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;WindowComplexManager: Custom basis type not yet implemented.&#39;</span><span class="p">)</span>
<a name="ln-1619"></a>  <span class="k">END IF</span>
<a name="ln-1620"></a><span class="k">  RETURN</span>
<a name="ln-1621"></a>
<a name="ln-1622"></a><span class="k">END SUBROUTINE </span><span class="n">FillBasisElement</span>
<a name="ln-1623"></a>
<a name="ln-1624"></a><span class="k">SUBROUTINE </span><span class="n">SetupComplexWindowStateGeometry</span> <span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span><span class="n">IConst</span><span class="p">,</span><span class="n">Window</span><span class="p">,</span><span class="n">Geom</span><span class="p">,</span><span class="n">State</span><span class="p">)</span>
<a name="ln-1625"></a>
<a name="ln-1626"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1627"></a>          <span class="c">!       AUTHOR         J. Klems</span>
<a name="ln-1628"></a>          <span class="c">!       DATE WRITTEN   June 2011</span>
<a name="ln-1629"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-1630"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1631"></a>
<a name="ln-1632"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1633"></a>          <span class="c">! Define all the geometric quantites for a complex fenestration state</span>
<a name="ln-1634"></a>
<a name="ln-1635"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1636"></a>          <span class="c">! &lt;description&gt;</span>
<a name="ln-1637"></a>
<a name="ln-1638"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1639"></a>          <span class="c">! na</span>
<a name="ln-1640"></a>
<a name="ln-1641"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1642"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-1643"></a>
<a name="ln-1644"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1645"></a>
<a name="ln-1646"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1647"></a>       <span class="c">!INTEGER, INTENT(IN)      ::  IWind            !Complex fenestration number (in window list)</span>
<a name="ln-1648"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">ISurf</span>    <span class="c">!Surface number of the complex fenestration</span>
<a name="ln-1649"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">IState</span>    <span class="c">!State number of the complex fenestration state</span>
<a name="ln-1650"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">IConst</span>    <span class="c">!Pointer to construction for this state</span>
<a name="ln-1651"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFWindowGeomDescr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Window</span>  <span class="c">!Window Geometry</span>
<a name="ln-1652"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFGeomDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Geom</span>    <span class="c">!State Geometry</span>
<a name="ln-1653"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFStateDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">State</span>    <span class="c">!State Description</span>
<a name="ln-1654"></a>
<a name="ln-1655"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1656"></a>          <span class="c">! na</span>
<a name="ln-1657"></a>
<a name="ln-1658"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-1659"></a>          <span class="c">! na</span>
<a name="ln-1660"></a>
<a name="ln-1661"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-1662"></a>       <span class="k">TYPE </span><span class="n">BackHitList</span>
<a name="ln-1663"></a>         <span class="kt">INTEGER</span>                <span class="kd">::</span>  <span class="n">KBkSurf</span>     <span class="c">!Back surface index of the hit surface</span>
<a name="ln-1664"></a>         <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">HitSurf</span>    <span class="c">!Surface number of the hit surface</span>
<a name="ln-1665"></a>         <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">HitPt</span>    <span class="c">!coords of hit pt (world syst)</span>
<a name="ln-1666"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">HitDsq</span>    <span class="c">!Squared distance to the current hit pt</span>
<a name="ln-1667"></a>       <span class="k">END TYPE </span><span class="n">BackHitList</span>
<a name="ln-1668"></a>
<a name="ln-1669"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1670"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Azimuth</span>    <span class="c">!Complex fenestration azimuth</span>
<a name="ln-1671"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Tilt</span>    <span class="c">!Complex fenestration tilt</span>
<a name="ln-1672"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">ElemNo</span>    <span class="c">!Grid index variable</span>
<a name="ln-1673"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IHit</span>    <span class="c">!Surface intersection flag</span>
<a name="ln-1674"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">I</span><span class="p">,</span> <span class="n">J</span>    <span class="c">!Temp Indices</span>
<a name="ln-1675"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IRay</span>    <span class="c">!Ray index variable</span>
<a name="ln-1676"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IZone</span>    <span class="c">!Zone containing the complex window</span>
<a name="ln-1677"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">JSurf</span>    <span class="c">!Secondary Surface index</span>
<a name="ln-1678"></a>       <span class="kt">INTEGER</span>              <span class="kd">::</span>  <span class="n">BaseSurf</span>    <span class="c">!base surface index</span>
<a name="ln-1679"></a>       <span class="kt">INTEGER</span>              <span class="kd">::</span>  <span class="n">KBkSurf</span>     <span class="c">!Back surface index</span>
<a name="ln-1680"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">MaxHits</span>    <span class="c">!Max no of hits found</span>
<a name="ln-1681"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">MaxInt</span>    <span class="c">!Max no of intersections found</span>
<a name="ln-1682"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">NSky</span>    <span class="c">!No of sky rays</span>
<a name="ln-1683"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">NGnd</span>    <span class="c">!No of gnd rays</span>
<a name="ln-1684"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">NReflSurf</span>  <span class="c">!No of rays striking ext surfaces</span>
<a name="ln-1685"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">NBkSurf</span>  <span class="c">!No of back surfaces</span>
<a name="ln-1686"></a>       <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">TotHits</span>    <span class="c">!Current number of surface intersections</span>
<a name="ln-1687"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Theta</span>    <span class="c">!Basis theta angle</span>
<a name="ln-1688"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>   <span class="n">Phi</span>    <span class="c">!Basis phi angle</span>
<a name="ln-1689"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>   <span class="n">HitDsq</span>    <span class="c">!Squared distance to current hit pt</span>
<a name="ln-1690"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>   <span class="n">LeastHitDsq</span>  <span class="c">!Squared distance to closest hit pt</span>
<a name="ln-1691"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>        <span class="kd">::</span>   <span class="n">HitPt</span>    <span class="c">!coords of hit pt (world syst)</span>
<a name="ln-1692"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>      <span class="kd">::</span>   <span class="n">V</span>    <span class="c">!vector array</span>
<a name="ln-1693"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>   <span class="n">VLen</span>    <span class="c">!Length of vector array</span>
<a name="ln-1694"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>        <span class="kd">::</span>   <span class="n">X</span>    <span class="c">!position vector</span>
<a name="ln-1695"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>        <span class="kd">::</span>   <span class="n">VecNorm</span>  <span class="c">!outer normal vector</span>
<a name="ln-1696"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">TmpRfSfInd</span>  <span class="c">!Temporary RefSurfIndex</span>
<a name="ln-1697"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">TmpRfRyNH</span>  <span class="c">!Temporary RefRayNHits</span>
<a name="ln-1698"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>    <span class="kd">::</span>  <span class="n">TmpHSurfNo</span>  <span class="c">!Temporary HitSurfNo</span>
<a name="ln-1699"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>    <span class="kd">::</span>  <span class="n">TmpHSurfDSq</span>  <span class="c">!Temporary HitSurfDSq</span>
<a name="ln-1700"></a>        <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>    <span class="kd">::</span>  <span class="n">TmpSkyInd</span>  <span class="c">!Temporary sky index list</span>
<a name="ln-1701"></a>        <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>    <span class="kd">::</span>  <span class="n">TmpGndInd</span>  <span class="c">!Temporary gnd index list</span>
<a name="ln-1702"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>    <span class="kd">::</span>  <span class="n">TmpGndPt</span>  <span class="c">!Temporary ground intersection list</span>
<a name="ln-1703"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span><span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">TmpSurfInt</span>  <span class="c">!Temporary index of ray intersecing back surf</span>
<a name="ln-1704"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span><span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">TmpSjdotN</span>  <span class="c">!Temporary dot prod of ray angle w bk surf norm</span>
<a name="ln-1705"></a>       <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">ITemp1D</span>  <span class="c">!Temporary INT 1D array</span>
<a name="ln-1706"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>    <span class="kd">::</span>  <span class="n">Temp2D</span>    <span class="c">!Temporary real 2D array</span>
<a name="ln-1707"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">TempV2D</span>  <span class="c">!Temporary vector 2D array</span>
<a name="ln-1708"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:,:),</span> <span class="k">ALLOCATABLE</span>  <span class="kd">::</span>  <span class="n">TmpHitPt</span>    <span class="c">!Temporary HitPt</span>
<a name="ln-1709"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">TransRSurf</span>  <span class="c">!Norminal transmittance of shading surface</span>
<a name="ln-1710"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                         <span class="kd">::</span>  <span class="n">WtSum</span>    <span class="c">!Sum for normalizing various weights</span>
<a name="ln-1711"></a>       <span class="k">TYPE</span> <span class="p">(</span><span class="n">BackHitList</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">BSHit</span>    <span class="c">!Temp list of back surface hit quantities for a ray</span>
<a name="ln-1712"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                <span class="kd">::</span>      <span class="n">DotProd</span>     <span class="c">!Temporary variable for manipulating dot product .dot.</span>
<a name="ln-1713"></a>
<a name="ln-1714"></a>              <span class="c">!This routine primarily fills in the BSDFGeomDescr type for a given window and state</span>
<a name="ln-1715"></a>              <span class="c">!Note that on call the incoming and outgoing basis structure types have already been filled in</span>
<a name="ln-1716"></a>                  <span class="c">!</span>
<a name="ln-1717"></a>              <span class="c">!  Define the central ray directions (in world coordinate system)</span>
<a name="ln-1718"></a>              <span class="c">!</span>
<a name="ln-1719"></a>
<a name="ln-1720"></a>        <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">NLayers</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">NumLayers</span>
<a name="ln-1721"></a>        <span class="n">Azimuth</span> <span class="o">=</span> <span class="n">DegToRadians</span> <span class="o">*</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Azimuth</span>
<a name="ln-1722"></a>        <span class="n">Tilt</span> <span class="o">=</span> <span class="n">DegToRadians</span> <span class="o">*</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Tilt</span>
<a name="ln-1723"></a>
<a name="ln-1724"></a>         <span class="c">!For incoming grid</span>
<a name="ln-1725"></a>
<a name="ln-1726"></a>         <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1727"></a>         <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-1728"></a>         <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">pInc</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1729"></a>         <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">CosInc</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1730"></a>         <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">DAInc</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1731"></a>         <span class="n">Geom</span><span class="p">%</span><span class="n">pInc</span> <span class="o">=</span> <span class="n">BSDFDaylghtPosition</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-1732"></a>          <span class="k">DO </span><span class="n">ElemNo</span><span class="o">=</span><span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-1733"></a>             <span class="n">Theta</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">Theta</span>
<a name="ln-1734"></a>             <span class="n">Phi</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">Phi</span>
<a name="ln-1735"></a>                       <span class="c">!The following puts in the vectors depending on</span>
<a name="ln-1736"></a>                       <span class="c">! window orientation</span>
<a name="ln-1737"></a>             <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span>  <span class="o">=</span> <span class="n">WorldVectFromW6</span> <span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">Front_Incident</span><span class="p">,</span> <span class="n">Tilt</span><span class="p">,</span> <span class="n">Azimuth</span><span class="p">)</span>
<a name="ln-1738"></a>             <span class="n">Geom</span><span class="p">%</span><span class="n">pInc</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span>  <span class="o">=</span> <span class="n">DaylghtAltAndAzimuth</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">))</span>
<a name="ln-1739"></a>
<a name="ln-1740"></a>             <span class="n">Geom</span><span class="p">%</span><span class="n">CosInc</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="o">=</span> <span class="nb">COS</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">Theta</span><span class="p">)</span>
<a name="ln-1741"></a>             <span class="c">!Geom%DAInc(ElemNo) = COS(Geom%pInc(ElemNo)%Altitude) * Geom%Inc%Grid(ElemNo)%dTheta * Geom%Inc%Grid(ElemNo)%dPhi</span>
<a name="ln-1742"></a>             <span class="c">! Geom%DAInc(ElemNo) = Geom%Inc%Grid(ElemNo)%dTheta * Geom%Inc%Grid(ElemNo)%dPhi</span>
<a name="ln-1743"></a>             <span class="n">Geom</span><span class="p">%</span><span class="n">DAInc</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="o">=</span> <span class="nb">COS</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">Theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">dTheta</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">dPhi</span>
<a name="ln-1744"></a>          <span class="k">END DO</span>
<a name="ln-1745"></a>         <span class="c">!  For outgoing grid</span>
<a name="ln-1746"></a>         <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">sTrn</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1747"></a>         <span class="n">Geom</span><span class="p">%</span><span class="n">sTrn</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-1748"></a>         <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">pTrn</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1749"></a>         <span class="n">Geom</span><span class="p">%</span><span class="n">pTrn</span> <span class="o">=</span> <span class="n">BSDFDaylghtPosition</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-1750"></a>          <span class="k">DO </span><span class="n">ElemNo</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-1751"></a>             <span class="n">Theta</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">Theta</span>
<a name="ln-1752"></a>             <span class="n">Phi</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)%</span><span class="n">Phi</span>
<a name="ln-1753"></a>                       <span class="c">!The following puts in the vectors depending on</span>
<a name="ln-1754"></a>                       <span class="c">! window orientation</span>
<a name="ln-1755"></a>             <span class="n">Geom</span><span class="p">%</span><span class="n">sTrn</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span> <span class="o">=</span> <span class="n">WorldVectFromW6</span> <span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">Front_Transmitted</span><span class="p">,</span> <span class="n">Tilt</span><span class="p">,</span> <span class="n">Azimuth</span><span class="p">)</span>
<a name="ln-1756"></a>             <span class="n">Geom</span><span class="p">%</span><span class="n">pTrn</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">)</span>  <span class="o">=</span> <span class="n">DaylghtAltAndAzimuth</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">sTrn</span><span class="p">(</span><span class="n">ElemNo</span><span class="p">))</span>
<a name="ln-1757"></a>          <span class="k">END DO</span>
<a name="ln-1758"></a>              <span class="c">!</span>
<a name="ln-1759"></a>              <span class="c">!  Incident Basis:</span>
<a name="ln-1760"></a>              <span class="c">!  Construct sky and ground ray index maps, and list of rays intersecting exterior surfaces</span>
<a name="ln-1761"></a>              <span class="c">!</span>
<a name="ln-1762"></a>                  <span class="c">!Sky, and ground ray index maps, and rays that are potentially beam radiation reflected from exterior surfaces</span>
<a name="ln-1763"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpRfSfInd</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1764"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpRfRyNH</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1765"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">,</span><span class="n">TotSurfaces</span><span class="p">))</span>
<a name="ln-1766"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">,</span><span class="n">TotSurfaces</span><span class="p">))</span>
<a name="ln-1767"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">,</span><span class="n">TotSurfaces</span><span class="p">))</span>
<a name="ln-1768"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpSkyInd</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1769"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpGndInd</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1770"></a>                  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpGndPt</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1771"></a>          <span class="n">NSky</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1772"></a>          <span class="n">NGnd</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1773"></a>          <span class="n">NReflSurf</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1774"></a>          <span class="n">TmpRfRyNH</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1775"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">NSkyUnobs</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1776"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">NGndUnobs</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1777"></a>          <span class="c">!  Note--this loop could be repeated for different positions in the window plane (as for detailed reflection</span>
<a name="ln-1778"></a>          <span class="c">!  calculations, varying the origin in the call to PierceSurface.  Essentially, have set NsubV =1.</span>
<a name="ln-1779"></a>          <span class="k">DO </span><span class="n">IRay</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-1780"></a>              <span class="k">IF</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">)%</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1781"></a>                  <span class="c">! A ground ray</span>
<a name="ln-1782"></a>                  <span class="n">Geom</span><span class="p">%</span><span class="n">NGndUnobs</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NGndUnobs</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1783"></a>              <span class="k">ELSE</span>
<a name="ln-1784"></a>                  <span class="c">! A sky ray</span>
<a name="ln-1785"></a>                  <span class="n">Geom</span><span class="p">%</span><span class="n">NSkyUnobs</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSkyUnobs</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1786"></a>              <span class="n">ENDIF</span>
<a name="ln-1787"></a>          <span class="c">!</span>
<a name="ln-1788"></a>          <span class="c">! Exterior reveal shadowing/reflection treatment should be inserted here</span>
<a name="ln-1789"></a>          <span class="c">!</span>
<a name="ln-1790"></a>             <span class="n">IHit</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1791"></a>             <span class="n">TotHits</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1792"></a>             <span class="k">DO </span><span class="n">JSurf</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">TotSurfaces</span>
<a name="ln-1793"></a>               <span class="c">! the following test will cycle on anything except exterior surfaces and shading surfaces</span>
<a name="ln-1794"></a>               <span class="k">IF</span><span class="p">(</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">HeatTransSurf</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">ExtBoundCond</span> <span class="o">/=</span> <span class="n">ExternalEnvironment</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1795"></a>               <span class="c">!  skip the base surface containing the window and any other subsurfaces of that surface</span>
<a name="ln-1796"></a>               <span class="k">IF</span><span class="p">(</span> <span class="n">JSurf</span> <span class="o">==</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">BaseSurf</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">BaseSurf</span> <span class="o">==</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">BaseSurf</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1797"></a>               <span class="c">!  skip surfaces that face away from the window</span>
<a name="ln-1798"></a>               <span class="n">DotProd</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">)</span> <span class="p">.</span><span class="n">dot</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">NewellSurfaceNormalVector</span>
<a name="ln-1799"></a>               <span class="k">IF</span><span class="p">(</span> <span class="n">DotProd</span> <span class="o">&gt;=</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1800"></a><span class="k">               CALL </span><span class="n">PierceSurfaceVector</span><span class="p">(</span><span class="n">JSurf</span><span class="p">,</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">),</span> <span class="n">IHit</span><span class="p">,</span> <span class="n">HitPt</span><span class="p">)</span>
<a name="ln-1801"></a>               <span class="k">IF</span> <span class="p">(</span><span class="n">IHit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1802"></a><span class="k">               </span><span class="n">IHit</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!A hit, clear the hit flag for the next cycle</span>
<a name="ln-1803"></a>               <span class="k">IF</span><span class="p">(</span><span class="n">TotHits</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1804"></a>                   <span class="c">!  First hit for this ray</span>
<a name="ln-1805"></a>                   <span class="n">TotHits</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1806"></a>                   <span class="n">NReflSurf</span><span class="o">=</span><span class="n">NReflSurf</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1807"></a>                   <span class="n">TmpRfSfInd</span><span class="p">(</span><span class="n">NReflSurf</span><span class="p">)</span> <span class="o">=</span> <span class="n">IRay</span>
<a name="ln-1808"></a>                   <span class="n">TmpRfRyNH</span> <span class="p">(</span><span class="n">NReflSurf</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1809"></a>                   <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">JSurf</span>
<a name="ln-1810"></a>                   <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">HitPt</span>
<a name="ln-1811"></a>                   <span class="n">V</span> <span class="o">=</span> <span class="n">HitPt</span> <span class="o">-</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span>    <span class="c">!vector array from window ctr to hit pt</span>
<a name="ln-1812"></a>                   <span class="n">LeastHitDsq</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span> <span class="p">(</span><span class="n">V</span> <span class="p">,</span> <span class="n">V</span><span class="p">)</span>  <span class="c">!dist^2 window ctr to hit pt</span>
<a name="ln-1813"></a>                   <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">LeastHitDsq</span>
<a name="ln-1814"></a>                   <span class="k">IF</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">HeatTransSurf</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">SchedShadowSurfIndex</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1815"></a><span class="k">                       </span><span class="n">TransRSurf</span> <span class="o">=</span> <span class="mf">1.0d0</span>  <span class="c">!If a shadowing surface may have a scheduled transmittance,</span>
<a name="ln-1816"></a>                             <span class="c">!   treat it here as completely transparent</span>
<a name="ln-1817"></a>                   <span class="k">ELSE</span>
<a name="ln-1818"></a><span class="k">                       </span><span class="n">TransRSurf</span><span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1819"></a>                   <span class="n">ENDIF</span>
<a name="ln-1820"></a>               <span class="k">ELSE</span>
<a name="ln-1821"></a><span class="k">                   </span><span class="n">V</span> <span class="o">=</span> <span class="n">HitPt</span> <span class="o">-</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span>
<a name="ln-1822"></a>                   <span class="n">HitDsq</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span> <span class="p">(</span><span class="n">V</span> <span class="p">,</span> <span class="n">V</span><span class="p">)</span>
<a name="ln-1823"></a>                   <span class="k">IF</span> <span class="p">(</span><span class="n">HitDsq</span> <span class="o">&gt;=</span> <span class="n">LeastHitDsq</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1824"></a><span class="k">                       IF</span> <span class="p">(</span><span class="n">TransRSurf</span>  <span class="o">&gt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>  <span class="c">!forget the new hit if the closer hit is opaque</span>
<a name="ln-1825"></a>                           <span class="n">J</span> <span class="o">=</span> <span class="n">TotHits</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1826"></a>                           <span class="k">IF</span> <span class="p">(</span> <span class="n">TotHits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1827"></a><span class="k">                               DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">TotHits</span>
<a name="ln-1828"></a>                                   <span class="k">IF</span> <span class="p">(</span> <span class="n">HitDsq</span> <span class="o">&lt;</span> <span class="n">TmpHSurfDSq</span><span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="p">)</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1829"></a><span class="k">                                       </span><span class="n">J</span> <span class="o">=</span> <span class="n">I</span>
<a name="ln-1830"></a>                                       <span class="k">EXIT</span>
<a name="ln-1831"></a><span class="k">                                   </span><span class="n">ENDIF</span>
<a name="ln-1832"></a>                               <span class="n">ENDDO</span>
<a name="ln-1833"></a>                               <span class="k">IF</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">HeatTransSurf</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">SchedShadowSurfIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="k">THEN</span>
<a name="ln-1834"></a>                                   <span class="c">!  The new hit is opaque, so we can drop all the hits further away</span>
<a name="ln-1835"></a>                                   <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">JSurf</span>
<a name="ln-1836"></a>                                   <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">HitPt</span>
<a name="ln-1837"></a>                                   <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">HitDsq</span>
<a name="ln-1838"></a>                                   <span class="n">TotHits</span> <span class="o">=</span> <span class="n">J</span>
<a name="ln-1839"></a>                               <span class="k">ELSE</span>
<a name="ln-1840"></a>                                   <span class="c">!  The new hit is scheduled (presumed transparent), so keep the more distant hits</span>
<a name="ln-1841"></a>                                   <span class="c">!     Note that all the hists in the list will be transparent except the last,</span>
<a name="ln-1842"></a>                                   <span class="c">!       which may be either transparent or opaque</span>
<a name="ln-1843"></a>                                   <span class="k">IF</span> <span class="p">(</span><span class="n">TotHits</span> <span class="o">&gt;=</span> <span class="n">J</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1844"></a><span class="k">                                       DO </span><span class="n">I</span> <span class="o">=</span> <span class="n">TotHits</span> <span class="p">,</span> <span class="n">J</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1845"></a>                                          <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<a name="ln-1846"></a>                                          <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<a name="ln-1847"></a>                                           <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<a name="ln-1848"></a>                                       <span class="n">ENDDO</span>
<a name="ln-1849"></a>                                       <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">JSurf</span>
<a name="ln-1850"></a>                                       <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">HitPt</span>
<a name="ln-1851"></a>                                       <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">HitDsq</span>
<a name="ln-1852"></a>                                       <span class="n">TotHits</span> <span class="o">=</span> <span class="n">TotHits</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1853"></a>                                   <span class="n">ENDIF</span>
<a name="ln-1854"></a>                               <span class="n">ENDIF</span>
<a name="ln-1855"></a>                           <span class="n">ENDIF</span>
<a name="ln-1856"></a>                       <span class="n">ENDIF</span>
<a name="ln-1857"></a>                   <span class="k">ELSE</span>
<a name="ln-1858"></a>                       <span class="c">!  A new closest hit.  If it is opaque, drop the current hit list,</span>
<a name="ln-1859"></a>                       <span class="c">!    otherwise add it at the front</span>
<a name="ln-1860"></a>                       <span class="n">LeastHitDsq</span> <span class="o">=</span> <span class="n">HitDsq</span>
<a name="ln-1861"></a>                       <span class="k">IF</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">HeatTransSurf</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">SchedShadowSurfIndex</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1862"></a><span class="k">                           </span><span class="n">TransRSurf</span> <span class="o">=</span> <span class="mf">1.0d0</span>  <span class="c">! New closest hit is transparent, keep the existing hit list</span>
<a name="ln-1863"></a>                           <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="n">TotHits</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1864"></a>                               <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<a name="ln-1865"></a>                                <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<a name="ln-1866"></a>                               <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="n">I</span><span class="p">)</span>
<a name="ln-1867"></a>                               <span class="n">TotHits</span> <span class="o">=</span> <span class="n">TotHits</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1868"></a>                           <span class="n">ENDDO</span>
<a name="ln-1869"></a>                       <span class="k">ELSE</span>
<a name="ln-1870"></a><span class="k">                           </span><span class="n">TransRSurf</span> <span class="o">=</span> <span class="mf">0.0d0</span>  <span class="c">!New closest hit is opaque, drop the existing hit list</span>
<a name="ln-1871"></a>                           <span class="n">TotHits</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1872"></a>                       <span class="n">ENDIF</span>
<a name="ln-1873"></a>                       <span class="n">TmpHSurfNo</span> <span class="p">(</span><span class="n">NReflSurf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">JSurf</span>  <span class="c">! In either case the new hit is put in position 1</span>
<a name="ln-1874"></a>                       <span class="n">TmpHitPt</span> <span class="p">(</span><span class="n">NReflSurf</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">HitPt</span>
<a name="ln-1875"></a>                       <span class="n">TmpHSurfDSq</span> <span class="p">(</span><span class="n">NReflSurf</span> <span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">LeastHitDsq</span>
<a name="ln-1876"></a>                   <span class="n">ENDIF</span>
<a name="ln-1877"></a>               <span class="n">ENDIF</span>
<a name="ln-1878"></a>             <span class="k">END DO</span>  <span class="c">!End of loop over surfaces</span>
<a name="ln-1879"></a>              <span class="k">IF</span> <span class="p">(</span><span class="n">TotHits</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1880"></a>                 <span class="c">!This ray reached the sky or ground unobstructed</span>
<a name="ln-1881"></a>                 <span class="k">IF</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">)%</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1882"></a>                     <span class="c">!A ground ray</span>
<a name="ln-1883"></a>                     <span class="n">NGnd</span> <span class="o">=</span> <span class="n">NGnd</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1884"></a>                     <span class="n">TmpGndInd</span><span class="p">(</span><span class="n">NGnd</span><span class="p">)</span> <span class="o">=</span> <span class="n">IRay</span>
<a name="ln-1885"></a>                     <span class="n">TmpGndPt</span><span class="p">(</span> <span class="n">NGnd</span><span class="p">)%</span><span class="n">x</span> <span class="o">=</span><span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span><span class="p">%</span><span class="n">x</span> <span class="o">-</span>   <span class="p">&amp;</span>
<a name="ln-1886"></a>                        <span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">)%</span><span class="n">x</span> <span class="o">/</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">)%</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span><span class="p">%</span><span class="n">z</span>
<a name="ln-1887"></a>                          <span class="n">TmpGndPt</span><span class="p">(</span> <span class="n">NGnd</span><span class="p">)%</span><span class="n">y</span> <span class="o">=</span><span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span><span class="p">%</span><span class="n">y</span> <span class="o">-</span>   <span class="p">&amp;</span>
<a name="ln-1888"></a>                             <span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">)%</span><span class="n">y</span> <span class="o">/</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">IRay</span><span class="p">)%</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span><span class="p">%</span><span class="n">z</span>
<a name="ln-1889"></a>                     <span class="n">TmpGndPt</span><span class="p">(</span> <span class="n">NGnd</span><span class="p">)%</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1890"></a>                 <span class="k">ELSE</span>
<a name="ln-1891"></a>                    <span class="c">!A sky ray</span>
<a name="ln-1892"></a>                    <span class="n">NSky</span> <span class="o">=</span> <span class="n">NSky</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-1893"></a>                    <span class="n">TmpSkyInd</span><span class="p">(</span><span class="n">NSky</span><span class="p">)</span> <span class="o">=</span> <span class="n">IRay</span>
<a name="ln-1894"></a>                 <span class="n">ENDIF</span>
<a name="ln-1895"></a>             <span class="k">ELSE</span>
<a name="ln-1896"></a>                 <span class="c">!Save the number of hits for this ray</span>
<a name="ln-1897"></a>                 <span class="n">TmpRfRyNH</span> <span class="p">(</span><span class="n">NReflSurf</span><span class="p">)</span> <span class="o">=</span> <span class="n">TotHits</span>
<a name="ln-1898"></a>             <span class="n">ENDIF</span>
<a name="ln-1899"></a>          <span class="k">END DO</span>  <span class="c">!End of loop over basis rays</span>
<a name="ln-1900"></a>          <span class="c">!</span>
<a name="ln-1901"></a>          <span class="c">!Store results of indexing the incident basis for this window</span>
<a name="ln-1902"></a>          <span class="c">!</span>
<a name="ln-1903"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">NSky</span> <span class="o">=</span> <span class="n">NSky</span>
<a name="ln-1904"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">NGnd</span> <span class="o">=</span> <span class="n">NGnd</span>
<a name="ln-1905"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">NReflSurf</span> <span class="o">=</span> <span class="n">NReflSurf</span>
<a name="ln-1906"></a>          <span class="k">ALLOCATE</span> <span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SkyIndex</span><span class="p">(</span><span class="n">NSky</span><span class="p">))</span>
<a name="ln-1907"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">SkyIndex</span> <span class="o">=</span> <span class="n">TmpSkyInd</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NSky</span><span class="p">)</span>
<a name="ln-1908"></a>          <span class="k">DEALLOCATE</span> <span class="p">(</span><span class="n">TmpSkyInd</span><span class="p">)</span>
<a name="ln-1909"></a>          <span class="k">ALLOCATE</span><span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">GndIndex</span><span class="p">(</span><span class="n">NGnd</span><span class="p">)</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">GndPt</span><span class="p">(</span><span class="n">NGnd</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1910"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">GndIndex</span> <span class="o">=</span> <span class="n">TmpGndInd</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NGnd</span><span class="p">)</span>
<a name="ln-1911"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">GndPt</span> <span class="o">=</span> <span class="n">TmpGndPt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NGnd</span><span class="p">)</span>
<a name="ln-1912"></a>          <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">TmpGndInd</span><span class="p">,</span><span class="n">TmpGndPt</span><span class="p">)</span>
<a name="ln-1913"></a>          <span class="n">MaxHits</span> <span class="o">=</span> <span class="nb">MAXVAL</span><span class="p">(</span><span class="n">TmpRfRyNH</span><span class="p">)</span>
<a name="ln-1914"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">RefSurfIndex</span><span class="p">(</span><span class="n">NReflSurf</span><span class="p">),</span><span class="n">Geom</span><span class="p">%</span><span class="n">RefRayNHits</span><span class="p">(</span><span class="n">NReflSurf</span><span class="p">))</span>
<a name="ln-1915"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">HitSurfNo</span><span class="p">(</span><span class="n">NReflSurf</span><span class="p">,</span><span class="n">MaxHits</span><span class="p">),</span><span class="n">Geom</span><span class="p">%</span><span class="n">HitSurfDSq</span><span class="p">(</span><span class="n">NReflSurf</span><span class="p">,</span><span class="n">MaxHits</span><span class="p">))</span>
<a name="ln-1916"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">HitPt</span><span class="p">(</span><span class="n">NReflSurf</span><span class="p">,</span><span class="n">MaxHits</span><span class="p">))</span>
<a name="ln-1917"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">RefSurfIndex</span> <span class="o">=</span> <span class="n">TmpRfSfInd</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NReflSurf</span><span class="p">)</span>
<a name="ln-1918"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">RefRayNHits</span> <span class="o">=</span> <span class="n">TmpRfRyNH</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NReflSurf</span><span class="p">)</span>
<a name="ln-1919"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">HitSurfNo</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1920"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">HitSurfDSq</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1921"></a>          <span class="n">Geom</span><span class="p">%</span><span class="n">HitPt</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span><span class="mf">0.0d0</span><span class="p">,</span><span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-1922"></a>          <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NReflSurf</span>
<a name="ln-1923"></a>              <span class="n">TotHits</span> <span class="o">=</span> <span class="n">TmpRfRyNH</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1924"></a>              <span class="n">Geom</span><span class="p">%</span><span class="n">HitSurfNo</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">TotHits</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHSurfNo</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">TotHits</span><span class="p">)</span>
<a name="ln-1925"></a>              <span class="n">Geom</span><span class="p">%</span><span class="n">HitSurfDSq</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">TotHits</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHSurfDSq</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">TotHits</span><span class="p">)</span>
<a name="ln-1926"></a>              <span class="n">Geom</span><span class="p">%</span><span class="n">HitPt</span><span class="p">(</span> <span class="n">I</span> <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">TotHits</span><span class="p">)</span> <span class="o">=</span> <span class="n">TmpHitPt</span> <span class="p">(</span> <span class="n">I</span> <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">TotHits</span><span class="p">)</span>
<a name="ln-1927"></a>          <span class="n">ENDDO</span>
<a name="ln-1928"></a>          <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">TmpRfRyNH</span><span class="p">,</span><span class="n">TmpRfSfInd</span><span class="p">,</span><span class="n">TmpHSurfNo</span><span class="p">,</span><span class="n">TmpHSurfDSq</span><span class="p">,</span><span class="n">TmpHitPt</span><span class="p">)</span>
<a name="ln-1929"></a>          <span class="c">!</span>
<a name="ln-1930"></a>          <span class="c">!In above scheme sky and ground rays are those that intesect no exterior surfaces.</span>
<a name="ln-1931"></a>          <span class="c">!  The list of hit points is compiled for later (future?) calculation</span>
<a name="ln-1932"></a>          <span class="c">!  of reflections from these surfaces.  The hit list for each ray includes all</span>
<a name="ln-1933"></a>          <span class="c">!   surfaces with schedulable transmittance intersected by the ray,</span>
<a name="ln-1934"></a>          <span class="c">!   in order of increasing distance, up to the first opaque surface.</span>
<a name="ln-1935"></a>          <span class="c">!  Rays that intesect one or more schedulable transmittance but no opaque</span>
<a name="ln-1936"></a>          <span class="c">!  surfaces (therefore may reach the sky or ground) are left out of the sky/ground</span>
<a name="ln-1937"></a>          <span class="c">!  calcuation.  A correction for these rays could/should be made after the</span>
<a name="ln-1938"></a>          <span class="c">!  shading calculation.</span>
<a name="ln-1939"></a>          <span class="c">!</span>
<a name="ln-1940"></a>              <span class="c">!</span>
<a name="ln-1941"></a>              <span class="c">! Now calculate weights for averaging the transmittance matrix</span>
<a name="ln-1942"></a>              <span class="c">!</span>
<a name="ln-1943"></a>          <span class="c">!</span>
<a name="ln-1944"></a>          <span class="c">!Sky Weights</span>
<a name="ln-1945"></a>          <span class="c">!</span>
<a name="ln-1946"></a>          <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span><span class="p">(</span><span class="n">NSky</span><span class="p">))</span>
<a name="ln-1947"></a>           <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NSky</span>
<a name="ln-1948"></a>           <span class="n">J</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SkyIndex</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1949"></a>           <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">SkyWeight</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">sInc</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
<a name="ln-1950"></a>           <span class="n">ENDDO</span>
<a name="ln-1951"></a>           <span class="n">WtSum</span> <span class="o">=</span> <span class="nb">SUM</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NSky</span><span class="p">))</span>
<a name="ln-1952"></a>           <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NSky</span><span class="p">)</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NSky</span><span class="p">)</span><span class="o">/</span><span class="n">WtSum</span>
<a name="ln-1953"></a>           <span class="c">!</span>
<a name="ln-1954"></a>           <span class="c">!SkyGround Weights</span>
<a name="ln-1955"></a>           <span class="c">!</span>
<a name="ln-1956"></a>           <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span><span class="p">(</span><span class="n">NGnd</span><span class="p">))</span>
<a name="ln-1957"></a>           <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NGnd</span>
<a name="ln-1958"></a>           <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">SkyGndWeight</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">GndPt</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-1959"></a>           <span class="n">ENDDO</span>
<a name="ln-1960"></a>           <span class="n">WtSum</span> <span class="o">=</span> <span class="nb">SUM</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NGnd</span><span class="p">))</span>
<a name="ln-1961"></a>           <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NGnd</span><span class="p">)</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">NGnd</span><span class="p">)</span><span class="o">/</span><span class="n">WtSum</span>
<a name="ln-1962"></a>           <span class="c">!  Weights for beam reflected from ground are calculated after shading</span>
<a name="ln-1963"></a>           <span class="c">!  interval is determined</span>
<a name="ln-1964"></a>              <span class="c">!</span>
<a name="ln-1965"></a>              <span class="c">!Transmitted Basis:</span>
<a name="ln-1966"></a>              <span class="c">!  Construct back surface intersection maps</span>
<a name="ln-1967"></a>              <span class="c">!</span>
<a name="ln-1968"></a>              <span class="n">IZone</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Zone</span>
<a name="ln-1969"></a>              <span class="n">NBkSurf</span> <span class="o">=</span> <span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span>
<a name="ln-1970"></a>              <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span><span class="n">NBkSurf</span><span class="p">))</span>
<a name="ln-1971"></a>              <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!Initialize the number of intersections to zero</span>
<a name="ln-1972"></a>              <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpSurfInt</span><span class="p">(</span><span class="n">NBkSurf</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1973"></a>              <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TmpSjdotN</span><span class="p">(</span><span class="n">NBkSurf</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-1974"></a>       <span class="c">!Find the intersections of the basis rays with the back surfaces</span>
<a name="ln-1975"></a>        <span class="k">DO </span><span class="n">IRay</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>  <span class="c">!ray loop</span>
<a name="ln-1976"></a>           <span class="n">IHit</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1977"></a>            <span class="n">TotHits</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1978"></a>        <span class="c">!</span>
<a name="ln-1979"></a>        <span class="c">!  Insert treatment of intersection &amp; reflection from interior reveals here</span>
<a name="ln-1980"></a>        <span class="c">!</span>
<a name="ln-1981"></a>           <span class="k">DO </span><span class="n">KBkSurf</span>  <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">NBkSurf</span>    <span class="c">!back surf loop</span>
<a name="ln-1982"></a>               <span class="n">BaseSurf</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">BaseSurf</span>     <span class="c">!ShadowComb is organized by base surface</span>
<a name="ln-1983"></a>              <span class="n">JSurf</span> <span class="o">=</span> <span class="n">ShadowComb</span><span class="p">(</span><span class="n">BaseSurf</span><span class="p">)%</span><span class="n">BackSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)</span>    <span class="c">!these are all proper back surfaces</span>
<a name="ln-1984"></a>              <span class="k">CALL </span><span class="n">PierceSurfaceVector</span><span class="p">(</span><span class="n">JSurf</span><span class="p">,</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sTrn</span><span class="p">(</span><span class="n">IRay</span><span class="p">),</span> <span class="n">IHit</span><span class="p">,</span> <span class="n">HitPt</span><span class="p">)</span>
<a name="ln-1985"></a>               <span class="k">IF</span> <span class="p">(</span><span class="n">IHit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1986"></a><span class="k">               </span><span class="n">IHit</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!A hit, clear the hit flag for the next cycle</span>
<a name="ln-1987"></a>               <span class="k">IF</span><span class="p">(</span><span class="n">TotHits</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1988"></a>                  <span class="c">!  First hit for this ray</span>
<a name="ln-1989"></a>                   <span class="n">TotHits</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1990"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">KBkSurf</span> <span class="o">=</span> <span class="n">KBkSurf</span>
<a name="ln-1991"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">HitSurf</span> <span class="o">=</span> <span class="n">JSurf</span>
<a name="ln-1992"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">HitPt</span> <span class="o">=</span> <span class="n">HitPt</span>
<a name="ln-1993"></a>                   <span class="n">V</span> <span class="o">=</span> <span class="n">HitPt</span> <span class="o">-</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span>
<a name="ln-1994"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">HitDSq</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span> <span class="p">(</span> <span class="n">V</span> <span class="p">,</span> <span class="n">V</span> <span class="p">)</span>
<a name="ln-1995"></a>               <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">BSHit</span><span class="p">%</span><span class="n">HitSurf</span> <span class="o">==</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">BaseSurf</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1996"></a>                   <span class="c">!  another hit, check whether this is a subsurface of a previously hit base surface</span>
<a name="ln-1997"></a>                   <span class="c">!  (which would be listed first in the Surface array)</span>
<a name="ln-1998"></a>                   <span class="c">!  if so, replace the previous hit with this one</span>
<a name="ln-1999"></a>                   <span class="n">TotHits</span><span class="o">=</span><span class="n">TotHits</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-2000"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">KBkSurf</span> <span class="o">=</span> <span class="n">KBkSurf</span>
<a name="ln-2001"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">HitSurf</span> <span class="o">=</span> <span class="n">JSurf</span>
<a name="ln-2002"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">HitPt</span> <span class="o">=</span> <span class="n">HitPt</span>
<a name="ln-2003"></a>                   <span class="n">V</span> <span class="o">=</span> <span class="n">HitPt</span> <span class="o">-</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span>
<a name="ln-2004"></a>                   <span class="n">BSHit</span><span class="p">%</span><span class="n">HitDSq</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span> <span class="p">(</span> <span class="n">V</span> <span class="p">,</span> <span class="n">V</span> <span class="p">)</span>
<a name="ln-2005"></a>               <span class="k">ELSE</span>
<a name="ln-2006"></a><span class="k">                   </span><span class="n">TotHits</span><span class="o">=</span><span class="n">TotHits</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-2007"></a>                   <span class="c">! is the new hit closer than the previous one (i.e., zone not strictly convex)?</span>
<a name="ln-2008"></a>                   <span class="c">! if so, take the closer hit</span>
<a name="ln-2009"></a>                   <span class="n">V</span> <span class="o">=</span> <span class="n">HitPt</span> <span class="o">-</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Centroid</span>
<a name="ln-2010"></a>                   <span class="n">HitDSq</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span> <span class="p">(</span> <span class="n">V</span> <span class="p">,</span> <span class="n">V</span> <span class="p">)</span>
<a name="ln-2011"></a>                   <span class="k">IF</span> <span class="p">(</span><span class="n">HitDSq</span> <span class="o">&lt;</span> <span class="n">BSHit</span><span class="p">%</span><span class="n">HitDSq</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2012"></a><span class="k">                       </span><span class="n">BSHit</span><span class="p">%</span><span class="n">KBkSurf</span> <span class="o">=</span> <span class="n">KBkSurf</span>
<a name="ln-2013"></a>                       <span class="n">BSHit</span><span class="p">%</span><span class="n">HitSurf</span> <span class="o">=</span> <span class="n">JSurf</span>
<a name="ln-2014"></a>                       <span class="n">BSHit</span><span class="p">%</span><span class="n">HitPt</span> <span class="o">=</span> <span class="n">HitPt</span>
<a name="ln-2015"></a>                       <span class="n">BSHit</span><span class="p">%</span><span class="n">HitDSq</span> <span class="o">=</span> <span class="n">HitDSq</span>
<a name="ln-2016"></a>                   <span class="n">ENDIF</span>
<a name="ln-2017"></a>               <span class="n">ENDIF</span>
<a name="ln-2018"></a>           <span class="n">ENDDO</span>      <span class="c">!back surf loop</span>
<a name="ln-2019"></a>           <span class="k">IF</span> <span class="p">(</span><span class="n">TotHits</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>  <span class="c">!this should not happen--means a ray has gotten lost</span>
<a name="ln-2020"></a>           <span class="c">!    CALL ShowWarningError (&#39;BSDF--Zone surfaces do not completely enclose zone--transmitted ray lost&#39;)</span>
<a name="ln-2021"></a>           <span class="k">ELSE</span>
<a name="ln-2022"></a><span class="k">               </span><span class="n">KBkSurf</span> <span class="o">=</span> <span class="n">BSHit</span><span class="p">%</span><span class="n">KBkSurf</span>
<a name="ln-2023"></a>               <span class="n">JSurf</span> <span class="o">=</span> <span class="n">BSHit</span><span class="p">%</span><span class="n">HitSurf</span>
<a name="ln-2024"></a>               <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span> <span class="n">KBkSurf</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span> <span class="n">KBkSurf</span> <span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
<a name="ln-2025"></a>               <span class="n">TmpSurfInt</span><span class="p">(</span><span class="n">KBkSurf</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span> <span class="n">KBkSurf</span>  <span class="p">))</span> <span class="o">=</span> <span class="n">IRay</span>
<a name="ln-2026"></a>               <span class="n">VecNorm</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">OutNormVec</span>
<a name="ln-2027"></a>               <span class="n">TmpSjdotN</span><span class="p">(</span><span class="n">KBkSurf</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span> <span class="n">KBkSurf</span>  <span class="p">))</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">sTrn</span><span class="p">(</span><span class="n">IRay</span><span class="p">)</span> <span class="p">.</span><span class="n">dot</span><span class="p">.</span> <span class="n">VecNorm</span>
<a name="ln-2028"></a>           <span class="n">ENDIF</span>
<a name="ln-2029"></a>        <span class="n">ENDDO</span>        <span class="c">!ray loop</span>
<a name="ln-2030"></a>              <span class="c">!  All rays traced, now put away the results in the temporary arrays</span>
<a name="ln-2031"></a>              <span class="n">MaxInt</span> <span class="o">=</span> <span class="nb">MAXVAL</span><span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span> <span class="p">)</span>
<a name="ln-2032"></a>              <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span> <span class="p">,</span> <span class="n">MaxInt</span><span class="p">))</span>
<a name="ln-2033"></a>              <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SjdotN</span><span class="p">(</span><span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span> <span class="p">,</span> <span class="n">MaxInt</span><span class="p">))</span>
<a name="ln-2034"></a>              <span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2035"></a>              <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span>
<a name="ln-2036"></a>                  <span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span><span class="n">I</span><span class="p">))</span> <span class="o">=</span> <span class="n">TmpSurfInt</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-2037"></a>                  <span class="n">Geom</span><span class="p">%</span><span class="n">SjdotN</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span><span class="n">I</span><span class="p">))</span> <span class="o">=</span> <span class="n">TmpSjdotN</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-2038"></a>              <span class="k">END DO</span>
<a name="ln-2039"></a>
<a name="ln-2040"></a><span class="k">              DEALLOCATE</span><span class="p">(</span><span class="n">TmpSurfInt</span><span class="p">)</span>
<a name="ln-2041"></a>              <span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">TmpSjdotN</span><span class="p">)</span>
<a name="ln-2042"></a>
<a name="ln-2043"></a>  <span class="k">RETURN</span>
<a name="ln-2044"></a>
<a name="ln-2045"></a><span class="k">END SUBROUTINE </span><span class="n">SetupComplexWindowStateGeometry</span>
<a name="ln-2046"></a>
<a name="ln-2047"></a><span class="k">SUBROUTINE </span><span class="n">CalcWindowStaticProperties</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">IState</span><span class="p">,</span> <span class="n">Window</span><span class="p">,</span> <span class="n">Geom</span><span class="p">,</span> <span class="n">State</span><span class="p">)</span>
<a name="ln-2048"></a>
<a name="ln-2049"></a>  <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2050"></a>  <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-2051"></a>  <span class="c">!       DATE WRITTEN   &lt;date_written&gt;</span>
<a name="ln-2052"></a>  <span class="c">!       MODIFIED       na</span>
<a name="ln-2053"></a>  <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2054"></a>
<a name="ln-2055"></a>  <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2056"></a>  <span class="c">! Calculates those optical properties of all the Complex Fenestrations that</span>
<a name="ln-2057"></a>  <span class="c">! do not depend on the beam direction (hence, on hour and time step)</span>
<a name="ln-2058"></a>
<a name="ln-2059"></a>  <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2060"></a>  <span class="c">! &lt;description&gt;</span>
<a name="ln-2061"></a>
<a name="ln-2062"></a>  <span class="c">! REFERENCES:</span>
<a name="ln-2063"></a>  <span class="c">! na</span>
<a name="ln-2064"></a>
<a name="ln-2065"></a>  <span class="c">! USE STATEMENTS:</span>
<a name="ln-2066"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-2067"></a>
<a name="ln-2068"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2069"></a>
<a name="ln-2070"></a>  <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2071"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">ISurf</span>    <span class="c">!Surface number of the complex fenestration</span>
<a name="ln-2072"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">IState</span>    <span class="c">!State number of the complex fenestration state</span>
<a name="ln-2073"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFWindowGeomDescr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Window</span>  <span class="c">!Window Geometry</span>
<a name="ln-2074"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFGeomDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Geom</span>    <span class="c">!State Geometry</span>
<a name="ln-2075"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BSDFStateDescr</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">State</span>    <span class="c">!State Description</span>
<a name="ln-2076"></a>
<a name="ln-2077"></a>
<a name="ln-2078"></a>  <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2079"></a>  <span class="c">! na</span>
<a name="ln-2080"></a>
<a name="ln-2081"></a>  <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-2082"></a>  <span class="c">! na</span>
<a name="ln-2083"></a>
<a name="ln-2084"></a>  <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-2085"></a>  <span class="c">! na</span>
<a name="ln-2086"></a>
<a name="ln-2087"></a>  <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2088"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">IConst</span>    <span class="c">!Pointer to construction for this fenestration</span>
<a name="ln-2089"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">I</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-2090"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">J</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index</span>
<a name="ln-2091"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">JJ</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index--ray</span>
<a name="ln-2092"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">L</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index--layer</span>
<a name="ln-2093"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">M</span>  <span class="o">=</span><span class="mi">0</span>  <span class="c">!general purpose index--ray</span>
<a name="ln-2094"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">KBkSurf</span>    <span class="c">!back surface index</span>
<a name="ln-2095"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>  <span class="n">JSurf</span>    <span class="c">!surface number (used for back surface)</span>
<a name="ln-2096"></a>  <span class="kt">INTEGER</span>      <span class="kd">::</span>  <span class="n">BaseSurf</span>    <span class="c">!base surface number (used for finding back surface)</span>
<a name="ln-2097"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Sum1</span>    <span class="c">!general purpose temporary sum</span>
<a name="ln-2098"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Sum2</span>    <span class="c">!general purpose temporary sum</span>
<a name="ln-2099"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Sum3</span>    <span class="c">!general purpose temporary sum</span>
<a name="ln-2100"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Hold</span>        <span class="c">!temp variable</span>
<a name="ln-2101"></a>
<a name="ln-2102"></a>  <span class="n">IConst</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">Konst</span>
<a name="ln-2103"></a>
<a name="ln-2104"></a>  <span class="c">!Calculate the hemispherical-hemispherical transmittance</span>
<a name="ln-2105"></a>
<a name="ln-2106"></a>  <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2107"></a>  <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2108"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">!Incident ray loop</span>
<a name="ln-2109"></a>    <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span> <span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2110"></a>    <span class="k">DO  </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">!Outgoing ray loop</span>
<a name="ln-2111"></a>      <span class="n">Sum1</span> <span class="o">=</span><span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span> <span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
<a name="ln-2112"></a>    <span class="k">END DO</span>        <span class="c">!Outgoing ray loop</span>
<a name="ln-2113"></a>  <span class="k">END DO</span>        <span class="c">!Incident ray loop</span>
<a name="ln-2114"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2115"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinDiffTrans</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2116"></a>  <span class="k">ELSE</span>
<a name="ln-2117"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinDiffTrans</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2118"></a>    <span class="k">CALL </span><span class="n">ShowWarningError</span> <span class="p">(</span><span class="s1">&#39;BSDF--Inc basis has zero projected solid angle&#39;</span><span class="p">)</span>
<a name="ln-2119"></a>  <span class="n">ENDIF</span>
<a name="ln-2120"></a>
<a name="ln-2121"></a>  <span class="c">!Calculate the hemispherical-hemispherical transmittance for visible spetrum</span>
<a name="ln-2122"></a>
<a name="ln-2123"></a>  <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2124"></a>  <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2125"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">!Incident ray loop</span>
<a name="ln-2126"></a>    <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2127"></a>    <span class="k">DO  </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">!Outgoing ray loop</span>
<a name="ln-2128"></a>      <span class="n">Sum1</span> <span class="o">=</span><span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">VisFrtTrans</span> <span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
<a name="ln-2129"></a>    <span class="k">END DO</span>        <span class="c">!Outgoing ray loop</span>
<a name="ln-2130"></a>  <span class="k">END DO</span>        <span class="c">!Incident ray loop</span>
<a name="ln-2131"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2132"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinDiffVisTrans</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2133"></a>  <span class="k">ELSE</span>
<a name="ln-2134"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinDiffVisTrans</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2135"></a>    <span class="k">CALL </span><span class="n">ShowWarningError</span> <span class="p">(</span><span class="s1">&#39;BSDF--Inc basis has zero projected solid angle&#39;</span><span class="p">)</span>
<a name="ln-2136"></a>  <span class="n">ENDIF</span>
<a name="ln-2137"></a>
<a name="ln-2138"></a>  <span class="c">!Set the nominal diffuse transmittance so the surface isn&#39;t mistaken as opaque</span>
<a name="ln-2139"></a>  <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">TransDiff</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">ComplexFen</span><span class="p">%</span><span class="n">State</span><span class="p">(</span><span class="n">IState</span><span class="p">)%</span><span class="n">WinDiffTrans</span>
<a name="ln-2140"></a>  <span class="c">!Calculate Window Sky Transmittance (transmitted radiation assumed diffuse)</span>
<a name="ln-2141"></a>  <span class="c">!and Sky Absorptance (by layer)</span>
<a name="ln-2142"></a>  <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2143"></a>  <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2144"></a>  <span class="n">Sum3</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2145"></a>  <span class="k">DO  </span><span class="n">JJ</span> <span class="o">=</span>  <span class="mi">1</span> <span class="p">,</span>  <span class="n">Geom</span><span class="p">%</span><span class="n">NSky</span>
<a name="ln-2146"></a>    <span class="k">DO </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2147"></a>      <span class="n">J</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SkyIndex</span><span class="p">(</span> <span class="n">JJ</span> <span class="p">)</span>
<a name="ln-2148"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2149"></a>    <span class="k">END DO</span>
<a name="ln-2150"></a><span class="k">  END DO</span>
<a name="ln-2151"></a><span class="k">  DO  </span><span class="n">JJ</span> <span class="o">=</span>  <span class="mi">1</span> <span class="p">,</span>  <span class="n">Geom</span><span class="p">%</span><span class="n">NSky</span>
<a name="ln-2152"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SkyIndex</span><span class="p">(</span> <span class="n">JJ</span> <span class="p">)</span>
<a name="ln-2153"></a>    <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span> <span class="p">(</span> <span class="n">JJ</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">J</span> <span class="p">)</span>
<a name="ln-2154"></a>  <span class="k">END DO</span>
<a name="ln-2155"></a>
<a name="ln-2156"></a><span class="k">  IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2157"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyTrans</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2158"></a>  <span class="k">ELSE</span>
<a name="ln-2159"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyTrans</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2160"></a>  <span class="k">END IF</span>
<a name="ln-2161"></a>
<a name="ln-2162"></a><span class="k">  ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyFtAbs</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">NLayers</span><span class="p">))</span>
<a name="ln-2163"></a>  <span class="c">!Also allocate the beam quantities for this state</span>
<a name="ln-2164"></a>  <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>
<a name="ln-2165"></a>    <span class="n">Sum3</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2166"></a>    <span class="k">DO </span><span class="n">JJ</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSky</span>
<a name="ln-2167"></a>      <span class="n">J</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SkyIndex</span><span class="p">(</span> <span class="n">JJ</span> <span class="p">)</span>
<a name="ln-2168"></a>      <span class="n">Sum3</span> <span class="o">=</span> <span class="n">Sum3</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyWt</span> <span class="p">(</span><span class="n">JJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">FrtAbs</span><span class="p">(</span><span class="mi">1</span> <span class="p">,</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2169"></a>    <span class="k">END DO</span>
<a name="ln-2170"></a>
<a name="ln-2171"></a><span class="k">    IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2172"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyFtAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum3</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2173"></a>    <span class="k">ELSE</span>
<a name="ln-2174"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyFtAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2175"></a>    <span class="k">END IF</span>
<a name="ln-2176"></a>
<a name="ln-2177"></a><span class="k">  END DO</span>
<a name="ln-2178"></a>
<a name="ln-2179"></a>  <span class="c">!Calculate Window Sky/Ground Transmittance</span>
<a name="ln-2180"></a>  <span class="c">!(applies to ground-reflected sky radiation, transmitted radiation assumed diffuse)</span>
<a name="ln-2181"></a>  <span class="c">!This is the same calculation as the sky transmittance, except that the set of incident</span>
<a name="ln-2182"></a>  <span class="c">!rays and the ray weights are different</span>
<a name="ln-2183"></a>  <span class="c">!Also calculate Window Sky/Ground Absorptance (by layer)</span>
<a name="ln-2184"></a>  <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2185"></a>  <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2186"></a>  <span class="n">Sum3</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2187"></a>
<a name="ln-2188"></a>  <span class="k">DO </span><span class="n">JJ</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NGnd</span>
<a name="ln-2189"></a>    <span class="k">DO </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2190"></a>      <span class="n">J</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">GndIndex</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span>
<a name="ln-2191"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2192"></a>    <span class="k">END DO</span>
<a name="ln-2193"></a><span class="k">  END DO</span>
<a name="ln-2194"></a>
<a name="ln-2195"></a><span class="k">  DO   </span><span class="n">JJ</span> <span class="o">=</span>  <span class="mi">1</span> <span class="p">,</span>  <span class="n">Geom</span><span class="p">%</span><span class="n">NGnd</span>
<a name="ln-2196"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">GndIndex</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span>
<a name="ln-2197"></a>    <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span> <span class="p">(</span> <span class="n">JJ</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">J</span> <span class="p">)</span>
<a name="ln-2198"></a>  <span class="k">END DO</span>
<a name="ln-2199"></a>
<a name="ln-2200"></a><span class="k">  IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2201"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyGndTrans</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2202"></a>  <span class="k">ELSE</span>
<a name="ln-2203"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyGndTrans</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2204"></a>  <span class="k">END IF</span>
<a name="ln-2205"></a>
<a name="ln-2206"></a><span class="k">  ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyGndAbs</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">NLayers</span><span class="p">))</span>
<a name="ln-2207"></a>  <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>
<a name="ln-2208"></a>    <span class="n">Sum3</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2209"></a>    <span class="k">DO  </span><span class="n">JJ</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NGnd</span>
<a name="ln-2210"></a>      <span class="n">J</span> <span class="o">=</span> <span class="n">Geom</span><span class="p">%</span><span class="n">GndIndex</span><span class="p">(</span> <span class="n">JJ</span> <span class="p">)</span>
<a name="ln-2211"></a>      <span class="n">Sum3</span> <span class="o">=</span> <span class="n">Sum3</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SolSkyGndWt</span><span class="p">(</span><span class="n">JJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">FrtAbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<a name="ln-2212"></a>    <span class="k">END DO</span>
<a name="ln-2213"></a>
<a name="ln-2214"></a><span class="k">    IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2215"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyGndAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum3</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2216"></a>    <span class="k">ELSE</span>
<a name="ln-2217"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinSkyGndAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2218"></a>    <span class="k">END IF</span>
<a name="ln-2219"></a><span class="k">  END DO</span>
<a name="ln-2220"></a>
<a name="ln-2221"></a>  <span class="c">!Calculate Window Back Hemispherical Reflectance and Layer Back Hemispherical Absorptance</span>
<a name="ln-2222"></a>  <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2223"></a>  <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2224"></a>  <span class="n">Sum3</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2225"></a>  <span class="c">!Note this again assumes the equivalence Inc basis = transmission basis for back incidence and</span>
<a name="ln-2226"></a>  <span class="c">! Trn basis = incident basis for back incidence</span>
<a name="ln-2227"></a>  <span class="k">DO   </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2228"></a>    <span class="k">DO </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2229"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span>  <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolBkRefl</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2230"></a>    <span class="k">END DO</span>
<a name="ln-2231"></a><span class="k">  END DO</span>
<a name="ln-2232"></a><span class="k">  DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2233"></a>      <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span>  <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">J</span> <span class="p">)</span>
<a name="ln-2234"></a>  <span class="k">END DO</span>
<a name="ln-2235"></a>
<a name="ln-2236"></a><span class="k">  IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2237"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinBkHemRefl</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2238"></a>  <span class="k">ELSE</span>
<a name="ln-2239"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinBkHemRefl</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2240"></a>  <span class="k">END IF</span>
<a name="ln-2241"></a>
<a name="ln-2242"></a><span class="k">  </span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">ReflectSolDiffBack</span> <span class="o">=</span> <span class="n">State</span><span class="p">%</span><span class="n">WinBkHemRefl</span>
<a name="ln-2243"></a>
<a name="ln-2244"></a>  <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">WinBkHemAbs</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">NLayers</span><span class="p">))</span>
<a name="ln-2245"></a>  <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>
<a name="ln-2246"></a>    <span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2247"></a>      <span class="n">Sum3</span> <span class="o">=</span> <span class="n">Sum3</span> <span class="o">+</span>  <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">BkAbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<a name="ln-2248"></a>    <span class="k">END DO</span>
<a name="ln-2249"></a>
<a name="ln-2250"></a><span class="k">    IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2251"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinBkHemAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum3</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2252"></a>    <span class="k">ELSE</span>
<a name="ln-2253"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinBkHemAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2254"></a>    <span class="k">END IF</span>
<a name="ln-2255"></a>
<a name="ln-2256"></a>    <span class="c">!Put this into the construction for use in non-detailed optical calculations</span>
<a name="ln-2257"></a>    <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">AbsDiffBack</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">State</span><span class="p">%</span><span class="n">WinBkHemAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<a name="ln-2258"></a>  <span class="k">END DO</span>
<a name="ln-2259"></a>
<a name="ln-2260"></a>  <span class="c">!Calculate Window Layer Front Hemispherical Absorptance</span>
<a name="ln-2261"></a>  <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2262"></a>  <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2263"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2264"></a>    <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2265"></a>  <span class="k">END DO</span>
<a name="ln-2266"></a><span class="k">  ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">WinFtHemAbs</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">NLayers</span><span class="p">))</span>
<a name="ln-2267"></a>  <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>
<a name="ln-2268"></a>    <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2269"></a>    <span class="k">DO   </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2270"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span>  <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">J</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">FrtAbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<a name="ln-2271"></a>    <span class="k">END DO</span>
<a name="ln-2272"></a>
<a name="ln-2273"></a><span class="k">    IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2274"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinFtHemAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2275"></a>    <span class="k">ELSE</span>
<a name="ln-2276"></a><span class="k">      </span><span class="n">State</span><span class="p">%</span><span class="n">WinFtHemAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2277"></a>    <span class="k">END IF</span>
<a name="ln-2278"></a>
<a name="ln-2279"></a>    <span class="c">!Put this into the construction for use in non-detailed optical calculations</span>
<a name="ln-2280"></a>    <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">AbsDiff</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">State</span><span class="p">%</span><span class="n">WinFtHemAbs</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<a name="ln-2281"></a>  <span class="k">END DO</span>
<a name="ln-2282"></a>
<a name="ln-2283"></a>  <span class="c">!Calculate Window Back Hemispherical Visible Reflectance</span>
<a name="ln-2284"></a>  <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2285"></a>  <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2286"></a>  <span class="c">!Note this again assumes the equivalence Inc basis = transmission basis for back incidence and</span>
<a name="ln-2287"></a>  <span class="c">! Trn basis = incident basis for back incidence</span>
<a name="ln-2288"></a>  <span class="k">DO   </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2289"></a>    <span class="k">DO </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2290"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span>  <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">VisBkRefl</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2291"></a>    <span class="k">END DO</span>
<a name="ln-2292"></a><span class="k">  END DO</span>
<a name="ln-2293"></a><span class="k">  DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2294"></a>      <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span>  <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">J</span> <span class="p">)</span>
<a name="ln-2295"></a>  <span class="k">END DO</span>
<a name="ln-2296"></a>
<a name="ln-2297"></a><span class="k">  IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2298"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinBkHemVisRefl</span> <span class="o">=</span> <span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2299"></a>  <span class="k">ELSE</span>
<a name="ln-2300"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">WinBkHemVisRefl</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2301"></a>  <span class="k">END IF</span>
<a name="ln-2302"></a>
<a name="ln-2303"></a><span class="k">  </span><span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">ReflectVisDiffBack</span> <span class="o">=</span> <span class="n">State</span><span class="p">%</span><span class="n">WinBkHemVisRefl</span>
<a name="ln-2304"></a>
<a name="ln-2305"></a>  <span class="c">!     *     *     *     *</span>
<a name="ln-2306"></a>  <span class="c">!Note potential problem if one relaxes the assumption that Inc and Trn basis have same structure:</span>
<a name="ln-2307"></a>  <span class="c">!  The following calculations are made for the set of ray numbers defined in the Trn basis that</span>
<a name="ln-2308"></a>  <span class="c">!   were determined to connect the center of the window to a particular back surface.</span>
<a name="ln-2309"></a>  <span class="c">!   Here it is assumed that one can reverse these rays and get an equivalent set in the Trn</span>
<a name="ln-2310"></a>  <span class="c">!   basis for back-incidence quantities: back transmittance and back layer absorptance</span>
<a name="ln-2311"></a>  <span class="c">!   This assumption may fail if the Inc and Trn bases are allowed to have different structure.</span>
<a name="ln-2312"></a>  <span class="c">!   Note also that in this case one would need to rethink the relationship of the basis</span>
<a name="ln-2313"></a>  <span class="c">!   definitions to back-incidence quantities:  possibly this would</span>
<a name="ln-2314"></a>  <span class="c">!   also require that the basis for back incident quantities be</span>
<a name="ln-2315"></a>  <span class="c">!   different from the Trn basis, and similarly the basis for backward outgoing rays</span>
<a name="ln-2316"></a>  <span class="c">!   be different from the Inc basis.</span>
<a name="ln-2317"></a>
<a name="ln-2318"></a>  <span class="c">!     *     *     *     *</span>
<a name="ln-2319"></a>  <span class="c">!  Note that we are assuming that for back incidence the layer numberings are the same</span>
<a name="ln-2320"></a>  <span class="c">!  as for front incidence, i.e., from outside to inside when incidence is from inside</span>
<a name="ln-2321"></a>  <span class="c">!     *     *     *     *</span>
<a name="ln-2322"></a>  <span class="c">!For back surfaces that are complex fenestrations, calculate the directional-hemispherical back</span>
<a name="ln-2323"></a>  <span class="c">!  reflectance and the directional back absorptance by layer for this fenestration receiving</span>
<a name="ln-2324"></a>  <span class="c">!  radiation via the back surface</span>
<a name="ln-2325"></a>  <span class="c">!  Make this calculation only for cases where the back surface is a Complex Fenestration</span>
<a name="ln-2326"></a>  <span class="c">!</span>
<a name="ln-2327"></a>  <span class="c">!First allocate the back surface section of the state properties</span>
<a name="ln-2328"></a>  <span class="k">IF</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">))</span> <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span><span class="p">))</span>
<a name="ln-2329"></a>  <span class="k">DO </span><span class="n">KBkSurf</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Window</span><span class="p">%</span><span class="n">NBkSurf</span>  <span class="c">!back surface loop</span>
<a name="ln-2330"></a>    <span class="n">BaseSurf</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">BaseSurf</span>     <span class="c">!ShadowComb is organized by base surface</span>
<a name="ln-2331"></a>    <span class="n">JSurf</span> <span class="o">=</span> <span class="n">ShadowComb</span><span class="p">(</span><span class="n">BaseSurf</span><span class="p">)%</span><span class="n">BackSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)</span>
<a name="ln-2332"></a>    <span class="k">IF</span> <span class="p">(</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">JSurf</span><span class="p">)%</span><span class="n">WindowModelType</span> <span class="o">/=</span> <span class="n">WindowBSDFModel</span> <span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-2333"></a>
<a name="ln-2334"></a>    <span class="c">!  Directional-hemispherical back reflectance</span>
<a name="ln-2335"></a>    <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2336"></a>    <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2337"></a>    <span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)</span>   <span class="c">!Inc Ray loop</span>
<a name="ln-2338"></a>      <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">KBkSurf</span> <span class="p">,</span> <span class="n">J</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-2339"></a>      <span class="k">DO </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>   <span class="c">!Outgoing Ray loop</span>
<a name="ln-2340"></a>        <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">,</span> <span class="n">J</span><span class="p">))</span> <span class="o">*</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-2341"></a>                           <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolBkRefl</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">,</span> <span class="n">J</span><span class="p">))</span>
<a name="ln-2342"></a>      <span class="k">END DO</span>    <span class="c">!Outgoing Ray loop</span>
<a name="ln-2343"></a>    <span class="k">END DO</span>    <span class="c">!Inc Ray loop</span>
<a name="ln-2344"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2345"></a><span class="k">      </span><span class="n">Hold</span> <span class="o">=</span><span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2346"></a>      <span class="k">DO  </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span>
<a name="ln-2347"></a>        <span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span><span class="n">NumOfTimeStepInHour</span>
<a name="ln-2348"></a>          <span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDHBkRefl</span><span class="p">(</span> <span class="n">I</span> <span class="p">,</span> <span class="n">J</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Hold</span>
<a name="ln-2349"></a>        <span class="k">END DO</span>
<a name="ln-2350"></a><span class="k">      END DO</span>
<a name="ln-2351"></a><span class="k">    ELSE</span>
<a name="ln-2352"></a><span class="k">      DO  </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span><span class="mi">24</span>
<a name="ln-2353"></a>        <span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span><span class="n">NumOfTimeStepInHour</span>
<a name="ln-2354"></a>          <span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDHBkRefl</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2355"></a>        <span class="k">END DO</span>
<a name="ln-2356"></a><span class="k">      END DO</span>
<a name="ln-2357"></a><span class="k">    </span><span class="n">ENDIF</span>
<a name="ln-2358"></a>
<a name="ln-2359"></a>    <span class="c">!  Directional layer  back absorption</span>
<a name="ln-2360"></a>    <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>  <span class="c">!layer loop</span>
<a name="ln-2361"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2362"></a>      <span class="n">Sum2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2363"></a>      <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">NSurfInt</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)</span>  <span class="c">!Inc Ray loop</span>
<a name="ln-2364"></a>        <span class="n">Sum2</span> <span class="o">=</span> <span class="n">Sum2</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">,</span> <span class="n">J</span><span class="p">))</span>
<a name="ln-2365"></a>        <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">KBkSurf</span> <span class="p">,</span> <span class="n">J</span><span class="p">))</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-2366"></a>                        <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">BkAbs</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">SurfInt</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">,</span> <span class="n">J</span><span class="p">))</span>
<a name="ln-2367"></a>      <span class="k">END DO</span>    <span class="c">!Inc Ray loop</span>
<a name="ln-2368"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Sum2</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2369"></a><span class="k">        </span><span class="n">Hold</span> <span class="o">=</span><span class="n">Sum1</span><span class="o">/</span><span class="n">Sum2</span>
<a name="ln-2370"></a>        <span class="k">DO  </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span>
<a name="ln-2371"></a>          <span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span>
<a name="ln-2372"></a>            <span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDirBkAbs</span><span class="p">(</span> <span class="n">L</span> <span class="p">,</span> <span class="n">I</span> <span class="p">,</span> <span class="n">J</span> <span class="p">)</span> <span class="o">=</span> <span class="n">Hold</span>
<a name="ln-2373"></a>          <span class="k">END DO</span>
<a name="ln-2374"></a><span class="k">        END DO</span>
<a name="ln-2375"></a><span class="k">      ELSE</span>
<a name="ln-2376"></a><span class="k">        DO  </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span>
<a name="ln-2377"></a>          <span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumOfTimeStepInHour</span>
<a name="ln-2378"></a>            <span class="n">State</span><span class="p">%</span><span class="n">BkSurf</span><span class="p">(</span><span class="n">KBkSurf</span><span class="p">)%</span><span class="n">WinDirBkAbs</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2379"></a>          <span class="k">END DO</span>
<a name="ln-2380"></a><span class="k">        END DO</span>
<a name="ln-2381"></a><span class="k">      </span><span class="n">ENDIF</span>
<a name="ln-2382"></a>
<a name="ln-2383"></a>    <span class="k">END DO</span>      <span class="c">!layer loop</span>
<a name="ln-2384"></a>  <span class="k">END DO</span>  <span class="c">!back surface loop</span>
<a name="ln-2385"></a>
<a name="ln-2386"></a>  <span class="c">! ********************************************************************************</span>
<a name="ln-2387"></a>  <span class="c">! Allocation and calculation of integrated values for front of window surface</span>
<a name="ln-2388"></a>  <span class="c">! ********************************************************************************</span>
<a name="ln-2389"></a>
<a name="ln-2390"></a>  <span class="c">! Sum of front absorptances for each incident direction (integration of absorptances)</span>
<a name="ln-2391"></a>  <span class="k">IF</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtAbs</span><span class="p">))</span> <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtAbs</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-2392"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2393"></a>    <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2394"></a>    <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>  <span class="c">!layer loop</span>
<a name="ln-2395"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">FrtAbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<a name="ln-2396"></a>    <span class="k">END DO</span>
<a name="ln-2397"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtAbs</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span>
<a name="ln-2398"></a>  <span class="k">END DO</span>
<a name="ln-2399"></a>
<a name="ln-2400"></a>  <span class="c">! Integrating front transmittance</span>
<a name="ln-2401"></a>  <span class="k">IF</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtTrans</span><span class="p">))</span> <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtTrans</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-2402"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">! Incident ray loop</span>
<a name="ln-2403"></a>    <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2404"></a>    <span class="k">DO  </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">! Outgoing ray loop</span>
<a name="ln-2405"></a>      <span class="n">Sum1</span> <span class="o">=</span><span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolFrtTrans</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<a name="ln-2406"></a>    <span class="k">END DO</span>        <span class="c">! Outgoing ray loop</span>
<a name="ln-2407"></a>    <span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtTrans</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span>
<a name="ln-2408"></a>  <span class="k">END DO</span> <span class="c">! Incident ray loop</span>
<a name="ln-2409"></a>
<a name="ln-2410"></a>  <span class="k">IF</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtRefl</span><span class="p">))</span> <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtRefl</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-2411"></a>  <span class="c">! Integrating front reflectance</span>
<a name="ln-2412"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">! Incoming ray loop</span>
<a name="ln-2413"></a>    <span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtRefl</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtTrans</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">-</span> <span class="n">State</span><span class="p">%</span><span class="n">IntegratedFtAbs</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2414"></a>  <span class="k">END DO</span> <span class="c">!Incoming ray loop</span>
<a name="ln-2415"></a>
<a name="ln-2416"></a>  <span class="c">! ********************************************************************************</span>
<a name="ln-2417"></a>  <span class="c">! Allocation and calculation of integrated values for back of window surface</span>
<a name="ln-2418"></a>  <span class="c">! ********************************************************************************</span>
<a name="ln-2419"></a>
<a name="ln-2420"></a>  <span class="c">! Sum of back absorptances for each incident direction (integration of absorptances)</span>
<a name="ln-2421"></a>  <span class="k">IF</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkAbs</span><span class="p">))</span> <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkAbs</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-2422"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>
<a name="ln-2423"></a>    <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2424"></a>    <span class="k">DO </span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">State</span><span class="p">%</span><span class="n">NLayers</span>  <span class="c">!layer loop</span>
<a name="ln-2425"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">Layer</span><span class="p">(</span><span class="n">L</span><span class="p">)%</span><span class="n">BkAbs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<a name="ln-2426"></a>    <span class="k">END DO</span>
<a name="ln-2427"></a><span class="k">    </span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkAbs</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span>
<a name="ln-2428"></a>  <span class="k">END DO</span>
<a name="ln-2429"></a>
<a name="ln-2430"></a>  <span class="c">! Integrating back reflectance</span>
<a name="ln-2431"></a>  <span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkRefl</span><span class="p">))</span> <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkRefl</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-2432"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">! Outgoing ray loop</span>
<a name="ln-2433"></a>    <span class="n">Sum1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2434"></a>    <span class="k">DO  </span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">! Incident ray loop</span>
<a name="ln-2435"></a>      <span class="n">Sum1</span> <span class="o">=</span> <span class="n">Sum1</span> <span class="o">+</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Inc</span><span class="p">%</span><span class="n">Lamda</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">Construct</span><span class="p">(</span><span class="n">IConst</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">SolBkRefl</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
<a name="ln-2436"></a>    <span class="k">END DO</span>        <span class="c">!Incident ray loop</span>
<a name="ln-2437"></a>    <span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkRefl</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum1</span>
<a name="ln-2438"></a>  <span class="k">END DO</span> <span class="c">!Outgoing ray loop</span>
<a name="ln-2439"></a>
<a name="ln-2440"></a>  <span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">ALLOCATED</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkTrans</span><span class="p">))</span> <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkTrans</span><span class="p">(</span><span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span><span class="p">))</span>
<a name="ln-2441"></a>  <span class="c">! Integrating back transmittance</span>
<a name="ln-2442"></a>  <span class="k">DO  </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">Geom</span><span class="p">%</span><span class="n">Trn</span><span class="p">%</span><span class="n">NBasis</span>     <span class="c">! Outgoing ray loop</span>
<a name="ln-2443"></a>    <span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkTrans</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkRefl</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">-</span> <span class="n">State</span><span class="p">%</span><span class="n">IntegratedBkAbs</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2444"></a>  <span class="k">END DO</span> <span class="c">!Outgoing ray loop</span>
<a name="ln-2445"></a>
<a name="ln-2446"></a>  <span class="k">RETURN</span>
<a name="ln-2447"></a>
<a name="ln-2448"></a><span class="k">END SUBROUTINE </span><span class="n">CalcWindowStaticProperties</span>
<a name="ln-2449"></a>
<a name="ln-2450"></a>
<a name="ln-2451"></a><span class="k">FUNCTION </span><span class="n">SkyWeight</span> <span class="p">(</span><span class="n">DirVec</span><span class="p">)</span> <span class="k">RESULT</span><span class="p">(</span><span class="n">Wt</span><span class="p">)</span>
<a name="ln-2452"></a>
<a name="ln-2453"></a>          <span class="c">! FUNCTION INFORMATION:</span>
<a name="ln-2454"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-2455"></a>          <span class="c">!       DATE WRITTEN   June 2011</span>
<a name="ln-2456"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2457"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2458"></a>
<a name="ln-2459"></a>          <span class="c">! PURPOSE OF THIS FUNCTION:</span>
<a name="ln-2460"></a>          <span class="c">! Search a one-dimensional array for a given value, returning the index of the element equal to the value, if</span>
<a name="ln-2461"></a>          <span class="c">!   found, or zero</span>
<a name="ln-2462"></a>
<a name="ln-2463"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2464"></a>          <span class="c">! na</span>
<a name="ln-2465"></a>
<a name="ln-2466"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2467"></a>          <span class="c">! na</span>
<a name="ln-2468"></a>
<a name="ln-2469"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2470"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-2471"></a>
<a name="ln-2472"></a>  <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2473"></a>
<a name="ln-2474"></a>          <span class="c">! FUNCTION ARGUMENT DEFINITIONS:</span>
<a name="ln-2475"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span>       <span class="kd">::</span>  <span class="n">DirVec</span>            <span class="c">! Direction of the element to be weighted</span>
<a name="ln-2476"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">Wt</span>  <span class="c">! Weight</span>
<a name="ln-2477"></a>
<a name="ln-2478"></a>          <span class="c">! FUNCTION PARAMETER DEFINITIONS:</span>
<a name="ln-2479"></a>          <span class="c">! na</span>
<a name="ln-2480"></a>
<a name="ln-2481"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2482"></a>          <span class="c">! na</span>
<a name="ln-2483"></a>
<a name="ln-2484"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2485"></a>          <span class="c">! na</span>
<a name="ln-2486"></a>
<a name="ln-2487"></a>          <span class="c">! FUNCTION LOCAL VARIABLE DECLARATIONS</span>
<a name="ln-2488"></a>          <span class="c">!na</span>
<a name="ln-2489"></a>
<a name="ln-2490"></a>          <span class="c">!Flow:</span>
<a name="ln-2491"></a>
<a name="ln-2492"></a>          <span class="n">Wt</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-2493"></a>
<a name="ln-2494"></a>          <span class="c">! To do:  figure out how to weight sky elements to reproduce the current E+ assumptions</span>
<a name="ln-2495"></a>          <span class="c">!  Possibly one will need to calculated average DH transmittance for isotropic sky and</span>
<a name="ln-2496"></a>          <span class="c">!  horizon separately and then later average according to sky conditions.  Then a completely</span>
<a name="ln-2497"></a>          <span class="c">!  different scheme for daylight.  For now: rays that reach sky equally weighted in calculating</span>
<a name="ln-2498"></a>          <span class="c">!  transmittance, rays passing through surfaces with scheduled transmittance are neglected.</span>
<a name="ln-2499"></a>
<a name="ln-2500"></a>      <span class="k">RETURN</span>
<a name="ln-2501"></a>
<a name="ln-2502"></a><span class="k">END FUNCTION </span><span class="n">SkyWeight</span>
<a name="ln-2503"></a>
<a name="ln-2504"></a><span class="k">FUNCTION </span><span class="n">SkyGndWeight</span> <span class="p">(</span><span class="n">PosVec</span><span class="p">)</span> <span class="k">RESULT</span><span class="p">(</span><span class="n">Wt</span><span class="p">)</span>
<a name="ln-2505"></a>
<a name="ln-2506"></a>          <span class="c">! FUNCTION INFORMATION:</span>
<a name="ln-2507"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-2508"></a>          <span class="c">!       DATE WRITTEN   June 2011</span>
<a name="ln-2509"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2510"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2511"></a>
<a name="ln-2512"></a>          <span class="c">! PURPOSE OF THIS FUNCTION:</span>
<a name="ln-2513"></a>          <span class="c">! Search a one-dimensional array for a given value, returning the index of the element equal to the value, if</span>
<a name="ln-2514"></a>          <span class="c">!   found, or zero</span>
<a name="ln-2515"></a>
<a name="ln-2516"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2517"></a>          <span class="c">! na</span>
<a name="ln-2518"></a>
<a name="ln-2519"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2520"></a>          <span class="c">! na</span>
<a name="ln-2521"></a>
<a name="ln-2522"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2523"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-2524"></a>
<a name="ln-2525"></a>  <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2526"></a>
<a name="ln-2527"></a>          <span class="c">! FUNCTION ARGUMENT DEFINITIONS:</span>
<a name="ln-2528"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span>       <span class="kd">::</span>  <span class="n">PosVec</span>            <span class="c">! x,y,z(=0) of ground intersection pt</span>
<a name="ln-2529"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">Wt</span>  <span class="c">! Weight</span>
<a name="ln-2530"></a>
<a name="ln-2531"></a>          <span class="c">! FUNCTION PARAMETER DEFINITIONS:</span>
<a name="ln-2532"></a>          <span class="c">! na</span>
<a name="ln-2533"></a>
<a name="ln-2534"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2535"></a>          <span class="c">! na</span>
<a name="ln-2536"></a>
<a name="ln-2537"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2538"></a>          <span class="c">! na</span>
<a name="ln-2539"></a>
<a name="ln-2540"></a>          <span class="c">! FUNCTION LOCAL VARIABLE DECLARATIONS</span>
<a name="ln-2541"></a>          <span class="c">!na</span>
<a name="ln-2542"></a>
<a name="ln-2543"></a>          <span class="c">!Flow:</span>
<a name="ln-2544"></a>
<a name="ln-2545"></a>          <span class="n">Wt</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-2546"></a>
<a name="ln-2547"></a>          <span class="c">!  At present, equally weights all ground rays for calculation of the complex window transmittance for</span>
<a name="ln-2548"></a>          <span class="c">!  sky radiation reflected from ground.  This does not take into account shading of the ground.</span>
<a name="ln-2549"></a>          <span class="c">!  The correct procedure would be to generate a set of rays to the sky and see which do not intersect</span>
<a name="ln-2550"></a>          <span class="c">!  surfaces, as is done in the reflection manager.  However, this would increase computational load.</span>
<a name="ln-2551"></a>          <span class="c">!  Given that equal weighting, by averaging the transmittance only over rays that come from the ground,</span>
<a name="ln-2552"></a>          <span class="c">!  already produces a more accurate ground transmittance than the existing method, it is at least questionable</span>
<a name="ln-2553"></a>          <span class="c">!  whether the more detailed procedure would produce enough improvement in accuracy to make up for</span>
<a name="ln-2554"></a>          <span class="c">!  the additional calculation time.  Therefore a more detailed treatment is deferred until there is some</span>
<a name="ln-2555"></a>          <span class="c">!  experience with the new method to determine whether further detail is warranted.</span>
<a name="ln-2556"></a>
<a name="ln-2557"></a>
<a name="ln-2558"></a>      <span class="k">RETURN</span>
<a name="ln-2559"></a>
<a name="ln-2560"></a><span class="k">END FUNCTION </span><span class="n">SkyGndWeight</span>
<a name="ln-2561"></a>
<a name="ln-2562"></a><span class="k">FUNCTION </span><span class="n">DaylghtAltAndAzimuth</span> <span class="p">(</span><span class="n">UnitVect</span><span class="p">)</span> <span class="k">RESULT</span><span class="p">(</span><span class="n">DayPos</span><span class="p">)</span>
<a name="ln-2563"></a>
<a name="ln-2564"></a>
<a name="ln-2565"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2566"></a>          <span class="c">!       AUTHOR         Simon Vidanovic</span>
<a name="ln-2567"></a>          <span class="c">!       DATE WRITTEN   April 2013</span>
<a name="ln-2568"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2569"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2570"></a>
<a name="ln-2571"></a>          <span class="c">! PURPOSE OF THIS FUNCTION:</span>
<a name="ln-2572"></a>          <span class="c">! Transform unit vector (given in world coordinates) into altitude and azimuth.  Azimuth is measured from positive x-axe.</span>
<a name="ln-2573"></a>          <span class="c">! Altitude range is from -pi/2 to pi/2. Vector laying in horizontal plane will have altitude equal to zero and vector</span>
<a name="ln-2574"></a>          <span class="c">! pointing upward will have altitude equal to pi/2. Range for azimuth is calculated from -pi to +pi.</span>
<a name="ln-2575"></a>
<a name="ln-2576"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2577"></a>          <span class="c">! &lt;n/a&gt;</span>
<a name="ln-2578"></a>
<a name="ln-2579"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2580"></a>          <span class="c">! na</span>
<a name="ln-2581"></a>
<a name="ln-2582"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2583"></a><span class="k">use </span><span class="n">DataBSDFWindow</span>
<a name="ln-2584"></a><span class="k">use </span><span class="n">vectors</span>
<a name="ln-2585"></a><span class="k">use </span><span class="n">DataGlobals</span>
<a name="ln-2586"></a>
<a name="ln-2587"></a><span class="k">implicit none</span>
<a name="ln-2588"></a>
<a name="ln-2589"></a><span class="k">type</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span>  <span class="n">UnitVect</span> <span class="c">! vector which needs to be converted</span>
<a name="ln-2590"></a><span class="k">type</span><span class="p">(</span><span class="n">BSDFDaylghtPosition</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">DayPos</span>  <span class="c">! altitude and azimuth in world coordinates</span>
<a name="ln-2591"></a>
<a name="ln-2592"></a><span class="k">if</span> <span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">/=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2593"></a><span class="k">  if</span> <span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2594"></a><span class="k">    </span><span class="n">DayPos</span><span class="p">%</span><span class="n">Azimuth</span> <span class="o">=</span> <span class="nb">atan</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span><span class="o">/</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2595"></a>  <span class="k">else</span>
<a name="ln-2596"></a><span class="k">    if</span> <span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2597"></a><span class="k">      </span><span class="n">DayPos</span><span class="p">%</span><span class="n">Azimuth</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">+</span> <span class="nb">atan</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span><span class="o">/</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2598"></a>    <span class="k">else</span>
<a name="ln-2599"></a><span class="k">      </span><span class="n">DayPos</span><span class="p">%</span><span class="n">Azimuth</span> <span class="o">=</span> <span class="o">-</span><span class="n">pi</span> <span class="o">+</span> <span class="nb">atan</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span><span class="o">/</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span><span class="p">)</span>
<a name="ln-2600"></a>    <span class="k">end if</span>
<a name="ln-2601"></a><span class="k">  end if</span>
<a name="ln-2602"></a><span class="k">else</span>
<a name="ln-2603"></a><span class="k">  if</span> <span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2604"></a><span class="k">    </span><span class="n">DayPos</span><span class="p">%</span><span class="n">Azimuth</span> <span class="o">=</span> <span class="n">PiOvr2</span>
<a name="ln-2605"></a>  <span class="k">else</span>
<a name="ln-2606"></a><span class="k">    </span><span class="n">DayPos</span><span class="p">%</span><span class="n">Azimuth</span> <span class="o">=</span> <span class="o">-</span><span class="n">PiOvr2</span>
<a name="ln-2607"></a>  <span class="k">end if</span>
<a name="ln-2608"></a><span class="k">end if</span>
<a name="ln-2609"></a>
<a name="ln-2610"></a><span class="n">DayPos</span><span class="p">%</span><span class="n">Altitude</span> <span class="o">=</span> <span class="nb">asin</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span><span class="p">)</span>
<a name="ln-2611"></a>
<a name="ln-2612"></a><span class="k">return</span>
<a name="ln-2613"></a>
<a name="ln-2614"></a><span class="k">END FUNCTION </span><span class="n">DaylghtAltAndAzimuth</span>
<a name="ln-2615"></a>
<a name="ln-2616"></a><span class="k">FUNCTION </span><span class="n">WorldVectFromW6</span> <span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">RadType</span><span class="p">,</span> <span class="nb">Gamma</span><span class="p">,</span> <span class="n">Alpha</span><span class="p">)</span> <span class="k">RESULT</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">)</span>
<a name="ln-2617"></a>
<a name="ln-2618"></a>
<a name="ln-2619"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2620"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-2621"></a>          <span class="c">!       DATE WRITTEN   Aug 2010</span>
<a name="ln-2622"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2623"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2624"></a>
<a name="ln-2625"></a>          <span class="c">! PURPOSE OF THIS FUNCTION:</span>
<a name="ln-2626"></a>          <span class="c">! Transform angular coordinates in the WINDOW6 coordinate system for</span>
<a name="ln-2627"></a>          <span class="c">! a given surface into a unit vector in the world coordinate system,</span>
<a name="ln-2628"></a>          <span class="c">! pointing to the radiation source (for incident radiation) or in</span>
<a name="ln-2629"></a>          <span class="c">! the direction of propagation (for outgoing radiation)</span>
<a name="ln-2630"></a>
<a name="ln-2631"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2632"></a>          <span class="c">! &lt;n/a&gt;</span>
<a name="ln-2633"></a>
<a name="ln-2634"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2635"></a>          <span class="c">! na</span>
<a name="ln-2636"></a>
<a name="ln-2637"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2638"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-2639"></a>
<a name="ln-2640"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2641"></a>
<a name="ln-2642"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2643"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Theta</span>  <span class="c">!Polar angle in W6 Coords</span>
<a name="ln-2644"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Phi</span>  <span class="c">!Azimuthal angle in W6 Coords</span>
<a name="ln-2645"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">RadType</span>  <span class="c">!Type of radiation: Front_Incident, etc.</span>
<a name="ln-2646"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="nb">Gamma</span>  <span class="c">!Surface tilt angle, radians, world coordinate system</span>
<a name="ln-2647"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Alpha</span>  <span class="c">!Surface azimuth, radians, world coordinate system</span>
<a name="ln-2648"></a>  <span class="k">TYPE</span><span class="p">(</span><span class="n">Vector</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">UnitVect</span>  <span class="c">!unit vector direction in world CS</span>
<a name="ln-2649"></a>
<a name="ln-2650"></a>  <span class="c">! Error tolerance is used to make small numbers equal to zero.  Due to precision of pi constant used in E+, performing</span>
<a name="ln-2651"></a>  <span class="c">! trigonometric operations on those constant will not cause absolutely accurate results</span>
<a name="ln-2652"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PARAMETER</span>  <span class="kd">::</span> <span class="n">ErrorTolerance</span> <span class="o">=</span> <span class="mf">1.d-10</span>
<a name="ln-2653"></a>
<a name="ln-2654"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2655"></a>          <span class="c">! na</span>
<a name="ln-2656"></a>
<a name="ln-2657"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-2658"></a>          <span class="c">! na</span>
<a name="ln-2659"></a>
<a name="ln-2660"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-2661"></a>          <span class="c">! na</span>
<a name="ln-2662"></a>
<a name="ln-2663"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2664"></a>
<a name="ln-2665"></a>
<a name="ln-2666"></a>  <span class="n">UnitVect</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">,</span> <span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-2667"></a>  <span class="k">SELECT CASE</span> <span class="p">(</span><span class="n">RadType</span><span class="p">)</span>
<a name="ln-2668"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Front_Incident</span><span class="p">)</span>   <span class="c">!W6 vector will point in direction of propagation, must reverse to get world vector</span>
<a name="ln-2669"></a>                                             <span class="c">!  after the W6 vector has been rotated into the world CS</span>
<a name="ln-2670"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2671"></a>        <span class="p">&amp;</span> <span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2672"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">+</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2673"></a>        <span class="p">&amp;</span> <span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2674"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2675"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Front_Transmitted</span><span class="p">)</span>
<a name="ln-2676"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2677"></a>        <span class="p">&amp;</span> <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2678"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">+</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2679"></a>        <span class="p">&amp;</span> <span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">))</span>
<a name="ln-2680"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span>
<a name="ln-2681"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Front_Reflected</span><span class="p">)</span>
<a name="ln-2682"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2683"></a>        <span class="p">&amp;</span> <span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2684"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2685"></a>        <span class="p">&amp;</span> <span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2686"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span>
<a name="ln-2687"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Back_Incident</span><span class="p">)</span>
<a name="ln-2688"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span> <span class="o">-</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2689"></a>        <span class="p">&amp;</span> <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2690"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span> <span class="o">+</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2691"></a>        <span class="p">&amp;</span> <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2692"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span>
<a name="ln-2693"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Back_Transmitted</span><span class="p">)</span>    <span class="c">!This is same as front reflected</span>
<a name="ln-2694"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2695"></a>        <span class="p">&amp;</span> <span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2696"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2697"></a>        <span class="p">&amp;</span> <span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2698"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span>
<a name="ln-2699"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Back_Reflected</span><span class="p">)</span>    <span class="c">!This is same as front transmitted</span>
<a name="ln-2700"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2701"></a>        <span class="p">&amp;</span> <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2702"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span><span class="o">+</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)&amp;</span>
<a name="ln-2703"></a>        <span class="p">&amp;</span> <span class="o">+</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">))</span>
<a name="ln-2704"></a>      <span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span>
<a name="ln-2705"></a>    <span class="k">END SELECT</span>
<a name="ln-2706"></a>
<a name="ln-2707"></a>    <span class="c">! Remove small numbers from evaluation (due to limited decimal points for pi)</span>
<a name="ln-2708"></a>    <span class="k">IF</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">ErrorTolerance</span><span class="p">)</span> <span class="n">UnitVect</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2709"></a>    <span class="k">IF</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">ErrorTolerance</span><span class="p">)</span> <span class="n">UnitVect</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2710"></a>    <span class="k">IF</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">ErrorTolerance</span><span class="p">)</span> <span class="n">UnitVect</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2711"></a>
<a name="ln-2712"></a>   <span class="k">RETURN</span>
<a name="ln-2713"></a>
<a name="ln-2714"></a><span class="k">END FUNCTION </span><span class="n">WorldVectFromW6</span>
<a name="ln-2715"></a>
<a name="ln-2716"></a><span class="k">FUNCTION </span><span class="n">FindInBasis</span> <span class="p">(</span> <span class="n">RayToFind</span><span class="p">,</span> <span class="n">RadType</span><span class="p">,</span><span class="n">ISurf</span><span class="p">,</span><span class="n">IState</span><span class="p">,</span><span class="n">Basis</span><span class="p">,</span><span class="n">Theta</span><span class="p">,</span><span class="n">Phi</span><span class="p">)</span> <span class="k">RESULT</span> <span class="p">(</span> <span class="n">RayIndex</span> <span class="p">)</span>
<a name="ln-2717"></a>
<a name="ln-2718"></a>
<a name="ln-2719"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2720"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-2721"></a>          <span class="c">!       DATE WRITTEN August 2011</span>
<a name="ln-2722"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2723"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2724"></a>
<a name="ln-2725"></a>          <span class="c">! PURPOSE OF THIS FUNCTION:</span>
<a name="ln-2726"></a>          <span class="c">!</span>
<a name="ln-2727"></a>
<a name="ln-2728"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2729"></a>          <span class="c">! &lt;n/a&gt;</span>
<a name="ln-2730"></a>
<a name="ln-2731"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2732"></a>          <span class="c">! na</span>
<a name="ln-2733"></a>
<a name="ln-2734"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2735"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-2736"></a>
<a name="ln-2737"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2738"></a>
<a name="ln-2739"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2740"></a>
<a name="ln-2741"></a>  <span class="k">TYPE</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">RayToFind</span>    <span class="c">!Ray vector direction in world CS</span>
<a name="ln-2742"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">RadType</span>  <span class="c">!Type of radiation: Front_Incident, etc.</span>
<a name="ln-2743"></a>  <span class="c">! INTEGER, INTENT(IN)      ::  IWind  !window index in window list</span>
<a name="ln-2744"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">ISurf</span>  <span class="c">!Window Surface number</span>
<a name="ln-2745"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">IState</span>  <span class="c">!Complex Fenestration state number</span>
<a name="ln-2746"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">BasisStruct</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Basis</span>  <span class="c">!Complex Fenestration basis root</span>
<a name="ln-2747"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Theta</span>  <span class="c">!Theta value for ray</span>
<a name="ln-2748"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Phi</span>  <span class="c">!Phi value for ray</span>
<a name="ln-2749"></a>  <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">RayIndex</span>  <span class="c">!Index of ray in basis, zero if ray not in hemisphere</span>
<a name="ln-2750"></a>
<a name="ln-2751"></a>
<a name="ln-2752"></a>
<a name="ln-2753"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2754"></a>          <span class="c">! na</span>
<a name="ln-2755"></a>
<a name="ln-2756"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-2757"></a>          <span class="c">! na</span>
<a name="ln-2758"></a>
<a name="ln-2759"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-2760"></a>          <span class="c">! na</span>
<a name="ln-2761"></a>
<a name="ln-2762"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2763"></a>          <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">ITheta</span>  <span class="c">!Table index of Theta</span>
<a name="ln-2764"></a>          <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IPhi</span>  <span class="c">!Table index of Phi, given ITheta</span>
<a name="ln-2765"></a>          <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IThDn</span>  <span class="c">!Theta lower table index</span>
<a name="ln-2766"></a>          <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IThUp</span>  <span class="c">!Theta upper table index</span>
<a name="ln-2767"></a>          <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IPhDn</span>  <span class="c">!Phi lower table index</span>
<a name="ln-2768"></a>          <span class="kt">INTEGER</span>        <span class="kd">::</span>  <span class="n">IPhUp</span>  <span class="c">!Phi upper table index</span>
<a name="ln-2769"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="nb">Gamma</span>  <span class="c">!Gamma (tilt) angle of window</span>
<a name="ln-2770"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Alpha</span>  <span class="c">!Alpha (azimuth) angle of window</span>
<a name="ln-2771"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">DotProd</span>
<a name="ln-2772"></a>
<a name="ln-2773"></a>
<a name="ln-2774"></a>          <span class="n">Theta</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2775"></a>          <span class="n">Phi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2776"></a>
<a name="ln-2777"></a>          <span class="c">! Check if surface and vector are pointing in different directions</span>
<a name="ln-2778"></a>          <span class="n">DotProd</span> <span class="o">=</span> <span class="n">RayToFind</span> <span class="p">.</span><span class="n">dot</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">NewellSurfaceNormalVector</span>
<a name="ln-2779"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">DotProd</span> <span class="o">&lt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2780"></a><span class="k">            </span><span class="n">RayIndex</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2781"></a>            <span class="k">RETURN</span>
<a name="ln-2782"></a><span class="k">          END IF</span>
<a name="ln-2783"></a>
<a name="ln-2784"></a>          <span class="c">!get window tilt and azimuth</span>
<a name="ln-2785"></a>          <span class="nb">Gamma</span> <span class="o">=</span> <span class="n">DegToRadians</span><span class="o">*</span><span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Tilt</span>
<a name="ln-2786"></a>          <span class="n">Alpha</span> <span class="o">=</span> <span class="n">DegToRadians</span><span class="o">*</span><span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Azimuth</span>
<a name="ln-2787"></a>          <span class="c">!get the corresponding local Theta, Phi for ray</span>
<a name="ln-2788"></a>          <span class="k">CALL </span><span class="n">W6CoordsFromWorldVect</span> <span class="p">(</span><span class="n">RayToFind</span><span class="p">,</span> <span class="n">RadType</span><span class="p">,</span> <span class="nb">Gamma</span><span class="p">,</span> <span class="n">Alpha</span><span class="p">,</span><span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">)</span>
<a name="ln-2789"></a>
<a name="ln-2790"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">Theta</span> <span class="o">&gt;=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">Pi</span><span class="p">)</span> <span class="k">THEN</span>     <span class="c">!Ray was in not in correct hemisphere</span>
<a name="ln-2791"></a>              <span class="n">RayIndex</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2792"></a>              <span class="k">RETURN</span>
<a name="ln-2793"></a><span class="k">          </span><span class="n">ENDIF</span>
<a name="ln-2794"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">BasisSymmetryType</span> <span class="o">==</span> <span class="n">BasisSymmetry_None</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2795"></a>              <span class="c">!Search the basis thetas</span>
<a name="ln-2796"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">Theta</span> <span class="o">&lt;=</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2797"></a>              <span class="c">!Special case, Theta = 0.; this is always the first basis element</span>
<a name="ln-2798"></a>              <span class="n">RayIndex</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2799"></a>              <span class="k">RETURN</span>
<a name="ln-2800"></a><span class="k">              </span><span class="n">ENDIF</span>
<a name="ln-2801"></a>              <span class="c">!So here Theta &gt; 0</span>
<a name="ln-2802"></a>              <span class="c">!Note the table searches always go to the limit point, which is not itself a basis element</span>
<a name="ln-2803"></a>              <span class="n">IThUp</span> <span class="o">=</span> <span class="n">SearchAscTable</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span><span class="n">Basis</span><span class="p">%</span><span class="n">NThetas</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">Basis</span><span class="p">%</span><span class="n">Thetas</span><span class="p">)</span>
<a name="ln-2804"></a>              <span class="n">IThDn</span> <span class="o">=</span> <span class="n">IThUP</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-2805"></a>              <span class="c">!Determine which of the theta basis points is closer to the Theta value</span>
<a name="ln-2806"></a>              <span class="k">IF</span> <span class="p">(</span><span class="n">Theta</span> <span class="o">&lt;=</span> <span class="n">Basis</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span><span class="n">IThDn</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">)%</span><span class="n">UpprTheta</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2807"></a>                  <span class="c">!Note this will take care of both the special cases IThUp=2 and IThUp=NThetas +1</span>
<a name="ln-2808"></a>                  <span class="n">ITheta</span> <span class="o">=</span> <span class="n">IThDn</span>
<a name="ln-2809"></a>              <span class="k">ELSE</span>
<a name="ln-2810"></a><span class="k">                  </span><span class="n">ITheta</span> <span class="o">=</span> <span class="n">IThUp</span>
<a name="ln-2811"></a>              <span class="n">ENDIF</span>
<a name="ln-2812"></a>              <span class="c">!Now determine the Phi index</span>
<a name="ln-2813"></a>              <span class="k">IF</span> <span class="p">(</span><span class="n">Basis</span><span class="p">%</span><span class="n">NPhis</span><span class="p">(</span><span class="n">ITheta</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2814"></a>                  <span class="c">!Note that for W6 basis this can only happen for the first basis element</span>
<a name="ln-2815"></a>                  <span class="c">!If later bases are introduced this logic may have to be redesigned</span>
<a name="ln-2816"></a>                  <span class="n">RayIndex</span> <span class="o">=</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span><span class="n">ITheta</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2817"></a>                  <span class="k">RETURN</span>
<a name="ln-2818"></a><span class="k">              </span><span class="n">ENDIF</span>
<a name="ln-2819"></a>                  <span class="n">IPhUp</span> <span class="o">=</span> <span class="n">SearchAscTable</span><span class="p">(</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">Basis</span><span class="p">%</span><span class="n">NPhis</span><span class="p">(</span><span class="n">ITheta</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">,</span> <span class="n">Basis</span><span class="p">%</span><span class="n">Phis</span> <span class="p">(:</span> <span class="p">,</span> <span class="n">ITheta</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-2820"></a>                  <span class="n">IPhDn</span> <span class="o">=</span> <span class="n">IPhUp</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2821"></a>                  <span class="k">IF</span> <span class="p">(</span><span class="n">Phi</span> <span class="o">&lt;=</span> <span class="n">Basis</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span><span class="n">ITheta</span><span class="p">,</span> <span class="n">IPhDn</span><span class="p">)</span> <span class="p">)%</span><span class="n">UpprPhi</span>  <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2822"></a><span class="k">                      </span><span class="n">IPhi</span> <span class="o">=</span> <span class="n">IPhDn</span>
<a name="ln-2823"></a>                  <span class="k">ELSE</span>
<a name="ln-2824"></a><span class="k">                      IF</span> <span class="p">(</span><span class="n">IPhUp</span> <span class="o">==</span> <span class="n">Basis</span><span class="p">%</span><span class="n">NPhis</span><span class="p">(</span><span class="n">ITheta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2825"></a>                          <span class="c">! Phi is above upper limit for highest Phi basis element, meaning it is closer to 2Pi,</span>
<a name="ln-2826"></a>                          <span class="c">! i.e., the first element</span>
<a name="ln-2827"></a>                          <span class="n">IPhi</span> <span class="o">=</span><span class="mi">1</span>
<a name="ln-2828"></a>                      <span class="k">ELSE</span>
<a name="ln-2829"></a><span class="k">                          </span><span class="n">IPhi</span> <span class="o">=</span> <span class="n">IPhUp</span>
<a name="ln-2830"></a>                      <span class="n">ENDIF</span>
<a name="ln-2831"></a>                  <span class="n">ENDIF</span>
<a name="ln-2832"></a>                  <span class="n">RayIndex</span> <span class="o">=</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span> <span class="n">ITheta</span> <span class="p">,</span> <span class="n">IPhi</span> <span class="p">)</span>
<a name="ln-2833"></a>                  <span class="k">RETURN</span>
<a name="ln-2834"></a><span class="k">          ELSE IF</span><span class="p">(</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisSymmetryType</span> <span class="o">==</span> <span class="n">BasisSymmetry_Axisymmetric</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2835"></a>               <span class="c">!Search the basis thetas</span>
<a name="ln-2836"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">Theta</span> <span class="o">&lt;=</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2837"></a>                  <span class="c">!Special case, Theta = 0.; this is always the first basis element</span>
<a name="ln-2838"></a>                  <span class="n">RayIndex</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2839"></a>                  <span class="k">RETURN</span>
<a name="ln-2840"></a><span class="k">              </span><span class="n">ENDIF</span>
<a name="ln-2841"></a>              <span class="c">!So here Theta &gt; 0</span>
<a name="ln-2842"></a>              <span class="c">!Note the table searches always go to the limit point, which is not itself a basis element</span>
<a name="ln-2843"></a>              <span class="n">IThUp</span> <span class="o">=</span> <span class="n">SearchAscTable</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span><span class="n">Basis</span><span class="p">%</span><span class="n">NThetas</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">Basis</span><span class="p">%</span><span class="n">Thetas</span><span class="p">)</span>
<a name="ln-2844"></a>              <span class="n">IThDn</span> <span class="o">=</span> <span class="n">IThUP</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-2845"></a>              <span class="c">!Determine which of the theta basis points is closer to the Theta value</span>
<a name="ln-2846"></a>              <span class="k">IF</span> <span class="p">(</span><span class="n">Theta</span> <span class="o">&lt;=</span> <span class="n">Basis</span><span class="p">%</span><span class="n">Grid</span><span class="p">(</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span><span class="n">IThDn</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">)%</span><span class="n">UpprTheta</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2847"></a>                  <span class="c">!Note this will take care of both the special cases IThUp=2 and IThUp=NThetas +1</span>
<a name="ln-2848"></a>                  <span class="n">ITheta</span> <span class="o">=</span> <span class="n">IThDn</span>
<a name="ln-2849"></a>              <span class="k">ELSE</span>
<a name="ln-2850"></a><span class="k">                  </span><span class="n">ITheta</span> <span class="o">=</span> <span class="n">IThUp</span>
<a name="ln-2851"></a>              <span class="n">ENDIF</span>
<a name="ln-2852"></a>              <span class="n">RayIndex</span> <span class="o">=</span> <span class="n">Basis</span><span class="p">%</span><span class="n">BasisIndex</span><span class="p">(</span> <span class="n">ITheta</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<a name="ln-2853"></a>              <span class="k">RETURN</span>
<a name="ln-2854"></a><span class="k">          </span><span class="n">ENDIF</span>
<a name="ln-2855"></a>          <span class="c">!No other type is implemented</span>
<a name="ln-2856"></a>           <span class="n">RayIndex</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2857"></a>
<a name="ln-2858"></a>
<a name="ln-2859"></a>
<a name="ln-2860"></a>   <span class="k">RETURN</span>
<a name="ln-2861"></a>
<a name="ln-2862"></a><span class="k">END FUNCTION </span><span class="n">FindInBasis</span>
<a name="ln-2863"></a>
<a name="ln-2864"></a>
<a name="ln-2865"></a><span class="k">SUBROUTINE </span><span class="n">W6CoordsFromWorldVect</span> <span class="p">(</span><span class="n">RayVect</span><span class="p">,</span> <span class="n">RadType</span><span class="p">,</span> <span class="nb">Gamma</span><span class="p">,</span> <span class="n">Alpha</span><span class="p">,</span><span class="n">Theta</span><span class="p">,</span> <span class="n">Phi</span><span class="p">)</span>
<a name="ln-2866"></a>
<a name="ln-2867"></a>
<a name="ln-2868"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2869"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-2870"></a>          <span class="c">!       DATE WRITTEN   August 2011</span>
<a name="ln-2871"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2872"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2873"></a>
<a name="ln-2874"></a>          <span class="c">! PURPOSE OF THIS FUNCTION:</span>
<a name="ln-2875"></a>          <span class="c">! Invert the transformation from W6 to world coordinates to</span>
<a name="ln-2876"></a>          <span class="c">! calculate the theta, phi corresponding to a given ray direction</span>
<a name="ln-2877"></a>          <span class="c">! in the world coordinate system, for a window with a</span>
<a name="ln-2878"></a>          <span class="c">! given rotation and tilt (Gamma and Alpha)</span>
<a name="ln-2879"></a>          <span class="c">!  (needed for locating the sun direction in the local coordinate system)</span>
<a name="ln-2880"></a>
<a name="ln-2881"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2882"></a>          <span class="c">! &lt;n/a&gt;</span>
<a name="ln-2883"></a>
<a name="ln-2884"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2885"></a>          <span class="c">! na</span>
<a name="ln-2886"></a>
<a name="ln-2887"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2888"></a>   <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-2889"></a>
<a name="ln-2890"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2891"></a>
<a name="ln-2892"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2893"></a>
<a name="ln-2894"></a>  <span class="k">TYPE</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">RayVect</span>  <span class="c">!Ray vector direction in world CS</span>
<a name="ln-2895"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">RadType</span>  <span class="c">!Type of radiation: Front_Incident, etc.</span>
<a name="ln-2896"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="nb">Gamma</span>  <span class="c">!Surface tilt angle, world coordinate system</span>
<a name="ln-2897"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Alpha</span>  <span class="c">!Surface azimuth, world coordinate system</span>
<a name="ln-2898"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Theta</span>  <span class="c">!Polar angle in W6 Coords</span>
<a name="ln-2899"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">Phi</span>  <span class="c">!Azimuthal angle in W6 Coords</span>
<a name="ln-2900"></a>
<a name="ln-2901"></a>
<a name="ln-2902"></a>         <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2903"></a>          <span class="c">! na</span>
<a name="ln-2904"></a>
<a name="ln-2905"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-2906"></a>          <span class="c">! na</span>
<a name="ln-2907"></a>
<a name="ln-2908"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-2909"></a>          <span class="c">! na</span>
<a name="ln-2910"></a>
<a name="ln-2911"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2912"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>         <span class="kd">::</span>  <span class="n">W6x</span>  <span class="c">!W6 x coordinate unit vector</span>
<a name="ln-2913"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>         <span class="kd">::</span>  <span class="n">W6y</span>  <span class="c">!W6 y coordinate unit vector</span>
<a name="ln-2914"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>         <span class="kd">::</span>  <span class="n">W6z</span>  <span class="c">!W6 z coordinate unit vector</span>
<a name="ln-2915"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                <span class="kd">::</span>  <span class="n">Cost</span>  <span class="c">!Temp for cos theta</span>
<a name="ln-2916"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                <span class="kd">::</span>  <span class="n">Sint</span>  <span class="c">!Temp for sin theta</span>
<a name="ln-2917"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                <span class="kd">::</span>  <span class="n">Psi</span>  <span class="c">!Temp for phi before rotation adjustment</span>
<a name="ln-2918"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                     <span class="kd">::</span>  <span class="n">RdotX</span>   <span class="c">!Temp variable for manipulating .dot. produt</span>
<a name="ln-2919"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                     <span class="kd">::</span>  <span class="n">RdotY</span>   <span class="c">!Temp variable for manipulating .dot. produt</span>
<a name="ln-2920"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>                     <span class="kd">::</span>  <span class="n">RdotZ</span>   <span class="c">!Temp variable for manipulating .dot. produt</span>
<a name="ln-2921"></a>
<a name="ln-2922"></a>  <span class="c">! define the local W6 coordinate vectors</span>
<a name="ln-2923"></a>  <span class="n">W6x</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2924"></a>  <span class="n">W6x</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2925"></a>  <span class="n">W6x</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2926"></a>  <span class="n">W6y</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2927"></a>  <span class="n">W6y</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span>  <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2928"></a>  <span class="n">W6y</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span>
<a name="ln-2929"></a>  <span class="n">W6z</span><span class="p">%</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">SIN</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2930"></a>  <span class="n">W6z</span><span class="p">%</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="nb">SIN</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">Alpha</span><span class="p">)</span>
<a name="ln-2931"></a>  <span class="n">W6z</span><span class="p">%</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="nb">Gamma</span><span class="p">)</span>
<a name="ln-2932"></a>  <span class="k">SELECT CASE</span> <span class="p">(</span><span class="n">RadType</span><span class="p">)</span>
<a name="ln-2933"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Front_Incident</span><span class="p">)</span>
<a name="ln-2934"></a>      <span class="n">RdotZ</span> <span class="o">=</span><span class="n">W6z</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2935"></a>      <span class="n">Cost</span> <span class="o">=</span> <span class="o">-</span><span class="n">RdotZ</span>
<a name="ln-2936"></a>      <span class="n">Sint</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">Cost</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2937"></a>      <span class="n">Theta</span> <span class="o">=</span> <span class="nb">ACOS</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span>
<a name="ln-2938"></a>      <span class="n">RdotY</span> <span class="o">=</span> <span class="n">W6y</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2939"></a>      <span class="n">RdotX</span> <span class="o">=</span> <span class="n">W6x</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2940"></a>      <span class="n">Psi</span> <span class="o">=</span> <span class="n">ATAN2</span><span class="p">(</span><span class="o">-</span><span class="n">RdotY</span><span class="o">/</span><span class="n">Sint</span> <span class="p">,</span> <span class="o">-</span><span class="n">RdotX</span><span class="o">/</span><span class="n">Sint</span><span class="p">)</span>
<a name="ln-2941"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Psi</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2942"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span> <span class="o">+</span> <span class="n">Psi</span>
<a name="ln-2943"></a>      <span class="k">ELSE</span>
<a name="ln-2944"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Psi</span>
<a name="ln-2945"></a>      <span class="n">ENDIF</span>
<a name="ln-2946"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Front_Transmitted</span><span class="p">)</span>
<a name="ln-2947"></a>      <span class="n">Cost</span> <span class="o">=</span> <span class="n">W6z</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2948"></a>      <span class="n">Sint</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">Cost</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2949"></a>      <span class="n">Theta</span> <span class="o">=</span> <span class="nb">ACOS</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span>
<a name="ln-2950"></a>      <span class="n">RdotY</span> <span class="o">=</span> <span class="n">W6y</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2951"></a>      <span class="n">RdotX</span> <span class="o">=</span> <span class="n">W6x</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2952"></a>      <span class="n">Psi</span> <span class="o">=</span> <span class="n">ATAN2</span><span class="p">(</span><span class="n">RdotY</span><span class="o">/</span><span class="n">Sint</span> <span class="p">,</span> <span class="n">RdotX</span><span class="o">/</span><span class="n">Sint</span><span class="p">)</span>
<a name="ln-2953"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Psi</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2954"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span> <span class="o">+</span> <span class="n">Psi</span>
<a name="ln-2955"></a>      <span class="k">ELSE</span>
<a name="ln-2956"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Psi</span>
<a name="ln-2957"></a>      <span class="n">ENDIF</span>
<a name="ln-2958"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Front_Reflected</span><span class="p">)</span>
<a name="ln-2959"></a>      <span class="n">RdotZ</span> <span class="o">=</span><span class="n">W6z</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2960"></a>      <span class="n">Cost</span> <span class="o">=</span> <span class="o">-</span><span class="n">RdotZ</span>
<a name="ln-2961"></a>      <span class="n">Sint</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">Cost</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2962"></a>      <span class="n">Theta</span> <span class="o">=</span> <span class="nb">ACOS</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span>
<a name="ln-2963"></a>      <span class="n">RdotY</span> <span class="o">=</span> <span class="n">W6y</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2964"></a>      <span class="n">RdotX</span> <span class="o">=</span> <span class="n">W6x</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2965"></a>      <span class="n">Psi</span> <span class="o">=</span> <span class="n">ATAN2</span><span class="p">(</span><span class="n">RdotY</span><span class="o">/</span><span class="n">Sint</span> <span class="p">,</span> <span class="n">RdotX</span><span class="o">/</span><span class="n">Sint</span><span class="p">)</span>
<a name="ln-2966"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Psi</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2967"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span> <span class="o">+</span> <span class="n">Psi</span>
<a name="ln-2968"></a>      <span class="k">ELSE</span>
<a name="ln-2969"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Psi</span>
<a name="ln-2970"></a>      <span class="n">ENDIF</span>
<a name="ln-2971"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Back_Incident</span><span class="p">)</span>
<a name="ln-2972"></a>      <span class="n">Cost</span> <span class="o">=</span> <span class="n">W6z</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2973"></a>      <span class="n">Sint</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">Cost</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2974"></a>      <span class="n">Theta</span> <span class="o">=</span> <span class="nb">ACOS</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span>
<a name="ln-2975"></a>      <span class="n">RdotY</span> <span class="o">=</span> <span class="n">W6y</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2976"></a>      <span class="n">RdotX</span> <span class="o">=</span> <span class="n">W6x</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2977"></a>      <span class="n">Psi</span> <span class="o">=</span> <span class="n">ATAN2</span><span class="p">(</span><span class="o">-</span><span class="n">RdotY</span><span class="o">/</span><span class="n">Sint</span> <span class="p">,</span> <span class="o">-</span><span class="n">RdotX</span><span class="o">/</span><span class="n">Sint</span><span class="p">)</span>
<a name="ln-2978"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Psi</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2979"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Pi</span> <span class="o">+</span> <span class="n">Psi</span>
<a name="ln-2980"></a>      <span class="k">ELSE</span>
<a name="ln-2981"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Psi</span>
<a name="ln-2982"></a>      <span class="n">ENDIF</span>
<a name="ln-2983"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Back_Transmitted</span><span class="p">)</span>    <span class="c">!This is same as front reflected</span>
<a name="ln-2984"></a>      <span class="n">RdotZ</span> <span class="o">=</span> <span class="n">W6z</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2985"></a>      <span class="n">Cost</span> <span class="o">=</span> <span class="o">-</span><span class="n">RdotZ</span>
<a name="ln-2986"></a>      <span class="n">Sint</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">Cost</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2987"></a>      <span class="n">Theta</span> <span class="o">=</span> <span class="nb">ACOS</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span>
<a name="ln-2988"></a>      <span class="n">RdotY</span> <span class="o">=</span> <span class="n">W6y</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2989"></a>      <span class="n">RdotX</span> <span class="o">=</span> <span class="n">W6x</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2990"></a>      <span class="n">Psi</span> <span class="o">=</span> <span class="n">ATAN2</span><span class="p">(</span><span class="n">RdotY</span><span class="o">/</span><span class="n">Sint</span> <span class="p">,</span> <span class="n">RdotX</span><span class="o">/</span><span class="n">Sint</span><span class="p">)</span>
<a name="ln-2991"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Psi</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2992"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span> <span class="o">+</span> <span class="n">Psi</span>
<a name="ln-2993"></a>      <span class="k">ELSE</span>
<a name="ln-2994"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Psi</span>
<a name="ln-2995"></a>      <span class="n">ENDIF</span>
<a name="ln-2996"></a>    <span class="k">CASE</span> <span class="p">(</span><span class="n">Back_Reflected</span><span class="p">)</span>    <span class="c">!This is same as front transmitted</span>
<a name="ln-2997"></a>      <span class="n">Cost</span> <span class="o">=</span> <span class="n">W6z</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-2998"></a>      <span class="n">Sint</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">Cost</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2999"></a>      <span class="n">Theta</span> <span class="o">=</span> <span class="nb">ACOS</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span>
<a name="ln-3000"></a>      <span class="n">RdotY</span> <span class="o">=</span> <span class="n">W6y</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-3001"></a>      <span class="n">RdotX</span> <span class="o">=</span> <span class="n">W6x</span><span class="p">.</span><span class="n">dot</span><span class="p">.</span><span class="n">RayVect</span>
<a name="ln-3002"></a>      <span class="n">Psi</span> <span class="o">=</span> <span class="n">ATAN2</span><span class="p">(</span><span class="n">RdotY</span><span class="o">/</span><span class="n">Sint</span> <span class="p">,</span> <span class="n">RdotX</span><span class="o">/</span><span class="n">Sint</span><span class="p">)</span>
<a name="ln-3003"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Psi</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3004"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="mf">2.0d0</span><span class="o">*</span><span class="n">Pi</span> <span class="o">+</span> <span class="n">Psi</span>
<a name="ln-3005"></a>      <span class="k">ELSE</span>
<a name="ln-3006"></a><span class="k">          </span><span class="n">Phi</span> <span class="o">=</span> <span class="n">Psi</span>
<a name="ln-3007"></a>      <span class="n">ENDIF</span>
<a name="ln-3008"></a>   <span class="k">END SELECT</span>
<a name="ln-3009"></a><span class="k">   IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">rTinyValue</span><span class="p">)</span><span class="n">Cost</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3010"></a>   <span class="k">IF</span><span class="p">(</span><span class="n">Cost</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span> <span class="p">)</span> <span class="n">Theta</span> <span class="o">=</span> <span class="n">Pi</span> <span class="o">-</span> <span class="n">Theta</span>  <span class="c">!This signals ray out of hemisphere</span>
<a name="ln-3011"></a>   <span class="k">RETURN</span>
<a name="ln-3012"></a>
<a name="ln-3013"></a><span class="k">END SUBROUTINE </span><span class="n">W6CoordsFromWorldVect</span>
<a name="ln-3014"></a>
<a name="ln-3015"></a>
<a name="ln-3016"></a><span class="k">SUBROUTINE </span><span class="n">CalcComplexWindowThermal</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">,</span><span class="n">ConstrNum</span><span class="p">,</span><span class="n">HextConvCoeff</span><span class="p">,</span><span class="n">SurfInsideTemp</span><span class="p">,</span><span class="n">SurfOutsideTemp</span><span class="p">,</span><span class="n">SurfOutsideEmiss</span><span class="p">,</span><span class="n">CalcCondition</span><span class="p">)</span>
<a name="ln-3017"></a>
<a name="ln-3018"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3019"></a>          <span class="c">!       AUTHOR         B. Griffith</span>
<a name="ln-3020"></a>          <span class="c">!       DATE WRITTEN   October 2009</span>
<a name="ln-3021"></a>          <span class="c">!       MODIFIED       Simon Vidanovic</span>
<a name="ln-3022"></a>          <span class="c">!       RE-ENGINEERED  September 2011</span>
<a name="ln-3023"></a>
<a name="ln-3024"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3025"></a>          <span class="c">! wrapper between E+ and TARCOG</span>
<a name="ln-3026"></a>
<a name="ln-3027"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3028"></a>          <span class="c">! draft out an attempt for proof-of-concept, to reuse native TARCOG implementation</span>
<a name="ln-3029"></a>          <span class="c">! based off of 1-26-2009 version of WinCOG/TARCOG solution from Carli, Inc.</span>
<a name="ln-3030"></a>
<a name="ln-3031"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3032"></a>          <span class="c">! na</span>
<a name="ln-3033"></a>
<a name="ln-3034"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3035"></a>  <span class="c">!USE WindowTARCOGManager, ONLY: tarcog</span>
<a name="ln-3036"></a>  <span class="k">USE </span><span class="n">DataBSDFWindow</span>
<a name="ln-3037"></a>  <span class="k">USE </span><span class="n">DataZoneEquipment</span><span class="p">,</span> <span class="n">ONLY</span> <span class="p">:</span> <span class="n">ZoneEquipConfig</span>
<a name="ln-3038"></a>  <span class="k">USE </span><span class="n">DataLoopNode</span><span class="p">,</span>      <span class="n">ONLY</span> <span class="p">:</span> <span class="n">Node</span>
<a name="ln-3039"></a>  <span class="k">USE </span><span class="n">Psychrometrics</span><span class="p">,</span>    <span class="n">ONLY</span> <span class="p">:</span> <span class="n">PsyCpAirFnWTdb</span><span class="p">,</span><span class="n">PsyTdpFnWPb</span>
<a name="ln-3040"></a>  <span class="k">USE </span><span class="n">General</span><span class="p">,</span>           <span class="n">ONLY</span> <span class="p">:</span> <span class="n">InterpSlatAng</span> <span class="p">,</span> <span class="n">InterpSw</span> <span class="c">! Function for slat angle interpolation</span>
<a name="ln-3041"></a>  <span class="k">USE </span><span class="n">InputProcessor</span><span class="p">,</span>    <span class="n">ONLY</span> <span class="p">:</span> <span class="n">SameString</span>
<a name="ln-3042"></a>  <span class="k">USE </span><span class="n">DataHeatBalSurface</span><span class="p">,</span> <span class="n">ONLY</span> <span class="p">:</span> <span class="n">HcExtSurf</span>
<a name="ln-3043"></a>  <span class="k">USE </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">StefanBoltzmann</span>
<a name="ln-3044"></a>  <span class="k">USE </span><span class="n">TARCOGGassesParams</span><span class="p">,</span> <span class="n">ONLY</span> <span class="p">:</span> <span class="n">maxgas</span>
<a name="ln-3045"></a>  <span class="k">USE </span><span class="n">TARCOGParams</span><span class="p">,</span> <span class="n">ONLY</span> <span class="p">:</span> <span class="n">maxlay</span><span class="p">,</span> <span class="n">maxlay1</span>
<a name="ln-3046"></a>  <span class="k">USE </span><span class="n">DataHeatBalance</span><span class="p">,</span> <span class="n">ONLY</span> <span class="p">:</span> <span class="n">GasCoeffsAir</span><span class="p">,</span> <span class="n">SupportPillar</span>
<a name="ln-3047"></a>  <span class="k">USE </span><span class="n">TARCOGMain</span><span class="p">,</span> <span class="n">ONLY</span> <span class="p">:</span> <span class="n">TARCOG90</span>
<a name="ln-3048"></a>
<a name="ln-3049"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3050"></a>
<a name="ln-3051"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3052"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">SurfNum</span>         <span class="c">! Surface number</span>
<a name="ln-3053"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">CalcCondition</span>   <span class="c">! Calucation condition (summer, winter or no condition)</span>
<a name="ln-3054"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">ConstrNum</span>       <span class="c">! Construction number</span>
<a name="ln-3055"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">HextConvCoeff</span>   <span class="c">! Outside air film conductance coefficient</span>
<a name="ln-3056"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">SurfInsideTemp</span>  <span class="c">! Inside window surface temperature</span>
<a name="ln-3057"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">SurfOutsideTemp</span> <span class="c">! Outside surface temperature (C)</span>
<a name="ln-3058"></a>                                                        <span class="c">! (temperature of innermost face) [C]</span>
<a name="ln-3059"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">SurfOutsideEmiss</span>
<a name="ln-3060"></a>  <span class="c">!INTEGER, INTENT(IN)        :: CurrentThermalModelNumber</span>
<a name="ln-3061"></a>
<a name="ln-3062"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3063"></a>  <span class="c">!INTEGER,  PARAMETER :: maxlay = 100 ! maximum number of layers (including laminates)</span>
<a name="ln-3064"></a>  <span class="c">!INTEGER,  PARAMETER :: maxgas = 10  ! maximum number of individual gasses</span>
<a name="ln-3065"></a>  <span class="c">!INTEGER, PARAMETER :: maxlay1  = maxlay+1     ! maximum number of &#39;gaps&#39;, including in and out (maxlay+1)</span>
<a name="ln-3066"></a>  <span class="c">!REAL(r64), PARAMETER :: StefanBoltzmannConst = 5.6697d-8   ! Stefan-Boltzmann constant in W/(m2*K4)</span>
<a name="ln-3067"></a>
<a name="ln-3068"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:</span>
<a name="ln-3069"></a>          <span class="c">! na</span>
<a name="ln-3070"></a>
<a name="ln-3071"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:</span>
<a name="ln-3072"></a>          <span class="c">! na</span>
<a name="ln-3073"></a>
<a name="ln-3074"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3075"></a>
<a name="ln-3076"></a>  <span class="c">! TARCOG Inputs:</span>
<a name="ln-3077"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span>  <span class="n">nlayer</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">!    Number of glazing layers</span>
<a name="ln-3078"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span>  <span class="n">iwd</span>    <span class="o">=</span> <span class="mi">0</span> <span class="c">!    Wind direction:  0 - windward, 1 - leeward</span>
<a name="ln-3079"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tout</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Outdoor temperature [K]</span>
<a name="ln-3080"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tind</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Indoor temperature [K]</span>
<a name="ln-3081"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">trmin</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Indoor mean radiant temperature [K]</span>
<a name="ln-3082"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">wso</span>    <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Outdoor wind speed [m/s]</span>
<a name="ln-3083"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">wsi</span>    <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Inside forced air speed [m/s]</span>
<a name="ln-3084"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">dir</span>    <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!    Direct solar radiation [W/m^2]</span>
<a name="ln-3085"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span>  <span class="n">isky</span>   <span class="o">=</span> <span class="mi">0</span>  <span class="c">!    Flag for sky temperature (Tsky) and sky emittance (esky)</span>
<a name="ln-3086"></a>                            <span class="c">!                      0 - both tsky and esky are specified</span>
<a name="ln-3087"></a>                            <span class="c">!                      1 - tsky specified, esky = 1</span>
<a name="ln-3088"></a>                            <span class="c">!                      2 - Swinbank model for effective sky emittance</span>
<a name="ln-3089"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">tsky</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Night sky temperature [K]</span>
<a name="ln-3090"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">esky</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Effective night sky emittance</span>
<a name="ln-3091"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">fclr</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Fraction of sky that is clear</span>
<a name="ln-3092"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">VacuumPressure</span> <span class="c">! maximal pressure for gas to be considered as vacuum [Pa]</span>
<a name="ln-3093"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">VacuumMaxGapThickness</span>  <span class="c">! maximal gap thickness for which vacuum calculation will work without issuing</span>
<a name="ln-3094"></a>                                       <span class="c">! warning message</span>
<a name="ln-3095"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">gap</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of gap widths [m] {maxlay}</span>
<a name="ln-3096"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">thick</span>    <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of glass thicknesses [m] {maxlay}</span>
<a name="ln-3097"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">scon</span>     <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of conductivities of each glazing layer  [W/m.K] {maxlay}</span>
<a name="ln-3098"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">)</span> <span class="kd">::</span>  <span class="n">tir</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of IR transmittances of each layer {2*maxlay - 2 surfaces per layer}</span>
<a name="ln-3099"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">)</span> <span class="kd">::</span>  <span class="n">emis</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of IR emittances of each surface {2*maxlay - 2 surfaces per layer}</span>
<a name="ln-3100"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SupportPlr</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c">! Shows whether or not gap have support pillar</span>
<a name="ln-3101"></a>                                                    <span class="c">! 0 - does not have support pillar</span>
<a name="ln-3102"></a>                                                    <span class="c">! 1 - have support pillar</span>
<a name="ln-3103"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarSpacing</span> <span class="o">=</span> <span class="mf">0.0d0</span>        <span class="c">! Pillar spacing for each gap (used in case there is support pillar)</span>
<a name="ln-3104"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PillarRadius</span> <span class="o">=</span> <span class="mf">0.0d0</span>         <span class="c">! Pillar radius for each gap (used in case there is support pillar)</span>
<a name="ln-3105"></a>
<a name="ln-3106"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="kd">::</span>   <span class="n">totsol</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Total solar transmittance of the IGU</span>
<a name="ln-3107"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="kd">::</span>   <span class="n">tilt</span>    <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Window tilt [degrees]</span>
<a name="ln-3108"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">asol</span> <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!    Vector of Absorbed solar energy fractions for each layer {maxlay}</span>
<a name="ln-3109"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="kd">::</span>    <span class="n">height</span> <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">! IGU cavity height [m]</span>
<a name="ln-3110"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="kd">::</span>    <span class="n">heightt</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Total window height [m]</span>
<a name="ln-3111"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="kd">::</span>    <span class="n">width</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Window width [m]</span>
<a name="ln-3112"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">presure</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!   Vector of gas pressures in gaps [N/m^2] {maxlay+1}</span>
<a name="ln-3113"></a>
<a name="ln-3114"></a>  <span class="c">!Deflection</span>
<a name="ln-3115"></a>  <span class="c">!Tarcog requires deflection as input parameters.  Deflection is NOT used in EnergyPlus simulations</span>
<a name="ln-3116"></a>  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">CalcDeflection</span>     <span class="c">! Deflection calculation flag:</span>
<a name="ln-3117"></a>                                <span class="c">!    0 - no deflection calculations</span>
<a name="ln-3118"></a>                                <span class="c">!    1 - perform deflection calculation (input is Pressure/Temp)</span>
<a name="ln-3119"></a>                                <span class="c">!    2 - perform deflection calculation (input is measured deflection)</span>
<a name="ln-3120"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pa</span>      <span class="c">! Atmospheric (outside/inside) pressure (used onlu if CalcDeflection = 1)</span>
<a name="ln-3121"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Pini</span>    <span class="c">! Initial presssure at time of fabrication (used only if CalcDeflection = 1)</span>
<a name="ln-3122"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tini</span>   <span class="c">! Initial temperature at time of fabrication (used only if CalcDeflection = 1)</span>
<a name="ln-3123"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">GapDefMax</span>    <span class="c">! Vector of gap widths in deflected state.  It will be used as input</span>
<a name="ln-3124"></a>                                                <span class="c">! if CalcDeflection = 2. In case CalcDeflection = 1 it will return recalculated</span>
<a name="ln-3125"></a>                                                <span class="c">! gap widths. [m]</span>
<a name="ln-3126"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">YoungsMod</span>      <span class="c">! Vector of Young&#39;s modulus. [m]</span>
<a name="ln-3127"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PoissonsRat</span>    <span class="c">! Vector of Poisson&#39;s Ratios. [m]</span>
<a name="ln-3128"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LayerDef</span>       <span class="c">! Vector of layers deflection. [m]</span>
<a name="ln-3129"></a>
<a name="ln-3130"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">)</span>   <span class="kd">::</span>  <span class="n">iprop</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">!  Matrix of gas codes - see above {maxgap x maxgas}</span>
<a name="ln-3131"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxgas</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">frct</span>  <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!  Matrix of mass percentages in gap mixtures  {maxgap x maxgas}</span>
<a name="ln-3132"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">gcon</span>  <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!  Matrix of constants for gas conductivity calc</span>
<a name="ln-3133"></a>                                                            <span class="c">!     (A, B, C for max of 10 gasses) {maxgas x 3}</span>
<a name="ln-3134"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">gvis</span>  <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!  Matrix of constants for gas dynamic viscosity calc</span>
<a name="ln-3135"></a>                                                            <span class="c">!     (A, B, C for max of 10 gasses) {maxgas x 3}</span>
<a name="ln-3136"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxgas</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">gcp</span>   <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!  Matrix of constants for gas specific heat calc at constant pressure</span>
<a name="ln-3137"></a>                                                            <span class="c">!     (A, B, C for max of 10 gasses) {maxgas x 3}</span>
<a name="ln-3138"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span>           <span class="kd">::</span>  <span class="n">wght</span>   <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!  Vector of Molecular weights for gasses {maxgas}</span>
<a name="ln-3139"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxgas</span><span class="p">)</span>           <span class="kd">::</span>  <span class="n">gama</span>   <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!  Vector of spefic heat ration for low pressure calc {maxgas}</span>
<a name="ln-3140"></a>  <span class="kt">LOGICAL</span>                                 <span class="kd">::</span>  <span class="n">feedData</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span> <span class="c">!flag to notify if data needs to be feed into gas arrays</span>
<a name="ln-3141"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>         <span class="kd">::</span>  <span class="n">nmix</span>   <span class="o">=</span> <span class="mi">0</span>      <span class="c">!  Vector of number of gasses in gas mixture of each gap {maxlay+1}</span>
<a name="ln-3142"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="kd">::</span>   <span class="n">hin</span>  <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Indoor combined film coefficient (if non-zero) [W/m^2.K]</span>
<a name="ln-3143"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="kd">::</span>   <span class="n">hout</span> <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Outdoor combined film coefficient (if non-zero) [W/m^2.K]</span>
<a name="ln-3144"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">ibc</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!  Vector of boundary condition flags (ibc(1) - outdoor, ibc(2) - indoor)</span>
<a name="ln-3145"></a>                                      <span class="c">!             0 - h to be calculated;</span>
<a name="ln-3146"></a>                                      <span class="c">!             1 - combined film coefficient (h) prescribed;</span>
<a name="ln-3147"></a>                                      <span class="c">!             2 - convective film coefficient (hc) prescribed.</span>
<a name="ln-3148"></a>                                      <span class="c">!           Also used in old algorithms for calculating h, accessible through</span>
<a name="ln-3149"></a>                                      <span class="c">!           negative values for flags:</span>
<a name="ln-3150"></a>                                      <span class="c">!             -1  - old SPC142 correlation</span>
<a name="ln-3151"></a>                                      <span class="c">!             -2  - Klems-Yazdanian correlation (applicable to outdoor only)</span>
<a name="ln-3152"></a>                                      <span class="c">!             -3  - Kimura correlation (applicable to outdoor only)</span>
<a name="ln-3153"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Atop</span> <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Vector with areas of top openings - between SD layers and top of</span>
<a name="ln-3154"></a>                                                <span class="c">!               glazing cavity, for each layer [m^2] {maxlay} *</span>
<a name="ln-3155"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Abot</span> <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Vector with areas of bottom openings - between SD layers</span>
<a name="ln-3156"></a>                                                <span class="c">!               and bottom of glazing cavity [m^2] {maxlay}</span>
<a name="ln-3157"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Al</span>   <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Vector with areas of left-hand side openings - between SD layers</span>
<a name="ln-3158"></a>                                                <span class="c">!               and left end of glazing cavity [m^2] {maxlay}</span>
<a name="ln-3159"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ar</span>   <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Vector of areas of right-hand side openings - between SD layers</span>
<a name="ln-3160"></a>                                                <span class="c">!               and right end of glazing cavity [m^2] {maxlay}</span>
<a name="ln-3161"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ah</span>   <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Vector of total areas of holes for each SD [m^2] {maxlay}</span>
<a name="ln-3162"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatThick</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!  Thickness of the slat material [m] {maxlay} **</span>
<a name="ln-3163"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatWidth</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!  Slat width [m] {maxlay}</span>
<a name="ln-3164"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatAngle</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!  Slat tilt angle [deg] {maxlay}</span>
<a name="ln-3165"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatCond</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!  Conductivity of the slat material [W/m.K] {maxlay}</span>
<a name="ln-3166"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatSpacing</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Distance between slats [m] {maxlay}</span>
<a name="ln-3167"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SlatCurve</span> <span class="o">=</span> <span class="mf">0.0D0</span>   <span class="c">! Curvature radius of the slat [m] {maxlay}</span>
<a name="ln-3168"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vvent</span>   <span class="o">=</span> <span class="mf">0.0D0</span>   <span class="c">!   Vector of velocities for forced ventilation, for each gap, and for</span>
<a name="ln-3169"></a>                                                      <span class="c">!               outdoor and indoor environment [m/s] {maxlay+1} ***</span>
<a name="ln-3170"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tvent</span>   <span class="o">=</span> <span class="mf">0.0D0</span>   <span class="c">!  Vector of temperatures of ventilation gas for forced ventilation, for each</span>
<a name="ln-3171"></a>                                                      <span class="c">!  gap, and for outdoor and indoor environment [K] {maxlay+1}</span>
<a name="ln-3172"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">LayerType</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">!  Glazing layer type flag {maxlay}:</span>
<a name="ln-3173"></a>                                              <span class="c">!                 0 - Specular layer,</span>
<a name="ln-3174"></a>                                              <span class="c">!                 1 - Venetian blind (SD)</span>
<a name="ln-3175"></a>                                              <span class="c">!                 2 - Woven shade (SD) (not implemented)</span>
<a name="ln-3176"></a>                                              <span class="c">!                 3 - Diffuse shade (not implemented)</span>
<a name="ln-3177"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">nslice</span>   <span class="o">=</span> <span class="mi">0</span>  <span class="c">!   Vector of numbers of slices in a laminated glazing layers</span>
<a name="ln-3178"></a>                                                <span class="c">!   (0 - monolithic layer) {maxlay}</span>
<a name="ln-3179"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateA</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!  Left-hand side array for creating slice equations {maxlay}</span>
<a name="ln-3180"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">LaminateB</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!  Right-hand side array for creating slice equations {maxlay}</span>
<a name="ln-3181"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sumsol</span> <span class="o">=</span> <span class="mf">0.0D0</span>    <span class="c">!  Array of absorbed solar energy fractions for each laminated</span>
<a name="ln-3182"></a>                                                  <span class="c">!               glazing layer [W/m^2] {maxlay}</span>
<a name="ln-3183"></a>  <span class="kt">INTEGER</span> <span class="kd">::</span>   <span class="n">standard</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">!   Calculation standard switch:</span>
<a name="ln-3184"></a>                            <span class="c">!                 1 - ISO 15099,</span>
<a name="ln-3185"></a>                            <span class="c">!                 2 - EN673 / ISO 10292 Declared,</span>
<a name="ln-3186"></a>                            <span class="c">!                 3 - EN673 / ISO 10292 Design.</span>
<a name="ln-3187"></a>  <span class="kt">INTEGER</span> <span class="kd">::</span>    <span class="n">ThermalMod</span>  <span class="o">=</span> <span class="mi">0</span> <span class="c">! Thermal model:</span>
<a name="ln-3188"></a>                                <span class="c">!                 0 - ISO15099</span>
<a name="ln-3189"></a>                                <span class="c">!                 1 - Scaled Cavity Width (SCW)</span>
<a name="ln-3190"></a>                                <span class="c">!                 2 - Convective Scalar Model (CSM)</span>
<a name="ln-3191"></a>  <span class="kt">INTEGER</span> <span class="kd">::</span>   <span class="n">Debug_mode</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! Switch for debug output files:</span>
<a name="ln-3192"></a>                              <span class="c">!                 0 - don&#39;t create debug output files</span>
<a name="ln-3193"></a>                              <span class="c">!                 1 - append results to existing debug output file (where applicable)</span>
<a name="ln-3194"></a>                              <span class="c">!                 2 - store results in a new debug output file</span>
<a name="ln-3195"></a>  <span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">Debug_dir</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>  <span class="c">! Target directory for debug files (pointer to a character array)</span>
<a name="ln-3196"></a>  <span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">Debug_file</span> <span class="o">=</span> <span class="s1">&#39;Test&#39;</span>  <span class="c">! Template file name used to create debug output files</span>
<a name="ln-3197"></a>  <span class="kt">INTEGER</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span>    <span class="n">Window_ID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">!  ID of the window (long integer value, passed by W6)</span>
<a name="ln-3198"></a>  <span class="kt">INTEGER</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span>    <span class="n">IGU_ID</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! ID of the IGU (long integer value, passed by W6)</span>
<a name="ln-3199"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">SDScalar</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!  SD convection factor (value between 0 and 1)</span>
<a name="ln-3200"></a>                                    <span class="c">!                 0.0 - No SD layer</span>
<a name="ln-3201"></a>                                    <span class="c">!                 1.0 - Closed SD</span>
<a name="ln-3202"></a>  <span class="c">!</span>
<a name="ln-3203"></a>  <span class="c">!               Notes:   * vvent, tvent, Atop, Abot, Al, Ar and Ah are considered for SD layers only.</span>
<a name="ln-3204"></a>  <span class="c">!                       ** SlatThick, SlatWidth, SlatAngle, SlatCond, SlatSpacing, SlatCurve</span>
<a name="ln-3205"></a>  <span class="c">!                          are used for Venetian blind layers only.</span>
<a name="ln-3206"></a>  <span class="c">!                      *** For vvent &amp; tvent: vvent(1) - exterior, vvent(nlayer+1) - interior.</span>
<a name="ln-3207"></a>  <span class="c">!                     **** Forced ventilation calculation is not active at this time.</span>
<a name="ln-3208"></a>  <span class="c">!</span>
<a name="ln-3209"></a>  <span class="c">! TARCOG Output:</span>
<a name="ln-3210"></a>
<a name="ln-3211"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">)</span> <span class="kd">::</span>   <span class="n">theta</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of average temperatures of glazing surfaces [K] {2*maxlay}</span>
<a name="ln-3212"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">q</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!   Vector of various heat fluxes [W/m^2] {2*maxlay+1},</span>
<a name="ln-3213"></a>                                                        <span class="c">!    depending on element index:</span>
<a name="ln-3214"></a>                                                        <span class="c">!    1  = qout (heat flux from outer-most glazing surface to outdoor space)</span>
<a name="ln-3215"></a>                                                        <span class="c">!   2*i = qpane(i) (heat flux through i-th glazing layer)</span>
<a name="ln-3216"></a>                                                        <span class="c">! 2*i-1 = qgap(i) (heat flux from i-th glazing cavity to indoor-faced</span>
<a name="ln-3217"></a>                                                        <span class="c">!          surface of the adjacent glazing layer)</span>
<a name="ln-3218"></a>                                                        <span class="c">! 2*nlayer+1 = qin (heat flux from indoor space to inner-most glazing</span>
<a name="ln-3219"></a>                                                        <span class="c">!              surface)</span>
<a name="ln-3220"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qprim</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of heat fluxes from the outdoor-faced surfaces of glazing layers</span>
<a name="ln-3221"></a>                                                        <span class="c">!    towards the adjacent glazing cavity [W/m2]</span>
<a name="ln-3222"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">qv</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!     Vector of heat fluxes to each gap by ventillation [W/m^2]</span>
<a name="ln-3223"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ufactor</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Center of glass U-value [W/m^2.K]</span>
<a name="ln-3224"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sc</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!        Shading Coefficient</span>
<a name="ln-3225"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hflux</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!     Net heat flux between room and window [W/m^2]</span>
<a name="ln-3226"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rhum</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Relative humidity at inner-most surface for condensation</span>
<a name="ln-3227"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">rhout</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Relative humidity at outer-most surface for condensation</span>
<a name="ln-3228"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">hcin</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Indoor convective surface heat transfer coefficient  [W/m^2.K]</span>
<a name="ln-3229"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">hcout</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Outdoor convective surface heat transfer coefficient [W/m^2.K]</span>
<a name="ln-3230"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">hrin</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Indoor radiative surface heat transfer coefficient [W/m^2.K]</span>
<a name="ln-3231"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">hrout</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Outdoor radiative surface heat transfer coefficient [W/m^2.K]</span>
<a name="ln-3232"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">hcgap</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!      Convective part of gap effective conductivity {maxlay}</span>
<a name="ln-3233"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay1</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">hrgap</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Radiative part of gap effective conductivity (including in and out)</span>
<a name="ln-3234"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">shgc</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Solar heat gain coefficient - per ISO 15099</span>
<a name="ln-3235"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">shgct</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Solar heat gain coefficient - per old procedure</span>
<a name="ln-3236"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">tamb</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!       Outdoor environmental temperature [K]</span>
<a name="ln-3237"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>     <span class="n">troom</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!      Indoor environmental temperature [K]</span>
<a name="ln-3238"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>     <span class="n">hg</span>    <span class="o">=</span> <span class="mf">0.0D0</span>  <span class="c">!      Gas conductance of the glazing cavity</span>
<a name="ln-3239"></a>                                                      <span class="c">!         [W/m^2.K] - EN673 and ISO 10292 procedure</span>
<a name="ln-3240"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>     <span class="n">hr</span>   <span class="o">=</span> <span class="mf">0.0D0</span>   <span class="c">!      Radiation conductance of the glazing cavity</span>
<a name="ln-3241"></a>                                                      <span class="c">!         [W/m^2.K] - EN673 and ISO 10292 procedure</span>
<a name="ln-3242"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span> <span class="kd">::</span>     <span class="n">hs</span>  <span class="o">=</span> <span class="mf">0.0D0</span>    <span class="c">!     Thermal conductance of the glazing cavity</span>
<a name="ln-3243"></a>                                                      <span class="c">!         [W/m^2.K] - EN673 and ISO 10292 procedure</span>
<a name="ln-3244"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>     <span class="n">he</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!         External heat transfer coefficient [W/m^2.K] - EN673 and ISO 10292 procedure</span>
<a name="ln-3245"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>     <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!          Internal heat transfer coefficient [W/m^2.K] - EN673 and ISO 10292 procedure</span>
<a name="ln-3246"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Ra</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!         Vector of Rayleigh numbers, for each gap {maxlay}</span>
<a name="ln-3247"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Nu</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!         Vector of Nusselt numbers, for each gap {maxlay}</span>
<a name="ln-3248"></a>  <span class="kt">INTEGER</span> <span class="kd">::</span>   <span class="n">nperr</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">!               Error code</span>
<a name="ln-3249"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">ShadeEmisRatioOut</span> <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Ratio of modified to glass emissivity at the outermost glazing surface</span>
<a name="ln-3250"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">ShadeEmisRatioIn</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!   Ratio of modified to glass emissivity at the innermost glazing surface</span>
<a name="ln-3251"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">ShadeHcRatioOut</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Ratio of modified to unshaded Hc at the outermost glazing surface</span>
<a name="ln-3252"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">ShadeHcRatioIn</span>    <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Ratio of modified to unshaded Hc at the innermost glazing surface</span>
<a name="ln-3253"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">HcUnshadedOut</span>     <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Hc value at outdoor surface of an unshaded subsystem [W/m^2.K]</span>
<a name="ln-3254"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span>   <span class="n">HcUnshadedIn</span>     <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!     Hc value at indoor surface of an unshaded subsystem [W/m^2.K]</span>
<a name="ln-3255"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">Keff</span>   <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">!    Vector of keff values for gaps [W/m.K] {maxlay}</span>
<a name="ln-3256"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxlay</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="kd">::</span>    <span class="n">ShadeGapKeffConv</span>  <span class="o">=</span> <span class="mf">0.0D0</span> <span class="c">! Vector of convective keff values for areas above/below</span>
<a name="ln-3257"></a>                                                                   <span class="c">! SD layers [W/m.K] {maxlay-1}</span>
<a name="ln-3258"></a>
<a name="ln-3259"></a>
<a name="ln-3260"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">ZoneNum</span>                      <span class="c">! Zone number corresponding to SurfNum</span>
<a name="ln-3261"></a>
<a name="ln-3262"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">locTCSpecTemp</span>                <span class="c">! The temperature corresponding to the specified optical properties of the TC layer</span>
<a name="ln-3263"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">locTCLayerTemp</span>               <span class="c">! TC layer temperature at each time step. C</span>
<a name="ln-3264"></a>  <span class="kt">LOGICAL</span>   <span class="kd">::</span> <span class="n">locTCFlag</span> <span class="o">=</span><span class="p">.</span><span class="n">False</span><span class="p">.</span>           <span class="c">! True if this surface is a TC window</span>
<a name="ln-3265"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">deltaTemp</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3266"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">i</span>
<a name="ln-3267"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">iMinDT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3268"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">IDConst</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3269"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dT0</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3270"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dT1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3271"></a>
<a name="ln-3272"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">IConst</span>                       <span class="c">! Construction number</span>
<a name="ln-3273"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">TotLay</span>                       <span class="c">! Total number of layers in a construction</span>
<a name="ln-3274"></a>                                            <span class="c">!   (sum of solid layers and gap layers)</span>
<a name="ln-3275"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">Lay</span>                          <span class="c">! Layer number</span>
<a name="ln-3276"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">LayPtr</span>                       <span class="c">! Material number for a layer</span>
<a name="ln-3277"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">ShadingLayPtr</span>                <span class="c">! Shading layer pointer for effective temperature calculations</span>
<a name="ln-3278"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">GlassLayPtr</span>                  <span class="c">! Glass layer pointer for effective temperature calculations</span>
<a name="ln-3279"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">EpsGlassIR</span>
<a name="ln-3280"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">RhoGlassIR</span>
<a name="ln-3281"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">TauShadeIR</span>
<a name="ln-3282"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">EpsShadeIR</span>
<a name="ln-3283"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">RhoShadeIR</span>
<a name="ln-3284"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">IGlass</span>                       <span class="c">! glass layer number (1,2,3,...)</span>
<a name="ln-3285"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">IGap</span>                         <span class="c">! Gap layer number (1,2,...)</span>
<a name="ln-3286"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">ShadeLayPtr</span>                  <span class="c">! Material number corresponding to a shade layer</span>
<a name="ln-3287"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">TotGlassLay</span>                  <span class="c">! Total number of glass layers in a construction</span>
<a name="ln-3288"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">BlNum</span>                        <span class="c">! Blind number</span>
<a name="ln-3289"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">ZoneEquipConfigNum</span>
<a name="ln-3290"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">NodeNum</span>
<a name="ln-3291"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SumSysMCp</span>                    <span class="c">! Zone sum of air system MassFlowRate*Cp</span>
<a name="ln-3292"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SumSysMCpT</span>                   <span class="c">! Zone sum of air system MassFlowRate*Cp*T</span>
<a name="ln-3293"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">MassFlowRate</span>
<a name="ln-3294"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NodeTemp</span>
<a name="ln-3295"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CpAir</span>
<a name="ln-3296"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">RefAirTemp</span> <span class="c">! reference air temperatures</span>
<a name="ln-3297"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">tmpGasType</span>
<a name="ln-3298"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">k</span>                            <span class="c">! Layer counter</span>
<a name="ln-3299"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">SurfNumAdj</span>                   <span class="c">! An interzone surface&#39;s number in the adjacent zone</span>
<a name="ln-3300"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">ZoneNumAdj</span>                   <span class="c">! An interzone surface&#39;s adjacent zone number</span>
<a name="ln-3301"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">ShadeFlag</span>                    <span class="c">! Flag indicating whether shade or blind is on, and shade/blind position</span>
<a name="ln-3302"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">imix</span>
<a name="ln-3303"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">EffShBlEmiss</span>                 <span class="c">! Effective interior shade or blind emissivity</span>
<a name="ln-3304"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">EffGlEmiss</span>                   <span class="c">! Effective inside glass emissivity when interior shade or blind</span>
<a name="ln-3305"></a>
<a name="ln-3306"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">IncidentSolar</span>         <span class="c">! Solar incident on outside of window (W)</span>
<a name="ln-3307"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ConvHeatFlowNatural</span>   <span class="c">! Convective heat flow from gap between glass and interior shade or blind (W)</span>
<a name="ln-3308"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ShadeArea</span>             <span class="c">! shade/blind area (m2)</span>
<a name="ln-3309"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">sconsh</span>                <span class="c">! shade/blind conductance (W/m2-K)</span>
<a name="ln-3310"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">CondHeatGainShade</span>     <span class="c">! Conduction through shade/blind, outside to inside (W)</span>
<a name="ln-3311"></a>
<a name="ln-3312"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ShGlReflFacIR</span>         <span class="c">! Factor for long-wave inter-reflection between shade/blind and adjacent glass</span>
<a name="ln-3313"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">RhoGlIR1</span><span class="p">,</span><span class="n">RhoGlIR2</span>     <span class="c">! Long-wave reflectance of glass surface facing shade/blind; 1=exterior shade/blind,</span>
<a name="ln-3314"></a>                                             <span class="c">!  2=interior shade/blind</span>
<a name="ln-3315"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">RhoShIR1</span><span class="p">,</span><span class="n">RhoShIR2</span>     <span class="c">! Long-wave reflectance of shade/blind surface facing glass; 1=interior shade/blind,</span>
<a name="ln-3316"></a>                                             <span class="c">!  2=exterior shade/blind</span>
<a name="ln-3317"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">EpsShIR1</span><span class="p">,</span><span class="n">EpsShIR2</span>     <span class="c">! Long-wave emissivity of shade/blind surface facing glass; 1=interior shade/blind,</span>
<a name="ln-3318"></a>                                             <span class="c">!  2=exterior shade/blind</span>
<a name="ln-3319"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">TauShIR</span>               <span class="c">! Long-wave transmittance of isolated shade/blind</span>
<a name="ln-3320"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">NetIRHeatGainShade</span>    <span class="c">! Net IR heat gain to zone from interior shade/blind (W)</span>
<a name="ln-3321"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">NetIRHeatGainGlass</span>    <span class="c">! Net IR heat gain to zone from shade/blind side of glass when interior</span>
<a name="ln-3322"></a>                                             <span class="c">!  shade/blind is present. Zero if shade/blind has zero IR transmittance (W)</span>
<a name="ln-3323"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ConvHeatGainFrZoneSideOfShade</span> <span class="c">! Convective heat gain to zone from side of interior shade facing zone (W)</span>
<a name="ln-3324"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ConvHeatGainFrZoneSideOfGlass</span> <span class="c">! Convective heat gain to zone from side of glass facing zone when</span>
<a name="ln-3325"></a>                                                   <span class="c">!  no interior shade/blind is present (W)</span>
<a name="ln-3326"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">CondHeatGainGlass</span>     <span class="c">! Conduction through inner glass layer, outside to inside (W)</span>
<a name="ln-3327"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">TotAirflowGap</span>         <span class="c">! Total volumetric airflow through window gap (m3/s)</span>
<a name="ln-3328"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">TAirflowGapOutlet</span>     <span class="c">! Temperature of air leaving airflow gap between glass panes (K)</span>
<a name="ln-3329"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">TAirflowGapOutletC</span>    <span class="c">! Temperature of air leaving airflow gap between glass panes (C)</span>
<a name="ln-3330"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ConvHeatFlowForced</span>    <span class="c">! Convective heat flow from forced airflow gap (W)</span>
<a name="ln-3331"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">InletAirHumRat</span>        <span class="c">! Humidity ratio of air from window gap entering fan</span>
<a name="ln-3332"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ZoneTemp</span>              <span class="c">! Zone air temperature (C)</span>
<a name="ln-3333"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">CpAirOutlet</span>           <span class="c">! Heat capacity of air from window gap (J/kg-K)</span>
<a name="ln-3334"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">CpAirZone</span>             <span class="c">! Heat capacity of zone air (J/kg-K)</span>
<a name="ln-3335"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ConvHeatGainToZoneAir</span> <span class="c">! Convective heat gain to zone air from window gap airflow (W)</span>
<a name="ln-3336"></a>  <span class="kt">INTEGER</span>           <span class="kd">::</span> <span class="n">ConstrNumSh</span>           <span class="c">! Construction number with shading device</span>
<a name="ln-3337"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">TransDiff</span>             <span class="c">! Diffuse shortwave transmittance</span>
<a name="ln-3338"></a>  <span class="kt">INTEGER</span>           <span class="kd">::</span> <span class="n">CalcSHGC</span> <span class="o">=</span> <span class="mi">0</span>          <span class="c">! SHGC calculations are not necessary for E+ run</span>
<a name="ln-3339"></a>  <span class="kt">INTEGER</span>           <span class="kd">::</span> <span class="n">NumOfIterations</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c">!</span>
<a name="ln-3340"></a>
<a name="ln-3341"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">GasType</span>  <span class="c">!locally used coefficent to point at correct gas type</span>
<a name="ln-3342"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ICoeff</span>
<a name="ln-3343"></a>
<a name="ln-3344"></a>  <span class="kt">CHARACTER</span> <span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tarcogErrorMessage</span> <span class="c">! store error text from tarcog</span>
<a name="ln-3345"></a>
<a name="ln-3346"></a>  <span class="c">!Simon: locally used variables</span>
<a name="ln-3347"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ngllayer</span><span class="p">,</span> <span class="n">nglface</span><span class="p">,</span> <span class="n">nglfacep</span><span class="p">,</span> <span class="n">tempInt</span>
<a name="ln-3348"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">PillarPtr</span><span class="p">,</span> <span class="n">DeflectionPtr</span><span class="p">,</span> <span class="n">GasPointer</span><span class="p">,</span> <span class="n">ThermalModelNum</span>
<a name="ln-3349"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Rmir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">Ebout</span>                         <span class="c">! IR radiance of window&#39;s interior surround (W/m2)</span>
<a name="ln-3350"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dominantGapWidth</span>               <span class="c">! store value for dominant gap width.  Used for airflow calculations</span>
<a name="ln-3351"></a>
<a name="ln-3352"></a>  <span class="c">! fill local vars</span>
<a name="ln-3353"></a>
<a name="ln-3354"></a>  <span class="n">CalcDeflection</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3355"></a>  <span class="n">CalcSHGC</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3356"></a>
<a name="ln-3357"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3358"></a><span class="k">    </span><span class="n">ConstrNum</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Construction</span>
<a name="ln-3359"></a>    <span class="n">SurfNumAdj</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ExtBoundCond</span>
<a name="ln-3360"></a>    <span class="n">ShadeFlag</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ShadingFlag</span>
<a name="ln-3361"></a>  <span class="k">end if</span>
<a name="ln-3362"></a>
<a name="ln-3363"></a><span class="k">  </span><span class="n">TotGlassLay</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">TotGlassLayers</span>
<a name="ln-3364"></a>  <span class="n">ngllayer</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">TotGlassLayers</span>
<a name="ln-3365"></a>  <span class="n">nglface</span>  <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">ngllayer</span>
<a name="ln-3366"></a>  <span class="n">nglfacep</span> <span class="o">=</span> <span class="n">nglface</span>
<a name="ln-3367"></a>  <span class="n">hrin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3368"></a>  <span class="n">hcin</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3369"></a>  <span class="n">hrout</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3370"></a>  <span class="n">hcout</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3371"></a>
<a name="ln-3372"></a>  <span class="n">Pa</span> <span class="o">=</span> <span class="n">OutBaroPress</span>
<a name="ln-3373"></a>
<a name="ln-3374"></a>  <span class="n">ThermalModelNum</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">BSDFInput</span><span class="p">%</span><span class="n">ThermalModel</span>
<a name="ln-3375"></a>  <span class="n">standard</span>        <span class="o">=</span> <span class="n">WindowThermalModel</span><span class="p">(</span><span class="n">ThermalModelNum</span><span class="p">)%</span><span class="n">CalculationStandard</span>
<a name="ln-3376"></a>  <span class="n">ThermalMod</span>      <span class="o">=</span> <span class="n">WindowThermalModel</span><span class="p">(</span><span class="n">ThermalModelNum</span><span class="p">)%</span><span class="n">ThermalModel</span>
<a name="ln-3377"></a>  <span class="n">CalcDeflection</span>  <span class="o">=</span> <span class="n">WindowThermalModel</span><span class="p">(</span><span class="n">ThermalModelNum</span><span class="p">)%</span><span class="n">DeflectionModel</span>
<a name="ln-3378"></a>  <span class="n">SDScalar</span>        <span class="o">=</span> <span class="n">WindowThermalModel</span><span class="p">(</span><span class="n">ThermalModelNum</span><span class="p">)%</span><span class="n">SDScalar</span>
<a name="ln-3379"></a>  <span class="n">VacuumPressure</span>  <span class="o">=</span> <span class="n">WindowThermalModel</span><span class="p">(</span><span class="n">ThermalModelNum</span><span class="p">)%</span><span class="n">VacuumPressureLimit</span>
<a name="ln-3380"></a>  <span class="n">Tini</span>            <span class="o">=</span> <span class="n">WindowThermalModel</span><span class="p">(</span><span class="n">ThermalModelNum</span><span class="p">)%</span><span class="n">InitialTemperature</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-3381"></a>  <span class="n">Pini</span>            <span class="o">=</span> <span class="n">WindowThermalModel</span><span class="p">(</span><span class="n">ThermalModelNum</span><span class="p">)%</span><span class="n">InitialPressure</span>
<a name="ln-3382"></a>
<a name="ln-3383"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3384"></a><span class="k">    </span><span class="n">ZoneNum</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Zone</span>
<a name="ln-3385"></a>  <span class="k">end if</span>
<a name="ln-3386"></a>
<a name="ln-3387"></a><span class="k">  </span><span class="n">nlayer</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">TotSolidLayers</span>
<a name="ln-3388"></a>  <span class="n">isky</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c">! IR radiation is provided from external source</span>
<a name="ln-3389"></a>  <span class="n">iwd</span>  <span class="o">=</span> <span class="mi">0</span> <span class="c">! assume windward for now.  TODO compare surface normal with wind direction</span>
<a name="ln-3390"></a>
<a name="ln-3391"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3392"></a>
<a name="ln-3393"></a>    <span class="c">! determine reference air temperature for this surface</span>
<a name="ln-3394"></a>                                                              <span class="k">SELECT CASE</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">TAirRef</span><span class="p">)</span>
<a name="ln-3395"></a>      <span class="k">CASE</span> <span class="p">(</span><span class="n">ZoneMeanAirTemp</span><span class="p">)</span>
<a name="ln-3396"></a>          <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">MAT</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)</span>
<a name="ln-3397"></a>      <span class="k">CASE</span> <span class="p">(</span><span class="n">AdjacentAirTemp</span><span class="p">)</span>
<a name="ln-3398"></a>          <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">TempEffBulkAir</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>
<a name="ln-3399"></a>      <span class="k">CASE</span> <span class="p">(</span><span class="n">ZoneSupplyAirTemp</span><span class="p">)</span>
<a name="ln-3400"></a>              <span class="c">! determine ZoneEquipConfigNum for this zone</span>
<a name="ln-3401"></a>  <span class="c">!            ControlledZoneAirFlag = .FALSE.</span>
<a name="ln-3402"></a>          <span class="n">ZoneEquipConfigNum</span> <span class="o">=</span> <span class="n">ZoneNum</span>
<a name="ln-3403"></a>  <span class="c">!            DO ZoneEquipConfigNum = 1, NumOfControlledZones</span>
<a name="ln-3404"></a>  <span class="c">!                IF (ZoneEquipConfig(ZoneEquipConfigNum)%ActualZoneNum /= ZoneNum) CYCLE</span>
<a name="ln-3405"></a>  <span class="c">!                ControlledZoneAirFlag = .TRUE.</span>
<a name="ln-3406"></a>  <span class="c">!                EXIT</span>
<a name="ln-3407"></a>  <span class="c">!            END DO ! ZoneEquipConfigNum</span>
<a name="ln-3408"></a>              <span class="c">! check whether this zone is a controlled zone or not</span>
<a name="ln-3409"></a>          <span class="k">IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">IsControlled</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3410"></a><span class="k">             CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Zones must be controlled for Ceiling-Diffuser Convection model. No system serves zone &#39;</span><span class="o">//</span>  <span class="p">&amp;</span>
<a name="ln-3411"></a>                                 <span class="nb">TRIM</span><span class="p">(</span><span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">))</span>
<a name="ln-3412"></a>             <span class="k">RETURN</span>
<a name="ln-3413"></a><span class="k">          END IF</span>
<a name="ln-3414"></a>          <span class="c">! determine supply air conditions</span>
<a name="ln-3415"></a>          <span class="n">SumSysMCp</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3416"></a>          <span class="n">SumSysMCpT</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3417"></a>          <span class="k">DO </span><span class="n">NodeNum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ZoneEquipConfig</span><span class="p">(</span><span class="n">ZoneEquipConfigNum</span><span class="p">)%</span><span class="n">NumInletNodes</span>
<a name="ln-3418"></a>              <span class="n">NodeTemp</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">ZoneEquipConfig</span><span class="p">(</span><span class="n">ZoneEquipConfigNum</span><span class="p">)%</span><span class="n">InletNode</span><span class="p">(</span><span class="n">NodeNum</span><span class="p">))%</span><span class="n">Temp</span>
<a name="ln-3419"></a>              <span class="n">MassFlowRate</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">ZoneEquipConfig</span><span class="p">(</span><span class="n">ZoneEquipConfigNum</span><span class="p">)%</span><span class="n">InletNode</span><span class="p">(</span><span class="n">NodeNum</span><span class="p">))%</span><span class="n">MassFlowRate</span>
<a name="ln-3420"></a>              <span class="n">CpAir</span> <span class="o">=</span> <span class="n">PsyCpAirFnWTdb</span><span class="p">(</span><span class="n">ZoneAirHumRat</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">),</span> <span class="n">NodeTemp</span><span class="p">,</span><span class="s1">&#39;CalcComplexWindowThermal&#39;</span><span class="p">)</span>
<a name="ln-3421"></a>              <span class="n">SumSysMCp</span> <span class="o">=</span> <span class="n">SumSysMCp</span> <span class="o">+</span> <span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">CpAir</span>
<a name="ln-3422"></a>              <span class="n">SumSysMCpT</span> <span class="o">=</span> <span class="n">SumSysMCpT</span> <span class="o">+</span> <span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">CpAir</span> <span class="o">*</span> <span class="n">NodeTemp</span>
<a name="ln-3423"></a>          <span class="k">END DO</span>
<a name="ln-3424"></a>            <span class="c">! a weighted average of the inlet temperatures.</span>
<a name="ln-3425"></a>            <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">SumSysMCpT</span><span class="o">/</span><span class="n">SumSysMCp</span>
<a name="ln-3426"></a>        <span class="k">CASE </span><span class="n">DEFAULT</span>
<a name="ln-3427"></a>            <span class="c">! currently set to mean air temp but should add error warning here</span>
<a name="ln-3428"></a>            <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">MAT</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)</span>
<a name="ln-3429"></a>    <span class="k">END SELECT</span>
<a name="ln-3430"></a>
<a name="ln-3431"></a><span class="k">    </span><span class="n">tind</span> <span class="o">=</span> <span class="n">RefAirTemp</span> <span class="o">+</span> <span class="n">KelvinConv</span>  <span class="c">! Inside air temperature</span>
<a name="ln-3432"></a>
<a name="ln-3433"></a>    <span class="c">! now get &quot;outside&quot; air temperature</span>
<a name="ln-3434"></a>    <span class="k">IF</span><span class="p">(</span><span class="n">SurfNumAdj</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>  <span class="c">! Interzone window</span>
<a name="ln-3435"></a>
<a name="ln-3436"></a>    <span class="n">ZoneNumAdj</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNumAdj</span><span class="p">)%</span><span class="n">Zone</span>
<a name="ln-3437"></a>
<a name="ln-3438"></a>     <span class="c">! determine reference air temperature for this surface</span>
<a name="ln-3439"></a>    <span class="k">SELECT CASE</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNumAdj</span><span class="p">)%</span><span class="n">TAirRef</span><span class="p">)</span>
<a name="ln-3440"></a>      <span class="k">CASE</span> <span class="p">(</span><span class="n">ZoneMeanAirTemp</span><span class="p">)</span>
<a name="ln-3441"></a>          <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">MAT</span><span class="p">(</span><span class="n">ZoneNumAdj</span><span class="p">)</span>
<a name="ln-3442"></a>      <span class="k">CASE</span> <span class="p">(</span><span class="n">AdjacentAirTemp</span><span class="p">)</span>
<a name="ln-3443"></a>          <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">TempEffBulkAir</span><span class="p">(</span><span class="n">SurfNumAdj</span><span class="p">)</span>
<a name="ln-3444"></a>      <span class="k">CASE</span> <span class="p">(</span><span class="n">ZoneSupplyAirTemp</span><span class="p">)</span>
<a name="ln-3445"></a>          <span class="c">! determine ZoneEquipConfigNum for this zone</span>
<a name="ln-3446"></a>          <span class="n">ZoneEquipConfigNum</span> <span class="o">=</span> <span class="n">ZoneNum</span>
<a name="ln-3447"></a>          <span class="c">! check whether this zone is a controlled zone or not</span>
<a name="ln-3448"></a>          <span class="k">IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">IsControlled</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3449"></a><span class="k">            CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Zones must be controlled for Ceiling-Diffuser Convection model. No system serves zone &#39;</span><span class="o">//</span>  <span class="p">&amp;</span>
<a name="ln-3450"></a>                               <span class="nb">TRIM</span><span class="p">(</span><span class="n">Zone</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">))</span>
<a name="ln-3451"></a>            <span class="k">RETURN</span>
<a name="ln-3452"></a><span class="k">          END IF</span>
<a name="ln-3453"></a>          <span class="c">! determine supply air conditions</span>
<a name="ln-3454"></a>          <span class="n">SumSysMCp</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3455"></a>          <span class="n">SumSysMCpT</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3456"></a>          <span class="k">DO </span><span class="n">NodeNum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ZoneEquipConfig</span><span class="p">(</span><span class="n">ZoneEquipConfigNum</span><span class="p">)%</span><span class="n">NumInletNodes</span>
<a name="ln-3457"></a>              <span class="n">NodeTemp</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">ZoneEquipConfig</span><span class="p">(</span><span class="n">ZoneEquipConfigNum</span><span class="p">)%</span><span class="n">InletNode</span><span class="p">(</span><span class="n">NodeNum</span><span class="p">))%</span><span class="n">Temp</span>
<a name="ln-3458"></a>              <span class="n">MassFlowRate</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">ZoneEquipConfig</span><span class="p">(</span><span class="n">ZoneEquipConfigNum</span><span class="p">)%</span><span class="n">InletNode</span><span class="p">(</span><span class="n">NodeNum</span><span class="p">))%</span><span class="n">MassFlowRate</span>
<a name="ln-3459"></a>              <span class="n">CpAir</span> <span class="o">=</span> <span class="n">PsyCpAirFnWTdb</span><span class="p">(</span><span class="n">ZoneAirHumRat</span><span class="p">(</span><span class="n">ZoneNumAdj</span><span class="p">),</span> <span class="n">NodeTemp</span><span class="p">,</span> <span class="s1">&#39;CalcComplexWindowThermal&#39;</span><span class="p">)</span>
<a name="ln-3460"></a>              <span class="n">SumSysMCp</span> <span class="o">=</span> <span class="n">SumSysMCp</span> <span class="o">+</span> <span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">CpAir</span>
<a name="ln-3461"></a>              <span class="n">SumSysMCpT</span> <span class="o">=</span> <span class="n">SumSysMCpT</span> <span class="o">+</span> <span class="n">MassFlowRate</span> <span class="o">*</span> <span class="n">CpAir</span> <span class="o">*</span> <span class="n">NodeTemp</span>
<a name="ln-3462"></a>          <span class="k">END DO</span>
<a name="ln-3463"></a>          <span class="c">! a weighted average of the inlet temperatures.</span>
<a name="ln-3464"></a>          <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">SumSysMCpT</span><span class="o">/</span><span class="n">SumSysMCp</span>
<a name="ln-3465"></a>      <span class="k">CASE </span><span class="n">DEFAULT</span>
<a name="ln-3466"></a>          <span class="c">! currently set to mean air temp but should add error warning here</span>
<a name="ln-3467"></a>          <span class="n">RefAirTemp</span> <span class="o">=</span> <span class="n">MAT</span><span class="p">(</span><span class="n">ZoneNumAdj</span><span class="p">)</span>
<a name="ln-3468"></a>    <span class="k">END SELECT</span>
<a name="ln-3469"></a>
<a name="ln-3470"></a><span class="k">      </span><span class="n">Tout</span> <span class="o">=</span> <span class="n">RefAirTemp</span> <span class="o">+</span> <span class="n">KelvinConv</span>  <span class="c">! outside air temperature</span>
<a name="ln-3471"></a>
<a name="ln-3472"></a>      <span class="n">tsky</span> <span class="o">=</span> <span class="n">MRT</span><span class="p">(</span><span class="n">ZoneNumAdj</span><span class="p">)</span> <span class="o">+</span> <span class="n">KelvinConv</span> <span class="c">! TODO this misses IR from sources such as high temp radiant and baseboards</span>
<a name="ln-3473"></a>
<a name="ln-3474"></a>    <span class="c">!  ! Add long-wave radiation from adjacent zone absorbed by glass layer closest to the adjacent zone.</span>
<a name="ln-3475"></a>    <span class="c">!</span>
<a name="ln-3476"></a>    <span class="c">!  AbsRadGlassFace(1) = AbsRadGlassFace(1) + QRadThermInAbs(SurfNumAdj)</span>
<a name="ln-3477"></a>    <span class="c">!</span>
<a name="ln-3478"></a>    <span class="c">!  ! The IR radiance of this window&#39;s &quot;exterior&quot; surround is the IR radiance</span>
<a name="ln-3479"></a>    <span class="c">!  ! from surfaces and high-temp radiant sources in the adjacent zone</span>
<a name="ln-3480"></a>    <span class="c">!</span>
<a name="ln-3481"></a>    <span class="n">outir</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNumAdj</span><span class="p">)%</span><span class="n">IRfromParentZone</span> <span class="o">+</span> <span class="n">QHTRadSysSurf</span><span class="p">(</span><span class="n">SurfNumAdj</span><span class="p">)</span> <span class="o">+</span> <span class="n">QHWBaseboardSurf</span><span class="p">(</span><span class="n">SurfNumAdj</span><span class="p">)</span>
<a name="ln-3482"></a>
<a name="ln-3483"></a>    <span class="k">ELSE</span>  <span class="c">! Exterior window (ExtBoundCond = 0)</span>
<a name="ln-3484"></a>
<a name="ln-3485"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ExtWind</span><span class="p">)</span> <span class="k">THEN</span>  <span class="c">! Window is exposed to wind (and possibly rain)</span>
<a name="ln-3486"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">IsRain</span><span class="p">)</span> <span class="k">THEN</span>  <span class="c">! Raining: since wind exposed, outside window surface gets wet</span>
<a name="ln-3487"></a>          <span class="n">tout</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">OutWetBulbTemp</span> <span class="o">+</span> <span class="n">KelvinConv</span>
<a name="ln-3488"></a>        <span class="k">ELSE</span>             <span class="c">! Dry</span>
<a name="ln-3489"></a>          <span class="n">tout</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">OutDryBulbTemp</span> <span class="o">+</span> <span class="n">KelvinConv</span>
<a name="ln-3490"></a>        <span class="k">END IF</span>
<a name="ln-3491"></a><span class="k">      ELSE</span>                               <span class="c">! Window not exposed to wind</span>
<a name="ln-3492"></a>        <span class="n">tout</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">OutDryBulbTemp</span> <span class="o">+</span> <span class="n">KelvinConv</span>
<a name="ln-3493"></a>      <span class="k">END IF</span>
<a name="ln-3494"></a>        <span class="c">!tsky = SkyTemp + TKelvin</span>
<a name="ln-3495"></a>        <span class="n">tsky</span> <span class="o">=</span> <span class="n">SkyTempKelvin</span>
<a name="ln-3496"></a>        <span class="n">Ebout</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">tout</span><span class="o">**</span><span class="mi">4</span>
<a name="ln-3497"></a>        <span class="n">outir</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ViewFactorSkyIR</span> <span class="o">*</span> <span class="p">(</span><span class="n">AirSkyRadSplit</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="n">tsky</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span>   <span class="p">&amp;</span>
<a name="ln-3498"></a>           <span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="n">AirSkyRadSplit</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">))</span><span class="o">*</span><span class="n">Ebout</span><span class="p">)</span> <span class="o">+</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ViewFactorGroundIR</span> <span class="o">*</span> <span class="n">Ebout</span>
<a name="ln-3499"></a>
<a name="ln-3500"></a>    <span class="k">END IF</span>
<a name="ln-3501"></a>
<a name="ln-3502"></a><span class="k">    </span><span class="n">hin</span> <span class="o">=</span> <span class="n">HConvIn</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>  <span class="c">! Room-side surface convective film conductance</span>
<a name="ln-3503"></a>    <span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">! convective coefficient on indoor side will be recalculated (like in Winkelmann routines)</span>
<a name="ln-3504"></a>
<a name="ln-3505"></a>    <span class="c">!hcout=HExtConvCoeff  ! Exterior convection coefficient is passed in from outer routine</span>
<a name="ln-3506"></a>    <span class="n">hout</span><span class="o">=</span><span class="n">HExtConvCoeff</span>  <span class="c">! Exterior convection coefficient is passed in from outer routine</span>
<a name="ln-3507"></a>    <span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span> <span class="c">! prescribed convective film coeff on outdoor side</span>
<a name="ln-3508"></a>    <span class="n">tilt</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Tilt</span>
<a name="ln-3509"></a>    <span class="n">height</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Height</span>
<a name="ln-3510"></a>    <span class="n">heightt</span> <span class="o">=</span> <span class="n">height</span> <span class="c">! for now put same window and glazing pocket hights</span>
<a name="ln-3511"></a>    <span class="n">width</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Width</span>
<a name="ln-3512"></a>
<a name="ln-3513"></a>    <span class="c">!indoor mean radiant temperature.</span>
<a name="ln-3514"></a>    <span class="c">! IR incident on window from zone surfaces and high-temp radiant sources</span>
<a name="ln-3515"></a>    <span class="n">rmir</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">IRfromParentZone</span> <span class="o">+</span> <span class="n">QHTRadSysSurf</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">+</span> <span class="n">QHWBaseboardSurf</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3516"></a>      <span class="n">QSteamBaseboardSurf</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">+</span> <span class="n">QElecBaseboardSurf</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>
<a name="ln-3517"></a>    <span class="n">trmin</span> <span class="o">=</span> <span class="p">(</span> <span class="n">rmir</span> <span class="o">/</span> <span class="n">StefanBoltzmann</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25d0</span>  <span class="c">! TODO check model equation.</span>
<a name="ln-3518"></a>
<a name="ln-3519"></a>    <span class="c">! outdoor wind speed</span>
<a name="ln-3520"></a>    <span class="k">IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ExtWind</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3521"></a><span class="k">      </span><span class="n">wso</span> <span class="o">=</span>  <span class="mf">0.0d0</span>  <span class="c">! No wind exposure</span>
<a name="ln-3522"></a>      <span class="c">!ELSE IF (Surface(SurfNum)%Class == SurfaceClass_Window .AND. SurfaceWindow(SurfNum)%ShadingFlag == ExtShadeOn) THEN</span>
<a name="ln-3523"></a>      <span class="c">!  wso =  0.0  ! Assume zero wind speed at outside glass surface of window with exterior shade</span>
<a name="ln-3524"></a>    <span class="k">ELSE</span>
<a name="ln-3525"></a><span class="k">      </span><span class="n">wso</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">WindSpeed</span>
<a name="ln-3526"></a>    <span class="n">ENDIF</span>
<a name="ln-3527"></a>
<a name="ln-3528"></a>    <span class="c">! indoor wind speed</span>
<a name="ln-3529"></a>    <span class="n">wsi</span> <span class="o">=</span> <span class="mf">0.0d0</span> <span class="c">! assumuption (TODO, what to use for inside air velocity?)</span>
<a name="ln-3530"></a>
<a name="ln-3531"></a>
<a name="ln-3532"></a>    <span class="n">fclr</span> <span class="o">=</span> <span class="mf">1.0D0</span> <span class="o">-</span> <span class="n">CloudFraction</span>
<a name="ln-3533"></a>  <span class="k">end if</span>
<a name="ln-3534"></a>
<a name="ln-3535"></a>  <span class="c">!now fill layer data</span>
<a name="ln-3536"></a>  <span class="c">!IConst = ConstrNum</span>
<a name="ln-3537"></a>  <span class="c">!IF(ShadeFlag==IntShadeOn.OR.ShadeFlag==ExtShadeOn.OR.ShadeFlag==IntBlindOn.OR.ShadeFlag==ExtBlindOn &amp;</span>
<a name="ln-3538"></a>  <span class="c">!    .OR.ShadeFlag==BGShadeOn.OR.ShadeFlag==BGBlindOn.OR.ShadeFlag==ExtScreenOn) THEN</span>
<a name="ln-3539"></a>  <span class="c">!  IConst = Surface(SurfNum)%ShadedConstruction</span>
<a name="ln-3540"></a>  <span class="c">!  IF(Surfacewindow(SurfNum)%StormWinFlag &gt; 0) IConst = Surface(SurfNum)%StormWinShadedConstruction</span>
<a name="ln-3541"></a>  <span class="c">!END IF</span>
<a name="ln-3542"></a>  <span class="c">!TotLay = Construct(IConst)%TotLayers</span>
<a name="ln-3543"></a>  <span class="n">TotLay</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">TotLayers</span>
<a name="ln-3544"></a>  <span class="n">IGap</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3545"></a>
<a name="ln-3546"></a>  <span class="c">!****************************************************************************************************</span>
<a name="ln-3547"></a>  <span class="c">!</span>
<a name="ln-3548"></a>  <span class="c">! Inside and outside gas coefficients</span>
<a name="ln-3549"></a>  <span class="c">!</span>
<a name="ln-3550"></a>  <span class="c">!****************************************************************************************************</span>
<a name="ln-3551"></a>  <span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">! air on outdoor side</span>
<a name="ln-3552"></a>  <span class="n">frct</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="mf">1.0d0</span>   <span class="c">! pure air on outdoor side</span>
<a name="ln-3553"></a>  <span class="n">nmix</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="o">=</span> <span class="mi">1</span> <span class="c">! pure air on outdoor side</span>
<a name="ln-3554"></a>
<a name="ln-3555"></a>  <span class="n">iprop</span><span class="p">(</span><span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">! air on indoor side</span>
<a name="ln-3556"></a>  <span class="n">frct</span><span class="p">(</span><span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="mf">1.0d0</span> <span class="c">! pure air on indoor side</span>
<a name="ln-3557"></a>  <span class="n">nmix</span><span class="p">(</span><span class="n">nlayer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>     <span class="o">=</span> <span class="mi">1</span> <span class="c">! pure air on indoor side</span>
<a name="ln-3558"></a>
<a name="ln-3559"></a>  <span class="c">!Simon: feed gas coefficients with air.  This is necessary for tarcog because it is used on indoor and outdoor sides</span>
<a name="ln-3560"></a>  <span class="n">GasType</span> <span class="o">=</span> <span class="n">GasCoeffsAir</span>
<a name="ln-3561"></a>  <span class="n">wght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="n">GasWght</span><span class="p">(</span><span class="n">GasType</span><span class="p">)</span>
<a name="ln-3562"></a>  <span class="n">gama</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="n">GasSpecificHeatRatio</span><span class="p">(</span><span class="n">GasType</span><span class="p">)</span>
<a name="ln-3563"></a>  <span class="k">DO </span><span class="n">ICoeff</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-3564"></a>    <span class="n">gcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ICoeff</span><span class="p">)</span>   <span class="o">=</span> <span class="n">GasCoeffsCon</span><span class="p">(</span><span class="n">GasType</span><span class="p">,</span><span class="n">ICoeff</span><span class="p">)</span>
<a name="ln-3565"></a>    <span class="n">gvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ICoeff</span><span class="p">)</span>   <span class="o">=</span> <span class="n">GasCoeffsVis</span><span class="p">(</span><span class="n">GasType</span><span class="p">,</span><span class="n">ICoeff</span><span class="p">)</span>
<a name="ln-3566"></a>    <span class="n">gcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ICoeff</span><span class="p">)</span>   <span class="o">=</span> <span class="n">GasCoeffsCp</span> <span class="p">(</span><span class="n">GasType</span><span class="p">,</span><span class="n">ICoeff</span><span class="p">)</span>
<a name="ln-3567"></a>  <span class="k">END DO</span>
<a name="ln-3568"></a>
<a name="ln-3569"></a>  <span class="c">! Fill window layer properties needed for window layer heat balance calculation</span>
<a name="ln-3570"></a>  <span class="n">IGlass</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3571"></a>  <span class="n">IGap</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3572"></a>  <span class="k">DO </span><span class="n">Lay</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">TotLay</span>
<a name="ln-3573"></a>    <span class="n">LayPtr</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">LayerPoint</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span>
<a name="ln-3574"></a>
<a name="ln-3575"></a>    <span class="k">IF</span><span class="p">((</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Group</span> <span class="o">==</span> <span class="n">WindowGlass</span><span class="p">)</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="p">(</span><span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Group</span> <span class="o">==</span> <span class="n">WindowSimpleGlazing</span><span class="p">)</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3576"></a><span class="k">      </span><span class="n">IGlass</span> <span class="o">=</span> <span class="n">IGlass</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3577"></a>      <span class="n">LayerType</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! this marks specular layer type</span>
<a name="ln-3578"></a>      <span class="n">thick</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span> <span class="o">=</span>    <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Thickness</span>
<a name="ln-3579"></a>      <span class="n">scon</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span> <span class="o">=</span>     <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Conductivity</span>
<a name="ln-3580"></a>      <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">AbsorpThermalFront</span>
<a name="ln-3581"></a>      <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="p">)</span> <span class="o">=</span>   <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">AbsorpThermalBack</span>
<a name="ln-3582"></a>      <span class="n">tir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">TransThermal</span>
<a name="ln-3583"></a>      <span class="n">tir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="p">)</span> <span class="o">=</span>    <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">TransThermal</span>
<a name="ln-3584"></a>      <span class="n">YoungsMod</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">YoungModulus</span>
<a name="ln-3585"></a>      <span class="n">PoissonsRat</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">PoissonsRatio</span>
<a name="ln-3586"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Group</span> <span class="o">==</span> <span class="n">ComplexWindowShade</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3587"></a><span class="k">      if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3588"></a><span class="k">        if</span> <span class="p">(</span><span class="n">Lay</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ShadingFlag</span> <span class="o">=</span> <span class="n">ExtShadeOn</span>
<a name="ln-3589"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">Lay</span> <span class="o">==</span> <span class="n">TotLay</span><span class="p">)</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ShadingFlag</span> <span class="o">=</span> <span class="n">IntShadeOn</span>
<a name="ln-3590"></a>      <span class="k">end if</span>
<a name="ln-3591"></a><span class="k">      </span><span class="n">IGlass</span> <span class="o">=</span> <span class="n">IGlass</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3592"></a>      <span class="n">TempInt</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">ComplexShadePtr</span>
<a name="ln-3593"></a>      <span class="n">LayerType</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>  <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">LayerType</span>
<a name="ln-3594"></a>
<a name="ln-3595"></a>      <span class="n">thick</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>      <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">Thickness</span>
<a name="ln-3596"></a>      <span class="n">scon</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>      <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">Conductivity</span>
<a name="ln-3597"></a>      <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">FrontEmissivity</span>
<a name="ln-3598"></a>      <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="p">)</span>    <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">BackEmissivity</span>
<a name="ln-3599"></a>      <span class="n">tir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>    <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">IRTransmittance</span>
<a name="ln-3600"></a>      <span class="n">tir</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">IGlass</span><span class="p">)</span>      <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">IRTransmittance</span>
<a name="ln-3601"></a>
<a name="ln-3602"></a>      <span class="c">! This needs to be converted into correct areas. That can be done only after loading complete window data</span>
<a name="ln-3603"></a>      <span class="n">Atop</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>      <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">TopOpeningMultiplier</span>
<a name="ln-3604"></a>      <span class="n">Abot</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>      <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">BottomOpeningMultiplier</span>
<a name="ln-3605"></a>      <span class="n">Al</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>        <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">LeftOpeningMultiplier</span>
<a name="ln-3606"></a>      <span class="n">Ar</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>        <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">RightOpeningMultiplier</span>
<a name="ln-3607"></a>      <span class="n">Ah</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>        <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">FrontOpeningMultiplier</span>
<a name="ln-3608"></a>
<a name="ln-3609"></a>      <span class="n">SlatThick</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>    <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">SlatThickness</span>
<a name="ln-3610"></a>      <span class="n">SlatWidth</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>    <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">SlatWidth</span>
<a name="ln-3611"></a>      <span class="n">SlatAngle</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>    <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">SlatAngle</span>
<a name="ln-3612"></a>      <span class="n">SlatCond</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>    <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">SlatConductivity</span>
<a name="ln-3613"></a>      <span class="n">SlatSpacing</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>  <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">SlatSpacing</span>
<a name="ln-3614"></a>      <span class="n">SlatCurve</span><span class="p">(</span><span class="n">IGlass</span><span class="p">)</span>    <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">TempInt</span><span class="p">)%</span><span class="n">SlatCurve</span>
<a name="ln-3615"></a>    <span class="k">else if</span><span class="p">(</span><span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Group</span> <span class="o">==</span> <span class="n">ComplexWindowGap</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3616"></a><span class="k">      </span><span class="n">IGap</span> <span class="o">=</span> <span class="n">IGap</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3617"></a>      <span class="n">gap</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span>  <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Thickness</span>
<a name="ln-3618"></a>      <span class="n">presure</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">Pressure</span>
<a name="ln-3619"></a>
<a name="ln-3620"></a>      <span class="n">DeflectionPtr</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">DeflectionStatePtr</span>
<a name="ln-3621"></a>      <span class="k">if</span><span class="p">(</span><span class="n">DeflectionPtr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3622"></a><span class="k">        </span><span class="n">GapDefMax</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span> <span class="o">=</span> <span class="n">DeflectionState</span><span class="p">(</span><span class="n">DeflectionPtr</span><span class="p">)%</span><span class="n">DeflectedThickness</span>
<a name="ln-3623"></a>      <span class="k">else</span>
<a name="ln-3624"></a><span class="k">        </span><span class="n">GapDefMax</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span>
<a name="ln-3625"></a>      <span class="k">end if</span>
<a name="ln-3626"></a>
<a name="ln-3627"></a><span class="k">      </span><span class="n">PillarPtr</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">SupportPillarPtr</span>
<a name="ln-3628"></a>
<a name="ln-3629"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">PillarPtr</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3630"></a><span class="k">        </span><span class="n">SupportPlr</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3631"></a>        <span class="n">PillarSpacing</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span> <span class="o">=</span> <span class="n">SupportPillar</span><span class="p">(</span><span class="n">PillarPtr</span><span class="p">)%</span><span class="nb">Spacing</span>
<a name="ln-3632"></a><span class="nb">        </span><span class="n">PillarRadius</span><span class="p">(</span><span class="n">IGap</span><span class="p">)</span>  <span class="o">=</span> <span class="n">SupportPillar</span><span class="p">(</span><span class="n">PillarPtr</span><span class="p">)%</span><span class="n">Radius</span>
<a name="ln-3633"></a>      <span class="k">end if</span>
<a name="ln-3634"></a>
<a name="ln-3635"></a><span class="k">      </span><span class="n">GasPointer</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">LayPtr</span><span class="p">)%</span><span class="n">GasPointer</span>
<a name="ln-3636"></a>
<a name="ln-3637"></a>      <span class="n">nmix</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">NumberOfGasesInMixture</span>
<a name="ln-3638"></a>      <span class="k">DO </span><span class="n">IMix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nmix</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3639"></a>        <span class="c">!iprop(IGap+1, IMix) = Material(LayPtr)%GasType(IMix)</span>
<a name="ln-3640"></a>        <span class="c">!iprop(IGap+1, IMix) = GetGasIndex(Material(LayPtr)%GasWGHT(IMix))</span>
<a name="ln-3641"></a>        <span class="n">frct</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">IMix</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">GasFract</span><span class="p">(</span><span class="n">IMix</span><span class="p">)</span>
<a name="ln-3642"></a>
<a name="ln-3643"></a>        <span class="c">!Now has to build-up gas coefficients arrays. All used gasses should be stored into these arrays and</span>
<a name="ln-3644"></a>        <span class="c">!to be correctly referenced by gap arrays</span>
<a name="ln-3645"></a>
<a name="ln-3646"></a>        <span class="c">!First check if gas coefficients are already part of array.  Duplicates are not necessary</span>
<a name="ln-3647"></a>        <span class="k">CALL </span><span class="n">CheckGasCoefs</span><span class="p">(</span><span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">GasWGHT</span><span class="p">(</span><span class="n">IMix</span><span class="p">),</span> <span class="n">iprop</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMix</span><span class="p">),</span> <span class="n">wght</span><span class="p">,</span> <span class="n">feedData</span><span class="p">)</span>
<a name="ln-3648"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">feedData</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3649"></a><span class="k">          </span><span class="n">wght</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMix</span><span class="p">))</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">GasWGHT</span><span class="p">(</span><span class="n">IMix</span><span class="p">)</span>
<a name="ln-3650"></a>          <span class="n">gama</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMix</span><span class="p">))</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">GasSpecHeatRatio</span><span class="p">(</span><span class="n">IMix</span><span class="p">)</span>
<a name="ln-3651"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
<a name="ln-3652"></a>            <span class="n">gcon</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMix</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">GasCON</span><span class="p">(</span><span class="n">IMix</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-3653"></a>            <span class="n">gvis</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMix</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">GasVIS</span><span class="p">(</span><span class="n">IMix</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-3654"></a>            <span class="n">gcp</span><span class="p">(</span><span class="n">iprop</span><span class="p">(</span><span class="n">IGap</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMix</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GasPointer</span><span class="p">)%</span><span class="n">GasCP</span><span class="p">(</span><span class="n">IMix</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="ln-3655"></a>          <span class="k">END DO</span>
<a name="ln-3656"></a><span class="k">        END IF</span> <span class="c">!IF feedData THEN</span>
<a name="ln-3657"></a>      <span class="k">END DO</span>
<a name="ln-3658"></a><span class="k">    else</span>
<a name="ln-3659"></a><span class="k">      CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;Illegal layer type in Construction:ComplexFenestrationState.&#39;</span><span class="p">)</span>
<a name="ln-3660"></a>      <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;Allowed object are:&#39;</span><span class="p">)</span>
<a name="ln-3661"></a>      <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;   - WindowMaterial:Glazing&#39;</span><span class="p">)</span>
<a name="ln-3662"></a>      <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;   - WindowMaterial:ComplexShade&#39;</span><span class="p">)</span>
<a name="ln-3663"></a>      <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;   - WindowMaterial:Gap&#39;</span><span class="p">)</span>
<a name="ln-3664"></a>      <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;halting because of error in layer definition for Construction:ComplexFenestrationState&#39;</span><span class="p">)</span>
<a name="ln-3665"></a>    <span class="k">end if</span>
<a name="ln-3666"></a>
<a name="ln-3667"></a><span class="k">  END DO</span>  <span class="c">! End of loop over glass, gap and blind/shade layers in a window construction</span>
<a name="ln-3668"></a>
<a name="ln-3669"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3670"></a>    <span class="c">! now calculate correct areas for multipliers</span>
<a name="ln-3671"></a>    <span class="k">DO </span><span class="n">Lay</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-3672"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">LayerType</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span> <span class="c">! Layer is shading</span>
<a name="ln-3673"></a>        <span class="c">! before changing multipliers, need to determine which one is dominant gap width</span>
<a name="ln-3674"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">Lay</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span> <span class="c">! Exterior shading device</span>
<a name="ln-3675"></a>          <span class="n">dominantGapWidth</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span>
<a name="ln-3676"></a>        <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">Lay</span> <span class="o">==</span> <span class="n">nlayer</span><span class="p">)</span> <span class="k">THEN</span> <span class="c">! Interior shading device</span>
<a name="ln-3677"></a>          <span class="n">dominantGapWidth</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="n">Lay</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3678"></a>        <span class="k">ELSE</span> <span class="c">! In-between shading device</span>
<a name="ln-3679"></a>          <span class="n">dominantGapWidth</span> <span class="o">=</span> <span class="nb">MIN</span><span class="p">(</span><span class="n">gap</span><span class="p">(</span><span class="n">Lay</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">gap</span><span class="p">(</span><span class="n">Lay</span><span class="p">))</span>
<a name="ln-3680"></a>        <span class="k">END IF</span>
<a name="ln-3681"></a><span class="k">        </span><span class="n">Atop</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span>      <span class="o">=</span> <span class="n">Atop</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span> <span class="o">*</span> <span class="n">dominantGapWidth</span> <span class="o">*</span> <span class="n">width</span>
<a name="ln-3682"></a>        <span class="n">Abot</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span>      <span class="o">=</span> <span class="n">Abot</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span> <span class="o">*</span> <span class="n">dominantGapWidth</span> <span class="o">*</span> <span class="n">width</span>
<a name="ln-3683"></a>        <span class="n">Al</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span>        <span class="o">=</span> <span class="n">Al</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span> <span class="o">*</span> <span class="n">dominantGapWidth</span> <span class="o">*</span> <span class="n">height</span>
<a name="ln-3684"></a>        <span class="n">Ar</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span>        <span class="o">=</span> <span class="n">Ar</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span> <span class="o">*</span> <span class="n">dominantGapWidth</span> <span class="o">*</span> <span class="n">height</span>
<a name="ln-3685"></a>        <span class="n">Ah</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span>        <span class="o">=</span> <span class="n">Ah</span><span class="p">(</span><span class="n">Lay</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span> <span class="o">*</span> <span class="n">height</span>
<a name="ln-3686"></a>      <span class="k">END IF</span>
<a name="ln-3687"></a><span class="k">    END DO</span>
<a name="ln-3688"></a><span class="k">  END IF</span>
<a name="ln-3689"></a>
<a name="ln-3690"></a>  <span class="c">!ThermalMod = 0</span>
<a name="ln-3691"></a>  <span class="n">Debug_mode</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3692"></a>  <span class="n">CalcSHGC</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3693"></a>
<a name="ln-3694"></a>  <span class="n">Window_ID</span> <span class="o">=</span> <span class="n">ConstrNum</span>
<a name="ln-3695"></a>
<a name="ln-3696"></a>  <span class="c">!vector of absorbed solar energy fractions for each layer.</span>
<a name="ln-3697"></a>  <span class="n">asol</span> <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-3698"></a>  <span class="c">! direct solar radiation</span>
<a name="ln-3699"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3700"></a><span class="k">    </span><span class="n">ShadeFlag</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ShadingFlag</span>
<a name="ln-3701"></a>    <span class="n">dir</span> <span class="o">=</span> <span class="n">QRadSWOutIncident</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">+</span>  <span class="n">QS</span><span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Zone</span><span class="p">)</span> <span class="c">! TODO, check , !</span>
<a name="ln-3702"></a>    <span class="c">!                  currently using Exterior beam plus diffuse solar incident on surface</span>
<a name="ln-3703"></a>    <span class="c">!                  plus zone short wave.  CHECK</span>
<a name="ln-3704"></a>    <span class="c">!if (dir.ne.0.0d0) then</span>
<a name="ln-3705"></a>      <span class="k">do </span><span class="n">IGlass</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-3706"></a>        <span class="c">!IF (dir &gt; 0.0D0 ) THEN</span>
<a name="ln-3707"></a>        <span class="n">asol</span><span class="p">(</span><span class="n">IGLASS</span><span class="p">)</span> <span class="o">=</span> <span class="n">QRadSWwinAbs</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">,</span> <span class="n">IGLASS</span><span class="p">)</span>
<a name="ln-3708"></a>        <span class="c">!ELSE</span>
<a name="ln-3709"></a>        <span class="c">!  asol(IGLASS) = 0.0D0</span>
<a name="ln-3710"></a>        <span class="c">!ENDIF</span>
<a name="ln-3711"></a>      <span class="k">end do</span>
<a name="ln-3712"></a>    <span class="c">!end if</span>
<a name="ln-3713"></a>
<a name="ln-3714"></a>    <span class="c">! Add contribution of IR from zone internal gains (lights, equipment and people). This is absorbed in zone-side layer and it</span>
<a name="ln-3715"></a>    <span class="c">! is assumed that nothing is transmitted through</span>
<a name="ln-3716"></a>    <span class="n">asol</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">=</span> <span class="n">asol</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">+</span> <span class="n">QRadThermInAbs</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>
<a name="ln-3717"></a>
<a name="ln-3718"></a>    <span class="n">presure</span> <span class="o">=</span> <span class="n">OutBaroPress</span>
<a name="ln-3719"></a>
<a name="ln-3720"></a>    <span class="c">! Instead of doing temperature guess get solution from previous iteration.  That should be much better than guess</span>
<a name="ln-3721"></a>    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span>
<a name="ln-3722"></a>      <span class="n">theta</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ThetaFace</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-3723"></a>    <span class="k">end do</span>
<a name="ln-3724"></a>
<a name="ln-3725"></a><span class="k">  end if</span>
<a name="ln-3726"></a>
<a name="ln-3727"></a>  <span class="c">! Standard conditions run (winter and summer)</span>
<a name="ln-3728"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">winterCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3729"></a><span class="k">    </span><span class="n">tind</span> <span class="o">=</span> <span class="mi">29</span><span class="mf">4.15d0</span>
<a name="ln-3730"></a>    <span class="n">tout</span> <span class="o">=</span> <span class="mi">25</span><span class="mf">5.15d0</span>
<a name="ln-3731"></a>    <span class="n">hcout</span> <span class="o">=</span> <span class="mi">2</span><span class="mf">6.0d0</span>
<a name="ln-3732"></a>    <span class="n">wso</span> <span class="o">=</span> <span class="mf">5.5d0</span>
<a name="ln-3733"></a>    <span class="n">dir</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3734"></a>  <span class="k">else if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">summerCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3735"></a><span class="k">    </span><span class="n">tind</span> <span class="o">=</span> <span class="mi">29</span><span class="mf">7.15d0</span>
<a name="ln-3736"></a>    <span class="n">tout</span> <span class="o">=</span> <span class="mi">30</span><span class="mf">5.15d0</span>
<a name="ln-3737"></a>    <span class="n">hcout</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">5.0d0</span>
<a name="ln-3738"></a>    <span class="n">wso</span> <span class="o">=</span> <span class="mf">2.75d0</span>
<a name="ln-3739"></a>    <span class="n">dir</span> <span class="o">=</span> <span class="mi">78</span><span class="mf">3.0d0</span>
<a name="ln-3740"></a>    <span class="n">CalcSHGC</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3741"></a>  <span class="k">end if</span>
<a name="ln-3742"></a>
<a name="ln-3743"></a>  <span class="c">! Common condition data</span>
<a name="ln-3744"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">/=</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3745"></a><span class="k">    </span><span class="n">trmin</span> <span class="o">=</span> <span class="n">tind</span>
<a name="ln-3746"></a>    <span class="n">outir</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3747"></a>    <span class="n">tsky</span> <span class="o">=</span> <span class="n">tout</span>
<a name="ln-3748"></a>    <span class="n">wsi</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3749"></a>    <span class="n">fclr</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-3750"></a>    <span class="n">ibc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3751"></a>    <span class="n">ibc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3752"></a>    <span class="n">presure</span> <span class="o">=</span> <span class="mi">10132</span><span class="mf">5.0d0</span>
<a name="ln-3753"></a>    <span class="n">iwd</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! Windward wind direction</span>
<a name="ln-3754"></a>    <span class="n">isky</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3755"></a>    <span class="n">esky</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-3756"></a>    <span class="n">height</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-3757"></a>    <span class="n">heightt</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-3758"></a>    <span class="n">width</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-3759"></a>    <span class="n">tilt</span> <span class="o">=</span> <span class="mi">9</span><span class="mf">0.0d0</span>
<a name="ln-3760"></a>    <span class="c">! Just to make initial quess different from absolute zero</span>
<a name="ln-3761"></a>    <span class="n">theta</span> <span class="o">=</span> <span class="mi">27</span><span class="mf">3.15d0</span>
<a name="ln-3762"></a>  <span class="k">end if</span>
<a name="ln-3763"></a>
<a name="ln-3764"></a>  <span class="c">!  call TARCOG</span>
<a name="ln-3765"></a>  <span class="k">CALL </span><span class="n">TARCOG90</span><span class="p">(</span><span class="n">nlayer</span><span class="p">,</span> <span class="n">iwd</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">tind</span><span class="p">,</span> <span class="n">trmin</span><span class="p">,</span> <span class="n">wso</span><span class="p">,</span> <span class="n">wsi</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">outir</span><span class="p">,</span> <span class="n">isky</span><span class="p">,</span> <span class="n">tsky</span><span class="p">,</span> <span class="n">esky</span><span class="p">,</span> <span class="n">fclr</span><span class="p">,</span> <span class="n">VacuumPressure</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3766"></a>                <span class="n">VacuumMaxGapThickness</span><span class="p">,</span> <span class="n">CalcDeflection</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">Pini</span><span class="p">,</span> <span class="n">Tini</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">GapDefMax</span><span class="p">,</span> <span class="n">thick</span><span class="p">,</span> <span class="n">scon</span><span class="p">,</span> <span class="n">YoungsMod</span><span class="p">,</span> <span class="n">PoissonsRat</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3767"></a>                <span class="n">tir</span><span class="p">,</span> <span class="n">emis</span><span class="p">,</span> <span class="n">totsol</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">asol</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">heightt</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3768"></a>                <span class="n">presure</span><span class="p">,</span> <span class="n">iprop</span><span class="p">,</span> <span class="n">frct</span><span class="p">,</span> <span class="n">gcon</span><span class="p">,</span> <span class="n">gvis</span><span class="p">,</span> <span class="n">gcp</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">gama</span><span class="p">,</span> <span class="n">nmix</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3769"></a>                <span class="n">SupportPlr</span><span class="p">,</span> <span class="n">PillarSpacing</span><span class="p">,</span> <span class="n">PillarRadius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3770"></a>                <span class="n">theta</span><span class="p">,</span> <span class="n">LayerDef</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">ufactor</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">hflux</span><span class="p">,</span> <span class="n">hcin</span><span class="p">,</span> <span class="n">hcout</span><span class="p">,</span> <span class="n">hrin</span><span class="p">,</span> <span class="n">hrout</span><span class="p">,</span> <span class="n">hin</span><span class="p">,</span> <span class="n">hout</span><span class="p">,</span> <span class="n">hcgap</span><span class="p">,</span> <span class="n">hrgap</span><span class="p">,</span> <span class="n">shgc</span><span class="p">,</span> <span class="n">nperr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3771"></a>                <span class="n">tarcogErrorMessage</span><span class="p">,</span> <span class="n">shgct</span><span class="p">,</span> <span class="n">tamb</span><span class="p">,</span> <span class="n">troom</span><span class="p">,</span> <span class="n">ibc</span><span class="p">,</span> <span class="n">Atop</span><span class="p">,</span> <span class="n">Abot</span><span class="p">,</span> <span class="n">Al</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">Ah</span><span class="p">,</span> <span class="n">SlatThick</span><span class="p">,</span> <span class="n">SlatWidth</span><span class="p">,</span> <span class="n">SlatAngle</span><span class="p">,&amp;</span>
<a name="ln-3772"></a>                <span class="n">SlatCond</span><span class="p">,</span> <span class="n">SlatSpacing</span><span class="p">,</span> <span class="n">SlatCurve</span><span class="p">,</span> <span class="n">vvent</span><span class="p">,</span><span class="n">tvent</span><span class="p">,</span> <span class="n">LayerType</span><span class="p">,</span> <span class="n">nslice</span><span class="p">,</span> <span class="n">LaminateA</span><span class="p">,</span> <span class="n">LaminateB</span><span class="p">,&amp;</span>
<a name="ln-3773"></a>                <span class="n">sumsol</span><span class="p">,</span> <span class="n">hg</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">he</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span><span class="n">Ra</span><span class="p">,</span><span class="n">Nu</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ThermalMod</span><span class="p">,</span> <span class="n">Debug_mode</span><span class="p">,</span> <span class="n">Debug_dir</span><span class="p">,</span> <span class="n">Debug_file</span><span class="p">,</span> <span class="n">Window_ID</span><span class="p">,</span> <span class="n">IGU_ID</span><span class="p">,&amp;</span>
<a name="ln-3774"></a>                <span class="n">ShadeEmisRatioOut</span><span class="p">,</span> <span class="n">ShadeEmisRatioIn</span><span class="p">,</span> <span class="n">ShadeHcRatioOut</span><span class="p">,</span> <span class="n">ShadeHcRatioIn</span><span class="p">,&amp;</span>
<a name="ln-3775"></a>                <span class="n">HcUnshadedOut</span><span class="p">,</span> <span class="n">HcUnshadedIn</span><span class="p">,</span> <span class="n">Keff</span><span class="p">,</span> <span class="n">ShadeGapKeffConv</span><span class="p">,</span> <span class="n">SDScalar</span><span class="p">,</span> <span class="n">CalcSHGC</span><span class="p">,</span> <span class="n">NumOfIterations</span><span class="p">)</span>
<a name="ln-3776"></a>
<a name="ln-3777"></a>  <span class="c">! process results from TARCOG</span>
<a name="ln-3778"></a>  <span class="k">IF</span> <span class="p">((</span><span class="n">nperr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">nperr</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">))</span> <span class="k">THEN</span> <span class="c">! process error signal from tarcog</span>
<a name="ln-3779"></a>
<a name="ln-3780"></a>    <span class="k">Call </span><span class="n">ShowSevereError</span><span class="p">(</span><span class="s1">&#39;Window tarcog returned an error&#39;</span><span class="p">)</span>
<a name="ln-3781"></a>    <span class="n">tarcogErrorMessage</span> <span class="o">=</span> <span class="s1">&#39;message = &quot;&#39;</span><span class="o">//</span><span class="n">tarcogErrorMessage</span><span class="o">//</span><span class="s1">&#39;&quot;&#39;</span>
<a name="ln-3782"></a>    <span class="k">Call </span><span class="n">ShowContinueErrorTimeStamp</span><span class="p">(</span><span class="n">tarcogErrorMessage</span><span class="p">)</span>
<a name="ln-3783"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3784"></a><span class="k">      CALL </span><span class="n">showContinueError</span><span class="p">(</span><span class="s1">&#39;surface name = &#39;</span><span class="o">//</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span>
<a name="ln-3785"></a>    <span class="k">end if</span>
<a name="ln-3786"></a><span class="k">    Call </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;construction name = &#39;</span> <span class="o">//</span><span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span>
<a name="ln-3787"></a>    <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;halting because of error in tarcog&#39;</span><span class="p">)</span>
<a name="ln-3788"></a>  <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">winterCondition</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3789"></a><span class="k">    </span><span class="n">NominalU</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">ufactor</span>
<a name="ln-3790"></a>  <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">summerCondition</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3791"></a>    <span class="c">!tempInt = SurfaceWindow(SurfNum)%ComplexFen%CurrentState</span>
<a name="ln-3792"></a>    <span class="c">!tempReal = SurfaceWindow(SurfNum)%ComplexFen%State(tempInt)%WinDiffTrans</span>
<a name="ln-3793"></a>
<a name="ln-3794"></a>    <span class="c">!Sum1 = 0.0d0</span>
<a name="ln-3795"></a>    <span class="c">!Sum2 = 0.0d0</span>
<a name="ln-3796"></a>    <span class="c">!do  j = 1 , ComplexWind(SurfNum)%Geom%Inc%NBasis     !Incident ray loop</span>
<a name="ln-3797"></a>    <span class="c">!  Sum2 = Sum2 + ComplexWind(SurfNum)%Geom%Inc%Lamda (j)</span>
<a name="ln-3798"></a>    <span class="c">!  do  m = 1 , ComplexWind(SurfNum)%Geom%Trn%NBasis     !Outgoing ray loop</span>
<a name="ln-3799"></a>    <span class="c">!    Sum1 =Sum1 + ComplexWind(SurfNum)%Geom%Inc%Lamda(j) * ComplexWind(SurfNum)%Geom%Trn%Lamda(m) * &amp;</span>
<a name="ln-3800"></a>    <span class="c">!      &amp; Construct(ConstrNum)%BSDFInput%SolFrtTrans ( j , m )</span>
<a name="ln-3801"></a>    <span class="c">!  end do      !Outgoing ray loop</span>
<a name="ln-3802"></a>    <span class="c">!end do      !Incident ray loop</span>
<a name="ln-3803"></a>    <span class="c">!if (Sum2 &gt; 0 ) THEN</span>
<a name="ln-3804"></a>    <span class="c">!  tempReal = Sum1/Sum2</span>
<a name="ln-3805"></a>    <span class="c">!else</span>
<a name="ln-3806"></a>    <span class="c">!  tempReal = 0.</span>
<a name="ln-3807"></a>    <span class="c">!  call ShowWarningError (&#39;BSDF--Inc basis has zero projected solid angle&#39;)</span>
<a name="ln-3808"></a>    <span class="c">!endif</span>
<a name="ln-3809"></a>
<a name="ln-3810"></a>    <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">SummerSHGC</span> <span class="o">=</span> <span class="n">shgc</span>
<a name="ln-3811"></a>
<a name="ln-3812"></a>    <span class="c">!Construct(SurfNum)%VisTransNorm = SurfaceWindow(SurfNum)%ComplexFen%State(tempInt)%WinDiffVisTrans</span>
<a name="ln-3813"></a>  <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">CalcCondition</span> <span class="o">==</span> <span class="n">noCondition</span><span class="p">)</span> <span class="k">THEN</span> <span class="c">! expect converged results...</span>
<a name="ln-3814"></a>         <span class="c">! Window heat balance solution has converged.</span>
<a name="ln-3815"></a>
<a name="ln-3816"></a>    <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">WindowCalcIterationsRep</span> <span class="o">=</span> <span class="n">NumOfIterations</span>
<a name="ln-3817"></a>    <span class="n">HConvIn</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">hcin</span>
<a name="ln-3818"></a>
<a name="ln-3819"></a>         <span class="c">! For interior shade, add convective gain from glass/shade gap air flow to zone convective gain;</span>
<a name="ln-3820"></a>         <span class="c">! For all cases, get total window heat gain for reporting. See CalcWinFrameAndDividerTemps for</span>
<a name="ln-3821"></a>         <span class="c">! contribution of frame and divider.</span>
<a name="ln-3822"></a>
<a name="ln-3823"></a>    <span class="n">SurfInsideTemp</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-3824"></a>    <span class="n">SurfOutsideTemp</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-3825"></a>    <span class="n">SurfOutsideEmiss</span> <span class="o">=</span> <span class="n">emis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3826"></a>
<a name="ln-3827"></a>    <span class="n">IncidentSolar</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span> <span class="o">*</span> <span class="n">QRadSWOutIncident</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>
<a name="ln-3828"></a>    <span class="k">IF</span><span class="p">(</span><span class="n">ShadeFlag</span> <span class="o">==</span> <span class="n">IntShadeOn</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">ShadeFlag</span> <span class="o">==</span> <span class="n">IntBlindOn</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3829"></a>         <span class="c">! Interior shade or blind</span>
<a name="ln-3830"></a>      <span class="n">ConvHeatFlowNatural</span> <span class="o">=</span> <span class="o">-</span><span class="n">qv</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="n">width</span>
<a name="ln-3831"></a>
<a name="ln-3832"></a>      <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ConvHeatFlowNatural</span> <span class="o">=</span> <span class="n">ConvHeatFlowNatural</span>
<a name="ln-3833"></a>      <span class="n">WinGapConvHtFlowRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvHeatFlowNatural</span>
<a name="ln-3834"></a>      <span class="n">WinGapConvHtFlowRepEnergy</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinGapConvHtFlowRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">*</span> <span class="n">TimeStepZone</span> <span class="o">*</span> <span class="n">SecInHour</span>
<a name="ln-3835"></a>         <span class="c">! Window heat gain from glazing and shade/blind to zone. Consists of transmitted solar, convection</span>
<a name="ln-3836"></a>         <span class="c">!   from air exiting gap, convection from zone-side of shade/blind, net IR to zone from shade and net IR to</span>
<a name="ln-3837"></a>         <span class="c">!   zone from the glass adjacent to the shade/blind (zero if shade/blind IR transmittance is zero).</span>
<a name="ln-3838"></a>         <span class="c">! Following assumes glazed area = window area (i.e., dividers ignored) in calculating</span>
<a name="ln-3839"></a>         <span class="c">!   IR to zone from glass when interior shade/blind is present.</span>
<a name="ln-3840"></a>      <span class="n">ShadeArea</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span> <span class="o">+</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">DividerArea</span>
<a name="ln-3841"></a>      <span class="n">sconsh</span>    <span class="o">=</span> <span class="n">scon</span><span class="p">(</span><span class="n">ngllayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">thick</span><span class="p">(</span><span class="n">ngllayer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3842"></a>      <span class="n">nglfacep</span> <span class="o">=</span> <span class="n">nglface</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-3843"></a>      <span class="n">CondHeatGainShade</span>  <span class="o">=</span> <span class="n">ShadeArea</span> <span class="o">*</span> <span class="n">sconsh</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">nglfacep</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">theta</span><span class="p">(</span><span class="n">nglfacep</span><span class="p">))</span>
<a name="ln-3844"></a>      <span class="n">EpsShIR1</span> <span class="o">=</span> <span class="n">emis</span><span class="p">(</span><span class="n">nglface</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3845"></a>      <span class="n">EpsShIR2</span> <span class="o">=</span> <span class="n">emis</span><span class="p">(</span><span class="n">nglface</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3846"></a>      <span class="n">TauShIR</span>  <span class="o">=</span> <span class="n">tir</span><span class="p">(</span><span class="n">nglface</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3847"></a>      <span class="n">RhoShIR1</span> <span class="o">=</span> <span class="nb">MAX</span><span class="p">(</span><span class="mf">0.d0</span><span class="p">,</span><span class="mf">1.d0</span><span class="o">-</span><span class="n">TauShIR</span><span class="o">-</span><span class="n">EpsShIR1</span><span class="p">)</span>
<a name="ln-3848"></a>      <span class="n">RhoShIR2</span> <span class="o">=</span> <span class="nb">MAX</span><span class="p">(</span><span class="mf">0.d0</span><span class="p">,</span><span class="mf">1.d0</span><span class="o">-</span><span class="n">TauShIR</span><span class="o">-</span><span class="n">EpsShIR2</span><span class="p">)</span>
<a name="ln-3849"></a>      <span class="n">RhoGlIR2</span> <span class="o">=</span> <span class="mf">1.d0</span><span class="o">-</span><span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ngllayer</span><span class="p">)</span>
<a name="ln-3850"></a>      <span class="n">ShGlReflFacIR</span> <span class="o">=</span> <span class="mf">1.d0</span><span class="o">-</span><span class="n">RhoGlIR2</span><span class="o">*</span><span class="n">RhoShIR1</span>
<a name="ln-3851"></a>      <span class="n">NetIRHeatGainShade</span> <span class="o">=</span> <span class="n">ShadeArea</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3852"></a>        <span class="n">EpsShIR2</span><span class="o">*</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">theta</span><span class="p">(</span><span class="n">nglfacep</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">rmir</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3853"></a>        <span class="n">EpsShIR1</span><span class="o">*</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">theta</span><span class="p">(</span><span class="n">nglfacep</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">rmir</span><span class="p">)</span><span class="o">*</span><span class="n">RhoGlIR2</span><span class="o">*</span><span class="n">TauShIR</span><span class="o">/</span><span class="n">ShGlReflFacIR</span>
<a name="ln-3854"></a>      <span class="n">NetIRHeatGainGlass</span> <span class="o">=</span> <span class="n">ShadeArea</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3855"></a>         <span class="p">(</span><span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ngllayer</span><span class="p">)</span><span class="o">*</span><span class="n">TauShIR</span><span class="o">/</span><span class="n">ShGlReflFacIR</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ngllayer</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">rmir</span><span class="p">)</span>
<a name="ln-3856"></a>      <span class="n">ConvHeatGainFrZoneSideOfShade</span> <span class="o">=</span> <span class="n">ShadeArea</span> <span class="o">*</span> <span class="n">hcin</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="n">nglfacep</span><span class="p">)</span> <span class="o">-</span> <span class="n">tind</span><span class="p">)</span>
<a name="ln-3857"></a>      <span class="n">WinHeatGain</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinTransSolar</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">+</span> <span class="n">ConvHeatFlowNatural</span> <span class="o">+</span> <span class="n">ConvHeatGainFrZoneSideOfShade</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3858"></a>                           <span class="n">NetIRHeatGainGlass</span> <span class="o">+</span> <span class="n">NetIRHeatGainShade</span>
<a name="ln-3859"></a>      <span class="c">! store components for reporting</span>
<a name="ln-3860"></a>      <span class="n">WinGainConvGlazShadGapToZoneRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvHeatFlowNatural</span> <span class="c">! result is in [W]</span>
<a name="ln-3861"></a>      <span class="n">WinGainConvShadeToZoneRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>       <span class="o">=</span> <span class="n">ConvHeatGainFrZoneSideOfShade</span>
<a name="ln-3862"></a>      <span class="n">WinGainIRGlazToZoneRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>          <span class="o">=</span> <span class="n">NetIRHeatGainGlass</span>
<a name="ln-3863"></a>      <span class="n">WinGainIRShadeToZoneRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>         <span class="o">=</span> <span class="n">NetIRHeatGainShade</span>
<a name="ln-3864"></a>    <span class="k">ELSE</span>
<a name="ln-3865"></a>         <span class="c">! Interior shade or blind not present; innermost layer is glass</span>
<a name="ln-3866"></a>      <span class="n">CondHeatGainGlass</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span> <span class="o">*</span> <span class="n">scon</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span><span class="o">/</span><span class="n">thick</span><span class="p">(</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">))</span>
<a name="ln-3867"></a>      <span class="n">NetIRHeatGainGlass</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span> <span class="o">*</span> <span class="n">emis</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">rmir</span><span class="p">)</span>
<a name="ln-3868"></a>      <span class="n">ConvHeatGainFrZoneSideOfGlass</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span> <span class="o">*</span> <span class="n">hcin</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nlayer</span><span class="p">)</span> <span class="o">-</span> <span class="n">tind</span><span class="p">)</span>
<a name="ln-3869"></a>      <span class="n">WinHeatGain</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinTransSolar</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">+</span> <span class="n">ConvHeatGainFrZoneSideOfGlass</span> <span class="o">+</span> <span class="n">NetIRHeatGainGlass</span>
<a name="ln-3870"></a>      <span class="c">! store components for reporting</span>
<a name="ln-3871"></a>      <span class="n">WinGainConvGlazToZoneRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvHeatGainFrZoneSideOfGlass</span>
<a name="ln-3872"></a>      <span class="n">WinGainIRGlazToZoneRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">NetIRHeatGainGlass</span>
<a name="ln-3873"></a>      <span class="c">! need to report convective heat flow from the gap in case of exterior shade</span>
<a name="ln-3874"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">ShadeFlag</span> <span class="o">==</span> <span class="n">ExtShadeOn</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3875"></a><span class="k">        </span><span class="n">ConvHeatFlowNatural</span> <span class="o">=</span> <span class="o">-</span><span class="n">qv</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="n">width</span> <span class="c">! qv(1) is exterior environment</span>
<a name="ln-3876"></a>
<a name="ln-3877"></a>        <span class="n">WinGapConvHtFlowRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvHeatFlowNatural</span>
<a name="ln-3878"></a>        <span class="n">WinGapConvHtFlowRepEnergy</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinGapConvHtFlowRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">*</span> <span class="n">TimeStepZone</span> <span class="o">*</span> <span class="n">SecInHour</span>
<a name="ln-3879"></a>      <span class="k">END IF</span>
<a name="ln-3880"></a><span class="k">    END IF</span>
<a name="ln-3881"></a>
<a name="ln-3882"></a>        <span class="c">! Add convective heat gain from airflow window</span>
<a name="ln-3883"></a>        <span class="c">! Note: effect of fan heat on gap outlet temperature is neglected since fan power (based</span>
<a name="ln-3884"></a>        <span class="c">! on pressure drop through the gap) is extremely small</span>
<a name="ln-3885"></a>
<a name="ln-3886"></a>    <span class="c">!WinGapConvHtFlowRep(SurfNum) = 0.0d0</span>
<a name="ln-3887"></a>    <span class="c">!WinGapConvHtFlowRepEnergy(SurfNum) = 0.0d0</span>
<a name="ln-3888"></a>    <span class="n">TotAirflowGap</span> <span class="o">=</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">AirFlowThisTS</span> <span class="o">*</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Width</span>
<a name="ln-3889"></a>    <span class="n">TAirflowGapOutlet</span> <span class="o">=</span> <span class="n">KelvinConv</span> <span class="c">! TODO Need to calculate this</span>
<a name="ln-3890"></a>    <span class="n">TAirflowGapOutletC</span> <span class="o">=</span> <span class="n">TAirflowGapOutlet</span><span class="o">-</span><span class="n">KelvinConv</span>
<a name="ln-3891"></a>    <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">TAirflowGapOutlet</span> <span class="o">=</span> <span class="n">TAirflowGapOutletC</span>
<a name="ln-3892"></a>    <span class="k">IF</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">AirFlowThisTS</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3893"></a><span class="k">      </span><span class="n">ConvHeatFlowForced</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">qv</span><span class="p">)</span> <span class="c">! TODO.  figure forced ventilation heat flow in Watts</span>
<a name="ln-3894"></a>
<a name="ln-3895"></a>      <span class="n">WinGapConvHtFlowRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">ConvHeatFlowForced</span>
<a name="ln-3896"></a>      <span class="n">WinGapConvHtFlowRepEnergy</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinGapConvHtFlowRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">*</span> <span class="n">TimeStepZone</span> <span class="o">*</span> <span class="n">SecInHour</span>
<a name="ln-3897"></a>      <span class="c">! Add heat from gap airflow to zone air if destination is inside air; save the heat gain to return</span>
<a name="ln-3898"></a>      <span class="c">! air in case it needs to be sent to the zone (due to no return air determined in HVAC simulation)</span>
<a name="ln-3899"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">AirFlowDestination</span> <span class="o">==</span> <span class="n">AirFlowWindow_Destination_IndoorAir</span>  <span class="p">.</span><span class="nb">or</span><span class="p">.</span>   <span class="p">&amp;</span>
<a name="ln-3900"></a>         <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">AirFlowDestination</span> <span class="o">==</span> <span class="n">AirFlowWindow_Destination_ReturnAir</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3901"></a><span class="k">        IF</span> <span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">AirflowSource</span> <span class="o">==</span> <span class="n">AirFlowWindow_Source_IndoorAir</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3902"></a><span class="k">          </span><span class="n">InletAirHumRat</span> <span class="o">=</span> <span class="n">ZoneAirHumRat</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)</span>
<a name="ln-3903"></a>        <span class="k">ELSE</span>  <span class="c">! AirflowSource = outside air</span>
<a name="ln-3904"></a>          <span class="n">InletAirHumRat</span> <span class="o">=</span> <span class="n">OutHumRat</span>
<a name="ln-3905"></a>        <span class="k">END IF</span>
<a name="ln-3906"></a><span class="k">        </span><span class="n">ZoneTemp</span>    <span class="o">=</span> <span class="n">MAT</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">)</span>  <span class="c">! this should be Tin (account for different reference temps)</span>
<a name="ln-3907"></a>        <span class="n">CpAirOutlet</span> <span class="o">=</span> <span class="n">PsyCpAirFnWTdb</span><span class="p">(</span><span class="n">InletAirHumRat</span><span class="p">,</span><span class="n">TAirflowGapOutletC</span><span class="p">)</span>
<a name="ln-3908"></a>        <span class="n">CpAirZone</span>   <span class="o">=</span> <span class="n">PsyCpAirFnWTdb</span><span class="p">(</span><span class="n">ZoneAirHumRat</span><span class="p">(</span><span class="n">ZoneNum</span><span class="p">),</span><span class="n">ZoneTemp</span><span class="p">)</span>
<a name="ln-3909"></a>        <span class="n">ConvHeatGainToZoneAir</span> <span class="o">=</span> <span class="n">TotAirflowGap</span> <span class="o">*</span> <span class="p">(</span><span class="n">CpAirOutlet</span><span class="o">*</span><span class="p">(</span><span class="n">TAirflowGapOutletC</span><span class="p">)</span> <span class="o">-</span> <span class="n">CpAirZone</span><span class="o">*</span><span class="n">ZoneTemp</span><span class="p">)</span>
<a name="ln-3910"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">AirFlowDestination</span> <span class="o">==</span> <span class="n">AirFlowWindow_Destination_IndoorAir</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3911"></a><span class="k">          </span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ConvHeatGainToZoneAir</span> <span class="o">=</span> <span class="n">ConvHeatGainToZoneAir</span>
<a name="ln-3912"></a>          <span class="n">WinHeatGain</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinHeatGain</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">+</span> <span class="n">ConvHeatGainToZoneAir</span>
<a name="ln-3913"></a>        <span class="k">ELSE</span>
<a name="ln-3914"></a><span class="k">          </span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">RetHeatGainToZoneAir</span> <span class="o">=</span> <span class="n">ConvHeatGainToZoneAir</span>
<a name="ln-3915"></a>        <span class="k">END IF</span>
<a name="ln-3916"></a><span class="k">      END IF</span>
<a name="ln-3917"></a>      <span class="c">! For AirflowDestination = ReturnAir in a controlled (i.e., conditioned) zone with return air, see CalcZoneLeavingConditions</span>
<a name="ln-3918"></a>      <span class="c">! for calculation of modification of return-air temperature due to airflow from window gaps into return air.</span>
<a name="ln-3919"></a>    <span class="k">END IF</span>
<a name="ln-3920"></a>
<a name="ln-3921"></a>        <span class="c">! Correct WinHeatGain for interior diffuse shortwave (solar and shortwave from lights) transmitted</span>
<a name="ln-3922"></a>        <span class="c">! back out window</span>
<a name="ln-3923"></a>    <span class="n">ConstrNum</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Construction</span>
<a name="ln-3924"></a>    <span class="c">!ConstrNumSh = Surface(SurfNum)%ShadedConstruction</span>
<a name="ln-3925"></a>    <span class="c">!IF(SurfaceWindow(SurfNum)%StormWinFlag==1) THEN</span>
<a name="ln-3926"></a>    <span class="c">!  ConstrNum = Surface(SurfNum)%StormWinConstruction</span>
<a name="ln-3927"></a>    <span class="c">!  ConstrNumSh = Surface(SurfNum)%StormWinShadedConstruction</span>
<a name="ln-3928"></a>    <span class="c">!END IF</span>
<a name="ln-3929"></a>    <span class="c">!IF(ShadeFlag &lt;= 0) THEN</span>
<a name="ln-3930"></a>      <span class="n">TransDiff</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">TransDiff</span>
<a name="ln-3931"></a>    <span class="c">!ELSE IF(ShadeFlag==IntShadeOn .OR. ShadeFlag==ExtShadeOn) THEN</span>
<a name="ln-3932"></a>    <span class="c">!  TransDiff = Construct(ConstrNum)%TransDiff</span>
<a name="ln-3933"></a>    <span class="c">!ELSE IF(ShadeFlag==IntBlindOn .OR. ShadeFlag==ExtBlindOn .OR.ShadeFlag==BGBlindOn) THEN</span>
<a name="ln-3934"></a>    <span class="c">!  TransDiff = InterpSlatAng(SurfaceWindow(SurfNum)%SlatAngThisTS,SurfaceWindow(SurfNum)%MovableSlats, &amp;</span>
<a name="ln-3935"></a>    <span class="c">!                             Construct(ConstrNumSh)%BlTransDiff)</span>
<a name="ln-3936"></a>    <span class="c">!ELSE IF(ShadeFlag == SwitchableGlazing) THEN</span>
<a name="ln-3937"></a>    <span class="c">!  TransDiff = InterpSW(SurfaceWindow(SurfNum)%SwitchingFactor,Construct(ConstrNum)%TransDiff, &amp;</span>
<a name="ln-3938"></a>    <span class="c">!                             Construct(ConstrNumSh)%TransDiff)</span>
<a name="ln-3939"></a>    <span class="c">!END IF</span>
<a name="ln-3940"></a>    <span class="n">WinHeatGain</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinHeatGain</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">-</span> <span class="n">QS</span><span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Zone</span><span class="p">)</span> <span class="o">*</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span> <span class="o">*</span> <span class="n">TransDiff</span>
<a name="ln-3941"></a>    <span class="n">WinLossSWZoneToOutWinRep</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">QS</span><span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Zone</span><span class="p">)</span> <span class="o">*</span> <span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span> <span class="o">*</span> <span class="n">TransDiff</span>
<a name="ln-3942"></a>
<a name="ln-3943"></a>    <span class="k">IF</span><span class="p">(</span><span class="n">ShadeFlag</span><span class="o">==</span><span class="n">IntShadeOn</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="n">ShadeFlag</span><span class="o">==</span><span class="n">ExtShadeOn</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3944"></a><span class="k">      </span><span class="n">WinShadingAbsorbedSolar</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ExtBeamAbsByShade</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3945"></a>                                         <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ExtDiffAbsByShade</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3946"></a>                                         <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span><span class="o">+</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">DividerArea</span><span class="p">)</span>
<a name="ln-3947"></a>      <span class="n">WinShadingAbsorbedSolarEnergy</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinShadingAbsorbedSolar</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">*</span> <span class="n">TimeStepZone</span> <span class="o">*</span> <span class="n">SecInHour</span>
<a name="ln-3948"></a>    <span class="k">END IF</span>
<a name="ln-3949"></a><span class="k">    IF</span><span class="p">(</span><span class="n">SunIsUp</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3950"></a><span class="k">      </span><span class="n">WinSysSolTransmittance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="n">WinTransSolar</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3951"></a>        <span class="p">(</span><span class="n">QRadSWOutIncident</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span><span class="o">+</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">DividerArea</span><span class="p">)</span><span class="o">+</span><span class="mf">0.0001d0</span><span class="p">)</span>
<a name="ln-3952"></a>      <span class="n">WinSysSolAbsorptance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>   <span class="o">=</span> <span class="p">(</span><span class="n">QRadSWwinAbsTot</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span><span class="o">+</span><span class="n">WinShadingAbsorbedSolar</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">))</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3953"></a>        <span class="p">(</span><span class="n">QRadSWOutIncident</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Area</span><span class="o">+</span><span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">DividerArea</span><span class="p">)</span><span class="o">+</span><span class="mf">0.0001d0</span><span class="p">)</span>
<a name="ln-3954"></a>      <span class="n">WinSysSolReflectance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">-</span> <span class="n">WinSysSolTransmittance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">-</span> <span class="n">WinSysSolAbsorptance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>
<a name="ln-3955"></a>    <span class="k">ELSE</span>
<a name="ln-3956"></a><span class="k">      </span><span class="n">WinSysSolTransmittance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3957"></a>      <span class="n">WinSysSolAbsorptance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3958"></a>      <span class="n">WinSysSolReflectance</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)</span>   <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3959"></a>    <span class="k">END IF</span>
<a name="ln-3960"></a>
<a name="ln-3961"></a>       <span class="c">! Save hcv for use in divider calc with interior or exterior shade (see CalcWinFrameAndDividerTemps)</span>
<a name="ln-3962"></a>   <span class="k">IF</span><span class="p">(</span><span class="n">ShadeFlag</span><span class="o">==</span><span class="n">IntShadeOn</span><span class="p">)</span> <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ConvCoeffWithShade</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3963"></a>
<a name="ln-3964"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">ShadeFlag</span> <span class="o">==</span> <span class="n">IntShadeOn</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3965"></a><span class="k">        </span><span class="n">SurfInsideTemp</span>  <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ngllayer</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-3966"></a>
<a name="ln-3967"></a>        <span class="c">! Get properties of inside shading layer</span>
<a name="ln-3968"></a>        <span class="n">ShadingLayPtr</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">LayerPoint</span><span class="p">(</span><span class="n">TotLay</span><span class="p">)</span>
<a name="ln-3969"></a>        <span class="n">ShadingLayPtr</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">ShadingLayPtr</span><span class="p">)%</span><span class="n">ComplexShadePtr</span>
<a name="ln-3970"></a>        <span class="n">TauShadeIR</span> <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">ShadingLayPtr</span><span class="p">)%</span><span class="n">IRTransmittance</span>
<a name="ln-3971"></a>        <span class="n">EpsShadeIR</span> <span class="o">=</span> <span class="n">ComplexShade</span><span class="p">(</span><span class="n">ShadingLayPtr</span><span class="p">)%</span><span class="n">FrontEmissivity</span>
<a name="ln-3972"></a>        <span class="n">RhoShadeIR</span> <span class="o">=</span> <span class="nb">MAX</span><span class="p">(</span><span class="mf">0.d0</span><span class="p">,</span><span class="mf">1.d0</span><span class="o">-</span><span class="n">TauShadeIR</span><span class="o">-</span><span class="n">EpsShadeIR</span><span class="p">)</span>
<a name="ln-3973"></a>
<a name="ln-3974"></a>        <span class="c">! Get properties of glass next to inside shading layer</span>
<a name="ln-3975"></a>        <span class="n">GlassLayPtr</span> <span class="o">=</span> <span class="n">Construct</span><span class="p">(</span><span class="n">ConstrNum</span><span class="p">)%</span><span class="n">LayerPoint</span><span class="p">(</span><span class="n">TotLay</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-3976"></a>        <span class="n">EpsGlassIR</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">GlassLayPtr</span><span class="p">)%</span><span class="n">AbsorpThermalBack</span>
<a name="ln-3977"></a>        <span class="n">RhoGlassIR</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">EpsGlassIR</span>
<a name="ln-3978"></a>
<a name="ln-3979"></a>        <span class="n">EffShBlEmiss</span> <span class="o">=</span> <span class="n">EpsShadeIR</span><span class="o">*</span><span class="p">(</span><span class="mf">1.d0</span><span class="o">+</span><span class="n">RhoGlassIR</span><span class="o">*</span><span class="n">TauShadeIR</span><span class="o">/</span><span class="p">(</span><span class="mf">1.d0</span><span class="o">-</span><span class="n">RhoGlassIR</span><span class="o">*</span><span class="n">RhoShadeIR</span><span class="p">))</span>
<a name="ln-3980"></a>        <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">EffShBlindEmiss</span> <span class="o">=</span> <span class="n">EffShBlEmiss</span>
<a name="ln-3981"></a>        <span class="n">EffGlEmiss</span>   <span class="o">=</span> <span class="n">EpsGlassIR</span><span class="o">*</span><span class="n">TauShadeIR</span><span class="o">/</span><span class="p">(</span><span class="mf">1.d0</span><span class="o">-</span><span class="n">RhoGlassIR</span><span class="o">*</span><span class="n">RhoShadeIR</span><span class="p">)</span>
<a name="ln-3982"></a>        <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">EffGlassEmiss</span> <span class="o">=</span> <span class="n">EffGlEmiss</span>
<a name="ln-3983"></a>      <span class="c">!  EffShBlEmiss = InterpSlatAng(SurfaceWindow(SurfNum)%SlatAngThisTS,SurfaceWindow(SurfNum)%MovableSlats, &amp;</span>
<a name="ln-3984"></a>      <span class="c">!                    SurfaceWindow(SurfNum)%EffShBlindEmiss)</span>
<a name="ln-3985"></a>      <span class="c">!  EffGlEmiss   = InterpSlatAng(SurfaceWindow(SurfNum)%SlatAngThisTS,SurfaceWindow(SurfNum)%MovableSlats, &amp;</span>
<a name="ln-3986"></a>      <span class="c">!                    SurfaceWindow(SurfNum)%EffGlassEmiss)</span>
<a name="ln-3987"></a>        <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">EffInsSurfTemp</span> <span class="o">=</span> <span class="p">(</span><span class="n">EffShBlEmiss</span> <span class="o">*</span> <span class="n">SurfInsideTemp</span> <span class="o">+</span> <span class="n">EffGlEmiss</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ngllayer</span><span class="p">)</span><span class="o">-</span><span class="n">KelvinConv</span><span class="p">))</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3988"></a>                                                   <span class="p">(</span><span class="n">EffShBlEmiss</span> <span class="o">+</span> <span class="n">EffGlEmiss</span><span class="p">)</span>
<a name="ln-3989"></a>      <span class="c">!ELSE</span>
<a name="ln-3990"></a>      <span class="c">!  SurfInsideTemp = theta(2*ngllayer) - TKelvin</span>
<a name="ln-3991"></a>      <span class="c">!END IF</span>
<a name="ln-3992"></a>      <span class="c">!IF(ShadeFlag == ExtShadeOn .OR. ShadeFlag == ExtBlindOn .OR. ShadeFlag == ExtScreenOn) THEN</span>
<a name="ln-3993"></a>        <span class="c">!SurfOutsideTemp = theta(2*ngllayer+1) - TKelvin  !this looks wrong.</span>
<a name="ln-3994"></a>      <span class="k">ELSE</span>
<a name="ln-3995"></a><span class="k">        </span><span class="n">SurfOutsideTemp</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-3996"></a>      <span class="k">END IF</span>
<a name="ln-3997"></a>
<a name="ln-3998"></a><span class="k">      DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nlayer</span>
<a name="ln-3999"></a>        <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ThetaFace</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4000"></a>        <span class="n">SurfaceWindow</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">ThetaFace</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
<a name="ln-4001"></a>
<a name="ln-4002"></a>        <span class="c">! temperatures for reporting</span>
<a name="ln-4003"></a>        <span class="n">FenLaySurfTempFront</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-4004"></a>        <span class="n">FenLaySurfTempBack</span><span class="p">(</span><span class="n">SurfNum</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">KelvinConv</span>
<a name="ln-4005"></a>        <span class="c">!thetas(k) = theta(k)</span>
<a name="ln-4006"></a>      <span class="k">END DO</span>
<a name="ln-4007"></a>
<a name="ln-4008"></a><span class="k">  </span><span class="n">ENDIF</span>
<a name="ln-4009"></a>
<a name="ln-4010"></a>  <span class="k">RETURN</span>
<a name="ln-4011"></a>
<a name="ln-4012"></a><span class="k">END SUBROUTINE </span><span class="n">CalcComplexWindowThermal</span>
<a name="ln-4013"></a>
<a name="ln-4014"></a><span class="c">! This function check if gas with molecular weight has already been feed into coefficients and</span>
<a name="ln-4015"></a><span class="c">! feed arrays</span>
<a name="ln-4016"></a><span class="k">SUBROUTINE </span><span class="n">CheckGasCoefs</span><span class="p">(</span><span class="n">currentWeight</span><span class="p">,</span> <span class="n">indexNumber</span><span class="p">,</span> <span class="n">wght</span><span class="p">,</span> <span class="n">feedData</span><span class="p">)</span>
<a name="ln-4017"></a>
<a name="ln-4018"></a><span class="k">USE </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-4019"></a><span class="k">USE </span><span class="n">TARCOGGassesParams</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">maxgas</span>
<a name="ln-4020"></a>
<a name="ln-4021"></a><span class="kt">LOGICAL</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">feedData</span>
<a name="ln-4022"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(</span><span class="n">maxgas</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>           <span class="kd">::</span>  <span class="n">wght</span>
<a name="ln-4023"></a>
<a name="ln-4024"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">currentWeight</span>
<a name="ln-4025"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">indexNumber</span>
<a name="ln-4026"></a>
<a name="ln-4027"></a><span class="c">!Local variables</span>
<a name="ln-4028"></a><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4029"></a><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">IMix</span><span class="p">,</span> <span class="n">I</span>
<a name="ln-4030"></a><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">numOfMixtures</span>
<a name="ln-4031"></a><span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="n">coeffFound</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4032"></a>
<a name="ln-4033"></a><span class="n">feedData</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4034"></a><span class="n">coeffFound</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4035"></a><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4036"></a><span class="k">DO WHILE</span><span class="p">((</span><span class="n">counter</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">maxgas</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="n">wght</span><span class="p">(</span><span class="n">counter</span><span class="p">).</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">coeffFound</span><span class="p">))</span>
<a name="ln-4037"></a>  <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">currentWeight</span><span class="o">-</span><span class="n">wght</span><span class="p">(</span><span class="n">counter</span><span class="p">)).</span><span class="n">lt</span><span class="p">.</span><span class="mf">1.0d-5</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4038"></a><span class="k">    </span><span class="n">coeffFound</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4039"></a>  <span class="k">ELSE</span>
<a name="ln-4040"></a><span class="k">    </span><span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-4041"></a>  <span class="n">ENDIF</span>
<a name="ln-4042"></a><span class="k">END DO</span> <span class="c">!DO WHILE((counter.LE.maxgas).AND.(wght(couner).NE.0).AND.(.NOT.coeffFound))</span>
<a name="ln-4043"></a>
<a name="ln-4044"></a><span class="c">! In case coefficient is not found data needs to be stored in gas coefficients arrays</span>
<a name="ln-4045"></a><span class="k">IF</span> <span class="p">((.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">coeffFound</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="n">counter</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">maxgas</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-4046"></a><span class="k">  </span><span class="n">feedData</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4047"></a><span class="n">ENDIF</span>
<a name="ln-4048"></a>
<a name="ln-4049"></a><span class="n">indexNumber</span> <span class="o">=</span> <span class="n">counter</span>
<a name="ln-4050"></a>
<a name="ln-4051"></a><span class="k">END SUBROUTINE </span><span class="n">CheckGasCoefs</span>
<a name="ln-4052"></a>
<a name="ln-4053"></a><span class="kt">INTEGER </span><span class="k">FUNCTION </span><span class="n">SearchAscTable</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">ytab</span><span class="p">)</span>
<a name="ln-4054"></a>
<a name="ln-4055"></a>          <span class="c">! FUNCTION INFORMATION:</span>
<a name="ln-4056"></a>          <span class="c">!       AUTHOR         Joe Klems</span>
<a name="ln-4057"></a>          <span class="c">!       DATE WRITTEN   Feb 2011</span>
<a name="ln-4058"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-4059"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-4060"></a>
<a name="ln-4061"></a>          <span class="c">! PURPOSE OF THIS FUNCTION:</span>
<a name="ln-4062"></a>          <span class="c">! Given an ascending monotonic table with n entries, find  an index i</span>
<a name="ln-4063"></a>          <span class="c">! such that ytab(i-1) &lt; y &lt;= ytab(i)</span>
<a name="ln-4064"></a>
<a name="ln-4065"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-4066"></a>          <span class="c">! binary search</span>
<a name="ln-4067"></a>
<a name="ln-4068"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-4069"></a>          <span class="c">! na</span>
<a name="ln-4070"></a>
<a name="ln-4071"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-4072"></a>          <span class="c">! na</span>
<a name="ln-4073"></a>
<a name="ln-4074"></a>  <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-4075"></a>
<a name="ln-4076"></a>          <span class="c">! FUNCTION ARGUMENT DEFINITIONS:</span>
<a name="ln-4077"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">y</span>            <span class="c">! Value to be found in the table</span>
<a name="ln-4078"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">n</span>    <span class="c">! Number of values in the table</span>
<a name="ln-4079"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">DIMENSION</span><span class="p">(:),</span> <span class="k">INTENT</span> <span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">ytab</span>      <span class="c">! Table of values, monotonic, ascending order</span>
<a name="ln-4080"></a>
<a name="ln-4081"></a>          <span class="c">! FUNCTION PARAMETER DEFINITIONS:</span>
<a name="ln-4082"></a>          <span class="c">! na</span>
<a name="ln-4083"></a>
<a name="ln-4084"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-4085"></a>          <span class="c">! na</span>
<a name="ln-4086"></a>
<a name="ln-4087"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-4088"></a>          <span class="c">! na</span>
<a name="ln-4089"></a>
<a name="ln-4090"></a>          <span class="c">! FUNCTION LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-4091"></a>  <span class="kt">INTEGER</span>     <span class="kd">::</span>   <span class="n">Ih</span>    <span class="c">! Intex for upper end of interval</span>
<a name="ln-4092"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>   <span class="n">Il</span>    <span class="c">! Index for lower end of interval</span>
<a name="ln-4093"></a>  <span class="kt">INTEGER</span>    <span class="kd">::</span>   <span class="n">Im</span>    <span class="c">! Index for midpoint of interval</span>
<a name="ln-4094"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>   <span class="n">Yh</span>    <span class="c">! Table value for upper end of interval</span>
<a name="ln-4095"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Yl</span>    <span class="c">! Table value for lower end of interval</span>
<a name="ln-4096"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Ym</span>    <span class="c">! Table value for midpoint of interval</span>
<a name="ln-4097"></a>
<a name="ln-4098"></a>
<a name="ln-4099"></a>  <span class="n">Yh</span> <span class="o">=</span> <span class="n">ytab</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-4100"></a>  <span class="n">Yl</span> <span class="o">=</span> <span class="n">ytab</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4101"></a>  <span class="n">Ih</span> <span class="o">=</span> <span class="n">n</span>
<a name="ln-4102"></a>  <span class="n">Il</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4103"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">Yl</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4104"></a><span class="k">    </span><span class="n">SearchAscTable</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4105"></a>    <span class="k">RETURN</span>
<a name="ln-4106"></a><span class="k">  ELSE IF</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">Yh</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4107"></a><span class="k">    </span><span class="n">SearchAscTable</span> <span class="o">=</span> <span class="n">n</span>
<a name="ln-4108"></a>    <span class="k">RETURN</span>
<a name="ln-4109"></a><span class="k">  </span><span class="n">ENDIF</span>
<a name="ln-4110"></a>  <span class="k">DO</span>
<a name="ln-4111"></a><span class="k">    IF</span><span class="p">(</span><span class="n">Ih</span><span class="o">-</span><span class="n">Il</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-4112"></a><span class="k">    </span><span class="n">Im</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ih</span> <span class="o">+</span> <span class="n">Il</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-4113"></a>    <span class="n">Ym</span> <span class="o">=</span> <span class="n">ytab</span><span class="p">(</span><span class="n">Im</span><span class="p">)</span>
<a name="ln-4114"></a>    <span class="k">IF</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">Ym</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4115"></a><span class="k">      </span><span class="n">Yh</span> <span class="o">=</span> <span class="n">Ym</span>
<a name="ln-4116"></a>      <span class="n">Ih</span> <span class="o">=</span> <span class="n">Im</span>
<a name="ln-4117"></a>    <span class="k">ELSE</span>
<a name="ln-4118"></a><span class="k">      </span><span class="n">Yl</span> <span class="o">=</span> <span class="n">Ym</span>
<a name="ln-4119"></a>      <span class="n">Il</span> <span class="o">=</span> <span class="n">Im</span>
<a name="ln-4120"></a>    <span class="n">ENDIF</span>
<a name="ln-4121"></a>
<a name="ln-4122"></a>  <span class="k">END DO</span>
<a name="ln-4123"></a>
<a name="ln-4124"></a><span class="k">  </span><span class="n">SearchAscTable</span> <span class="o">=</span> <span class="n">Ih</span>
<a name="ln-4125"></a>
<a name="ln-4126"></a><span class="k">RETURN</span>
<a name="ln-4127"></a>
<a name="ln-4128"></a><span class="k">END FUNCTION </span><span class="n">SearchAscTable</span>
<a name="ln-4129"></a>
<a name="ln-4130"></a><span class="c">!=================================================================================================</span>
<a name="ln-4131"></a>
<a name="ln-4132"></a><span class="k">SUBROUTINE </span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<a name="ln-4133"></a>
<a name="ln-4134"></a>  <span class="c">! Cross product between vectors A and B</span>
<a name="ln-4135"></a>
<a name="ln-4136"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-4137"></a>
<a name="ln-4138"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-4139"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>          <span class="c">! Vector components: C = A X B</span>
<a name="ln-4140"></a>
<a name="ln-4141"></a>          <span class="c">! FLOW:</span>
<a name="ln-4142"></a>  <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">A</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4143"></a>  <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-4144"></a>  <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4145"></a>
<a name="ln-4146"></a>  <span class="k">RETURN</span>
<a name="ln-4147"></a>
<a name="ln-4148"></a><span class="k">END SUBROUTINE </span><span class="n">CrossProduct</span>
<a name="ln-4149"></a>
<a name="ln-4150"></a><span class="k">SUBROUTINE </span><span class="n">PierceSurfaceVector</span><span class="p">(</span><span class="n">ISurf</span><span class="p">,</span> <span class="n">Orig</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">IPIERC</span><span class="p">,</span> <span class="n">HitPt</span><span class="p">)</span>
<a name="ln-4151"></a>
<a name="ln-4152"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-4153"></a>          <span class="c">!       AUTHOR         Fred Winkelmann</span>
<a name="ln-4154"></a>          <span class="c">!       DATE WRITTEN   July 1997</span>
<a name="ln-4155"></a>          <span class="c">!       MODIFIED       Sept 2003, FCW: modification of Daylighting routine DayltgPierceSurface</span>
<a name="ln-4156"></a>          <span class="c">!                             June 2011, JHK: inputs made vector types; copy of routine from</span>
<a name="ln-4157"></a>          <span class="c">!                                        SolarReflectionManager</span>
<a name="ln-4158"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-4159"></a>
<a name="ln-4160"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-4161"></a>          <span class="c">! Returns point CPhit that line through point R1 in direction of unit vector RN intersects</span>
<a name="ln-4162"></a>          <span class="c">! the plan of surface ISurf. IPIERC = 1 if CPhit is inside the perimeter of ISurf. If not,</span>
<a name="ln-4163"></a>          <span class="c">! IPIERC = 0. This routine works for convex and concave surfaces with 3 or more vertices.</span>
<a name="ln-4164"></a>          <span class="c">!</span>
<a name="ln-4165"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-4166"></a>
<a name="ln-4167"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-4168"></a>          <span class="c">! Based on DOE-2.1E subroutine DPIERC.</span>
<a name="ln-4169"></a>
<a name="ln-4170"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-4171"></a>  <span class="k">USE </span><span class="n">vectors</span>
<a name="ln-4172"></a>
<a name="ln-4173"></a>  <span class="k">IMPLICIT NONE</span> <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-4174"></a>
<a name="ln-4175"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:na</span>
<a name="ln-4176"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS:na</span>
<a name="ln-4177"></a>          <span class="c">! DERIVED TYPE DEFINITIONS:na</span>
<a name="ln-4178"></a>
<a name="ln-4179"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-4180"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ISurf</span>      <span class="c">! Surface index</span>
<a name="ln-4181"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">Orig</span>      <span class="c">! Point from which ray originates</span>
<a name="ln-4182"></a>  <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">Dir</span>      <span class="c">! Unit vector along in direction of ray whose</span>
<a name="ln-4183"></a>                                             <span class="c">!  intersection with surface is to be determined</span>
<a name="ln-4184"></a>  <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">IPIERC</span>     <span class="c">! =1 if line through point R1 in direction of unit vector</span>
<a name="ln-4185"></a>                                             <span class="c">!  RN intersects surface ISurf; =0 otherwise.</span>
<a name="ln-4186"></a> <span class="k">TYPE</span> <span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">HitPt</span>   <span class="c">! Point that ray along RN intersects plane of surface</span>
<a name="ln-4187"></a>
<a name="ln-4188"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-4189"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">CPhit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="c">! Point that ray along RN intersects plane of surface</span>
<a name="ln-4190"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">R1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>      <span class="c">! Point from which ray originates</span>
<a name="ln-4191"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">RN</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>      <span class="c">! Unit vector along in direction of ray whose</span>
<a name="ln-4192"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">V1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! First vertex</span>
<a name="ln-4193"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">V2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! Second vertex</span>
<a name="ln-4194"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">V3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! Third vertex</span>
<a name="ln-4195"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">NV</span>                       <span class="c">! Number of vertices (3 or 4)</span>
<a name="ln-4196"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! Vector from vertex 1 to 2</span>
<a name="ln-4197"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! Vector from vertex 2 to 3</span>
<a name="ln-4198"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AXC</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                   <span class="c">! Cross product of A and C</span>
<a name="ln-4199"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SN</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! Vector normal to surface (SN = A1 X A2)</span>
<a name="ln-4200"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AA</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! AA(I) = A(N,I)</span>
<a name="ln-4201"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CC</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="c">! CC(I) = C(N,I)</span>
<a name="ln-4202"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CCC</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                   <span class="c">! Vector from vertex 2 to CP</span>
<a name="ln-4203"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AAA</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                   <span class="c">! Vector from vertex 2 to vertex 1</span>
<a name="ln-4204"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">BBB</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                   <span class="c">! Vector from vertex 2 to vertex 3</span>
<a name="ln-4205"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">N</span>                        <span class="c">! Vertex loop index</span>
<a name="ln-4206"></a>  <span class="kt">INTEGER</span>   <span class="kd">::</span> <span class="n">I</span>                        <span class="c">! Vertext-to-vertex index</span>
<a name="ln-4207"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F1</span><span class="p">,</span><span class="n">F2</span>                    <span class="c">! Intermediate variables</span>
<a name="ln-4208"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">SCALE</span>                    <span class="c">! Scale factor</span>
<a name="ln-4209"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DOTCB</span>                    <span class="c">! Dot product of vectors CCC and BBB</span>
<a name="ln-4210"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DOTCA</span>                    <span class="c">! Dot product of vectors CCC and AAA</span>
<a name="ln-4211"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DOTAXCSN</span>                 <span class="c">! Dot product of vectors AXC and SN</span>
<a name="ln-4212"></a>
<a name="ln-4213"></a><span class="c">!  REAL(r64)      :: V(4,3)                   ! Vertices of surfaces</span>
<a name="ln-4214"></a><span class="c">!  REAL(r64)      :: A(4,3)                   ! Vertex-to-vertex vectors; A(1,i) is from vertex 1 to 2, etc.</span>
<a name="ln-4215"></a><span class="c">!  REAL(r64)      :: C(4,3)                   ! Vectors from vertices to intersection point</span>
<a name="ln-4216"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">SAVE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">V</span>     <span class="c">! Vertices of surfaces</span>
<a name="ln-4217"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">SAVE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">A</span>     <span class="c">! Vertex-to-vertex vectors; A(1,i) is from vertex 1 to 2, etc.</span>
<a name="ln-4218"></a>  <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">SAVE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">C</span>     <span class="c">! Vectors from vertices to intersection point</span>
<a name="ln-4219"></a>  <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="n">FirstTime</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-4220"></a>
<a name="ln-4221"></a>          <span class="c">! FLOW:</span>
<a name="ln-4222"></a>  <span class="n">IPIERC</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4223"></a>  <span class="n">R1</span> <span class="o">=</span> <span class="n">Orig</span>
<a name="ln-4224"></a>  <span class="n">RN</span> <span class="o">=</span> <span class="n">Dir</span>
<a name="ln-4225"></a>  <span class="c">! Vertex vectors</span>
<a name="ln-4226"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">FirstTime</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4227"></a><span class="k">    ALLOCATE</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">MaxVerticesPerSurface</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-4228"></a>    <span class="n">V</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4229"></a>    <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">MaxVerticesPerSurface</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-4230"></a>    <span class="n">A</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4231"></a>    <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="n">MaxVerticesPerSurface</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-4232"></a>    <span class="n">C</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4233"></a>    <span class="n">FirstTime</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4234"></a>  <span class="n">ENDIF</span>
<a name="ln-4235"></a>
<a name="ln-4236"></a>  <span class="n">NV</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Sides</span>
<a name="ln-4237"></a>  <span class="k">DO </span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NV</span>
<a name="ln-4238"></a>    <span class="n">V</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Vertex</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">X</span>
<a name="ln-4239"></a>    <span class="n">V</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Vertex</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">Y</span>
<a name="ln-4240"></a>    <span class="n">V</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="n">Vertex</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">Z</span>
<a name="ln-4241"></a>  <span class="k">END DO</span>
<a name="ln-4242"></a>
<a name="ln-4243"></a>  <span class="c">! Vertex-to-vertex vectors. A(1,2) is from vertex 1 to 2, etc.</span>
<a name="ln-4244"></a>  <span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-4245"></a>    <span class="k">DO </span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NV</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-4246"></a>      <span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span> <span class="o">-</span> <span class="n">V</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4247"></a>    <span class="k">END DO</span>
<a name="ln-4248"></a><span class="k">    </span><span class="n">A</span><span class="p">(</span><span class="n">NV</span><span class="p">,</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span> <span class="o">-</span> <span class="n">V</span><span class="p">(</span><span class="n">NV</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4249"></a>    <span class="n">A1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4250"></a>    <span class="n">A2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4251"></a>    <span class="n">V1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4252"></a>    <span class="n">V2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4253"></a>    <span class="n">V3</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4254"></a>  <span class="k">END DO</span>
<a name="ln-4255"></a>
<a name="ln-4256"></a>  <span class="c">! Vector normal to surface</span>
<a name="ln-4257"></a>  <span class="k">CALL </span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">SN</span><span class="p">)</span>
<a name="ln-4258"></a>  <span class="c">! Scale factor, the solution of SN.(CPhit-V2) = 0 and</span>
<a name="ln-4259"></a>  <span class="c">! CPhit = R1 + SCALE*RN, where CPhit is the point that RN,</span>
<a name="ln-4260"></a>  <span class="c">! when extended, intersects the plane of the surface.</span>
<a name="ln-4261"></a>  <span class="n">F1</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">SN</span><span class="p">,</span> <span class="n">V2</span> <span class="o">-</span> <span class="n">R1</span><span class="p">)</span>
<a name="ln-4262"></a>  <span class="n">F2</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">SN</span><span class="p">,</span> <span class="n">RN</span><span class="p">)</span>
<a name="ln-4263"></a>  <span class="c">! Skip surfaces that are parallel to RN</span>
<a name="ln-4264"></a>  <span class="k">IF</span> <span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">F2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01d0</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-4265"></a><span class="k">  </span><span class="nb">SCALE</span> <span class="o">=</span> <span class="n">F1</span> <span class="o">/</span> <span class="n">F2</span>
<a name="ln-4266"></a>  <span class="c">! Skip surfaces that RN points away from</span>
<a name="ln-4267"></a>  <span class="k">IF</span> <span class="p">(</span><span class="nb">SCALE</span> <span class="o">&lt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-4268"></a>  <span class="c">! Point that RN intersects plane of surface</span>
<a name="ln-4269"></a>  <span class="n">CPhit</span> <span class="o">=</span> <span class="n">R1</span> <span class="o">+</span> <span class="n">RN</span> <span class="o">*</span> <span class="nb">SCALE</span>
<a name="ln-4270"></a><span class="nb">  </span><span class="n">HitPt</span> <span class="o">=</span> <span class="n">CPhit</span>
<a name="ln-4271"></a>  <span class="c">! Vector from vertex 2 to CPhit</span>
<a name="ln-4272"></a>  <span class="n">CCC</span> <span class="o">=</span> <span class="n">CPhit</span> <span class="o">-</span> <span class="n">V2</span>
<a name="ln-4273"></a>
<a name="ln-4274"></a>  <span class="c">! Two cases: rectangle and non-rectangle; do rectangle</span>
<a name="ln-4275"></a>  <span class="c">! first since most common shape and faster calculation</span>
<a name="ln-4276"></a>  <span class="k">IF</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="nb">Shape</span> <span class="o">==</span> <span class="n">Rectangle</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="nb">Shape</span> <span class="o">==</span> <span class="n">RectangularDoorWindow</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>         <span class="p">&amp;</span>
<a name="ln-4277"></a>      <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="nb">Shape</span> <span class="o">==</span> <span class="n">RectangularOverhang</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="nb">Shape</span> <span class="o">==</span> <span class="n">RectangularLeftFin</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>  <span class="p">&amp;</span>
<a name="ln-4278"></a>      <span class="n">Surface</span><span class="p">(</span><span class="n">ISurf</span><span class="p">)%</span><span class="nb">Shape</span> <span class="o">==</span> <span class="n">RectangularRightFin</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4279"></a>    <span class="c">!</span>
<a name="ln-4280"></a>    <span class="c">! Surface is rectangular</span>
<a name="ln-4281"></a>    <span class="c">!</span>
<a name="ln-4282"></a>    <span class="c">! Vectors from vertex 2 to vertex 1 and vertex 2 to vertex 3</span>
<a name="ln-4283"></a>    <span class="n">AAA</span> <span class="o">=</span> <span class="n">V1</span> <span class="o">-</span> <span class="n">V2</span>
<a name="ln-4284"></a>    <span class="n">BBB</span> <span class="o">=</span> <span class="n">V3</span> <span class="o">-</span> <span class="n">V2</span>
<a name="ln-4285"></a>    <span class="c">! Intersection point, CCC, is inside rectangle if</span>
<a name="ln-4286"></a>    <span class="c">! 0 &lt; CCC.BBB &lt; BBB.BBB AND 0 &lt; CCC.AAA &lt; AAA.AAA</span>
<a name="ln-4287"></a>    <span class="n">DOTCB</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">CCC</span><span class="p">,</span> <span class="n">BBB</span><span class="p">)</span>
<a name="ln-4288"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">DOTCB</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-4289"></a><span class="k">    IF</span> <span class="p">(</span><span class="n">DOTCB</span> <span class="o">&gt;</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">BBB</span><span class="p">,</span><span class="n">BBB</span><span class="p">))</span> <span class="k">RETURN</span>
<a name="ln-4290"></a><span class="k">    </span><span class="n">DOTCA</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">CCC</span><span class="p">,</span> <span class="n">AAA</span><span class="p">)</span>
<a name="ln-4291"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">DOTCA</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-4292"></a><span class="k">    IF</span> <span class="p">(</span><span class="n">DOTCA</span> <span class="o">&gt;</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">AAA</span><span class="p">,</span><span class="n">AAA</span><span class="p">))</span> <span class="k">RETURN</span>
<a name="ln-4293"></a>    <span class="c">! Surface is intersected</span>
<a name="ln-4294"></a>    <span class="n">IPIERC</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4295"></a>  <span class="k">ELSE</span>
<a name="ln-4296"></a>    <span class="c">!</span>
<a name="ln-4297"></a>    <span class="c">! Surface is not rectangular</span>
<a name="ln-4298"></a>    <span class="c">!</span>
<a name="ln-4299"></a>    <span class="c">! Vectors from surface vertices to CPhit</span>
<a name="ln-4300"></a>    <span class="k">DO </span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NV</span>
<a name="ln-4301"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-4302"></a>        <span class="n">C</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">CPhit</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">-</span> <span class="n">V</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4303"></a>      <span class="k">END DO</span>
<a name="ln-4304"></a><span class="k">    END DO</span>
<a name="ln-4305"></a>    <span class="c">! Cross products of vertex-to-vertex vectors and</span>
<a name="ln-4306"></a>    <span class="c">! vertex-to-CPhit vectors</span>
<a name="ln-4307"></a>    <span class="k">DO </span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">NV</span>
<a name="ln-4308"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-4309"></a>        <span class="n">AA</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4310"></a>        <span class="n">CC</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
<a name="ln-4311"></a>      <span class="k">END DO</span>
<a name="ln-4312"></a><span class="k">      CALL </span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">AA</span><span class="p">,</span><span class="n">CC</span><span class="p">,</span><span class="n">AXC</span><span class="p">)</span>
<a name="ln-4313"></a>      <span class="n">DOTAXCSN</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">AXC</span><span class="p">,</span><span class="n">SN</span><span class="p">)</span>
<a name="ln-4314"></a>       <span class="c">! If at least one of these dot products is negative</span>
<a name="ln-4315"></a>       <span class="c">! intersection point is outside of surface</span>
<a name="ln-4316"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">DOTAXCSN</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-4317"></a><span class="k">    END DO</span>
<a name="ln-4318"></a>    <span class="c">! Surface is intersected</span>
<a name="ln-4319"></a>    <span class="n">IPIERC</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4320"></a>  <span class="k">END IF</span>
<a name="ln-4321"></a>
<a name="ln-4322"></a><span class="k">  RETURN</span>
<a name="ln-4323"></a>
<a name="ln-4324"></a><span class="k">END SUBROUTINE </span><span class="n">PierceSurfaceVector</span>
<a name="ln-4325"></a>
<a name="ln-4326"></a>
<a name="ln-4327"></a><span class="c">!     NOTICE</span>
<a name="ln-4328"></a><span class="c">!</span>
<a name="ln-4329"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-4330"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-4331"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-4332"></a><span class="c">!</span>
<a name="ln-4333"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-4334"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-4335"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-4336"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-4337"></a><span class="c">!</span>
<a name="ln-4338"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-4339"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-4340"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-4341"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-4342"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-4343"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-4344"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-4345"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-4346"></a><span class="c">!     permit others to do so.</span>
<a name="ln-4347"></a><span class="c">!</span>
<a name="ln-4348"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-4349"></a><span class="c">!</span>
<a name="ln-4350"></a>
<a name="ln-4351"></a><span class="k">END MODULE </span><span class="n">WindowComplexManager</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>


<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../sourcefile/airflownetworkbalancemanager.f90.html">AirflowNetworkBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html">AirflowNetworkSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiator.f90.html">BaseboardRadiator.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorelectric.f90.html">BaseboardRadiatorElectric.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorsteam.f90.html">BaseboardRadiatorSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorwater.f90.html">BaseboardRadiatorWater.f90</a>

      <a class="list-group-item" href="../sourcefile/branchinputmanager.f90.html">BranchInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/branchnodeconnections.f90.html">BranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/conductiontransferfunctioncalc.f90.html">ConductionTransferFunctionCalc.f90</a>

      <a class="list-group-item" href="../sourcefile/cooltower.f90.html">CoolTower.f90</a>

      <a class="list-group-item" href="../sourcefile/costestimatemanager.f90.html">CostEstimateManager.f90</a>

      <a class="list-group-item" href="../sourcefile/curvemanager.f90.html">CurveManager.f90</a>

      <a class="list-group-item" href="../sourcefile/cvfonlyroutines.f90.html">CVFOnlyRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairflownetwork.f90.html">DataAirflowNetwork.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairloop.f90.html">DataAirLoop.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairsystems.f90.html">DataAirSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchairloopplant.f90.html">DataBranchAirLoopPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchnodeconnections.f90.html">DataBranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/databsdfwindow.f90.html">DataBSDFWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/datacomplexfenestration.f90.html">DataComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/datacontaminantbalance.f90.html">DataContaminantBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconvergparams.f90.html">DataConvergParams.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconversions.f90.html">DataConversions.f90</a>

      <a class="list-group-item" href="../sourcefile/datacostestimate.f90.html">DataCostEstimate.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylighting.f90.html">DataDaylighting.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylightingdevices.f90.html">DataDaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/datadefineequip.f90.html">Datadefineequip.f90</a>

      <a class="list-group-item" href="../sourcefile/datadelight.f90.html">DataDElight.f90</a>

      <a class="list-group-item" href="../sourcefile/dataenvironment.f90.html">DataEnvironment.f90</a>

      <a class="list-group-item" href="../sourcefile/dataequivalentlayerwindow.f90.html">DataEquivalentLayerWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/dataerrortracking.f90.html">DataErrorTracking.f90</a>

      <a class="list-group-item" href="../sourcefile/datagenerators.f90.html">DataGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobalconstants.f90.html">DataGlobalConstants.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobals.f90.html">DataGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalance.f90.html">DataHeatBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalfansys.f90.html">DataHeatBalFanSys.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalsurface.f90.html">DataHeatBalSurface.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvaccontrollers.f90.html">DataHVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvacglobals.f90.html">DataHVACGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datainterfaces.f90.html">DataInterfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/dataipshortcuts.f90.html">DataIPShortCuts.f90</a>

      <a class="list-group-item" href="../sourcefile/dataloopnode.f90.html">DataLoopNode.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalance.f90.html">DataMoistureBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalanceempd.f90.html">DataMoistureBalanceEMPD.f90</a>

      <a class="list-group-item" href="../sourcefile/dataoutputs.f90.html">DataOutputs.f90</a>

      <a class="list-group-item" href="../sourcefile/dataphotovoltaics.f90.html">DataPhotovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplant.f90.html">DataPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplantpipingsystems.f90.html">DataPlantPipingSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/dataprecisionglobals.f90.html">DataPrecisionGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datareportingflags.f90.html">DataReportingFlags.f90</a>

      <a class="list-group-item" href="../sourcefile/dataroomair.f90.html">DataRoomAir.f90</a>

      <a class="list-group-item" href="../sourcefile/datarootfinder.f90.html">DataRootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/dataruntimelanguage.f90.html">DataRuntimeLanguage.f90</a>

      <a class="list-group-item" href="../sourcefile/datashadowingcombinations.f90.html">DataShadowingCombinations.f90</a>

      <a class="list-group-item" href="../sourcefile/datasizing.f90.html">DataSizing.f90</a>

      <a class="list-group-item" href="../sourcefile/datastringglobals.f90.html">DataStringGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacecolors.f90.html">DataSurfaceColors.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacelists.f90.html">DataSurfaceLists.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfaces.f90.html">DataSurfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/datasystemvariables.f90.html">DataSystemVariables.f90</a>

      <a class="list-group-item" href="../sourcefile/datatimings.f90.html">DataTimings.f90</a>

      <a class="list-group-item" href="../sourcefile/dataucsdshareddata.f90.html">DataUCSDSharedData.f90</a>

      <a class="list-group-item" href="../sourcefile/datavectortypes.f90.html">DataVectorTypes.f90</a>

      <a class="list-group-item" href="../sourcefile/dataviewfactorinformation.f90.html">DataViewFactorInformation.f90</a>

      <a class="list-group-item" href="../sourcefile/datawater.f90.html">DataWater.f90</a>

      <a class="list-group-item" href="../sourcefile/datazonecontrols.f90.html">DataZoneControls.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneenergydemands.f90.html">DataZoneEnergyDemands.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneequipment.f90.html">DataZoneEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingdevices.f90.html">DaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingmanager.f90.html">DaylightingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf.f90.html">DElightManagerF.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf_no.f90.html">DElightManagerF_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/demandmanager.f90.html">DemandManager.f90</a>

      <a class="list-group-item" href="../sourcefile/desiccantdehumidifiers.f90.html">DesiccantDehumidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/directair.f90.html">DirectAir.f90</a>

      <a class="list-group-item" href="../sourcefile/displayroutines.f90.html">DisplayRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dxcoil.f90.html">DXCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/earthtube.f90.html">EarthTube.f90</a>

      <a class="list-group-item" href="../sourcefile/economiclifecyclecost.f90.html">EconomicLifeCycleCost.f90</a>

      <a class="list-group-item" href="../sourcefile/economictariff.f90.html">EconomicTariff.f90</a>

      <a class="list-group-item" href="../sourcefile/ecoroof.f90.html">EcoRoof.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowergenerators.f90.html">ElectricPowerGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowermanager.f90.html">ElectricPowerManager.f90</a>

      <a class="list-group-item" href="../sourcefile/emsmanager.f90.html">EMSManager.f90</a>

      <a class="list-group-item" href="../sourcefile/energyplus.f90.html">EnergyPlus.f90</a>

      <a class="list-group-item" href="../sourcefile/exteriorenergyusemanager.f90.html">ExteriorEnergyUseManager.f90</a>

      <a class="list-group-item" href="../sourcefile/externalinterface_no.f90.html">ExternalInterface_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/fancoilunits.f90.html">FanCoilUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/faultsmanager.f90.html">FaultsManager.f90</a>

      <a class="list-group-item" href="../sourcefile/fluidproperties.f90.html">FluidProperties.f90</a>

      <a class="list-group-item" href="../sourcefile/general.f90.html">General.f90</a>

      <a class="list-group-item" href="../sourcefile/generalroutines.f90.html">GeneralRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/globalnames.f90.html">GlobalNames.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceairmanager.f90.html">HeatBalanceAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceconvectioncoeffs.f90.html">HeatBalanceConvectionCoeffs.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancehamtmanager.f90.html">HeatBalanceHAMTManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceinternalheatgains.f90.html">HeatBalanceInternalHeatGains.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceintradexchange.f90.html">HeatBalanceIntRadExchange.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemanager.f90.html">HeatBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemovableinsulation.f90.html">HeatBalanceMovableInsulation.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancesurfacemanager.f90.html">HeatBalanceSurfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalfinitedifferencemanager.f90.html">HeatBalFiniteDifferenceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatrecovery.f90.html">HeatRecovery.f90</a>

      <a class="list-group-item" href="../sourcefile/humidifiers.f90.html">Humidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccontrollers.f90.html">HVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccooledbeam.f90.html">HVACCooledBeam.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdualductsystem.f90.html">HVACDualDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacduct.f90.html">HVACDuct.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdxsystem.f90.html">HVACDXSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacevapcomponent.f90.html">HVACEvapComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfancomponent.f90.html">HVACFanComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfurnace.f90.html">HVACFurnace.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacheatingcoils.f90.html">HVACHeatingCoils.f90</a>

      <a class="list-group-item" href="../sourcefile/hvachxassistedcoolingcoil.f90.html">HVACHXAssistedCoolingCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacinterfacemanager.f90.html">HVACInterfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmanager.f90.html">HVACManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmixercomponent.f90.html">HVACMixerComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmultispeedheatpump.f90.html">HVACMultiSpeedHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductinduc.f90.html">HVACSingleDuctInduc.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductsystem.f90.html">HVACSingleDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsplittercomponent.f90.html">HVACSplitterComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacstandaloneerv.f90.html">HVACStandAloneERV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsteamcoilcomponent.f90.html">HVACSteamCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvactranspiredcollector.f90.html">HVACTranspiredCollector.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarybypassvav.f90.html">HVACUnitaryBypassVAV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarysystem.f90.html">HVACUnitarySystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacvariablerefrigerantflow.f90.html">HVACVariableRefrigerantFlow.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatercoilcomponent.f90.html">HVACWaterCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoair.f90.html">HVACWatertoAir.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoairmultispeedhp.f90.html">HVACWatertoAirMultiSpeedHP.f90</a>

      <a class="list-group-item" href="../sourcefile/inputprocessor.f90.html">InputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/matrixdatamanager.f90.html">MatrixDataManager.f90</a>

      <a class="list-group-item" href="../sourcefile/mixedair.f90.html">MixedAir.f90</a>

      <a class="list-group-item" href="../sourcefile/moisturebalanceempdmanager.f90.html">MoistureBalanceEMPDManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nodeinputmanager.f90.html">NodeInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nonzoneequipmentmanager.f90.html">NonZoneEquipmentManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outairnodemanager.f90.html">OutAirNodeManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outdoorairunit.f90.html">OutdoorAirUnit.f90</a>

      <a class="list-group-item" href="../sourcefile/outputprocessor.f90.html">OutputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreportpredefined.f90.html">OutputReportPredefined.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreports.f90.html">OutputReports.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreporttabular.f90.html">OutputReportTabular.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedterminalheatpump.f90.html">PackagedTerminalHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedthermalstoragecoil.f90.html">PackagedThermalStorageCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaics.f90.html">Photovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaicthermalcollectors.f90.html">PhotovoltaicThermalCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantabsorptionchillers.f90.html">PlantAbsorptionChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilers.f90.html">PlantBoilers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilerssteam.f90.html">PlantBoilersSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcentralgshp.f90.html">PlantCentralGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantchillers.f90.html">PlantChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondloopoperation.f90.html">PlantCondLoopOperation.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondlooptowers.f90.html">PlantCondLoopTowers.f90</a>

      <a class="list-group-item" href="../sourcefile/planteirchillers.f90.html">PlantEIRChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantevapfluidcoolers.f90.html">PlantEvapFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantexhaustabsorptionchiller.f90.html">PlantExhaustAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantfluidcoolers.f90.html">PlantFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgasabsorptionchiller.f90.html">PlantGasAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgroundheatexchangers.f90.html">PlantGroundHeatExchangers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantheatexchanger.f90.html">PlantHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/planticethermalstorage.f90.html">PlantIceThermalStorage.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloadprofile.f90.html">PlantLoadProfile.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopequipment.f90.html">PlantLoopEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopsolver.f90.html">PlantLoopSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/plantmanager.f90.html">PlantManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantoutsideenergysources.f90.html">PlantOutsideEnergySources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipeheattransfer.f90.html">PlantPipeHeatTransfer.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipes.f90.html">PlantPipes.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipingsystemmanager.f90.html">PlantPipingSystemManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpondgroundheatexchanger.f90.html">PlantPondGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpressuresystem.f90.html">PlantPressureSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpumps.f90.html">PlantPumps.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsolarcollectors.f90.html">PlantSolarCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsurfacegroundheatexchanger.f90.html">PlantSurfaceGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantutilities.f90.html">PlantUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/plantvalves.f90.html">PlantValves.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatersources.f90.html">PlantWaterSources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwaterthermaltank.f90.html">PlantWaterThermalTank.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatertowatergshp.f90.html">PlantWatertoWaterGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwateruse.f90.html">PlantWaterUse.f90</a>

      <a class="list-group-item" href="../sourcefile/pollutionanalysismodule.f90.html">PollutionAnalysisModule.f90</a>

      <a class="list-group-item" href="../sourcefile/poweredinductionunits.f90.html">PoweredInductionUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/psychroutines.f90.html">PsychRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/purchasedairmanager.f90.html">Purchasedairmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemhightemp.f90.html">RadiantSystemHighTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemlowtemp.f90.html">RadiantSystemLowTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/refrigeratedcase.f90.html">RefrigeratedCase.f90</a>

      <a class="list-group-item" href="../sourcefile/reportsizingmanager.f90.html">ReportSizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/returnairpath.f90.html">ReturnAirPath.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmanager.f90.html">RoomAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelcrossvent.f90.html">RoomAirModelCrossVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodeldisplacementvent.f90.html">RoomAirModelDisplacementVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelmundt.f90.html">RoomAirModelMundt.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelufad.f90.html">RoomAirModelUFAD.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelusertemppattern.f90.html">RoomAirModelUserTempPattern.f90</a>

      <a class="list-group-item" href="../sourcefile/rootfinder.f90.html">RootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/runtimelanguageprocessor.f90.html">RuntimeLanguageProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/schedulemanager.f90.html">ScheduleManager.f90</a>

      <a class="list-group-item" href="../sourcefile/setpointmanager.f90.html">SetPointManager.f90</a>

      <a class="list-group-item" href="../sourcefile/simairservingzones.f90.html">SimAirServingZones.f90</a>

      <a class="list-group-item" href="../sourcefile/simulationmanager.f90.html">SimulationManager.f90</a>

      <a class="list-group-item" href="../sourcefile/sizingmanager.f90.html">SizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarreflectionmanager.f90.html">SolarReflectionManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarshading.f90.html">SolarShading.f90</a>

      <a class="list-group-item" href="../sourcefile/sortandstringutilities.f90.html">SortAndStringUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlite3.c.html">sqlite3.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitecroutines.c.html">SQLiteCRoutines.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines.f90.html">SQLiteFortranRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines_no.f90.html">SQLiteFortranRoutines_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/standardratings.f90.html">StandardRatings.f90</a>

      <a class="list-group-item" href="../sourcefile/surfacegeometry.f90.html">SurfaceGeometry.f90</a>

      <a class="list-group-item" href="../sourcefile/systemavailabilitymanager.f90.html">SystemAvailabilityManager.f90</a>

      <a class="list-group-item" href="../sourcefile/systemreports.f90.html">SystemReports.f90</a>

      <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html">TarcogComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalchimney.f90.html">ThermalChimney.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalcomfort.f90.html">ThermalComfort.f90</a>

      <a class="list-group-item" href="../sourcefile/unitheater.f90.html">UnitHeater.f90</a>

      <a class="list-group-item" href="../sourcefile/unitventilator.f90.html">UnitVentilator.f90</a>

      <a class="list-group-item" href="../sourcefile/userdefinedcomponents.f90.html">UserDefinedComponents.f90</a>

      <a class="list-group-item" href="../sourcefile/utilityroutines.f90.html">UtilityRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/vectorutilities.f90.html">VectorUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/ventilatedslab.f90.html">VentilatedSlab.f90</a>

      <a class="list-group-item" href="../sourcefile/watermanager.f90.html">WaterManager.f90</a>

      <a class="list-group-item" href="../sourcefile/weathermanager.f90.html">WeatherManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowac.f90.html">WindowAC.f90</a>

      <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html">WindowComplexManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowequivalentlayer.f90.html">WindowEquivalentLayer.f90</a>

      <a class="list-group-item" href="../sourcefile/windowmanager.f90.html">WindowManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windturbine.f90.html">WindTurbine.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneairloopequipmentmanager.f90.html">Zoneairloopequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zonecontaminantpredictorcorrector.f90.html">ZoneContaminantPredictorCorrector.f90</a>

      <a class="list-group-item" href="../sourcefile/zonedehumidifier.f90.html">ZoneDehumidifier.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneequipmentmanager.f90.html">Zoneequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneplenumcomponent.f90.html">ZonePlenumComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/zonetemppredictorcorrector.f90.html">ZoneTempPredictorCorrector.f90</a>

    </div>
  </div>
</div>


  </section>

    <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by
            <a href="https://github.com/cmacmackin/ford">FORD</a>

          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> EnergyPlusFortran</p></div>
      </div>
      <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': {
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>
