<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	 <meta name="description" content="">

    <meta name="author" content="dmey (forked from NREL)" >
    <link rel="icon" href="../favicon.png">

    <title>AirflowNetworkSolver.f90 &ndash; EnergyPlusFortran</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>


    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">EnergyPlusFortran <small>8.1.0.009</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">

            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">

            <li><a href="../lists/files.html">Source Files</a></li>


            <li><a href="../lists/modules.html">Modules</a></li>


            <li><a href="../lists/procedures.html">Procedures</a></li>


            <li><a href="../lists/types.html">Derived Types</a></li>


            <li><a href="../program/energyplus.html">Program</a></li>

            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/energyplus.html">Program</a></li>

          </ul>


        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">


  <div class="row">
    <h1>AirflowNetworkSolver.f90
    <small>Source File</small>

    </h1>

<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">


     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 0.7% of total for source files.">2799 statements</a>
     </li>


    <li><i class="fa fa-code"></i><a href="../src/AirflowNetworkSolver.f90"> Source File</a></li>

  </ul>
  <ol class="breadcrumb in-well text-right">

     <li class="active">AirflowNetworkSolver.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">

<div id="sidebar">


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../module/airflownetworksolver.html">AirflowNetworkSolver</a>

    </div>
  </div>
</div>


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html#src">AirflowNetworkSolver.f90</a>
  </div>
</div>


  <hr>


<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../sourcefile/airflownetworkbalancemanager.f90.html">AirflowNetworkBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html">AirflowNetworkSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiator.f90.html">BaseboardRadiator.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorelectric.f90.html">BaseboardRadiatorElectric.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorsteam.f90.html">BaseboardRadiatorSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorwater.f90.html">BaseboardRadiatorWater.f90</a>

      <a class="list-group-item" href="../sourcefile/branchinputmanager.f90.html">BranchInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/branchnodeconnections.f90.html">BranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/conductiontransferfunctioncalc.f90.html">ConductionTransferFunctionCalc.f90</a>

      <a class="list-group-item" href="../sourcefile/cooltower.f90.html">CoolTower.f90</a>

      <a class="list-group-item" href="../sourcefile/costestimatemanager.f90.html">CostEstimateManager.f90</a>

      <a class="list-group-item" href="../sourcefile/curvemanager.f90.html">CurveManager.f90</a>

      <a class="list-group-item" href="../sourcefile/cvfonlyroutines.f90.html">CVFOnlyRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairflownetwork.f90.html">DataAirflowNetwork.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairloop.f90.html">DataAirLoop.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairsystems.f90.html">DataAirSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchairloopplant.f90.html">DataBranchAirLoopPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchnodeconnections.f90.html">DataBranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/databsdfwindow.f90.html">DataBSDFWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/datacomplexfenestration.f90.html">DataComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/datacontaminantbalance.f90.html">DataContaminantBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconvergparams.f90.html">DataConvergParams.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconversions.f90.html">DataConversions.f90</a>

      <a class="list-group-item" href="../sourcefile/datacostestimate.f90.html">DataCostEstimate.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylighting.f90.html">DataDaylighting.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylightingdevices.f90.html">DataDaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/datadefineequip.f90.html">Datadefineequip.f90</a>

      <a class="list-group-item" href="../sourcefile/datadelight.f90.html">DataDElight.f90</a>

      <a class="list-group-item" href="../sourcefile/dataenvironment.f90.html">DataEnvironment.f90</a>

      <a class="list-group-item" href="../sourcefile/dataequivalentlayerwindow.f90.html">DataEquivalentLayerWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/dataerrortracking.f90.html">DataErrorTracking.f90</a>

      <a class="list-group-item" href="../sourcefile/datagenerators.f90.html">DataGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobalconstants.f90.html">DataGlobalConstants.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobals.f90.html">DataGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalance.f90.html">DataHeatBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalfansys.f90.html">DataHeatBalFanSys.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalsurface.f90.html">DataHeatBalSurface.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvaccontrollers.f90.html">DataHVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvacglobals.f90.html">DataHVACGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datainterfaces.f90.html">DataInterfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/dataipshortcuts.f90.html">DataIPShortCuts.f90</a>

      <a class="list-group-item" href="../sourcefile/dataloopnode.f90.html">DataLoopNode.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalance.f90.html">DataMoistureBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalanceempd.f90.html">DataMoistureBalanceEMPD.f90</a>

      <a class="list-group-item" href="../sourcefile/dataoutputs.f90.html">DataOutputs.f90</a>

      <a class="list-group-item" href="../sourcefile/dataphotovoltaics.f90.html">DataPhotovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplant.f90.html">DataPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplantpipingsystems.f90.html">DataPlantPipingSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/dataprecisionglobals.f90.html">DataPrecisionGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datareportingflags.f90.html">DataReportingFlags.f90</a>

      <a class="list-group-item" href="../sourcefile/dataroomair.f90.html">DataRoomAir.f90</a>

      <a class="list-group-item" href="../sourcefile/datarootfinder.f90.html">DataRootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/dataruntimelanguage.f90.html">DataRuntimeLanguage.f90</a>

      <a class="list-group-item" href="../sourcefile/datashadowingcombinations.f90.html">DataShadowingCombinations.f90</a>

      <a class="list-group-item" href="../sourcefile/datasizing.f90.html">DataSizing.f90</a>

      <a class="list-group-item" href="../sourcefile/datastringglobals.f90.html">DataStringGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacecolors.f90.html">DataSurfaceColors.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacelists.f90.html">DataSurfaceLists.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfaces.f90.html">DataSurfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/datasystemvariables.f90.html">DataSystemVariables.f90</a>

      <a class="list-group-item" href="../sourcefile/datatimings.f90.html">DataTimings.f90</a>

      <a class="list-group-item" href="../sourcefile/dataucsdshareddata.f90.html">DataUCSDSharedData.f90</a>

      <a class="list-group-item" href="../sourcefile/datavectortypes.f90.html">DataVectorTypes.f90</a>

      <a class="list-group-item" href="../sourcefile/dataviewfactorinformation.f90.html">DataViewFactorInformation.f90</a>

      <a class="list-group-item" href="../sourcefile/datawater.f90.html">DataWater.f90</a>

      <a class="list-group-item" href="../sourcefile/datazonecontrols.f90.html">DataZoneControls.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneenergydemands.f90.html">DataZoneEnergyDemands.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneequipment.f90.html">DataZoneEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingdevices.f90.html">DaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingmanager.f90.html">DaylightingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf.f90.html">DElightManagerF.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf_no.f90.html">DElightManagerF_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/demandmanager.f90.html">DemandManager.f90</a>

      <a class="list-group-item" href="../sourcefile/desiccantdehumidifiers.f90.html">DesiccantDehumidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/directair.f90.html">DirectAir.f90</a>

      <a class="list-group-item" href="../sourcefile/displayroutines.f90.html">DisplayRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dxcoil.f90.html">DXCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/earthtube.f90.html">EarthTube.f90</a>

      <a class="list-group-item" href="../sourcefile/economiclifecyclecost.f90.html">EconomicLifeCycleCost.f90</a>

      <a class="list-group-item" href="../sourcefile/economictariff.f90.html">EconomicTariff.f90</a>

      <a class="list-group-item" href="../sourcefile/ecoroof.f90.html">EcoRoof.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowergenerators.f90.html">ElectricPowerGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowermanager.f90.html">ElectricPowerManager.f90</a>

      <a class="list-group-item" href="../sourcefile/emsmanager.f90.html">EMSManager.f90</a>

      <a class="list-group-item" href="../sourcefile/energyplus.f90.html">EnergyPlus.f90</a>

      <a class="list-group-item" href="../sourcefile/exteriorenergyusemanager.f90.html">ExteriorEnergyUseManager.f90</a>

      <a class="list-group-item" href="../sourcefile/externalinterface_no.f90.html">ExternalInterface_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/fancoilunits.f90.html">FanCoilUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/faultsmanager.f90.html">FaultsManager.f90</a>

      <a class="list-group-item" href="../sourcefile/fluidproperties.f90.html">FluidProperties.f90</a>

      <a class="list-group-item" href="../sourcefile/general.f90.html">General.f90</a>

      <a class="list-group-item" href="../sourcefile/generalroutines.f90.html">GeneralRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/globalnames.f90.html">GlobalNames.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceairmanager.f90.html">HeatBalanceAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceconvectioncoeffs.f90.html">HeatBalanceConvectionCoeffs.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancehamtmanager.f90.html">HeatBalanceHAMTManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceinternalheatgains.f90.html">HeatBalanceInternalHeatGains.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceintradexchange.f90.html">HeatBalanceIntRadExchange.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemanager.f90.html">HeatBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemovableinsulation.f90.html">HeatBalanceMovableInsulation.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancesurfacemanager.f90.html">HeatBalanceSurfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalfinitedifferencemanager.f90.html">HeatBalFiniteDifferenceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatrecovery.f90.html">HeatRecovery.f90</a>

      <a class="list-group-item" href="../sourcefile/humidifiers.f90.html">Humidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccontrollers.f90.html">HVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccooledbeam.f90.html">HVACCooledBeam.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdualductsystem.f90.html">HVACDualDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacduct.f90.html">HVACDuct.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdxsystem.f90.html">HVACDXSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacevapcomponent.f90.html">HVACEvapComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfancomponent.f90.html">HVACFanComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfurnace.f90.html">HVACFurnace.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacheatingcoils.f90.html">HVACHeatingCoils.f90</a>

      <a class="list-group-item" href="../sourcefile/hvachxassistedcoolingcoil.f90.html">HVACHXAssistedCoolingCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacinterfacemanager.f90.html">HVACInterfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmanager.f90.html">HVACManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmixercomponent.f90.html">HVACMixerComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmultispeedheatpump.f90.html">HVACMultiSpeedHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductinduc.f90.html">HVACSingleDuctInduc.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductsystem.f90.html">HVACSingleDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsplittercomponent.f90.html">HVACSplitterComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacstandaloneerv.f90.html">HVACStandAloneERV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsteamcoilcomponent.f90.html">HVACSteamCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvactranspiredcollector.f90.html">HVACTranspiredCollector.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarybypassvav.f90.html">HVACUnitaryBypassVAV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarysystem.f90.html">HVACUnitarySystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacvariablerefrigerantflow.f90.html">HVACVariableRefrigerantFlow.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatercoilcomponent.f90.html">HVACWaterCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoair.f90.html">HVACWatertoAir.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoairmultispeedhp.f90.html">HVACWatertoAirMultiSpeedHP.f90</a>

      <a class="list-group-item" href="../sourcefile/inputprocessor.f90.html">InputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/matrixdatamanager.f90.html">MatrixDataManager.f90</a>

      <a class="list-group-item" href="../sourcefile/mixedair.f90.html">MixedAir.f90</a>

      <a class="list-group-item" href="../sourcefile/moisturebalanceempdmanager.f90.html">MoistureBalanceEMPDManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nodeinputmanager.f90.html">NodeInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nonzoneequipmentmanager.f90.html">NonZoneEquipmentManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outairnodemanager.f90.html">OutAirNodeManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outdoorairunit.f90.html">OutdoorAirUnit.f90</a>

      <a class="list-group-item" href="../sourcefile/outputprocessor.f90.html">OutputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreportpredefined.f90.html">OutputReportPredefined.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreports.f90.html">OutputReports.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreporttabular.f90.html">OutputReportTabular.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedterminalheatpump.f90.html">PackagedTerminalHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedthermalstoragecoil.f90.html">PackagedThermalStorageCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaics.f90.html">Photovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaicthermalcollectors.f90.html">PhotovoltaicThermalCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantabsorptionchillers.f90.html">PlantAbsorptionChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilers.f90.html">PlantBoilers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilerssteam.f90.html">PlantBoilersSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcentralgshp.f90.html">PlantCentralGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantchillers.f90.html">PlantChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondloopoperation.f90.html">PlantCondLoopOperation.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondlooptowers.f90.html">PlantCondLoopTowers.f90</a>

      <a class="list-group-item" href="../sourcefile/planteirchillers.f90.html">PlantEIRChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantevapfluidcoolers.f90.html">PlantEvapFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantexhaustabsorptionchiller.f90.html">PlantExhaustAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantfluidcoolers.f90.html">PlantFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgasabsorptionchiller.f90.html">PlantGasAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgroundheatexchangers.f90.html">PlantGroundHeatExchangers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantheatexchanger.f90.html">PlantHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/planticethermalstorage.f90.html">PlantIceThermalStorage.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloadprofile.f90.html">PlantLoadProfile.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopequipment.f90.html">PlantLoopEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopsolver.f90.html">PlantLoopSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/plantmanager.f90.html">PlantManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantoutsideenergysources.f90.html">PlantOutsideEnergySources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipeheattransfer.f90.html">PlantPipeHeatTransfer.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipes.f90.html">PlantPipes.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipingsystemmanager.f90.html">PlantPipingSystemManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpondgroundheatexchanger.f90.html">PlantPondGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpressuresystem.f90.html">PlantPressureSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpumps.f90.html">PlantPumps.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsolarcollectors.f90.html">PlantSolarCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsurfacegroundheatexchanger.f90.html">PlantSurfaceGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantutilities.f90.html">PlantUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/plantvalves.f90.html">PlantValves.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatersources.f90.html">PlantWaterSources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwaterthermaltank.f90.html">PlantWaterThermalTank.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatertowatergshp.f90.html">PlantWatertoWaterGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwateruse.f90.html">PlantWaterUse.f90</a>

      <a class="list-group-item" href="../sourcefile/pollutionanalysismodule.f90.html">PollutionAnalysisModule.f90</a>

      <a class="list-group-item" href="../sourcefile/poweredinductionunits.f90.html">PoweredInductionUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/psychroutines.f90.html">PsychRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/purchasedairmanager.f90.html">Purchasedairmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemhightemp.f90.html">RadiantSystemHighTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemlowtemp.f90.html">RadiantSystemLowTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/refrigeratedcase.f90.html">RefrigeratedCase.f90</a>

      <a class="list-group-item" href="../sourcefile/reportsizingmanager.f90.html">ReportSizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/returnairpath.f90.html">ReturnAirPath.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmanager.f90.html">RoomAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelcrossvent.f90.html">RoomAirModelCrossVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodeldisplacementvent.f90.html">RoomAirModelDisplacementVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelmundt.f90.html">RoomAirModelMundt.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelufad.f90.html">RoomAirModelUFAD.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelusertemppattern.f90.html">RoomAirModelUserTempPattern.f90</a>

      <a class="list-group-item" href="../sourcefile/rootfinder.f90.html">RootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/runtimelanguageprocessor.f90.html">RuntimeLanguageProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/schedulemanager.f90.html">ScheduleManager.f90</a>

      <a class="list-group-item" href="../sourcefile/setpointmanager.f90.html">SetPointManager.f90</a>

      <a class="list-group-item" href="../sourcefile/simairservingzones.f90.html">SimAirServingZones.f90</a>

      <a class="list-group-item" href="../sourcefile/simulationmanager.f90.html">SimulationManager.f90</a>

      <a class="list-group-item" href="../sourcefile/sizingmanager.f90.html">SizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarreflectionmanager.f90.html">SolarReflectionManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarshading.f90.html">SolarShading.f90</a>

      <a class="list-group-item" href="../sourcefile/sortandstringutilities.f90.html">SortAndStringUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlite3.c.html">sqlite3.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitecroutines.c.html">SQLiteCRoutines.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines.f90.html">SQLiteFortranRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines_no.f90.html">SQLiteFortranRoutines_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/standardratings.f90.html">StandardRatings.f90</a>

      <a class="list-group-item" href="../sourcefile/surfacegeometry.f90.html">SurfaceGeometry.f90</a>

      <a class="list-group-item" href="../sourcefile/systemavailabilitymanager.f90.html">SystemAvailabilityManager.f90</a>

      <a class="list-group-item" href="../sourcefile/systemreports.f90.html">SystemReports.f90</a>

      <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html">TarcogComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalchimney.f90.html">ThermalChimney.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalcomfort.f90.html">ThermalComfort.f90</a>

      <a class="list-group-item" href="../sourcefile/unitheater.f90.html">UnitHeater.f90</a>

      <a class="list-group-item" href="../sourcefile/unitventilator.f90.html">UnitVentilator.f90</a>

      <a class="list-group-item" href="../sourcefile/userdefinedcomponents.f90.html">UserDefinedComponents.f90</a>

      <a class="list-group-item" href="../sourcefile/utilityroutines.f90.html">UtilityRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/vectorutilities.f90.html">VectorUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/ventilatedslab.f90.html">VentilatedSlab.f90</a>

      <a class="list-group-item" href="../sourcefile/watermanager.f90.html">WaterManager.f90</a>

      <a class="list-group-item" href="../sourcefile/weathermanager.f90.html">WeatherManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowac.f90.html">WindowAC.f90</a>

      <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html">WindowComplexManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowequivalentlayer.f90.html">WindowEquivalentLayer.f90</a>

      <a class="list-group-item" href="../sourcefile/windowmanager.f90.html">WindowManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windturbine.f90.html">WindTurbine.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneairloopequipmentmanager.f90.html">Zoneairloopequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zonecontaminantpredictorcorrector.f90.html">ZoneContaminantPredictorCorrector.f90</a>

      <a class="list-group-item" href="../sourcefile/zonedehumidifier.f90.html">ZoneDehumidifier.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneequipmentmanager.f90.html">Zoneequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneplenumcomponent.f90.html">ZonePlenumComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/zonetemppredictorcorrector.f90.html">ZoneTempPredictorCorrector.f90</a>

    </div>
  </div>
</div>


</div>

    </div>
    <div class="col-md-9" id='text'>


    <h3>This File Depends On</h3>

                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~airflownetworksolver.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileairflownetworksolverf90EfferentGraph" width="641pt" height="470pt"
 viewBox="0.00 0.00 641.00 470.14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph" class="graph" transform="scale(.5441 .5441) rotate(0) translate(4 860.1366)">
<title>sourcefile~~airflownetworksolver.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-860.1366 1174.1787,-860.1366 1174.1787,4 -4,4"/>
<!-- sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~airflownetworksolver.f90</title>
<polygon fill="none" stroke="#000000" points="1170.0366,-453.0729 1041.6058,-453.0729 1041.6058,-431.0621 1170.0366,-431.0621 1170.0366,-453.0729"/>
<text text-anchor="middle" x="1105.8212" y="-438.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">AirflowNetworkSolver.f90</text>
</g>
<!-- sourcefile~dataloopnode.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~dataloopnode.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/dataloopnode.f90.html" xlink:title="DataLoopNode.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="432.2051,-762.0729 331.8992,-762.0729 331.8992,-740.0621 432.2051,-740.0621 432.2051,-762.0729"/>
<text text-anchor="middle" x="382.0521" y="-747.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataLoopNode.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataloopnode.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~dataloopnode.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M418.4166,-762.0902C452.9665,-770.9811 506.2387,-780.5717 551.6558,-771.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M551.6558,-771.0675C617.1925,-757.3529 624.8532,-727.1719 689.844,-711.0675"/>
</g>
<!-- sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~general.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/general.f90.html" xlink:title="General.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="723.2128,-334.0729 656.4752,-334.0729 656.4752,-312.0621 723.2128,-312.0621 723.2128,-334.0729"/>
<text text-anchor="middle" x="689.844" y="-319.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">General.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M814.597,-442.0675C821.9214,-445.6017 947.8724,-483.3095 955.6897,-481.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M955.6897,-481.0675C987.1816,-472.0357 1022.6472,-462.7806 1051.1977,-455.5541"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1052.1486,-458.9239 1060.9901,-453.0862 1050.4379,-452.1362 1052.1486,-458.9239"/>
</g>
<!-- sourcefile~psychroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~psychroutines.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node6"><a xlink:href="../sourcefile/psychroutines.f90.html" xlink:title="PsychRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1005.2386,-453.0729 906.1408,-453.0729 906.1408,-431.0621 1005.2386,-431.0621 1005.2386,-453.0729"/>
<text text-anchor="middle" x="955.6897" y="-438.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">PsychRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M697.6655,-334.2891C715.3242,-358.6331 760.9513,-416.1822 814.597,-442.0675"/>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M814.597,-442.0675C839.4289,-454.0495 869.7006,-455.4949 895.828,-453.3529"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="896.3936,-456.8137 905.9912,-452.3266 895.6901,-449.8491 896.3936,-456.8137"/>
</g>
<!-- sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~dataenvironment.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node10"><a xlink:href="../sourcefile/dataenvironment.f90.html" xlink:title="DataEnvironment.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="869.7351,-492.0729 759.459,-492.0729 759.459,-470.0621 869.7351,-470.0621 869.7351,-492.0729"/>
<text text-anchor="middle" x="814.597" y="-477.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataEnvironment.f90</text>
</a>
</g>
</g>
<!-- sourcefile~general.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~general.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M692.9222,-334.2398C700.3326,-359.2379 721.4124,-420.2895 759.2783,-456.0675 762.8716,-459.4626 767.0052,-462.4529 771.3607,-465.0727"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="770.0379,-468.3335 780.5101,-469.9409 773.326,-462.1538 770.0379,-468.3335"/>
</g>
<!-- sourcefile~datahvacglobals.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~datahvacglobals.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node4"><a xlink:href="../sourcefile/datahvacglobals.f90.html" xlink:title="DataHVACGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="609.3488,-570.0729 493.9627,-570.0729 493.9627,-548.0621 609.3488,-548.0621 609.3488,-570.0729"/>
<text text-anchor="middle" x="551.6558" y="-555.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataHVACGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M563.7931,-570.1198C601.8058,-603.3343 721.5636,-697.3101 814.597,-653.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M814.597,-653.0675C899.0671,-601.6784 860.6474,-508.3254 955.6897,-481.0675"/>
</g>
<!-- sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~datahvacglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M599.766,-547.982C607.4017,-544.5234 614.6627,-539.9945 620.4097,-534.0675 672.5422,-480.3018 685.5369,-386.6897 688.7728,-344.6229"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="692.2797,-344.6296 689.4393,-334.4226 685.2946,-344.173 692.2797,-344.6296"/>
</g>
<!-- sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~datasurfaces.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node5"><a xlink:href="../sourcefile/datasurfaces.f90.html" xlink:title="DataSurfaces.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="598.2848,-722.0729 505.0268,-722.0729 505.0268,-700.0621 598.2848,-700.0621 598.2848,-722.0729"/>
<text text-anchor="middle" x="551.6558" y="-707.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataSurfaces.f90</text>
</a>
</g>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M598.3946,-716.607C625.4899,-718.4535 660.037,-718.4535 689.844,-711.0675"/>
</g>
<!-- sourcefile~datasurfaces.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~datasurfaces.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M558.5902,-699.8061C572.0883,-677.4876 602.1647,-625.7569 620.4097,-579.0675 653.3985,-494.648 676.7043,-388.7157 685.7166,-344.2501"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="689.1735,-344.8116 687.6971,-334.3202 682.3087,-343.4424 689.1735,-344.8116"/>
</g>
<!-- sourcefile~psychroutines.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~psychroutines.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1005.2644,-442.0675C1013.704,-442.0675 1022.6314,-442.0675 1031.544,-442.0675"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1031.5735,-445.5676 1041.5735,-442.0675 1031.5734,-438.5676 1031.5735,-445.5676"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~dataprecisionglobals.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node7"><a xlink:href="../sourcefile/dataprecisionglobals.f90.html" xlink:title="DataPrecisionGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="130.719,-568.0729 -.2403,-568.0729 -.2403,-546.0621 130.719,-546.0621 130.719,-568.0729"/>
<text text-anchor="middle" x="65.2394" y="-553.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataPrecisionGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge62" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M955.6897,-86.0675C1057.6765,-183.1653 1093.3556,-360.4178 1102.8939,-421.0658"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1099.4372,-421.6167 1104.3807,-430.9875 1106.3599,-420.5792 1099.4372,-421.6167"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M67.575,-545.8725C80.8481,-483.4328 148.8412,-179.1421 223.8406,-127.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M689.844,-10.0675C812.4444,-1.6786 866.6884,-1.3327 955.6897,-86.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-127.0675C273.2542,-92.758 262.9106,-54.9759 317.2024,-29.0675 411.553,15.9572 447.3565,-2.9308 551.6558,-10.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M551.6558,-10.0675C612.9846,-13.3568 628.4872,-12.7868 689.844,-10.0675"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataloopnode.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataloopnode.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M67.0492,-568.378C75.0525,-613.9269 111.9693,-783.7409 223.8406,-831.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-831.0675C269.0471,-850.1919 272.7585,-792.9027 317.2024,-772.0675 322.1582,-769.7443 327.44,-767.575 332.7682,-765.58"/>
<polygon fill="#ff0000" stroke="#ff0000" points="334.0944,-768.8233 342.3488,-762.1815 331.7541,-762.2261 334.0944,-768.8233"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M551.6558,-202.0675C601.1624,-230.2631 648.8749,-278.0388 673.1841,-304.3311"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="670.9047,-307.0262 680.227,-312.0607 676.079,-302.3116 670.9047,-307.0262"/>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M382.0521,-88.0675C411.8193,-92.06 424.0613,-87.5655 446.9019,-107.0675 475.326,-131.337 454.2918,-159.0175 482.9019,-183.0675 507.1694,-203.4671 524.1077,-186.378 551.6558,-202.0675"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M223.8406,-634.0675C250.9819,-639.2055 417.1571,-595.7561 501.9615,-572.7509"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="502.9076,-576.1208 511.6383,-570.1188 501.0702,-569.3662 502.9076,-576.1208"/>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M81.9085,-568.2244C109.8331,-586.188 168.4659,-620.8438 223.8406,-634.0675"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M223.8406,-831.0675C315.4754,-869.8332 361.4652,-863.0607 446.9019,-812.0675 471.9885,-797.0945 462.348,-777.8298 482.9019,-757.0675 494.2032,-745.6516 508.754,-735.43 521.5574,-727.5384"/>
<polygon fill="#5cff00" stroke="#5cff00" points="523.6941,-730.3399 530.5,-722.2201 520.116,-724.3234 523.6941,-730.3399"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M689.844,-48.0675C870.2922,-60.4147 936.6278,-340.4597 951.9736,-420.7383"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="948.5533,-421.491 953.8071,-430.6915 955.4374,-420.2228 948.5533,-421.491"/>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M551.6558,-10.0675C615.204,-14.4158 630.0841,-26.0213 689.844,-48.0675"/>
</g>
<!-- sourcefile~dataglobals.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~dataglobals.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node8"><a xlink:href="../sourcefile/dataglobals.f90.html" xlink:title="DataGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="267.6355,-492.0729 180.0456,-492.0729 180.0456,-470.0621 267.6355,-470.0621 267.6355,-492.0729"/>
<text text-anchor="middle" x="223.8406" y="-477.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataglobals.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataglobals.f90</title>
<path fill="none" stroke="#00b9ff" stroke-dasharray="5,2" d="M88.3014,-546.0165C115.4346,-533.0145 160.6652,-511.3405 191.3431,-496.6399"/>
<polygon fill="#00b9ff" stroke="#00b9ff" points="193.2452,-499.6097 200.7508,-492.1319 190.2202,-493.297 193.2452,-499.6097"/>
</g>
<!-- sourcefile~dataairflownetwork.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~dataairflownetwork.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node9"><a xlink:href="../sourcefile/dataairflownetwork.f90.html" xlink:title="DataAirflowNetwork.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="442.759,-138.0729 321.3452,-138.0729 321.3452,-116.0621 442.759,-116.0621 442.759,-138.0729"/>
<text text-anchor="middle" x="382.0521" y="-123.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataAirflowNetwork.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataairflownetwork.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataairflownetwork.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M223.8406,-127.0675C255.9219,-104.7494 301.2138,-107.2395 335.1219,-113.8557"/>
<polygon fill="#002eff" stroke="#002eff" points="334.742,-117.3534 345.2524,-116.0186 336.2036,-110.5077 334.742,-117.3534"/>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M223.8406,-634.0675C396.9139,-675.3983 451.1693,-634.025 620.4097,-579.0675 683.7129,-558.511 751.8954,-519.8079 788.2329,-497.6889"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="790.5021,-500.4023 797.1853,-492.1812 786.8341,-494.4402 790.5021,-500.4023"/>
</g>
<!-- sourcefile~dataairloop.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~dataairloop.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node11"><a xlink:href="../sourcefile/dataairloop.f90.html" xlink:title="DataAirLoop.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="425.9362,-803.0729 338.168,-803.0729 338.168,-781.0621 425.9362,-781.0621 425.9362,-803.0729"/>
<text text-anchor="middle" x="382.0521" y="-788.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataAirLoop.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataairloop.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataairloop.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M223.8406,-831.0675C245.3972,-840.187 305.1903,-821.2218 344.7814,-806.6691"/>
<polygon fill="#e700ff" stroke="#e700ff" points="346.2337,-809.8628 354.3761,-803.0841 343.7836,-803.3056 346.2337,-809.8628"/>
</g>
<!-- sourcefile~datainterfaces.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~datainterfaces.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node12"><a xlink:href="../sourcefile/datainterfaces.f90.html" xlink:title="DataInterfaces.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="430.8519,-60.0729 333.2524,-60.0729 333.2524,-38.0621 430.8519,-38.0621 430.8519,-60.0729"/>
<text text-anchor="middle" x="382.0521" y="-45.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataInterfaces.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datainterfaces.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datainterfaces.f90</title>
<path fill="none" stroke="#ff008b" stroke-dasharray="5,2" d="M223.8406,-127.0675C263.0089,-99.8192 274.0765,-94.4829 317.2024,-74.0675 324.8008,-70.4705 333.0666,-66.9797 341.0738,-63.8036"/>
<polygon fill="#ff008b" stroke="#ff008b" points="342.5862,-66.9714 350.6503,-60.0997 340.061,-60.4428 342.5862,-66.9714"/>
</g>
<!-- sourcefile~dataipshortcuts.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~dataipshortcuts.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node13"><a xlink:href="../sourcefile/dataipshortcuts.f90.html" xlink:title="DataIPShortCuts.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436.3521,-216.0729 327.7521,-216.0729 327.7521,-194.0621 436.3521,-194.0621 436.3521,-216.0729"/>
<text text-anchor="middle" x="382.0521" y="-201.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataIPShortCuts.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8406,-127.0675C263.0089,-99.8192 274.0765,-159.6521 317.2024,-180.0675 324.8008,-183.6645 333.0666,-187.1554 341.0738,-190.3314"/>
<polygon fill="#ff0000" stroke="#ff0000" points="340.061,-193.6923 350.6503,-194.0353 342.5862,-187.1636 340.061,-193.6923"/>
</g>
<!-- sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~dataruntimelanguage.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node14"><a xlink:href="../sourcefile/dataruntimelanguage.f90.html" xlink:title="DataRuntimeLanguage.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="620.1645,-174.0729 483.1471,-174.0729 483.1471,-152.0621 620.1645,-152.0621 620.1645,-174.0729"/>
<text text-anchor="middle" x="551.6558" y="-159.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataRuntimeLanguage.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M382.0521,-88.0675C411.8193,-92.06 420.5155,-92.7224 446.9019,-107.0675 465.4523,-117.1526 464.6822,-127.3964 482.9019,-138.0675 489.3817,-141.8627 496.5359,-145.2384 503.7072,-148.1859"/>
<polygon fill="#7fff00" stroke="#7fff00" points="502.8456,-151.6049 513.4352,-151.939 505.3653,-145.0741 502.8456,-151.6049"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M223.8406,-127.0675C283.3282,-85.7633 310.2737,-78.4404 382.0521,-88.0675"/>
</g>
<!-- sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~inputprocessor.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node16"><a xlink:href="../sourcefile/inputprocessor.f90.html" xlink:title="InputProcessor.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="601.2148,-295.0729 502.0967,-295.0729 502.0967,-273.0621 601.2148,-273.0621 601.2148,-295.0729"/>
<text text-anchor="middle" x="551.6558" y="-280.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">InputProcessor.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M223.8406,-127.0675C229.0961,-123.4114 441.3012,-181.9657 446.9019,-185.0675 456.8636,-190.5846 505.6227,-238.3107 532.968,-265.4301"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="530.8219,-268.2317 540.3821,-272.7984 535.7563,-263.2667 530.8219,-268.2317"/>
</g>
<!-- sourcefile~datasizing.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~datasizing.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node19"><a xlink:href="../sourcefile/datasizing.f90.html" xlink:title="DataSizing.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="422.3437,-373.0729 341.7606,-373.0729 341.7606,-351.0621 422.3437,-351.0621 422.3437,-373.0729"/>
<text text-anchor="middle" x="382.0521" y="-358.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataSizing.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasizing.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasizing.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M74.9603,-545.8485C92.0181,-526.6523 129.0922,-487.0653 166.4788,-461.0675 227.7479,-418.4623 248.8257,-416.9629 317.2024,-387.0675 325.2282,-383.5585 333.9169,-380.0293 342.2472,-376.7735"/>
<polygon fill="#00ffff" stroke="#00ffff" points="343.7262,-379.9546 351.8004,-373.0947 341.2107,-373.4222 343.7262,-379.9546"/>
</g>
<!-- sourcefile~datasystemvariables.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~datasystemvariables.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node20"><a xlink:href="../sourcefile/datasystemvariables.f90.html" xlink:title="DataSystemVariables.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="446.7519,-257.0729 317.3523,-257.0729 317.3523,-235.0621 446.7519,-235.0621 446.7519,-257.0729"/>
<text text-anchor="middle" x="382.0521" y="-242.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataSystemVariables.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M223.8406,-127.0675C273.2232,-92.7134 266.279,-193.0417 317.2024,-225.0675 320.7524,-227.3002 324.5623,-229.3171 328.492,-231.1352"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="327.2364,-234.4037 337.8131,-235.0248 329.9322,-227.9436 327.2364,-234.4037"/>
</g>
<!-- sourcefile~datavectortypes.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~datavectortypes.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node21"><a xlink:href="../sourcefile/datavectortypes.f90.html" xlink:title="DataVectorTypes.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="278.8255,-684.0729 168.8556,-684.0729 168.8556,-662.0621 278.8255,-662.0621 278.8255,-684.0729"/>
<text text-anchor="middle" x="223.8406" y="-669.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataVectorTypes.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datavectortypes.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~datavectortypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M75.2384,-568.126C92.4227,-586.6235 129.31,-624.1597 166.4788,-648.0675 171.935,-651.5771 177.9671,-654.8097 184.0095,-657.7036"/>
<polygon fill="#ff0000" stroke="#ff0000" points="182.878,-661.033 193.4319,-661.9634 185.7617,-654.6546 182.878,-661.033"/>
</g>
<!-- sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node22" class="node">
<title>sourcefile~databsdfwindow.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node22"><a xlink:href="../sourcefile/databsdfwindow.f90.html" xlink:title="DataBSDFWindow.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="440.5199,-684.0729 323.5844,-684.0729 323.5844,-662.0621 440.5199,-662.0621 440.5199,-684.0729"/>
<text text-anchor="middle" x="382.0521" y="-669.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataBSDFWindow.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~dataprecisionglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M223.8406,-634.0675C260.5848,-641.0233 301.568,-651.1947 332.6144,-659.4061"/>
<polygon fill="#00ffff" stroke="#00ffff" points="331.7631,-662.8013 342.3273,-661.9966 333.5671,-656.0377 331.7631,-662.8013"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge63" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M382.0521,-520.0675C412.211,-529.4099 420.112,-532.3601 446.9019,-549.0675 464.5741,-560.0888 466.0883,-566.7759 482.9019,-579.0675 526.9358,-611.2587 636.8993,-724.1869 689.844,-711.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M689.844,-711.0675C749.8339,-699.2379 762.3594,-684.8474 814.597,-653.0675"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataloopnode.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataloopnode.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M228.4328,-492.2375C245.4082,-533.4197 304.2961,-675.2902 317.2024,-693.0675 328.4855,-708.609 344.558,-723.0201 357.879,-733.5898"/>
<polygon fill="#ff0000" stroke="#ff0000" points="356.0963,-736.634 366.1575,-739.9542 360.3627,-731.0845 356.0963,-736.634"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M382.0521,-520.0675C454.0559,-542.3723 479.861,-543.0362 551.6558,-520.0675"/>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M551.6558,-520.0675C631.0395,-494.671 670.6197,-389.2127 684.2229,-343.9043"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="687.6022,-344.8171 687.0008,-334.2394 680.8746,-342.8834 687.6022,-344.8171"/>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M267.5304,-490.3855C299.5118,-497.5569 343.8151,-508.2227 382.0521,-520.0675"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datahvacglobals.f90</title>
<path fill="none" stroke="#e7ff00" stroke-dasharray="5,2" d="M382.0521,-520.0675C415.1256,-530.3128 452.5751,-539.2006 483.8553,-545.8933"/>
<polygon fill="#e7ff00" stroke="#e7ff00" points="483.2738,-549.3476 493.781,-547.9881 484.7193,-542.4985 483.2738,-549.3476"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M239.0663,-492.1111C275.6586,-518.8009 371.1246,-589.3183 446.9019,-653.0675 463.5112,-667.0404 464.3452,-674.8087 482.9019,-686.0675 489.2474,-689.9175 496.2786,-693.3125 503.3517,-696.2597"/>
<polygon fill="#5cff00" stroke="#5cff00" points="502.3739,-699.6348 512.9624,-700.0015 504.9136,-693.1118 502.3739,-699.6348"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M689.844,-520.0675C770.0784,-513.8347 796.7986,-534.6873 869.9158,-501.0675 889.9112,-491.8735 887.8916,-479.6958 905.9158,-467.0675 910.5686,-463.8076 915.7073,-460.7273 920.8637,-457.9158"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="922.7844,-460.8631 930.0635,-453.1648 919.5724,-454.6436 922.7844,-460.8631"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataairflownetwork.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataairflownetwork.f90</title>
<path fill="none" stroke="#002eff" stroke-dasharray="5,2" d="M227.5409,-469.9091C236.7742,-442.0108 261.503,-366.9514 281.2024,-304.0675 297.7207,-251.3382 287.504,-231.6641 317.2024,-185.0675 327.3915,-169.0809 343.1771,-154.8288 356.6227,-144.453"/>
<polygon fill="#002eff" stroke="#002eff" points="359.0887,-146.9818 365.0381,-138.2151 354.9202,-141.3583 359.0887,-146.9818"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M551.6558,-520.0675C610.1521,-501.3533 628.6115,-524.8242 689.844,-520.0675"/>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M689.844,-520.0675C721.8004,-517.585 756.4718,-505.969 781.1335,-496.0542"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="782.494,-499.2791 790.3956,-492.221 779.8172,-492.8111 782.494,-499.2791"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataairloop.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataairloop.f90</title>
<path fill="none" stroke="#e700ff" stroke-dasharray="5,2" d="M229.2224,-492.3716C240.1992,-515.7666 265.461,-571.3812 281.2024,-620.0675 302.4272,-685.7136 270.3854,-720.3913 317.2024,-771.0675 320.5401,-774.6803 324.5034,-777.6736 328.8011,-780.1532"/>
<polygon fill="#e700ff" stroke="#e700ff" points="327.4681,-783.3954 337.9993,-784.5555 330.4902,-777.0813 327.4681,-783.3954"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataipshortcuts.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M227.2479,-470.0448C241.7324,-423.4565 298.3119,-244.2571 317.2024,-226.0675 318.8993,-224.4335 320.7245,-222.9267 322.6477,-221.5371"/>
<polygon fill="#ff0000" stroke="#ff0000" points="324.8347,-224.3069 331.6137,-216.1647 321.2368,-218.3023 324.8347,-224.3069"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataruntimelanguage.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M226.7404,-469.978C235.2451,-439.6226 263.0053,-354.4227 317.2024,-309.0675 363.7754,-270.0926 401.6177,-306.5328 446.9019,-266.0675 475.3721,-240.6269 454.7986,-213.9129 482.9019,-188.0675 486.9335,-184.3598 491.5579,-181.1918 496.4609,-178.487"/>
<polygon fill="#7fff00" stroke="#7fff00" points="498.0437,-181.6093 505.5195,-174.1018 494.9936,-175.3088 498.0437,-181.6093"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M242.0626,-469.9315C253.4064,-462.925 268.2524,-453.621 281.2024,-445.0675 297.4565,-434.3316 299.6282,-428.4702 317.2024,-420.0675 371.394,-394.1569 394.7311,-411.8384 446.9019,-382.0675 483.5355,-361.1628 517.5462,-325.0253 536.3706,-302.96"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="539.0852,-305.1697 542.8155,-295.2533 533.7154,-300.6791 539.0852,-305.1697"/>
</g>
<!-- sourcefile~sortandstringutilities.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~sortandstringutilities.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node17"><a xlink:href="../sourcefile/sortandstringutilities.f90.html" xlink:title="SortAndStringUtilities.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="446.2726,-492.0729 317.8316,-492.0729 317.8316,-470.0621 446.2726,-470.0621 446.2726,-492.0729"/>
<text text-anchor="middle" x="382.0521" y="-477.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SortAndStringUtilities.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~sortandstringutilities.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~sortandstringutilities.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M267.4914,-481.0675C279.8819,-481.0675 293.7357,-481.0675 307.411,-481.0675"/>
<polygon fill="#ff0000" stroke="#ff0000" points="307.8066,-484.5676 317.8066,-481.0675 307.8065,-477.5676 307.8066,-484.5676"/>
</g>
<!-- sourcefile~dataoutputs.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~dataoutputs.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node18"><a xlink:href="../sourcefile/dataoutputs.f90.html" xlink:title="DataOutputs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="426.5167,-451.0729 337.5875,-451.0729 337.5875,-429.0621 426.5167,-429.0621 426.5167,-451.0729"/>
<text text-anchor="middle" x="382.0521" y="-436.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataOutputs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataoutputs.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~dataoutputs.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M266.6549,-469.9723C286.0801,-464.9383 309.2329,-458.9384 329.6837,-453.6386"/>
<polygon fill="#7fff00" stroke="#7fff00" points="330.6757,-456.9972 339.4779,-451.1005 328.9197,-450.2211 330.6757,-456.9972"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasizing.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~datasizing.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M233.7117,-470.0279C253.6279,-447.9447 298.3277,-399.3899 317.2024,-387.0675 322.9726,-383.3005 329.3956,-379.97 335.893,-377.0688"/>
<polygon fill="#00ffff" stroke="#00ffff" points="337.5035,-380.1899 345.3984,-373.1245 334.8206,-373.7245 337.5035,-380.1899"/>
</g>
<!-- sourcefile~dataglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~dataglobals.f90&#45;&gt;sourcefile~databsdfwindow.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M230.9801,-492.2511C245.8581,-515.2406 281.752,-569.0872 317.2024,-610.0675 331.1494,-626.1902 348.5501,-642.9374 361.8145,-655.1088"/>
<polygon fill="#00ffff" stroke="#00ffff" points="359.7115,-657.9264 369.4712,-662.0494 364.4128,-652.7401 359.7115,-657.9264"/>
</g>
<!-- sourcefile~dataairflownetwork.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge64" class="edge">
<title>sourcefile~dataairflownetwork.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M427.175,-115.9808C548.4503,-87.3669 877.54,-17.8841 955.6897,-86.0675"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge65" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M869.8494,-488.0555C896.3023,-489.6474 928.1408,-488.9684 955.6897,-481.0675"/>
</g>
<!-- sourcefile~dataenvironment.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~dataenvironment.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M854.6511,-469.996C870.5876,-465.5909 889.0948,-460.4753 905.8824,-455.835"/>
<polygon fill="#00ff2e" stroke="#00ff2e" points="906.8294,-459.2045 915.5355,-453.1667 904.9644,-452.4575 906.8294,-459.2045"/>
</g>
<!-- sourcefile~dataairloop.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge66" class="edge">
<title>sourcefile~dataairloop.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M425.9536,-788.6498C460.3908,-785.4847 509.4013,-779.9099 551.6558,-771.0675"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge67" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~airflownetworksolver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M551.6558,-48.0675C615.1909,-43.5319 626.2958,-14.4158 689.844,-10.0675"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M431.1019,-50.4702C465.0057,-51.0255 511.124,-50.961 551.6558,-48.0675"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M551.6558,-124.0675C579.1648,-139.8254 596.9157,-121.7816 620.4097,-143.0675 667.4237,-185.663 682.8781,-263.7613 687.737,-301.5106"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="684.3062,-302.313 688.928,-311.8465 691.2602,-301.5116 684.3062,-302.313"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~psychroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~psychroutines.f90</title>
<path fill="none" stroke="#00ff2e" stroke-dasharray="5,2" d="M551.6558,-48.0675C612.9169,-43.6942 628.5703,-43.8749 689.844,-48.0675"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataenvironment.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataenvironment.f90</title>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M551.6558,-124.0675C579.1648,-139.8254 594.8776,-124.2746 620.4097,-143.0675 688.495,-193.1818 690.2603,-225.2417 723.2783,-303.0675 750.5616,-367.3763 714.881,-402.1335 759.2783,-456.0675 761.9911,-459.363 765.23,-462.2414 768.7608,-464.7523"/>
<polygon fill="#5c00ff" stroke="#5c00ff" points="767.0465,-467.8056 777.4185,-469.9674 770.6584,-461.8094 767.0465,-467.8056"/>
<path fill="none" stroke="#5c00ff" stroke-dasharray="5,2" d="M418.8687,-60.1731C454.9457,-72.1965 510.3736,-93.7972 551.6558,-124.0675"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataruntimelanguage.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~dataruntimelanguage.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M423.5391,-60.1506C431.8814,-63.6724 440.1489,-68.2258 446.9019,-74.0675 471.5838,-95.4191 458.0161,-116.9538 482.9019,-138.0675 487.369,-141.8576 492.4584,-145.0935 497.8008,-147.8519"/>
<polygon fill="#7fff00" stroke="#7fff00" points="496.4168,-151.0676 506.9653,-152.0567 499.336,-144.7053 496.4168,-151.0676"/>
</g>
<!-- sourcefile~datainterfaces.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~datainterfaces.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M427.4606,-60.0938C434.7474,-63.5621 441.6174,-68.1097 446.9019,-74.0675 490.1048,-122.7761 450.5737,-159.5529 482.9019,-216.0675 494.2961,-235.9865 513.1236,-254.0205 528.1983,-266.5038"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="526.1226,-269.3255 536.116,-272.8446 530.4983,-263.8617 526.1226,-269.3255"/>
</g>
<!-- sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M419.4671,-194.041C455.7449,-185.6213 511.095,-178.9669 551.6558,-202.0675"/>
</g>
<!-- sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~dataipshortcuts.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M420.2281,-216.0775C429.106,-219.0081 438.434,-222.393 446.9019,-226.0675 474.6434,-238.1056 504.6827,-255.1912 525.4503,-267.7005"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="523.6622,-270.7095 534.0234,-272.9222 527.3035,-264.7311 523.6622,-270.7095"/>
</g>
<!-- sourcefile~dataruntimelanguage.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~dataruntimelanguage.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M597.2346,-174.1741C605.5754,-177.6576 613.7388,-182.1901 620.4097,-188.0675 655.8105,-219.2578 675.654,-272.8405 684.3873,-302.2468"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="681.0269,-303.2263 687.1104,-311.9005 687.764,-301.3259 681.0269,-303.2263"/>
</g>
<!-- sourcefile~datastringglobals.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~datastringglobals.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~EfferentGraph_node15"><a xlink:href="../sourcefile/datastringglobals.f90.html" xlink:title="DataStringGlobals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="281.0645,-295.0729 166.6166,-295.0729 166.6166,-273.0621 281.0645,-273.0621 281.0645,-295.0729"/>
<text text-anchor="middle" x="223.8406" y="-280.9175" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">DataStringGlobals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M382.0521,-323.0675C475.8756,-329.0435 586.1132,-326.8055 645.8893,-324.8211"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="646.2232,-328.3117 656.0962,-324.4682 645.9812,-321.3159 646.2232,-328.3117"/>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M382.0521,-323.0675C405.6399,-324.5699 463.7457,-309.6687 505.367,-297.8532"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="506.3854,-301.2023 515.033,-295.0811 504.4556,-294.4736 506.3854,-301.2023"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M254.5479,-295.0954C286.0563,-305.5844 336.7393,-320.1814 382.0521,-323.0675"/>
</g>
<!-- sourcefile~datastringglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~datastringglobals.f90&#45;&gt;sourcefile~datasystemvariables.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M270.0272,-272.9742C287.6545,-268.7404 307.9361,-263.8691 326.3564,-259.4448"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="327.1755,-262.8477 336.0816,-257.1089 325.5407,-256.0412 327.1755,-262.8477"/>
</g>
<!-- sourcefile~inputprocessor.f90&#45;&gt;sourcefile~general.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~inputprocessor.f90&#45;&gt;sourcefile~general.f90</title>
<path fill="none" stroke="#ff8b00" stroke-dasharray="5,2" d="M590.8853,-295.139C608.0946,-299.9959 628.3647,-305.7166 646.0633,-310.7116"/>
<polygon fill="#ff8b00" stroke="#ff8b00" points="645.5696,-314.2089 656.1443,-313.5567 647.4709,-307.472 645.5696,-314.2089"/>
</g>
<!-- sourcefile~sortandstringutilities.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~sortandstringutilities.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M430.133,-469.922C436.1338,-467.2925 441.907,-464.0536 446.9019,-460.0675 499.5173,-418.0784 531.6003,-341.9434 544.745,-305.1268"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="548.1328,-306.0387 548.0856,-295.444 541.5155,-303.7557 548.1328,-306.0387"/>
</g>
<!-- sourcefile~dataoutputs.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~dataoutputs.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M420.818,-428.9532C429.8605,-425.3512 439.114,-420.771 446.9019,-415.0675 488.9337,-384.2854 523.3787,-332.5479 540.3129,-304.1783"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="543.5401,-305.592 545.5562,-295.1908 537.4938,-302.0646 543.5401,-305.592"/>
</g>
<!-- sourcefile~datasizing.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~datasizing.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M412.663,-350.99C423.568,-346.8541 435.8753,-341.9675 446.9019,-337.0675 472.7446,-325.5834 501.3463,-310.9789 522.1248,-300.0099"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="523.8944,-303.0331 531.0831,-295.2502 520.61,-296.8514 523.8944,-303.0331"/>
</g>
<!-- sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~inputprocessor.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~datasystemvariables.f90&#45;&gt;sourcefile~inputprocessor.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M431.5644,-257.1608C450.6352,-261.4337 472.604,-266.3558 492.4952,-270.8125"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="491.8518,-274.255 502.3751,-273.0261 493.3823,-267.4244 491.8518,-274.255"/>
</g>
<!-- sourcefile~datavectortypes.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~datavectortypes.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M269.6813,-684.1708C284.7425,-687.4743 301.6174,-690.8104 317.2024,-693.0675 377.4266,-701.7896 447.0068,-706.4572 494.6288,-708.8348"/>
<polygon fill="#5cff00" stroke="#5cff00" points="494.5878,-712.3368 504.7446,-709.3218 494.9245,-705.3449 494.5878,-712.3368"/>
</g>
<!-- sourcefile~datavectortypes.f90&#45;&gt;sourcefile~databsdfwindow.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~datavectortypes.f90&#45;&gt;sourcefile~databsdfwindow.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M278.7313,-673.0675C289.9829,-673.0675 301.9578,-673.0675 313.6177,-673.0675"/>
<polygon fill="#00ffff" stroke="#00ffff" points="313.757,-676.5676 323.757,-673.0675 313.757,-669.5676 313.757,-676.5676"/>
</g>
<!-- sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~datasurfaces.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~databsdfwindow.f90&#45;&gt;sourcefile~datasurfaces.f90</title>
<path fill="none" stroke="#5cff00" stroke-dasharray="5,2" d="M431.5644,-684.1608C451.4785,-688.6226 474.5526,-693.7924 495.1213,-698.4009"/>
<polygon fill="#5cff00" stroke="#5cff00" points="494.4693,-701.8415 504.9926,-700.6126 495.9998,-695.0108 494.4693,-701.8415"/>
</g>
</g>
</svg>
</div>
                <script>var pansourcefileairflownetworksolverf90EfferentGraph = svgPanZoom('#sourcefileairflownetworksolverf90EfferentGraph', {
                    zoomEnabled: true,
                    controlIconsEnabled: true,
                    fit: true,
                    center: true,});
                    </script>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">

    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="186pt" height="31pt"
 viewBox="0.00 0.00 186.41 30.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 26.5)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-26.5 182.4064,-26.5 182.4064,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65.1576,-22.2554 -.0526,-22.2554 -.0526,-.2446 65.1576,-.2446 65.1576,-22.2554"/>
<text text-anchor="middle" x="32.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="178.2607,-22.2554 82.8443,-22.2554 82.8443,-.2446 178.2607,-.2446 178.2607,-22.2554"/>
<text text-anchor="middle" x="130.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>


    <p>Solid arrows point from a file to a file which depends upon it. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>

                      </div>
                    </div>
                  </div>
                </div>


      <h3>Files Dependent On This One</h3>

                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~airflownetworksolver.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileairflownetworksolverf90AfferentGraph" width="641pt" height="59pt"
 viewBox="0.00 0.00 641.00 58.71" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph" class="graph" transform="scale(.3507 .3507) rotate(0) translate(4 163.3904)">
<title>sourcefile~~airflownetworksolver.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-163.3904 1823.522,-163.3904 1823.522,4 -4,4"/>
<!-- sourcefile~airflownetworksolver.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~airflownetworksolver.f90</title>
<polygon fill="none" stroke="#000000" points="128.5729,-100.1458 .1421,-100.1458 .1421,-78.1349 128.5729,-78.1349 128.5729,-100.1458"/>
<text text-anchor="middle" x="64.3575" y="-85.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">AirflowNetworkSolver.f90</text>
</g>
<!-- sourcefile~airflownetworkbalancemanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~airflownetworkbalancemanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/airflownetworkbalancemanager.f90.html" xlink:title="AirflowNetworkBalanceManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="343.2237,-100.1458 164.5453,-100.1458 164.5453,-78.1349 343.2237,-78.1349 343.2237,-100.1458"/>
<text text-anchor="middle" x="253.8845" y="-85.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">AirflowNetworkBalanceManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~airflownetworksolver.f90&#45;&gt;sourcefile~airflownetworkbalancemanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~airflownetworksolver.f90&#45;&gt;sourcefile~airflownetworkbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M128.7872,-89.1404C137.0402,-89.1404 145.6364,-89.1404 154.2864,-89.1404"/>
<polygon fill="#ff0000" stroke="#ff0000" points="154.4483,-92.6405 164.4482,-89.1404 154.4482,-85.6405 154.4483,-92.6405"/>
</g>
<!-- sourcefile~systemavailabilitymanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~systemavailabilitymanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/systemavailabilitymanager.f90.html" xlink:title="SystemAvailabilityManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="533.7633,-81.1458 379.1508,-81.1458 379.1508,-59.1349 533.7633,-59.1349 533.7633,-81.1458"/>
<text text-anchor="middle" x="456.457" y="-66.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SystemAvailabilityManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~airflownetworkbalancemanager.f90&#45;&gt;sourcefile~systemavailabilitymanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~airflownetworkbalancemanager.f90&#45;&gt;sourcefile~systemavailabilitymanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M343.3254,-80.7514C351.7648,-79.9598 360.3154,-79.1578 368.7385,-78.3678"/>
<polygon fill="#ff0000" stroke="#ff0000" points="369.3042,-81.8302 378.9336,-77.4116 368.6504,-74.8608 369.3042,-81.8302"/>
</g>
<!-- sourcefile~hvacmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~hvacmanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node4"><a xlink:href="../sourcefile/hvacmanager.f90.html" xlink:title="HVACManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="847.876,-99.1458 749.3179,-99.1458 749.3179,-77.1349 847.876,-77.1349 847.876,-99.1458"/>
<text text-anchor="middle" x="798.5969" y="-84.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HVACManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~airflownetworkbalancemanager.f90&#45;&gt;sourcefile~hvacmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~airflownetworkbalancemanager.f90&#45;&gt;sourcefile~hvacmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M343.1237,-97.0693C421.6541,-103.2523 539.1114,-110.5714 641.5338,-109.1404"/>
</g>
<!-- sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~hvacmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~hvacmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M487.8019,-81.176C524.2766,-92.9756 586.5372,-109.9088 641.5338,-109.1404"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M641.5338,-109.1404C674.0146,-108.6866 709.9467,-104.1837 739.2362,-99.4636"/>
<polygon fill="#ff0000" stroke="#ff0000" points="740.0115,-102.8829 749.3027,-97.7913 738.8643,-95.9775 740.0115,-102.8829"/>
</g>
<!-- sourcefile~zoneequipmentmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~zoneequipmentmanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node5"><a xlink:href="../sourcefile/zoneequipmentmanager.f90.html" xlink:title="Zoneequipmentmanager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="713.3816,-40.1458 569.686,-40.1458 569.686,-18.1349 713.3816,-18.1349 713.3816,-40.1458"/>
<text text-anchor="middle" x="641.5338" y="-25.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Zoneequipmentmanager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~zoneequipmentmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~zoneequipmentmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M506.5415,-59.0452C529.7817,-53.8968 557.5828,-47.738 581.8991,-42.3512"/>
<polygon fill="#ff0000" stroke="#ff0000" points="582.724,-45.7534 591.7303,-40.1733 581.21,-38.9191 582.724,-45.7534"/>
</g>
<!-- sourcefile~simairservingzones.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~simairservingzones.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node6"><a xlink:href="../sourcefile/simairservingzones.f90.html" xlink:title="SimAirServingZones.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="704.2474,-81.1458 578.8203,-81.1458 578.8203,-59.1349 704.2474,-59.1349 704.2474,-81.1458"/>
<text text-anchor="middle" x="641.5338" y="-66.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SimAirServingZones.f90</text>
</a>
</g>
</g>
<!-- sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~simairservingzones.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~simairservingzones.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M533.8739,-70.1404C545.3255,-70.1404 557.0947,-70.1404 568.4541,-70.1404"/>
<polygon fill="#ff0000" stroke="#ff0000" points="568.7502,-73.6405 578.7502,-70.1404 568.7502,-66.6405 568.7502,-73.6405"/>
</g>
<!-- sourcefile~plantmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~plantmanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node7"><a xlink:href="../sourcefile/plantmanager.f90.html" xlink:title="PlantManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="688.8476,-159.1458 594.2201,-159.1458 594.2201,-137.1349 688.8476,-137.1349 688.8476,-159.1458"/>
<text text-anchor="middle" x="641.5338" y="-144.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">PlantManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~plantmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~plantmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M478.3277,-81.1719C500.953,-92.3913 537.4511,-109.9546 569.8601,-123.1404 578.8293,-126.7895 588.5543,-130.4035 597.8624,-133.7017"/>
<polygon fill="#ff0000" stroke="#ff0000" points="596.7674,-137.0265 607.3623,-137.0128 599.0714,-130.4165 596.7674,-137.0265"/>
</g>
<!-- sourcefile~heatbalanceairmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~heatbalanceairmanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node8"><a xlink:href="../sourcefile/heatbalanceairmanager.f90.html" xlink:title="HeatBalanceAirManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1027.4925,-78.1458 883.8174,-78.1458 883.8174,-56.1349 1027.4925,-56.1349 1027.4925,-78.1458"/>
<text text-anchor="middle" x="955.6549" y="-63.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceAirManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~heatbalanceairmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~systemavailabilitymanager.f90&#45;&gt;sourcefile~heatbalanceairmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M471.2278,-59.0598C491.9666,-44.2662 531.4893,-18.8055 569.8601,-9.1404 631.6403,6.4213 649.9362,-1.6775 713.2075,-9.1404 783.4299,-17.4231 862.7689,-38.757 910.9866,-53.1101"/>
<polygon fill="#ff0000" stroke="#ff0000" points="910.2045,-56.5297 920.7889,-56.0597 912.2216,-49.8266 910.2045,-56.5297"/>
</g>
<!-- sourcefile~hvacmanager.f90&#45;&gt;sourcefile~heatbalanceairmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~hvacmanager.f90&#45;&gt;sourcefile~heatbalanceairmanager.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M848.2911,-81.4958C856.4298,-80.4076 865.0485,-79.2552 873.7226,-78.0954"/>
<polygon fill="#00ffff" stroke="#00ffff" points="874.4574,-81.5284 883.9053,-76.7339 873.5297,-74.5902 874.4574,-81.5284"/>
</g>
<!-- sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~simulationmanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node10"><a xlink:href="../sourcefile/simulationmanager.f90.html" xlink:title="SimulationManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1687.1046,-117.1458 1567.2941,-117.1458 1567.2941,-95.1349 1687.1046,-95.1349 1687.1046,-117.1458"/>
<text text-anchor="middle" x="1627.1993" y="-102.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SimulationManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~hvacmanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~hvacmanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M847.8791,-90.7138C915.3215,-94.2298 1040.158,-100.7178 1146.6687,-106.1404"/>
</g>
<!-- sourcefile~zoneequipmentmanager.f90&#45;&gt;sourcefile~hvacmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~zoneequipmentmanager.f90&#45;&gt;sourcefile~hvacmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M682.7763,-40.2004C692.8189,-43.1739 703.4699,-46.5653 713.2075,-50.1404 731.1195,-56.7166 750.5932,-65.2693 766.4143,-72.5952"/>
<polygon fill="#ff0000" stroke="#ff0000" points="765.2064,-75.8943 775.7465,-76.9693 768.1773,-69.556 765.2064,-75.8943"/>
</g>
<!-- sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~sizingmanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node9"><a xlink:href="../sourcefile/sizingmanager.f90.html" xlink:title="SizingManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1531.4865,-78.1458 1432.5289,-78.1458 1432.5289,-56.1349 1531.4865,-56.1349 1531.4865,-78.1458"/>
<text text-anchor="middle" x="1482.0077" y="-63.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SizingManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~zoneequipmentmanager.f90&#45;&gt;sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~zoneequipmentmanager.f90&#45;&gt;sourcefile~sizingmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M955.6549,-28.1404C1150.631,-49.3027 1202.2199,-20.4641 1396.5183,-47.1404 1408.0812,-48.7279 1420.3752,-51.155 1431.9285,-53.7774"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1431.3175,-57.2293 1441.8537,-56.1161 1432.923,-50.4158 1431.3175,-57.2293"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M713.2946,-23.5523C777.1829,-19.8493 873.045,-17.4205 955.6549,-28.1404"/>
</g>
<!-- sourcefile~simairservingzones.f90&#45;&gt;sourcefile~hvacmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~simairservingzones.f90&#45;&gt;sourcefile~hvacmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M704.5124,-77.3579C715.8818,-78.6609 727.7043,-80.0158 738.9744,-81.3074"/>
<polygon fill="#7fff00" stroke="#7fff00" points="738.8068,-84.811 749.1403,-82.4725 739.6039,-77.8566 738.8068,-84.811"/>
</g>
<!-- sourcefile~simairservingzones.f90&#45;&gt;sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~simairservingzones.f90&#45;&gt;sourcefile~sizingmanager.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M678.7234,-59.066C737.477,-42.9482 855.4031,-16.1849 955.6549,-28.1404"/>
</g>
<!-- sourcefile~plantmanager.f90&#45;&gt;sourcefile~hvacmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~plantmanager.f90&#45;&gt;sourcefile~hvacmanager.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M674.4937,-137.0564C686.7064,-132.8412 700.638,-127.9047 713.2075,-123.1404 729.6754,-116.8984 747.7445,-109.5639 763.0034,-103.2259"/>
<polygon fill="#00ffff" stroke="#00ffff" points="764.7012,-106.3099 772.5799,-99.2264 762.0035,-99.8506 764.7012,-106.3099"/>
</g>
<!-- sourcefile~plantmanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~plantmanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M688.8962,-147.6511C750.386,-147.059 861.0349,-146.1404 955.6549,-146.1404 955.6549,-146.1404 955.6549,-146.1404 1146.6687,-146.1404 1295.7083,-146.1404 1333.3171,-156.3332 1482.0077,-146.1404"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1482.0077,-146.1404C1519.5474,-143.1915 1560.8012,-130.9008 1589.7092,-120.7127"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1591.1765,-123.9041 1599.3931,-117.2154 1588.7987,-117.3203 1591.1765,-123.9041"/>
</g>
<!-- sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~utilityroutines.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node12"><a xlink:href="../sourcefile/utilityroutines.f90.html" xlink:title="UtilityRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1819.3329,-157.1458 1723.0907,-157.1458 1723.0907,-135.1349 1819.3329,-135.1349 1819.3329,-157.1458"/>
<text text-anchor="middle" x="1771.2118" y="-142.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">UtilityRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~plantmanager.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~plantmanager.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1482.0077,-146.1404C1561.809,-139.8716 1654.3791,-141.4108 1712.8643,-143.4641"/>
<polygon fill="#00ffff" stroke="#00ffff" points="1712.8982,-146.9676 1723.0202,-143.838 1713.1557,-139.9724 1712.8982,-146.9676"/>
</g>
<!-- sourcefile~heatbalanceairmanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~heatbalanceairmanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1146.6687,-106.1404C1228.6059,-110.3119 1249.3364,-101.825 1331.2661,-106.1404"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M992.9186,-78.2201C1031.109,-88.7499 1092.4157,-103.3783 1146.6687,-106.1404"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~heatbalancesurfacemanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node13"><a xlink:href="../sourcefile/heatbalancesurfacemanager.f90.html" xlink:title="HeatBalanceSurfaceManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1229.8594,-78.1458 1063.478,-78.1458 1063.478,-56.1349 1229.8594,-56.1349 1229.8594,-78.1458"/>
<text text-anchor="middle" x="1146.6687" y="-63.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceSurfaceManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~heatbalanceairmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~heatbalanceairmanager.f90&#45;&gt;sourcefile~heatbalancesurfacemanager.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M1027.3248,-67.1404C1035.7706,-67.1404 1044.482,-67.1404 1053.1712,-67.1404"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="1053.3442,-70.6405 1063.3442,-67.1404 1053.3442,-63.6405 1053.3442,-70.6405"/>
</g>
<!-- sourcefile~sizingmanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~sizingmanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1523.2254,-78.2119C1539.695,-82.6358 1558.8326,-87.7763 1576.1664,-92.4324"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1575.5644,-95.8947 1586.13,-95.1087 1577.3803,-89.1343 1575.5644,-95.8947"/>
</g>
<!-- sourcefile~energyplus.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~energyplus.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node11"><a xlink:href="../sourcefile/energyplus.f90.html" xlink:title="EnergyPlus.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1812.9203,-116.1458 1729.5033,-116.1458 1729.5033,-94.1349 1812.9203,-94.1349 1812.9203,-116.1458"/>
<text text-anchor="middle" x="1771.2118" y="-101.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">EnergyPlus.f90</text>
</a>
</g>
</g>
<!-- sourcefile~simulationmanager.f90&#45;&gt;sourcefile~energyplus.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~simulationmanager.f90&#45;&gt;sourcefile~energyplus.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1687.0225,-105.725C1697.6871,-105.6509 1708.7189,-105.5743 1719.1452,-105.5019"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1719.3583,-109.0006 1729.3337,-105.4312 1719.3096,-102.0008 1719.3583,-109.0006"/>
</g>
<!-- sourcefile~simulationmanager.f90&#45;&gt;sourcefile~utilityroutines.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~simulationmanager.f90&#45;&gt;sourcefile~utilityroutines.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1666.9326,-117.1764C1683.7918,-121.8591 1703.6272,-127.3685 1721.4472,-132.3181"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1720.5363,-135.6975 1731.1083,-135.0015 1722.4097,-128.9528 1720.5363,-135.6975"/>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1182.6517,-78.2187C1219.5365,-88.7475 1278.7662,-103.3751 1331.2661,-106.1404"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1331.2661,-106.1404C1398.1696,-109.6643 1415.15,-101.8339 1482.0077,-106.1404"/>
</g>
<!-- sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_node14" class="node">
<title>sourcefile~heatbalancemanager.f90</title>
<g id="a_sourcefile~~airflownetworksolver.f90~~AfferentGraph_node14"><a xlink:href="../sourcefile/heatbalancemanager.f90.html" xlink:title="HeatBalanceManager.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1396.2714,-78.1458 1266.2608,-78.1458 1266.2608,-56.1349 1396.2714,-56.1349 1396.2714,-78.1458"/>
<text text-anchor="middle" x="1331.2661" y="-63.9904" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">HeatBalanceManager.f90</text>
</a>
</g>
</g>
<!-- sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~heatbalancesurfacemanager.f90&#45;&gt;sourcefile~heatbalancemanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1230.0564,-67.1404C1238.7779,-67.1404 1247.6067,-67.1404 1256.2271,-67.1404"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1256.2322,-70.6405 1266.2321,-67.1404 1256.2321,-63.6405 1256.2322,-70.6405"/>
</g>
<!-- sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~sizingmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~sizingmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1396.5068,-67.1404C1404.9922,-67.1404 1413.652,-67.1404 1422.0455,-67.1404"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1422.1221,-70.6405 1432.122,-67.1404 1422.122,-63.6405 1422.1221,-70.6405"/>
</g>
<!-- sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~simulationmanager.f90 -->
<g id="sourcefile~~airflownetworksolver.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~heatbalancemanager.f90&#45;&gt;sourcefile~simulationmanager.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1482.0077,-106.1404C1506.5493,-107.7211 1533.4727,-108.097 1557.3981,-107.9568"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1557.4843,-111.4563 1567.4527,-107.8672 1557.4218,-104.4566 1557.4843,-111.4563"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1360.472,-78.2089C1390.4522,-88.7299 1438.7109,-103.3515 1482.0077,-106.1404"/>
</g>
</g>
</svg>
</div>
                <script>var pansourcefileairflownetworksolverf90AfferentGraph = svgPanZoom('#sourcefileairflownetworksolverf90AfferentGraph', {
                    zoomEnabled: true,
                    controlIconsEnabled: true,
                    fit: true,
                    center: true,});
                    </script>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">

    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="186pt" height="31pt"
 viewBox="0.00 0.00 186.41 30.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 26.5)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-26.5 182.4064,-26.5 182.4064,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65.1576,-22.2554 -.0526,-22.2554 -.0526,-.2446 65.1576,-.2446 65.1576,-22.2554"/>
<text text-anchor="middle" x="32.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="178.2607,-22.2554 82.8443,-22.2554 82.8443,-.2446 178.2607,-.2446 178.2607,-22.2554"/>
<text text-anchor="middle" x="130.5525" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>


    <p>Solid arrows point from a file to a file which depends upon it. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>

                      </div>
                    </div>
                  </div>
                </div>


      <br>

    <section class="visible-xs visible-sm hidden-md">


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../module/airflownetworksolver.html">AirflowNetworkSolver</a>

    </div>
  </div>
</div>


<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html#src">AirflowNetworkSolver.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! define this variable to get new code, commenting should yield original</span>
<a name="ln-2"></a><span class="cp">#define SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-3"></a>
<a name="ln-4"></a><span class="k">MODULE </span><span class="n">AirflowNetworkSolver</span>
<a name="ln-5"></a>
<a name="ln-6"></a>
<a name="ln-7"></a>          <span class="c">! MODULE INFORMATION:</span>
<a name="ln-8"></a>          <span class="c">!       AUTHOR         Lixing Gu, Don Shirey, and Muthusamy V. Swami</span>
<a name="ln-9"></a>          <span class="c">!       DATE WRITTEN   Jul. 2005</span>
<a name="ln-10"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-11"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-12"></a>
<a name="ln-13"></a>
<a name="ln-14"></a>          <span class="c">! PURPOSE OF THIS MODULE:</span>
<a name="ln-15"></a>          <span class="c">! This module is used to simulate airflows and pressures. The module is modified to</span>
<a name="ln-16"></a>          <span class="c">! meet requirements of EnergyPLus based on AIRNET, developed by</span>
<a name="ln-17"></a>          <span class="c">! National Institute of Standards and Technology (NIST).</span>
<a name="ln-18"></a>
<a name="ln-19"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-20"></a>          <span class="c">! An airflow network approach is used. It consists of nodes connected by airflow elements.</span>
<a name="ln-21"></a>          <span class="c">! The Newton&#39;s method is applied to solve a sparse matrix. When a new solver is available, this</span>
<a name="ln-22"></a>          <span class="c">! module will be replaced or updated.</span>
<a name="ln-23"></a>
<a name="ln-24"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-25"></a>          <span class="c">! Walton, G. N., 1989, &quot;AIRNET - A Computer Program for Building Airflow Network Modeling,&quot;</span>
<a name="ln-26"></a>          <span class="c">! NISTIR 89-4072, National Institute of Standards and Technology, Gaithersburg, Maryland</span>
<a name="ln-27"></a>
<a name="ln-28"></a>          <span class="c">! OTHER NOTES: none</span>
<a name="ln-29"></a>
<a name="ln-30"></a>
<a name="ln-31"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-32"></a>
<a name="ln-33"></a>    <span class="k">USE </span><span class="n">DataPrecisionGlobals</span>
<a name="ln-34"></a>    <span class="k">USE </span><span class="n">DataGlobals</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">MaxNameLength</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">DegToRadians</span><span class="p">,</span> <span class="n">KelvinConv</span><span class="p">,</span><span class="n">rTinyValue</span>
<a name="ln-35"></a>    <span class="k">USE </span><span class="n">DataInterfaces</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">ShowFatalError</span><span class="p">,</span> <span class="n">ShowWarningError</span><span class="p">,</span> <span class="n">ShowSevereError</span><span class="p">,</span> <span class="n">ShowMessage</span><span class="p">,</span> <span class="n">ShowContinueError</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-36"></a>                           <span class="n">SetupOutputVariable</span><span class="p">,</span> <span class="n">ShowContinueErrorTimeStamp</span><span class="p">,</span> <span class="n">ShowRecurringWarningErrorAtEnd</span>
<a name="ln-37"></a>    <span class="k">USE </span><span class="n">DataEnvironment</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">StdBaroPress</span><span class="p">,</span> <span class="n">OutBaroPress</span><span class="p">,</span> <span class="n">OutDryBulbTemp</span><span class="p">,</span> <span class="n">OutHumRat</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-38"></a>                               <span class="n">Latitude</span>
<a name="ln-39"></a>    <span class="k">USE </span><span class="n">DataSurfaces</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">Surface</span>
<a name="ln-40"></a>    <span class="k">USE </span><span class="n">Psychrometrics</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">,</span><span class="n">PsyCpAirFnWTdb</span><span class="p">,</span><span class="n">PsyHFnTdbW</span>
<a name="ln-41"></a>    <span class="k">USE </span><span class="n">DataAirflowNetwork</span>
<a name="ln-42"></a>
<a name="ln-43"></a>
<a name="ln-44"></a><span class="k">IMPLICIT NONE</span>   <span class="c">! Enforce explicit typing of all variables</span>
<a name="ln-45"></a>
<a name="ln-46"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span>  <span class="kd">::</span> <span class="n">NetworkNumOfLinks</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-47"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PUBLIC</span>  <span class="kd">::</span> <span class="n">NetworkNumOfNodes</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-48"></a>
<a name="ln-49"></a><span class="k">PRIVATE</span> <span class="c">! Everything private unless explicitly made public</span>
<a name="ln-50"></a>
<a name="ln-51"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">NrInt</span><span class="o">=</span><span class="mi">20</span> <span class="c">! Number of intervals for a large opening</span>
<a name="ln-52"></a>
<a name="ln-53"></a><span class="c">! Common block AFEDAT</span>
<a name="ln-54"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">AFECTL</span>
<a name="ln-55"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">AFLOW2</span>
<a name="ln-56"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">AFLOW</span>
<a name="ln-57"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">PS</span>
<a name="ln-58"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">PW</span>
<a name="ln-59"></a>
<a name="ln-60"></a>
<a name="ln-61"></a><span class="c">! Common block CONTRL</span>
<a name="ln-62"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">PB</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-63"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">LIST</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-64"></a>
<a name="ln-65"></a>
<a name="ln-66"></a><span class="c">! Common block ZONL</span>
<a name="ln-67"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">RHOZ</span>
<a name="ln-68"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">SQRTDZ</span>
<a name="ln-69"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">VISCZ</span>
<a name="ln-70"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">SUMAF</span>
<a name="ln-71"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">TZ</span>              <span class="c">! Temperature [C]</span>
<a name="ln-72"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">WZ</span>              <span class="c">! Humidity ratio [kg/kg]</span>
<a name="ln-73"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">PZ</span>  <span class="c">! Pressure [Pa]</span>
<a name="ln-74"></a>
<a name="ln-75"></a><span class="c">! Other array variables</span>
<a name="ln-76"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">ID</span>
<a name="ln-77"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">IK</span>
<a name="ln-78"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">AD</span>
<a name="ln-79"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">AU</span>
<a name="ln-80"></a>
<a name="ln-81"></a><span class="cp">#ifdef SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-82"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">newIK</span>   <span class="c">!noel</span>
<a name="ln-83"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">newAU</span> <span class="c">!noel</span>
<a name="ln-84"></a><span class="cp">#endif</span>
<a name="ln-85"></a>
<a name="ln-86"></a><span class="c">!REAL(r64), ALLOCATABLE, DIMENSION(:) :: AL</span>
<a name="ln-87"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">SUMF</span>
<a name="ln-88"></a><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">Unit11</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-89"></a><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">Unit21</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-90"></a>
<a name="ln-91"></a><span class="c">! Large opening variables</span>
<a name="ln-92"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">DpProf</span>    <span class="c">! Differential pressure profile for Large Openings [Pa]</span>
<a name="ln-93"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">RhoProfF</span>  <span class="c">! Density profile in FROM zone [kg/m3]</span>
<a name="ln-94"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">RhoProfT</span>  <span class="c">! Density profile in TO zone [kg/m3]</span>
<a name="ln-95"></a><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">ALLOCATABLE</span><span class="p">,</span> <span class="k">DIMENSION</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">DpL</span>     <span class="c">! Array of stack pressures in link</span>
<a name="ln-96"></a>
<a name="ln-97"></a><span class="k">PUBLIC </span><span class="n">SETSKY</span>
<a name="ln-98"></a><span class="k">PUBLIC </span><span class="n">AIRMOV</span>
<a name="ln-99"></a><span class="k">Public </span><span class="n">AllocateAirflowNetworkData</span>
<a name="ln-100"></a><span class="k">Public </span><span class="n">InitAirflowNetworkData</span>
<a name="ln-101"></a>
<a name="ln-102"></a>
<a name="ln-103"></a><span class="k">CONTAINS</span>
<a name="ln-104"></a>
<a name="ln-105"></a>
<a name="ln-106"></a><span class="k">SUBROUTINE </span><span class="n">AllocateAirflowNetworkData</span>
<a name="ln-107"></a>
<a name="ln-108"></a>
<a name="ln-109"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-110"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-111"></a>          <span class="c">!       DATE WRITTEN   Aug. 2003</span>
<a name="ln-112"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-113"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-114"></a>
<a name="ln-115"></a>
<a name="ln-116"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-117"></a>          <span class="c">! This subroutine allocates dynamic arrays for AirflowNetworkSolver.</span>
<a name="ln-118"></a>
<a name="ln-119"></a>
<a name="ln-120"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-121"></a>          <span class="c">! na</span>
<a name="ln-122"></a>
<a name="ln-123"></a>
<a name="ln-124"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-125"></a>          <span class="c">! na</span>
<a name="ln-126"></a>
<a name="ln-127"></a>
<a name="ln-128"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-129"></a>          <span class="c">! na</span>
<a name="ln-130"></a>
<a name="ln-131"></a>
<a name="ln-132"></a>  <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-133"></a>
<a name="ln-134"></a>
<a name="ln-135"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-136"></a>          <span class="c">! na</span>
<a name="ln-137"></a>
<a name="ln-138"></a>
<a name="ln-139"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-140"></a>          <span class="c">! na</span>
<a name="ln-141"></a>
<a name="ln-142"></a>
<a name="ln-143"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-144"></a>          <span class="c">! na</span>
<a name="ln-145"></a>
<a name="ln-146"></a>
<a name="ln-147"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-148"></a>          <span class="c">! na</span>
<a name="ln-149"></a>
<a name="ln-150"></a>
<a name="ln-151"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-152"></a><span class="kt">INTEGER </span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">N</span>
<a name="ln-153"></a><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">EXTERNAL</span> <span class="kd">::</span> <span class="n">GetNewUnitNumber</span>  <span class="c">! External  function to &quot;get&quot; a unit number</span>
<a name="ln-154"></a>
<a name="ln-155"></a><span class="c">! Assume a network to simulate multizone airflow is a subset of the network to simulate air distribution system.</span>
<a name="ln-156"></a><span class="c">! Network array size is allocated based on the network of air distribution system.</span>
<a name="ln-157"></a><span class="c">! If multizone airflow is simulated only, the array size is allocated based on the multizone network.</span>
<a name="ln-158"></a>          <span class="c">! FLOW:</span>
<a name="ln-159"></a>   <span class="n">NetworkNumOfLinks</span> <span class="o">=</span> <span class="n">AirflowNetworkNumOfLinks</span>
<a name="ln-160"></a>   <span class="n">NetworkNumOfNodes</span> <span class="o">=</span> <span class="n">AirflowNetworkNumOfNodes</span>
<a name="ln-161"></a>
<a name="ln-162"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">NetworkNumOfLinks</span><span class="p">))</span>
<a name="ln-163"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">NetworkNumOfLinks</span><span class="p">))</span>
<a name="ln-164"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">NetworkNumOfLinks</span><span class="p">))</span>
<a name="ln-165"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">PW</span><span class="p">(</span><span class="n">NetworkNumOfLinks</span><span class="p">))</span>
<a name="ln-166"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">PS</span><span class="p">(</span><span class="n">NetworkNumOfLinks</span><span class="p">))</span>
<a name="ln-167"></a>
<a name="ln-168"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-169"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">WZ</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-170"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">PZ</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-171"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-172"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-173"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-174"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SUMAF</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-175"></a>
<a name="ln-176"></a>
<a name="ln-177"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-178"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-179"></a><span class="cp">#ifdef SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-180"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">newIK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-181"></a><span class="cp">#endif</span>
<a name="ln-182"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">AD</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-183"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">SUMF</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">))</span>
<a name="ln-184"></a>
<a name="ln-185"></a>   <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-186"></a>   <span class="k">Do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">AirflowNetworkNumOfLinks</span>
<a name="ln-187"></a>      <span class="n">j</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">CompTypeNum</span>
<a name="ln-188"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="n">CompTypeNum_DOP</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-189"></a><span class="k">         </span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-190"></a>      <span class="k">end if</span>
<a name="ln-191"></a><span class="k">   End do</span>
<a name="ln-192"></a>
<a name="ln-193"></a><span class="k">   ALLOCATE</span><span class="p">(</span><span class="n">DpProf</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)))</span>
<a name="ln-194"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">RhoProfF</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)))</span>
<a name="ln-195"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">RhoProfT</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)))</span>
<a name="ln-196"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">DpL</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">AirflowNetworkNumOfLinks</span><span class="p">))</span>
<a name="ln-197"></a>
<a name="ln-198"></a>   <span class="n">PB</span> <span class="o">=</span> <span class="mi">10132</span><span class="mf">5.0d0</span>
<a name="ln-199"></a><span class="c">!   LIST = 5</span>
<a name="ln-200"></a>   <span class="n">LIST</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-201"></a>   <span class="k">If</span> <span class="p">(</span><span class="n">LIST</span> <span class="p">.</span><span class="n">GE</span><span class="p">.</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-202"></a><span class="k">      </span><span class="n">Unit21</span> <span class="o">=</span> <span class="n">GetNewUnitNumber</span><span class="p">()</span>
<a name="ln-203"></a>      <span class="k">open</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;eplusADS.out&#39;</span><span class="p">)</span>
<a name="ln-204"></a>   <span class="k">end if</span>
<a name="ln-205"></a>
<a name="ln-206"></a>
<a name="ln-207"></a><span class="k">   DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-208"></a>      <span class="n">ID</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">N</span>
<a name="ln-209"></a>   <span class="k">END DO</span>
<a name="ln-210"></a><span class="k">   DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-211"></a>      <span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-212"></a>      <span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-213"></a>      <span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-214"></a>   <span class="k">END DO</span>
<a name="ln-215"></a>
<a name="ln-216"></a>
<a name="ln-217"></a><span class="k">   DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-218"></a>      <span class="n">TZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">AirflowNetworkNodeSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">TZ</span>
<a name="ln-219"></a>      <span class="n">WZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">AirflowNetworkNodeSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">WZ</span>
<a name="ln-220"></a>      <span class="n">PZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">AirflowNetworkNodeSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">PZ</span>
<a name="ln-221"></a>   <span class="k">END DO</span>
<a name="ln-222"></a>
<a name="ln-223"></a>   <span class="c">! Assign linkage values</span>
<a name="ln-224"></a>   <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-225"></a>      <span class="n">PW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-226"></a>   <span class="k">END DO</span>
<a name="ln-227"></a>   <span class="c">! Write an ouput file used for AIRNET input</span>
<a name="ln-228"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">LIST</span> <span class="p">.</span><span class="n">GE</span><span class="p">.</span> <span class="mi">5</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-229"></a><span class="k">     </span><span class="n">Unit11</span> <span class="o">=</span> <span class="n">GetNewUnitNumber</span><span class="p">()</span>
<a name="ln-230"></a>     <span class="k">open</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;eplusADS.inp&#39;</span><span class="p">)</span>
<a name="ln-231"></a>     <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-232"></a>        <span class="k">write</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">,</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeight</span><span class="p">,</span><span class="n">TZ</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">PZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-233"></a>     <span class="k">end do</span>
<a name="ln-234"></a><span class="k">     write</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="mi">0</span>
<a name="ln-235"></a>     <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">AirflowNetworkNumOfComps</span>
<a name="ln-236"></a>        <span class="n">j</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-237"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">CompTypeNum</span><span class="p">)</span>
<a name="ln-238"></a>           <span class="k">CASE</span> <span class="p">(</span><span class="n">CompTypeNum_PLR</span><span class="p">)</span> <span class="c">!&#39;PLR&#39;  Power law component</span>
<a name="ln-239"></a><span class="c">!              WRITE(Unit11,902) AirflowNetworkCompData(i)%CompNum,1,DisSysCompLeakData(j)%FlowCoef, &amp;</span>
<a name="ln-240"></a><span class="c">!                  DisSysCompLeakData(j)%FlowCoef,DisSysCompLeakData(j)%FlowCoef,DisSysCompLeakData(j)%FlowExpo</span>
<a name="ln-241"></a>           <span class="k">CASE</span> <span class="p">(</span><span class="n">CompTypeNum_SCR</span><span class="p">)</span> <span class="c">!&#39;SCR&#39;  Surface crack component</span>
<a name="ln-242"></a>              <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="mi">902</span><span class="p">)</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-243"></a>                  <span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="p">,</span><span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="p">,</span><span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-244"></a>           <span class="k">CASE</span> <span class="p">(</span><span class="n">CompTypeNum_DWC</span><span class="p">)</span> <span class="c">!&#39;DWC&#39; Duct component</span>
<a name="ln-245"></a><span class="c">!              WRITE(Unit11,902) AirflowNetworkCompData(i)%CompNum,2,DisSysCompDuctData(j)%L,DisSysCompDuctData(j)%D, &amp;</span>
<a name="ln-246"></a><span class="c">!                               DisSysCompDuctData(j)%A,DisSysCompDuctData(j)%Rough</span>
<a name="ln-247"></a><span class="c">!              WRITE(Unit11,903) DisSysCompDuctData(i)%TurDynCoef,DisSysCompDuctData(j)%LamFriCoef, &amp;</span>
<a name="ln-248"></a><span class="c">!                               DisSysCompDuctData(j)%LamFriCoef,DisSysCompDuctData(j)%InitLamCoef</span>
<a name="ln-249"></a><span class="c">!           CASE (CompTypeNum_CVF) ! &#39;CVF&#39; Constant volume fan component</span>
<a name="ln-250"></a><span class="c">!              WRITE(Unit11,904) AirflowNetworkCompData(i)%CompNum,4,DisSysCompCVFData(j)%FlowRate</span>
<a name="ln-251"></a>           <span class="k">CASE</span> <span class="p">(</span><span class="n">CompTypeNum_EXF</span><span class="p">)</span> <span class="c">! &#39;EXF&#39; Zone exhaust fan</span>
<a name="ln-252"></a>              <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="mi">904</span><span class="p">)</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">FlowRate</span>
<a name="ln-253"></a>           <span class="k">CASE </span><span class="n">Default</span>
<a name="ln-254"></a>        <span class="k">END SELECT</span>
<a name="ln-255"></a><span class="k">     end do</span>
<a name="ln-256"></a><span class="k">     write</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="mi">0</span>
<a name="ln-257"></a>     <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-258"></a>        <span class="k">write</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="mi">910</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-259"></a>                         <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-260"></a>                         <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
<a name="ln-261"></a>     <span class="k">end do</span>
<a name="ln-262"></a><span class="k">     write</span><span class="p">(</span><span class="n">Unit11</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="mi">0</span>
<a name="ln-263"></a>   <span class="k">end if</span>
<a name="ln-264"></a>
<a name="ln-265"></a><span class="k">   CALL </span><span class="n">SETSKY</span>
<a name="ln-266"></a>
<a name="ln-267"></a>   <span class="c">!SETSKY figures out the IK stuff -- which is why E+ doesn&#39;t allocate AU until here</span>
<a name="ln-268"></a><span class="cp">#ifdef SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-269"></a><span class="c">!   ! only printing to screen, can be commented</span>
<a name="ln-270"></a><span class="c">!   print*, &quot;SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS is defined&quot;</span>
<a name="ln-271"></a><span class="c">!</span>
<a name="ln-272"></a><span class="c">!   write(*,&#39;(2(a,i8))&#39;) &quot;AllocateAirflowNetworkData: after SETSKY, allocating AU.  NetworkNumOfNodes=&quot;, &amp;</span>
<a name="ln-273"></a><span class="c">!        NetworkNumOfNodes, &quot; IK(NetworkNumOfNodes+1)= NNZE=&quot;, IK(NetworkNumOfNodes+1)</span>
<a name="ln-274"></a><span class="c">!   print*, &quot; NetworkNumOfLinks=&quot;, NetworkNumOfLinks</span>
<a name="ln-275"></a><span class="c">!</span>
<a name="ln-276"></a>   <span class="c">! allocate same size as others -- this will be maximum  !noel</span>
<a name="ln-277"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">newAU</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-278"></a><span class="cp">#endif</span>
<a name="ln-279"></a>
<a name="ln-280"></a>   <span class="c">! noel, GNU says the AU is indexed above its upper bound</span>
<a name="ln-281"></a>   <span class="c">!ALLOCATE(AU(IK(NetworkNumOfNodes+1)-1))</span>
<a name="ln-282"></a>   <span class="k">ALLOCATE</span><span class="p">(</span><span class="n">AU</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-283"></a>
<a name="ln-284"></a><span class="mi">900</span> <span class="k">Format</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">i2</span><span class="p">)</span>
<a name="ln-285"></a><span class="mi">901</span> <span class="k">Format</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="mi">2</span><span class="n">I4</span><span class="p">,</span><span class="mi">4</span><span class="n">F9</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-286"></a><span class="mi">902</span> <span class="k">Format</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="mi">2</span><span class="n">I4</span><span class="p">,</span><span class="mi">4</span><span class="n">F9</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-287"></a><span class="mi">903</span> <span class="k">Format</span><span class="p">(</span><span class="mi">9</span><span class="n">X</span><span class="p">,</span><span class="mi">4</span><span class="n">F9</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-288"></a><span class="mi">904</span> <span class="k">Format</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="mi">2</span><span class="n">I4</span><span class="p">,</span><span class="mi">1</span><span class="n">F9</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-289"></a><span class="mi">910</span> <span class="k">Format</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">I4</span><span class="p">,</span><span class="mi">2</span><span class="p">(</span><span class="n">I4</span><span class="p">,</span><span class="n">F9</span><span class="p">.</span><span class="mi">4</span><span class="p">),</span><span class="n">I4</span><span class="p">,</span><span class="mi">2</span><span class="n">F4</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-290"></a>
<a name="ln-291"></a><span class="k">RETURN</span>
<a name="ln-292"></a><span class="k">END SUBROUTINE </span><span class="n">AllocateAirflowNetworkData</span>
<a name="ln-293"></a>
<a name="ln-294"></a><span class="k">SUBROUTINE </span><span class="n">InitAirflowNetworkData</span>
<a name="ln-295"></a>
<a name="ln-296"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-297"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-298"></a>          <span class="c">!       DATE WRITTEN   Aug. 2003</span>
<a name="ln-299"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-300"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-301"></a>
<a name="ln-302"></a>
<a name="ln-303"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-304"></a>          <span class="c">! This subroutine initializes variables for AirflowNetworkSolver.</span>
<a name="ln-305"></a>
<a name="ln-306"></a>
<a name="ln-307"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-308"></a>          <span class="c">! na</span>
<a name="ln-309"></a>
<a name="ln-310"></a>
<a name="ln-311"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-312"></a>          <span class="c">! na</span>
<a name="ln-313"></a>
<a name="ln-314"></a>
<a name="ln-315"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-316"></a>          <span class="c">! na</span>
<a name="ln-317"></a>
<a name="ln-318"></a>  <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-319"></a>
<a name="ln-320"></a>
<a name="ln-321"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-322"></a>          <span class="c">! na</span>
<a name="ln-323"></a>
<a name="ln-324"></a>
<a name="ln-325"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-326"></a>          <span class="c">! na</span>
<a name="ln-327"></a>
<a name="ln-328"></a>
<a name="ln-329"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-330"></a>          <span class="c">! na</span>
<a name="ln-331"></a>
<a name="ln-332"></a>
<a name="ln-333"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-334"></a>          <span class="c">! na</span>
<a name="ln-335"></a>
<a name="ln-336"></a>
<a name="ln-337"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-338"></a>   <span class="kt">INTEGER </span><span class="n">I</span><span class="p">,</span><span class="n">N</span>
<a name="ln-339"></a>
<a name="ln-340"></a>      <span class="c">! FLOW:</span>
<a name="ln-341"></a>   <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-342"></a>      <span class="n">ID</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">N</span>
<a name="ln-343"></a>   <span class="k">END DO</span>
<a name="ln-344"></a><span class="k">   DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-345"></a>      <span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-346"></a>      <span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-347"></a>      <span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-348"></a>   <span class="k">END DO</span>
<a name="ln-349"></a>
<a name="ln-350"></a><span class="k">   DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-351"></a>      <span class="n">TZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">AirflowNetworkNodeSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">TZ</span>
<a name="ln-352"></a>      <span class="n">WZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">AirflowNetworkNodeSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">WZ</span>
<a name="ln-353"></a>      <span class="n">PZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">AirflowNetworkNodeSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">PZ</span>
<a name="ln-354"></a>   <span class="k">END DO</span>
<a name="ln-355"></a>
<a name="ln-356"></a><span class="k">RETURN</span>
<a name="ln-357"></a>
<a name="ln-358"></a><span class="k">END SUBROUTINE </span><span class="n">InitAirflowNetworkData</span>
<a name="ln-359"></a>
<a name="ln-360"></a>
<a name="ln-361"></a>      <span class="k">SUBROUTINE </span><span class="n">SETSKY</span>
<a name="ln-362"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-363"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-364"></a>          <span class="c">!       DATE WRITTEN   1998</span>
<a name="ln-365"></a>          <span class="c">!       MODIFIED       Feb. 2006 (L. Gu) to meet requirements of AirflowNetwork</span>
<a name="ln-366"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-367"></a>
<a name="ln-368"></a>
<a name="ln-369"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-370"></a>          <span class="c">! This subroutine sets up the &quot;IK&quot; array describing the sparse matrix [A] in skyline</span>
<a name="ln-371"></a>          <span class="c">!     form by using the location matrix.</span>
<a name="ln-372"></a>
<a name="ln-373"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-374"></a>          <span class="c">! na</span>
<a name="ln-375"></a>
<a name="ln-376"></a>
<a name="ln-377"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-378"></a>          <span class="c">! AIRNET</span>
<a name="ln-379"></a>
<a name="ln-380"></a>
<a name="ln-381"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-382"></a>          <span class="c">! na</span>
<a name="ln-383"></a>
<a name="ln-384"></a>  <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-385"></a>
<a name="ln-386"></a>
<a name="ln-387"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-388"></a>          <span class="c">! na</span>
<a name="ln-389"></a>
<a name="ln-390"></a>
<a name="ln-391"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-392"></a>          <span class="c">! na</span>
<a name="ln-393"></a>
<a name="ln-394"></a>
<a name="ln-395"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-396"></a>          <span class="c">! na</span>
<a name="ln-397"></a>
<a name="ln-398"></a>
<a name="ln-399"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-400"></a>          <span class="c">! na</span>
<a name="ln-401"></a>
<a name="ln-402"></a>
<a name="ln-403"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-404"></a>          <span class="c">! IK(K) - pointer to the top of column/row &quot;K&quot;.</span>
<a name="ln-405"></a>      <span class="kt">INTEGER  </span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span>
<a name="ln-406"></a>
<a name="ln-407"></a>      <span class="c">! FLOW:</span>
<a name="ln-408"></a>      <span class="c">! Initialize &quot;IK&quot;.</span>
<a name="ln-409"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-410"></a>         <span class="n">IK</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-411"></a>      <span class="k">END DO</span>
<a name="ln-412"></a>      <span class="c">! Determine column heights.</span>
<a name="ln-413"></a>      <span class="k">DO </span><span class="n">M</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-414"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">M</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-415"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-416"></a><span class="k">        </span><span class="n">L</span> <span class="o">=</span> <span class="n">ID</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-417"></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">M</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-418"></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">ID</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-419"></a>        <span class="n">N1</span> <span class="o">=</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="n">K</span><span class="p">)</span>
<a name="ln-420"></a>        <span class="n">N2</span> <span class="o">=</span> <span class="nb">MAX</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">L</span><span class="p">)</span>
<a name="ln-421"></a>        <span class="n">IK</span><span class="p">(</span><span class="n">N2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">MAX</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">N2</span><span class="p">),</span><span class="n">N1</span><span class="p">)</span>
<a name="ln-422"></a>      <span class="k">END DO</span>
<a name="ln-423"></a>      <span class="c">! Convert heights to column addresses.</span>
<a name="ln-424"></a>      <span class="n">J</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-425"></a>      <span class="n">IK</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-426"></a>      <span class="k">DO </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-427"></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-428"></a>        <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">+</span><span class="n">J</span>
<a name="ln-429"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">I</span>
<a name="ln-430"></a>      <span class="k">END DO</span>
<a name="ln-431"></a>
<a name="ln-432"></a><span class="k">      RETURN</span>
<a name="ln-433"></a><span class="k">      END SUBROUTINE </span><span class="n">SETSKY</span>
<a name="ln-434"></a>
<a name="ln-435"></a>
<a name="ln-436"></a>      <span class="k">SUBROUTINE </span><span class="n">AIRMOV</span>
<a name="ln-437"></a><span class="c">!</span>
<a name="ln-438"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-439"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-440"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-441"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-442"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-443"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-444"></a>          <span class="c">!</span>
<a name="ln-445"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-446"></a>
<a name="ln-447"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-448"></a>          <span class="c">! This subroutine is a driver for AIRNET to calculate nodal pressures and linkage airflows</span>
<a name="ln-449"></a>
<a name="ln-450"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-451"></a>          <span class="c">! na</span>
<a name="ln-452"></a>
<a name="ln-453"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-454"></a>          <span class="c">! na</span>
<a name="ln-455"></a>
<a name="ln-456"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-457"></a>
<a name="ln-458"></a>  <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-459"></a>
<a name="ln-460"></a>
<a name="ln-461"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-462"></a>          <span class="c">! na</span>
<a name="ln-463"></a>
<a name="ln-464"></a>
<a name="ln-465"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-466"></a>          <span class="c">! na</span>
<a name="ln-467"></a>
<a name="ln-468"></a>
<a name="ln-469"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-470"></a>          <span class="c">! na</span>
<a name="ln-471"></a>
<a name="ln-472"></a>
<a name="ln-473"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-474"></a>          <span class="c">! na</span>
<a name="ln-475"></a>
<a name="ln-476"></a>
<a name="ln-477"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-478"></a>         <span class="kt">INTEGER  </span><span class="n">I</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">ITER</span>
<a name="ln-479"></a>
<a name="ln-480"></a>      <span class="c">! FLOW:</span>
<a name="ln-481"></a>      <span class="c">! Compute zone air properties.</span>
<a name="ln-482"></a>      <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-483"></a>        <span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">StdBaroPress</span><span class="o">+</span><span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">WZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-484"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">ExtNodeNum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-485"></a><span class="k">           </span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">StdBaroPress</span><span class="o">+</span><span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">OutDryBulbTemp</span><span class="p">,</span><span class="n">OutHumRat</span><span class="p">)</span>
<a name="ln-486"></a>           <span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">OutDryBulbTemp</span>
<a name="ln-487"></a>           <span class="n">WZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">OutHumRat</span>
<a name="ln-488"></a>        <span class="k">end if</span>
<a name="ln-489"></a><span class="k">        </span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-490"></a>        <span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.71432d-5</span><span class="o">+</span><span class="mf">4.828d-8</span><span class="o">*</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-491"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">903</span><span class="p">)</span> <span class="s1">&#39;D,V:&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-492"></a>      <span class="k">END DO</span>
<a name="ln-493"></a><span class="k">      IF</span><span class="p">(</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">InitFlag</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-494"></a><span class="k">        DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-495"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-496"></a>        <span class="k">END DO</span>
<a name="ln-497"></a><span class="k">      END IF</span>
<a name="ln-498"></a>      <span class="c">! Compute stack pressures.</span>
<a name="ln-499"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-500"></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-501"></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-502"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-503"></a><span class="k">          </span><span class="n">PS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">9.80d0</span><span class="o">*</span><span class="p">(</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeHeight</span><span class="o">-</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">M</span><span class="p">)%</span><span class="n">NodeHeight</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-504"></a>                    <span class="o">+</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-505"></a>        <span class="k">ELSE IF</span><span class="p">(</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="n">LT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-506"></a><span class="k">          </span><span class="n">PS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">9.80d0</span><span class="o">*</span><span class="p">(</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeHeight</span><span class="o">-</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">M</span><span class="p">)%</span><span class="n">NodeHeight</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-507"></a>                     <span class="o">+</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-508"></a>        <span class="k">ELSE</span>
<a name="ln-509"></a><span class="k">          </span><span class="n">PS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">4.90d0</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeHeight</span><span class="o">-</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">M</span><span class="p">)%</span><span class="n">NodeHeight</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-510"></a>            <span class="o">+</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>
<a name="ln-511"></a>        <span class="k">END IF</span>
<a name="ln-512"></a><span class="k">      END DO</span>
<a name="ln-513"></a>
<a name="ln-514"></a>      <span class="c">! Calculate pressure field in a large opening</span>
<a name="ln-515"></a>      <span class="k">CALL </span><span class="n">PSTACK</span>
<a name="ln-516"></a>
<a name="ln-517"></a>      <span class="k">CALL </span><span class="n">SOLVZP</span><span class="p">(</span><span class="n">IK</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">ITER</span><span class="p">)</span>
<a name="ln-518"></a>
<a name="ln-519"></a>      <span class="c">! Report element flows and zone pressures.</span>
<a name="ln-520"></a>      <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-521"></a>        <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-522"></a>      <span class="k">END DO</span>
<a name="ln-523"></a><span class="k">      IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span>
<a name="ln-524"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-525"></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-526"></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-527"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-528"></a><span class="k">          WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39;Flow: &#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DP</span><span class="p">,</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-529"></a>        <span class="k">END IF</span>
<a name="ln-530"></a><span class="k">        </span><span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-531"></a>        <span class="n">SUMAF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMAF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-532"></a>      <span class="k">END DO</span>
<a name="ln-533"></a><span class="k">      DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-534"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">903</span><span class="p">)</span> <span class="s1">&#39;Room: &#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-535"></a>      <span class="k">END DO</span>
<a name="ln-536"></a>
<a name="ln-537"></a><span class="k">   DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-538"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-539"></a><span class="k">         Continue</span>
<a name="ln-540"></a><span class="k">      end if</span>
<a name="ln-541"></a><span class="k">      if</span> <span class="p">(</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-542"></a><span class="k">         </span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW</span> <span class="o">=</span> <span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-543"></a>         <span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW2</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-544"></a>      <span class="k">else</span>
<a name="ln-545"></a><span class="k">         </span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-546"></a>         <span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW2</span> <span class="o">=</span> <span class="o">-</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-547"></a>      <span class="k">end if</span>
<a name="ln-548"></a><span class="k">      If</span> <span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">CompTypeNum</span> <span class="o">==</span> <span class="n">CompTypeNum_HOP</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-549"></a><span class="k">         if</span> <span class="p">(</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-550"></a><span class="k">            </span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW</span> <span class="o">=</span> <span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-551"></a>            <span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW2</span> <span class="o">=</span> <span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-552"></a>         <span class="k">end if</span>
<a name="ln-553"></a><span class="k">      end if</span>
<a name="ln-554"></a><span class="k">      if</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DetOpenNum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-555"></a><span class="k">         if</span> <span class="p">(</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-556"></a><span class="k">            </span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW</span> <span class="o">=</span> <span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-557"></a>            <span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW2</span> <span class="o">=</span> <span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-558"></a>         <span class="k">end if</span>
<a name="ln-559"></a><span class="k">      end if</span>
<a name="ln-560"></a><span class="k">      If</span> <span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">CompTypeNum</span> <span class="o">==</span> <span class="n">CompTypeNum_SOP</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-561"></a>          <span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-562"></a><span class="k">        if</span> <span class="p">(</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-563"></a><span class="k">         </span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW</span> <span class="o">=</span> <span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-564"></a>         <span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-565"></a>        <span class="k">else</span>
<a name="ln-566"></a><span class="k">         </span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-567"></a>         <span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FLOW2</span> <span class="o">=</span> <span class="o">-</span><span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-568"></a>        <span class="k">End If</span>
<a name="ln-569"></a><span class="k">      end if</span>
<a name="ln-570"></a><span class="k">   END DO</span>
<a name="ln-571"></a>
<a name="ln-572"></a><span class="k">   DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-573"></a>      <span class="n">AirflowNetworkNodeSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">PZ</span> <span class="o">=</span> <span class="n">PZ</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-574"></a>   <span class="k">END DO</span>
<a name="ln-575"></a>
<a name="ln-576"></a><span class="k">  </span><span class="mi">900</span> <span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="mi">11</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;i    n    m       DP&#39;</span><span class="p">,</span><span class="mi">12</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">,</span><span class="mi">12</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;F2&#39;</span><span class="p">)</span>
<a name="ln-577"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">A6</span><span class="p">,</span><span class="mi">3</span><span class="n">I5</span><span class="p">,</span><span class="mi">3</span><span class="n">F14</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-578"></a>  <span class="mi">902</span> <span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="mi">11</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;n       P&#39;</span><span class="p">,</span><span class="mi">12</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;sumF&#39;</span><span class="p">)</span>
<a name="ln-579"></a>  <span class="mi">903</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">A6</span><span class="p">,</span><span class="n">I5</span><span class="p">,</span><span class="mi">3</span><span class="n">F14</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-580"></a>  <span class="mi">907</span> <span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="s1">&#39; CPU seconds for &#39;</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">F12</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-581"></a>
<a name="ln-582"></a>      <span class="k">RETURN</span>
<a name="ln-583"></a><span class="k">      END SUBROUTINE </span><span class="n">AIRMOV</span>
<a name="ln-584"></a>
<a name="ln-585"></a>
<a name="ln-586"></a>      <span class="k">SUBROUTINE </span><span class="n">SOLVZP</span><span class="p">(</span><span class="n">IK</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">ITER</span><span class="p">)</span>
<a name="ln-587"></a>
<a name="ln-588"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-589"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-590"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-591"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-592"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-593"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-594"></a>          <span class="c">!</span>
<a name="ln-595"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-596"></a>
<a name="ln-597"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-598"></a>          <span class="c">! This subroutine solves zone pressures by modified Newton-Raphson iteration</span>
<a name="ln-599"></a>
<a name="ln-600"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-601"></a>          <span class="c">! na</span>
<a name="ln-602"></a>
<a name="ln-603"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-604"></a>          <span class="c">! na</span>
<a name="ln-605"></a>
<a name="ln-606"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-607"></a>          <span class="k">USE </span><span class="n">General</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">RoundSigDigits</span>
<a name="ln-608"></a>
<a name="ln-609"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-610"></a>
<a name="ln-611"></a>
<a name="ln-612"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-613"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">! pointer to the top of column/row &quot;K&quot;</span>
<a name="ln-614"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">ITER</span>  <span class="c">! number of iterations</span>
<a name="ln-615"></a>          <span class="c">!noel GNU says AU is being indexed beyound bounds</span>
<a name="ln-616"></a>          <span class="c">!REAL(r64), INTENT(INOUT) :: AU(IK(NetworkNumOfNodes+1)-1) ! the upper triangle of [A] before and after factoring</span>
<a name="ln-617"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AU</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c">! the upper triangle of [A] before and after factoring</span>
<a name="ln-618"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AD</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">)</span>  <span class="c">! the main diagonal of [A] before and after factoring</span>
<a name="ln-619"></a>
<a name="ln-620"></a>
<a name="ln-621"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-622"></a>          <span class="c">! na</span>
<a name="ln-623"></a>
<a name="ln-624"></a>
<a name="ln-625"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-626"></a>          <span class="c">! na</span>
<a name="ln-627"></a>
<a name="ln-628"></a>
<a name="ln-629"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-630"></a>          <span class="c">! na</span>
<a name="ln-631"></a>
<a name="ln-632"></a>
<a name="ln-633"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-634"></a>
<a name="ln-635"></a>          <span class="c">!     NNZE   - number of nonzero entries in the &quot;AU&quot; array.</span>
<a name="ln-636"></a>          <span class="c">!     LFLAG   - if = 1, use laminar relationship (initialization).</span>
<a name="ln-637"></a>          <span class="c">!     I       - element number.</span>
<a name="ln-638"></a>          <span class="c">!     N       - number of node/zone 1.</span>
<a name="ln-639"></a>          <span class="c">!     M       - number of node/zone 2.</span>
<a name="ln-640"></a>          <span class="c">!     F       - flows through the element (kg/s).</span>
<a name="ln-641"></a>          <span class="c">!     DF      - partial derivatives:  DF/DP.</span>
<a name="ln-642"></a>          <span class="c">!     NF      - number of flows, 1 or 2.</span>
<a name="ln-643"></a>          <span class="c">!     SUMF    - sum of flows into node/zone.</span>
<a name="ln-644"></a>          <span class="c">!     CCF     - current pressure correction (Pa).</span>
<a name="ln-645"></a>          <span class="c">!     PCF     - previous pressure correction (Pa).</span>
<a name="ln-646"></a>          <span class="c">!     CEF     - convergence enhancement factor.</span>
<a name="ln-647"></a><span class="c">!</span>
<a name="ln-648"></a>          <span class="kt">INTEGER  </span><span class="n">N</span><span class="p">,</span> <span class="n">NNZE</span><span class="p">,</span> <span class="n">NSYM</span><span class="p">,</span> <span class="n">LFLAG</span><span class="p">,</span> <span class="n">CONVG</span><span class="p">,</span> <span class="n">ACCEL</span>
<a name="ln-649"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">PCF</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">),</span> <span class="n">CEF</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">)</span>
<a name="ln-650"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">C</span><span class="p">,</span> <span class="n">SSUMF</span><span class="p">,</span> <span class="n">SSUMAF</span><span class="p">,</span> <span class="n">ACC0</span><span class="p">,</span> <span class="n">ACC1</span>
<a name="ln-651"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">CCF</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">)</span>
<a name="ln-652"></a>
<a name="ln-653"></a>      <span class="c">! FLOW:</span>
<a name="ln-654"></a>      <span class="n">ACC1</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-655"></a>      <span class="n">ACCEL</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-656"></a>      <span class="n">NSYM</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-657"></a>      <span class="n">NNZE</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-658"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Initialization&#39;</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span><span class="p">,</span><span class="n">NNZE</span>
<a name="ln-659"></a>      <span class="n">ITER</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-660"></a>
<a name="ln-661"></a>      <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-662"></a>        <span class="n">PCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-663"></a>        <span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-664"></a>      <span class="k">END DO</span>
<a name="ln-665"></a>
<a name="ln-666"></a><span class="k">      IF</span><span class="p">(</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">InitFlag</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-667"></a>        <span class="c">! Initialize node/zone pressure values by assuming only linear relationship between</span>
<a name="ln-668"></a>        <span class="c">! airflows and pressure drops.</span>
<a name="ln-669"></a>        <span class="n">LFLAG</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-670"></a>        <span class="k">CALL </span><span class="n">FILJAC</span><span class="p">(</span><span class="n">NNZE</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">)</span>
<a name="ln-671"></a>        <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-672"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-673"></a>        <span class="k">END DO</span>
<a name="ln-674"></a>        <span class="c">! Data dump.</span>
<a name="ln-675"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-676"></a><span class="k">          CALL </span><span class="n">DUMPVD</span><span class="p">(</span><span class="s1">&#39;AD:&#39;</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-677"></a>          <span class="k">CALL </span><span class="n">DUMPVD</span><span class="p">(</span><span class="s1">&#39;AU:&#39;</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">NNZE</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-678"></a>          <span class="k">CALL </span><span class="n">DUMPVR</span><span class="p">(</span><span class="s1">&#39;AF:&#39;</span><span class="p">,</span><span class="n">SUMF</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-679"></a>        <span class="k">END IF</span>
<a name="ln-680"></a>        <span class="c">! Solve linear system for approximate PZ.</span>
<a name="ln-681"></a><span class="cp">#ifdef SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-682"></a>        <span class="k">CALL </span><span class="n">FACSKY</span><span class="p">(</span><span class="n">newAU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">newAU</span><span class="p">,</span><span class="n">newIK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span> <span class="c">!noel</span>
<a name="ln-683"></a>        <span class="k">CALL </span><span class="n">SLVSKY</span><span class="p">(</span><span class="n">newAU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">newAU</span><span class="p">,</span><span class="n">PZ</span><span class="p">,</span><span class="n">newIK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span> <span class="c">!noel</span>
<a name="ln-684"></a><span class="cp">#else</span>
<a name="ln-685"></a>        <span class="k">CALL </span><span class="n">FACSKY</span><span class="p">(</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span>
<a name="ln-686"></a>        <span class="k">CALL </span><span class="n">SLVSKY</span><span class="p">(</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">PZ</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span>
<a name="ln-687"></a><span class="cp">#endif</span>
<a name="ln-688"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">CALL </span><span class="n">DUMPVD</span><span class="p">(</span><span class="s1">&#39;PZ:&#39;</span><span class="p">,</span><span class="n">PZ</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-689"></a>      <span class="k">END IF</span>
<a name="ln-690"></a>      <span class="c">! Solve nonlinear airflow network equations by modified Newton&#39;s method.</span>
<a name="ln-691"></a>
<a name="ln-692"></a>      <span class="k">DO WHILE</span> <span class="p">(</span><span class="n">ITER</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">MaxIteration</span><span class="p">)</span>
<a name="ln-693"></a>        <span class="n">LFLAG</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-694"></a>        <span class="n">ITER</span> <span class="o">=</span> <span class="n">ITER</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-695"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Begin iteration &#39;</span><span class="p">,</span><span class="n">ITER</span>
<a name="ln-696"></a>        <span class="c">! Set up the Jacobian matrix.</span>
<a name="ln-697"></a>        <span class="k">CALL </span><span class="n">FILJAC</span><span class="p">(</span><span class="n">NNZE</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">)</span>
<a name="ln-698"></a>        <span class="c">! Data dump.</span>
<a name="ln-699"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-700"></a><span class="k">          CALL </span><span class="n">DUMPVR</span><span class="p">(</span><span class="s1">&#39;SUMF:&#39;</span><span class="p">,</span><span class="n">SUMF</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-701"></a>          <span class="k">CALL </span><span class="n">DUMPVR</span><span class="p">(</span><span class="s1">&#39;SUMAF:&#39;</span><span class="p">,</span><span class="n">SUMAF</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-702"></a>        <span class="k">END IF</span>
<a name="ln-703"></a>        <span class="c">! Check convergence.</span>
<a name="ln-704"></a>        <span class="n">CONVG</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-705"></a>        <span class="n">SSUMF</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-706"></a>        <span class="n">SSUMAF</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-707"></a>        <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-708"></a>          <span class="n">SSUMF</span> <span class="o">=</span> <span class="n">SSUMF</span> <span class="o">+</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-709"></a>          <span class="n">SSUMAF</span> <span class="o">=</span> <span class="n">SSUMAF</span> <span class="o">+</span> <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-710"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">CONVG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-711"></a><span class="k">            IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">AbsTol</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-712"></a><span class="k">            IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)).</span><span class="n">GT</span><span class="p">.</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">RelTol</span><span class="p">)</span> <span class="n">CONVG</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-713"></a>          <span class="k">END IF</span>
<a name="ln-714"></a><span class="k">        END DO</span>
<a name="ln-715"></a><span class="k">        </span><span class="n">ACC0</span> <span class="o">=</span> <span class="n">ACC1</span>
<a name="ln-716"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">SSUMAF</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="n">ACC1</span> <span class="o">=</span> <span class="n">SSUMF</span> <span class="o">/</span> <span class="n">SSUMAF</span>
<a name="ln-717"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">CONVG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">ITER</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">RETURN</span>
<a name="ln-718"></a><span class="k">        IF</span><span class="p">(</span><span class="n">ITER</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">MaxIteration</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-719"></a>        <span class="c">! Data dump.</span>
<a name="ln-720"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-721"></a><span class="k">          CALL </span><span class="n">DUMPVD</span><span class="p">(</span><span class="s1">&#39;AD:&#39;</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-722"></a>          <span class="k">CALL </span><span class="n">DUMPVD</span><span class="p">(</span><span class="s1">&#39;AU:&#39;</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">NNZE</span><span class="p">,</span><span class="n">Unit21</span><span class="p">)</span>
<a name="ln-723"></a>        <span class="k">END IF</span>
<a name="ln-724"></a>        <span class="c">! Solve AA * CCF = SUMF.</span>
<a name="ln-725"></a>        <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-726"></a>          <span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-727"></a>        <span class="k">END DO</span>
<a name="ln-728"></a><span class="cp">#ifdef SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-729"></a>        <span class="k">CALL </span><span class="n">FACSKY</span><span class="p">(</span><span class="n">newAU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">newAU</span><span class="p">,</span><span class="n">newIK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span> <span class="c">!noel</span>
<a name="ln-730"></a>        <span class="k">CALL </span><span class="n">SLVSKY</span><span class="p">(</span><span class="n">newAU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">newAU</span><span class="p">,</span><span class="n">CCF</span><span class="p">,</span><span class="n">newIK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span> <span class="c">!noel</span>
<a name="ln-731"></a><span class="cp">#else</span>
<a name="ln-732"></a>        <span class="k">CALL </span><span class="n">FACSKY</span><span class="p">(</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span>
<a name="ln-733"></a>        <span class="k">CALL </span><span class="n">SLVSKY</span><span class="p">(</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">CCF</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span>
<a name="ln-734"></a><span class="cp">#endif</span>
<a name="ln-735"></a>        <span class="c">! Revise PZ (Steffensen iteration on the N-R correction factors to handle oscillating corrections).</span>
<a name="ln-736"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">ACCEL</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-737"></a><span class="k">          </span><span class="n">ACCEL</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-738"></a>        <span class="k">ELSE</span>
<a name="ln-739"></a><span class="k">          IF</span><span class="p">(</span><span class="n">ITER</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">2</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="n">ACC1</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">ACC0</span><span class="p">)</span> <span class="n">ACCEL</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-740"></a>        <span class="k">END IF</span>
<a name="ln-741"></a><span class="k">        DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-742"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-743"></a><span class="k">          </span><span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-744"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">ACCEL</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-745"></a><span class="k">            </span><span class="n">C</span> <span class="o">=</span> <span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">PCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-746"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">ConvLimit</span><span class="p">)</span> <span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">C</span><span class="p">)</span>
<a name="ln-747"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-748"></a>          <span class="k">ELSE</span>
<a name="ln-749"></a><span class="c">!            IF (CCF(N) .EQ. 0.0) CCF(N)=TINY(CCF(N))  ! 1.0E-40</span>
<a name="ln-750"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">=</span><span class="n">rTinyValue</span>     <span class="c">! 1.0E-40 (Epsilon)</span>
<a name="ln-751"></a>            <span class="n">PCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-752"></a>            <span class="n">C</span> <span class="o">=</span> <span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-753"></a>          <span class="k">END IF</span>
<a name="ln-754"></a><span class="k">          IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">C</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">MaxPressure</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-755"></a><span class="k">            </span><span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">MaxPressure</span><span class="o">/</span><span class="nb">ABS</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<a name="ln-756"></a>            <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-757"></a>          <span class="k">ELSE</span>
<a name="ln-758"></a><span class="k">            </span><span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">C</span>
<a name="ln-759"></a>          <span class="k">END IF</span>
<a name="ln-760"></a><span class="k">        END DO</span>
<a name="ln-761"></a>        <span class="c">! Data revision dump.</span>
<a name="ln-762"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-763"></a><span class="k">          DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-764"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-765"></a>            <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; Rev:&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">CCF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">CEF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-766"></a>          <span class="k">END DO</span>
<a name="ln-767"></a><span class="k">        </span><span class="n">ENDIF</span>
<a name="ln-768"></a>      <span class="k">END DO</span>
<a name="ln-769"></a>
<a name="ln-770"></a>      <span class="c">! Error termination.</span>
<a name="ln-771"></a>      <span class="k">CALL </span><span class="n">ShowSevereError</span><span class="p">(</span><span class="s1">&#39;Too many iterations (SOLVZP) in Airflow Network simulation&#39;</span><span class="p">)</span>
<a name="ln-772"></a>      <span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">ExtLargeOpeningErrCount</span> <span class="o">=</span> <span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">ExtLargeOpeningErrCount</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-773"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">ExtLargeOpeningErrCount</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-774"></a><span class="k">        CALL </span><span class="n">ShowWarningError</span><span class="p">(</span><span class="s1">&#39;AirflowNetwork: SOLVER, Changing values for initialization flag, Relative airflow convergence, &#39;</span> <span class="p">&amp;</span>
<a name="ln-775"></a>         <span class="o">//</span><span class="s1">&#39;Absolute airflow convergence, Convergence acceleration limit or Maximum Iteration Number may solve the problem.&#39;</span><span class="p">)</span>
<a name="ln-776"></a>        <span class="k">CALL </span><span class="n">ShowContinueErrorTimeStamp</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-777"></a>        <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;..Iterations=&#39;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">RoundSigDigits</span><span class="p">(</span><span class="n">ITER</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;, Max allowed=&#39;</span><span class="o">//</span>  <span class="p">&amp;</span>
<a name="ln-778"></a>               <span class="nb">TRIM</span><span class="p">(</span><span class="n">RoundSigDigits</span><span class="p">(</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">MaxIteration</span><span class="p">)))</span>
<a name="ln-779"></a>        <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;AirflowNetwork: SOLVER, The previous error causes termination.&#39;</span><span class="p">)</span>
<a name="ln-780"></a>      <span class="k">else</span>
<a name="ln-781"></a><span class="k">        CALL </span><span class="n">ShowRecurringWarningErrorAtEnd</span><span class="p">(</span><span class="s1">&#39;AirFlowNetwork: Too many iterations (SOLVZP) in AirflowNetwork &#39;</span> <span class="p">&amp;</span>
<a name="ln-782"></a>                                            <span class="o">//</span><span class="s1">&#39; simulation continues.&#39;</span><span class="p">,</span><span class="n">AirflowNetworkSimu</span><span class="p">%</span><span class="n">ExtLargeOpeningErrIndex</span><span class="p">)</span>
<a name="ln-783"></a>      <span class="k">end if</span>
<a name="ln-784"></a>
<a name="ln-785"></a><span class="k">  </span><span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="err">2</span><span class="n">E14</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="n">PF8</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span><span class="n">F24</span><span class="p">.</span><span class="mi">14</span><span class="p">)</span>
<a name="ln-786"></a>      <span class="k">RETURN</span>
<a name="ln-787"></a><span class="k">      END SUBROUTINE </span><span class="n">SOLVZP</span>
<a name="ln-788"></a>
<a name="ln-789"></a>
<a name="ln-790"></a>      <span class="k">SUBROUTINE </span><span class="n">FILJAC</span><span class="p">(</span><span class="n">NNZE</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">)</span>
<a name="ln-791"></a>
<a name="ln-792"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-793"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-794"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-795"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-796"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-797"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-798"></a>          <span class="c">!</span>
<a name="ln-799"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-800"></a>
<a name="ln-801"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-802"></a>          <span class="c">! This subroutine creates matrices for solution of flows</span>
<a name="ln-803"></a>
<a name="ln-804"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-805"></a>          <span class="c">! na</span>
<a name="ln-806"></a>
<a name="ln-807"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-808"></a>          <span class="c">! na</span>
<a name="ln-809"></a>
<a name="ln-810"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-811"></a>          <span class="c">! na</span>
<a name="ln-812"></a>
<a name="ln-813"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-814"></a>
<a name="ln-815"></a>
<a name="ln-816"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-817"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">NNZE</span>   <span class="c">! number of nonzero entries in the &quot;AU&quot; array.</span>
<a name="ln-818"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span>  <span class="c">! if = 1, use laminar relationship (initialization).</span>
<a name="ln-819"></a>
<a name="ln-820"></a>
<a name="ln-821"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-822"></a>          <span class="c">! na</span>
<a name="ln-823"></a>
<a name="ln-824"></a>
<a name="ln-825"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-826"></a>          <span class="c">! na</span>
<a name="ln-827"></a>
<a name="ln-828"></a>
<a name="ln-829"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-830"></a>          <span class="c">! na</span>
<a name="ln-831"></a>
<a name="ln-832"></a>
<a name="ln-833"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-834"></a>
<a name="ln-835"></a>          <span class="c">! I       - component number.</span>
<a name="ln-836"></a>          <span class="c">! N       - number of node/zone 1.</span>
<a name="ln-837"></a>          <span class="c">! M       - number of node/zone 2.</span>
<a name="ln-838"></a>          <span class="c">! F       - flows through the element (kg/s).</span>
<a name="ln-839"></a>          <span class="c">! DF      - partial derivatives:  DF/DP.</span>
<a name="ln-840"></a>          <span class="c">! NF      - number of flows, 1 or 2.</span>
<a name="ln-841"></a><span class="c">!</span>
<a name="ln-842"></a>       <span class="kt">INTEGER  </span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">FLAG</span><span class="p">,</span> <span class="n">NF</span>
<a name="ln-843"></a><span class="cp">#ifdef SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-844"></a>       <span class="kt">INTEGER </span><span class="n">LHK</span><span class="p">,</span><span class="n">JHK</span><span class="p">,</span><span class="n">JHK1</span><span class="p">,</span> <span class="n">newsum</span><span class="p">,</span><span class="n">newh</span><span class="p">,</span><span class="n">Nzeros</span><span class="p">,</span> <span class="n">ispan</span><span class="p">,</span> <span class="n">thisIK</span> <span class="c">!noel</span>
<a name="ln-845"></a>       <span class="kt">LOGICAL </span><span class="n">allZero</span> <span class="c">! noel</span>
<a name="ln-846"></a>       <span class="kt">LOGICAL</span><span class="p">,</span> <span class="k">save</span> <span class="kd">::</span> <span class="n">firsttime</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="c">! noel</span>
<a name="ln-847"></a><span class="cp">#endif</span>
<a name="ln-848"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-849"></a>       <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">DP</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-850"></a>
<a name="ln-851"></a>      <span class="c">! FLOW:</span>
<a name="ln-852"></a>      <span class="k">DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-853"></a>        <span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-854"></a>        <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-855"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-856"></a><span class="k">          </span><span class="n">AD</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-857"></a>        <span class="k">ELSE</span>
<a name="ln-858"></a><span class="k">          </span><span class="n">AD</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-859"></a>        <span class="k">END IF</span>
<a name="ln-860"></a><span class="k">      END DO</span>
<a name="ln-861"></a><span class="k">      DO </span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NNZE</span>
<a name="ln-862"></a>        <span class="n">AU</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-863"></a>      <span class="k">END DO</span>
<a name="ln-864"></a><span class="c">!                              Set up the Jacobian matrix.</span>
<a name="ln-865"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-866"></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-867"></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-868"></a>        <span class="c">!!!! Check array of DP. DpL is used for multizone air flow calculation only</span>
<a name="ln-869"></a>        <span class="c">!!!! and is not for forced air calculation</span>
<a name="ln-870"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">I</span> <span class="p">.</span><span class="n">GT</span><span class="p">.</span> <span class="n">NumOfLinksMultiZone</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-871"></a><span class="k">          </span><span class="n">DP</span> <span class="o">=</span> <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">PZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">PS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">PW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-872"></a>        <span class="k">else</span>
<a name="ln-873"></a><span class="k">          </span><span class="n">DP</span> <span class="o">=</span> <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">PZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">DpL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">PW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-874"></a>        <span class="k">end if</span>
<a name="ln-875"></a><span class="k">        IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39;PS:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">PS</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">PW</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DP</span>
<a name="ln-876"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">CompNum</span>
<a name="ln-877"></a>        <span class="k">Select Case</span> <span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">CompTypeNum</span><span class="p">)</span>
<a name="ln-878"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_PLR</span><span class="p">)</span> <span class="c">! Distribution system crack component</span>
<a name="ln-879"></a>              <span class="k">CALL </span><span class="n">AFEPLR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-880"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_DWC</span><span class="p">)</span> <span class="c">! Distribution system duct component</span>
<a name="ln-881"></a>              <span class="k">CALL </span><span class="n">AFEDWC</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-882"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_CVF</span><span class="p">)</span> <span class="c">! Distribution system constant volume fan component</span>
<a name="ln-883"></a>              <span class="k">CALL </span><span class="n">AFECFR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-884"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_FAN</span><span class="p">)</span> <span class="c">! Distribution system detailed fan component</span>
<a name="ln-885"></a>              <span class="k">CALL </span><span class="n">AFEFAN</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-886"></a><span class="c">!           Case (CompTypeNum_CPF) ! not currently used in EnergyPlus code -- left for compatibility with AirNet</span>
<a name="ln-887"></a><span class="c">!              CALL AFECPF(J,LFLAG,DP,I,N,M,F,DF,NF)</span>
<a name="ln-888"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_DMP</span><span class="p">)</span> <span class="c">! Distribution system damper component</span>
<a name="ln-889"></a>              <span class="k">CALL </span><span class="n">AFEDMP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-890"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_ELR</span><span class="p">)</span> <span class="c">! Distribution system effective leakage ratio component</span>
<a name="ln-891"></a>              <span class="k">CALL </span><span class="n">AFEELR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-892"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_CPD</span><span class="p">)</span> <span class="c">! Distribution system constant pressure drop component</span>
<a name="ln-893"></a>              <span class="k">CALL </span><span class="n">AFECPD</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-894"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_DOP</span><span class="p">)</span> <span class="c">! Detailed opening</span>
<a name="ln-895"></a>              <span class="k">CALL </span><span class="n">AFEDOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-896"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_SOP</span><span class="p">)</span> <span class="c">! Simple opening</span>
<a name="ln-897"></a>              <span class="k">CALL </span><span class="n">AFESOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-898"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_SCR</span><span class="p">)</span> <span class="c">! Surface crack component</span>
<a name="ln-899"></a>              <span class="k">CALL </span><span class="n">AFESCR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-900"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_SEL</span><span class="p">)</span> <span class="c">! Surface effective leakage ratio component</span>
<a name="ln-901"></a>              <span class="k">CALL </span><span class="n">AFESEL</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-902"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_COI</span><span class="p">)</span> <span class="c">! Distribution system coil component</span>
<a name="ln-903"></a>              <span class="k">CALL </span><span class="n">AFECOI</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-904"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_TMU</span><span class="p">)</span> <span class="c">! Distribution system terminal unit component</span>
<a name="ln-905"></a>              <span class="k">CALL </span><span class="n">AFETMU</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-906"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_EXF</span><span class="p">)</span> <span class="c">! Exhaust fan component</span>
<a name="ln-907"></a>              <span class="k">CALL </span><span class="n">AFEEXF</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-908"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_HEX</span><span class="p">)</span> <span class="c">! Distribution system heat exchanger component</span>
<a name="ln-909"></a>              <span class="k">CALL </span><span class="n">AFEHEX</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-910"></a>           <span class="k">Case</span> <span class="p">(</span><span class="n">CompTypeNum_HOP</span><span class="p">)</span> <span class="c">! Horizontal opening</span>
<a name="ln-911"></a>              <span class="k">CALL </span><span class="n">AFEHOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-912"></a>           <span class="k">Case </span><span class="n">Default</span>
<a name="ln-913"></a>              <span class="k">CYCLE</span>
<a name="ln-914"></a><span class="k">        End Select</span>
<a name="ln-915"></a><span class="k">        </span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DP</span> <span class="o">=</span> <span class="n">DP</span>
<a name="ln-916"></a>        <span class="n">AFLOW</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-917"></a>        <span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-918"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">CompTypeNum</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="n">CompTypeNum_DOP</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-919"></a><span class="k">           </span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-920"></a>        <span class="k">end if</span>
<a name="ln-921"></a><span class="k">        if</span> <span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">CompTypeNum</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="n">CompTypeNum_HOP</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-922"></a><span class="k">           </span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-923"></a>        <span class="k">end if</span>
<a name="ln-924"></a><span class="k">        IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; NRi:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DP</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-925"></a>        <span class="n">FLAG</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-926"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-927"></a><span class="k">          </span><span class="n">FLAG</span> <span class="o">=</span> <span class="n">FLAG</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-928"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-929"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-930"></a>          <span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-931"></a>          <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-932"></a>        <span class="k">END IF</span>
<a name="ln-933"></a><span class="k">        IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">M</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-934"></a><span class="k">          </span><span class="n">FLAG</span> <span class="o">=</span> <span class="n">FLAG</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-935"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span>  <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-936"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-937"></a>          <span class="n">SUMF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-938"></a>          <span class="n">SUMAF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMAF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-939"></a>        <span class="k">END IF</span>
<a name="ln-940"></a><span class="k">        IF</span><span class="p">(</span><span class="n">FLAG</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">CALL </span><span class="n">FILSKY</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">FLAG</span><span class="p">)</span>
<a name="ln-941"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">NF</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-942"></a><span class="k">        </span><span class="n">AFLOW2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-943"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; NRj:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">AirflowNetworkLinkSimu</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DP</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-944"></a>        <span class="n">FLAG</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-945"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">N</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-946"></a><span class="k">          </span><span class="n">FLAG</span> <span class="o">=</span> <span class="n">FLAG</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-947"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-948"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-949"></a>          <span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-950"></a>          <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMAF</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-951"></a>        <span class="k">END IF</span>
<a name="ln-952"></a><span class="k">        IF</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">M</span><span class="p">)%</span><span class="n">NodeTypeNum</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-953"></a><span class="k">          </span><span class="n">FLAG</span> <span class="o">=</span> <span class="n">FLAG</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-954"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span>  <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-955"></a>          <span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-956"></a>          <span class="n">SUMF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-957"></a>          <span class="n">SUMAF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">=</span> <span class="n">SUMAF</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-958"></a>        <span class="k">END IF</span>
<a name="ln-959"></a><span class="k">        IF</span><span class="p">(</span><span class="n">FLAG</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">CALL </span><span class="n">FILSKY</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">FLAG</span><span class="p">)</span>
<a name="ln-960"></a>      <span class="k">END DO</span>
<a name="ln-961"></a><span class="k">  </span><span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="mi">3</span><span class="n">I3</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-962"></a>
<a name="ln-963"></a><span class="cp">#ifdef SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS</span>
<a name="ln-964"></a>
<a name="ln-965"></a>     <span class="c">! After the matrix values have been set, we can look at them and see if any columns are filled with zeros.</span>
<a name="ln-966"></a>     <span class="c">! If they are, let&#39;s remove them from the matrix -- but only for the purposes of doing the solve.</span>
<a name="ln-967"></a>     <span class="c">! They way I do this is building a separate IK array (newIK) that simply changes the column heights.</span>
<a name="ln-968"></a>     <span class="c">! So the affected SOLVEs would use this newIK and nothing else changes.</span>
<a name="ln-969"></a>     <span class="k">DO </span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-970"></a>        <span class="n">newIK</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="n">IK</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-971"></a>        <span class="c">!print*, &quot; NetworkNumOfNodes  n=&quot;, n, &quot; IK(n)=&quot;, IK(n)</span>
<a name="ln-972"></a>     <span class="n">enddo</span>
<a name="ln-973"></a>
<a name="ln-974"></a>     <span class="n">newsum</span><span class="o">=</span><span class="n">IK</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">IK</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">! always 0?</span>
<a name="ln-975"></a>
<a name="ln-976"></a>     <span class="n">JHK</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-977"></a>     <span class="k">DO </span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-978"></a>        <span class="n">JHK1</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c">! starts at IK(3)-IK(2)</span>
<a name="ln-979"></a>        <span class="n">LHK</span> <span class="o">=</span> <span class="n">JHK1</span><span class="o">-</span><span class="n">JHK</span>
<a name="ln-980"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LHK</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-981"></a><span class="k">          </span><span class="n">newIK</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">newIK</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-982"></a>          <span class="k">CYCLE</span>
<a name="ln-983"></a><span class="k">        </span><span class="n">endif</span>
<a name="ln-984"></a>        <span class="c">!write(*,&#39;(4(a,i8))&#39;) &quot;n=&quot;, n, &quot; ik=&quot;, ik(n), &quot; JHK=&quot;, JHK, &quot; LHK=&quot;, LHK</span>
<a name="ln-985"></a>
<a name="ln-986"></a>        <span class="c">! is the entire column zero?  noel</span>
<a name="ln-987"></a>        <span class="n">allZero</span><span class="o">=</span><span class="p">.</span><span class="n">True</span><span class="p">.</span>
<a name="ln-988"></a>        <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">LHK</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-989"></a>           <span class="k">if</span> <span class="p">(</span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-990"></a><span class="k">              </span><span class="n">allZero</span><span class="o">=</span><span class="p">.</span><span class="n">False</span><span class="p">.</span>
<a name="ln-991"></a>              <span class="k">exit</span>
<a name="ln-992"></a><span class="k">           </span><span class="n">endif</span>
<a name="ln-993"></a>        <span class="n">enddo</span>
<a name="ln-994"></a>
<a name="ln-995"></a>        <span class="n">newh</span><span class="o">=</span><span class="n">LHK</span>
<a name="ln-996"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">allZero</span> <span class="p">.</span><span class="n">eqv</span><span class="p">.</span> <span class="p">.</span><span class="n">True</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-997"></a>           <span class="c">!print*, &quot;allzero n=&quot;, n</span>
<a name="ln-998"></a>           <span class="n">newh</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-999"></a>        <span class="k">else</span>
<a name="ln-1000"></a>           <span class="c">!DO i=0,LHK-1</span>
<a name="ln-1001"></a>           <span class="c">!   write(*, &#39;(2(a,i8),a, f15.3)&#39;) &quot;  n=&quot;, n, &quot; i=&quot;, i, &quot; AU(JHK+i)=&quot;, AU(JHK+i)</span>
<a name="ln-1002"></a>           <span class="c">!enddo</span>
<a name="ln-1003"></a>        <span class="n">endif</span>
<a name="ln-1004"></a>        <span class="n">newIK</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">newIK</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">newh</span>
<a name="ln-1005"></a>        <span class="n">newsum</span> <span class="o">=</span> <span class="n">newsum</span> <span class="o">+</span> <span class="n">newh</span>
<a name="ln-1006"></a>
<a name="ln-1007"></a>        <span class="c">!do i = LHK-1,0, -1</span>
<a name="ln-1008"></a>        <span class="c">!   write(*, &#39;(2(a,i8),a, f15.3)&#39;) &quot;  n=&quot;, n, &quot; i=&quot;, i, &quot; AU(JHK+i)=&quot;, AU(JHK+i)</span>
<a name="ln-1009"></a>        <span class="c">!enddo</span>
<a name="ln-1010"></a>        <span class="n">JHK</span> <span class="o">=</span> <span class="n">JHK1</span>
<a name="ln-1011"></a>     <span class="n">enddo</span>
<a name="ln-1012"></a>
<a name="ln-1013"></a>     <span class="c">! this is just a print to screen, is not necessary</span>
<a name="ln-1014"></a><span class="c">!     if (firsttime) then</span>
<a name="ln-1015"></a><span class="c">!        write(*, &#39;(2(a,i8))&#39;) &quot; After SKYLINE_MATRIX_REMOVE_ZERO_COLUMNS: newsum=&quot;, newsum, &quot; oldsum=&quot;, IK(NetworkNumOfNodes+1)</span>
<a name="ln-1016"></a><span class="c">!        firsttime=.false.</span>
<a name="ln-1017"></a><span class="c">!     endif</span>
<a name="ln-1018"></a>
<a name="ln-1019"></a>
<a name="ln-1020"></a>     <span class="c">! Now fill newAU from AU, using newIK</span>
<a name="ln-1021"></a>     <span class="n">thisIK</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1022"></a>     <span class="k">DO </span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NetworkNumOfNodes</span>
<a name="ln-1023"></a>        <span class="n">thisIK</span> <span class="o">=</span> <span class="n">newIK</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-1024"></a>        <span class="n">ispan</span> <span class="o">=</span> <span class="n">newIK</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">thisIK</span>
<a name="ln-1025"></a>
<a name="ln-1026"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">ispan</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-1027"></a><span class="k">        DO </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ispan</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1028"></a>           <span class="n">newAU</span><span class="p">(</span><span class="n">thisIK</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">AU</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1029"></a>        <span class="n">enddo</span>
<a name="ln-1030"></a>
<a name="ln-1031"></a>     <span class="n">enddo</span>
<a name="ln-1032"></a><span class="cp">#endif</span>
<a name="ln-1033"></a>
<a name="ln-1034"></a>      <span class="k">RETURN</span>
<a name="ln-1035"></a><span class="k">      END SUBROUTINE </span><span class="n">FILJAC</span>
<a name="ln-1036"></a>
<a name="ln-1037"></a>
<a name="ln-1038"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEPLR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1039"></a><span class="c">!</span>
<a name="ln-1040"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1041"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1042"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1043"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1044"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1045"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1046"></a>          <span class="c">!</span>
<a name="ln-1047"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1048"></a>
<a name="ln-1049"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1050"></a>          <span class="c">! This subroutine solves airflow for a power law resistance airflow component</span>
<a name="ln-1051"></a>
<a name="ln-1052"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1053"></a>          <span class="c">! na</span>
<a name="ln-1054"></a>
<a name="ln-1055"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1056"></a>          <span class="c">! na</span>
<a name="ln-1057"></a>
<a name="ln-1058"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1059"></a>          <span class="c">! na</span>
<a name="ln-1060"></a>
<a name="ln-1061"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1062"></a>
<a name="ln-1063"></a>
<a name="ln-1064"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1065"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-1066"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1067"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1068"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1069"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1070"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1071"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1072"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1073"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1074"></a>
<a name="ln-1075"></a>
<a name="ln-1076"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1077"></a>          <span class="c">! na</span>
<a name="ln-1078"></a>
<a name="ln-1079"></a>
<a name="ln-1080"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-1081"></a>          <span class="c">! na</span>
<a name="ln-1082"></a>
<a name="ln-1083"></a>
<a name="ln-1084"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-1085"></a>          <span class="c">! na</span>
<a name="ln-1086"></a>
<a name="ln-1087"></a>
<a name="ln-1088"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1089"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span>
<a name="ln-1090"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">RhozNorm</span><span class="p">,</span> <span class="n">VisczNorm</span><span class="p">,</span> <span class="n">expn</span><span class="p">,</span> <span class="n">Ctl</span><span class="p">,</span> <span class="n">coef</span>
<a name="ln-1091"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-1092"></a>
<a name="ln-1093"></a>      <span class="c">! FLOW:</span>
<a name="ln-1094"></a>      <span class="c">! Crack standard condition: T=20C, p=101325 Pa and 0 g/kg</span>
<a name="ln-1095"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-1096"></a>      <span class="n">RhozNorm</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="mi">10132</span><span class="mf">5.0d0</span><span class="p">,</span><span class="mi">2</span><span class="mf">0.0d0</span><span class="p">,</span><span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-1097"></a>      <span class="n">VisczNorm</span> <span class="o">=</span> <span class="mf">1.71432d-5</span><span class="o">+</span><span class="mf">4.828d-8</span><span class="o">*</span><span class="mi">2</span><span class="mf">0.0d0</span>
<a name="ln-1098"></a>      <span class="n">expn</span> <span class="o">=</span> <span class="n">DisSysCompLeakData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-1099"></a>      <span class="n">coef</span> <span class="o">=</span> <span class="n">DisSysCompLeakData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span>
<a name="ln-1100"></a>
<a name="ln-1101"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1102"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">coef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1103"></a>      <span class="k">ELSE</span>
<a name="ln-1104"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-1105"></a>      <span class="k">END IF</span>
<a name="ln-1106"></a>
<a name="ln-1107"></a><span class="k">      </span><span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1108"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1109"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-1110"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1111"></a><span class="k">          </span><span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-1112"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1113"></a>        <span class="k">ELSE</span>
<a name="ln-1114"></a><span class="k">          </span><span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-1115"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1116"></a>        <span class="k">END IF</span>
<a name="ln-1117"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1118"></a>      <span class="k">ELSE</span>
<a name="ln-1119"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-1120"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1121"></a>          <span class="c">! Flow in positive direction for laminar flow.</span>
<a name="ln-1122"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-1123"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1124"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1125"></a>          <span class="c">! Flow in positive direction for turbulent flow.</span>
<a name="ln-1126"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1127"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span>
<a name="ln-1128"></a>          <span class="k">ELSE</span>
<a name="ln-1129"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">PDROP</span><span class="o">**</span><span class="n">expn</span><span class="p">)</span>
<a name="ln-1130"></a>          <span class="k">END IF</span>
<a name="ln-1131"></a><span class="k">        ELSE</span>
<a name="ln-1132"></a>          <span class="c">! Flow in negative direction for laminar flow</span>
<a name="ln-1133"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-1134"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1135"></a>          <span class="c">! Flow in negative direction for turbulent flow</span>
<a name="ln-1136"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1137"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span>
<a name="ln-1138"></a>          <span class="k">ELSE</span>
<a name="ln-1139"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">**</span><span class="n">expn</span>
<a name="ln-1140"></a>          <span class="k">END IF</span>
<a name="ln-1141"></a><span class="k">        END IF</span>
<a name="ln-1142"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-1143"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; plr: &#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">FT</span>
<a name="ln-1144"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-1145"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-1146"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-1147"></a>        <span class="k">ELSE</span>
<a name="ln-1148"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-1149"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-1150"></a>        <span class="k">END IF</span>
<a name="ln-1151"></a><span class="k">      END IF</span>
<a name="ln-1152"></a><span class="c">!</span>
<a name="ln-1153"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1154"></a>      <span class="k">RETURN</span>
<a name="ln-1155"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEPLR</span>
<a name="ln-1156"></a>
<a name="ln-1157"></a>      <span class="k">SUBROUTINE </span><span class="n">AFESCR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1158"></a><span class="c">!</span>
<a name="ln-1159"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1160"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1161"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1162"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1163"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1164"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1165"></a>          <span class="c">!</span>
<a name="ln-1166"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1167"></a>
<a name="ln-1168"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1169"></a>          <span class="c">! This subroutine solves airflow for a surface crack component</span>
<a name="ln-1170"></a>
<a name="ln-1171"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1172"></a>          <span class="c">! na</span>
<a name="ln-1173"></a>
<a name="ln-1174"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1175"></a>          <span class="c">! na</span>
<a name="ln-1176"></a>
<a name="ln-1177"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1178"></a>          <span class="c">! na</span>
<a name="ln-1179"></a>
<a name="ln-1180"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1181"></a>
<a name="ln-1182"></a>
<a name="ln-1183"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1184"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-1185"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1186"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1187"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1188"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1189"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1190"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1191"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1192"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1193"></a>
<a name="ln-1194"></a>
<a name="ln-1195"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1196"></a>          <span class="c">! na</span>
<a name="ln-1197"></a>
<a name="ln-1198"></a>
<a name="ln-1199"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-1200"></a>          <span class="c">! na</span>
<a name="ln-1201"></a>
<a name="ln-1202"></a>
<a name="ln-1203"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-1204"></a>          <span class="c">! na</span>
<a name="ln-1205"></a>
<a name="ln-1206"></a>
<a name="ln-1207"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1208"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span>
<a name="ln-1209"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">RhozNorm</span><span class="p">,</span> <span class="n">VisczNorm</span><span class="p">,</span> <span class="n">expn</span><span class="p">,</span> <span class="n">Ctl</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">Corr</span><span class="p">,</span> <span class="n">VisAve</span><span class="p">,</span> <span class="n">Tave</span><span class="p">,</span> <span class="n">RhoCor</span>
<a name="ln-1210"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-1211"></a>
<a name="ln-1212"></a>      <span class="c">! FLOW:</span>
<a name="ln-1213"></a>      <span class="c">! Crack standard condition from given inputs</span>
<a name="ln-1214"></a>      <span class="n">Corr</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Factor</span>
<a name="ln-1215"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-1216"></a>      <span class="n">RhozNorm</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardP</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1217"></a>                 <span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardT</span><span class="p">,</span><span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardW</span><span class="p">)</span>
<a name="ln-1218"></a>      <span class="n">VisczNorm</span> <span class="o">=</span> <span class="mf">1.71432d-5</span><span class="o">+</span><span class="mf">4.828d-8</span><span class="o">*</span><span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardT</span>
<a name="ln-1219"></a>
<a name="ln-1220"></a>      <span class="n">expn</span> <span class="o">=</span> <span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-1221"></a>      <span class="n">VisAve</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-1222"></a>      <span class="n">Tave</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-1223"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1224"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Corr</span>
<a name="ln-1225"></a>      <span class="k">ELSE</span>
<a name="ln-1226"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">MultizoneSurfaceCrackData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Corr</span>
<a name="ln-1227"></a>      <span class="k">END IF</span>
<a name="ln-1228"></a>
<a name="ln-1229"></a><span class="k">      </span><span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1230"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1231"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-1232"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1233"></a><span class="k">          </span><span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-1234"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-1235"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1236"></a>        <span class="k">ELSE</span>
<a name="ln-1237"></a><span class="k">          </span><span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-1238"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-1239"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1240"></a>        <span class="k">END IF</span>
<a name="ln-1241"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1242"></a>      <span class="k">ELSE</span>
<a name="ln-1243"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-1244"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1245"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-1246"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-1247"></a>          <span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-1248"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-1249"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1250"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1251"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-1252"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1253"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1254"></a>          <span class="k">ELSE</span>
<a name="ln-1255"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">PDROP</span><span class="o">**</span><span class="n">expn</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1256"></a>          <span class="k">END IF</span>
<a name="ln-1257"></a><span class="k">        ELSE</span>
<a name="ln-1258"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-1259"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-1260"></a>          <span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-1261"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-1262"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1263"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1264"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-1265"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1266"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1267"></a>          <span class="k">ELSE</span>
<a name="ln-1268"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">**</span><span class="n">expn</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-1269"></a>          <span class="k">END IF</span>
<a name="ln-1270"></a><span class="k">        END IF</span>
<a name="ln-1271"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-1272"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; scr: &#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">FT</span>
<a name="ln-1273"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-1274"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-1275"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-1276"></a>        <span class="k">ELSE</span>
<a name="ln-1277"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-1278"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-1279"></a>        <span class="k">END IF</span>
<a name="ln-1280"></a><span class="k">      END IF</span>
<a name="ln-1281"></a><span class="c">!</span>
<a name="ln-1282"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1283"></a>      <span class="k">RETURN</span>
<a name="ln-1284"></a><span class="k">      END SUBROUTINE </span><span class="n">AFESCR</span>
<a name="ln-1285"></a>
<a name="ln-1286"></a>
<a name="ln-1287"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEDWC</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1288"></a>
<a name="ln-1289"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1290"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1291"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1292"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1293"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1294"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1295"></a>          <span class="c">!</span>
<a name="ln-1296"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1297"></a>
<a name="ln-1298"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1299"></a>          <span class="c">! This subroutine solves airflow for a duct/pipe component using Colebrook equation for the</span>
<a name="ln-1300"></a>          <span class="c">! turbulent friction factor</span>
<a name="ln-1301"></a>
<a name="ln-1302"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1303"></a>          <span class="c">! na</span>
<a name="ln-1304"></a>
<a name="ln-1305"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1306"></a>          <span class="c">! na</span>
<a name="ln-1307"></a>
<a name="ln-1308"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1309"></a>          <span class="c">! na</span>
<a name="ln-1310"></a>
<a name="ln-1311"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1312"></a>
<a name="ln-1313"></a>
<a name="ln-1314"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1315"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-1316"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1317"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1318"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1319"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1320"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1321"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1322"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1323"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1324"></a>
<a name="ln-1325"></a>
<a name="ln-1326"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1327"></a>          <span class="c">! na</span>
<a name="ln-1328"></a>
<a name="ln-1329"></a>
<a name="ln-1330"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-1331"></a>          <span class="c">! na</span>
<a name="ln-1332"></a>
<a name="ln-1333"></a>
<a name="ln-1334"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-1335"></a>          <span class="c">! na</span>
<a name="ln-1336"></a>
<a name="ln-1337"></a>
<a name="ln-1338"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1339"></a>          <span class="c">!     RE      - Reynolds number.</span>
<a name="ln-1340"></a>          <span class="c">!     FL      - friction factor for laminar flow.</span>
<a name="ln-1341"></a>          <span class="c">!     FT      - friction factor for turbulent flow.</span>
<a name="ln-1342"></a>
<a name="ln-1343"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">A0</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">EPS</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">FTT</span><span class="p">,</span> <span class="n">RE</span>
<a name="ln-1344"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-1345"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">ed</span><span class="p">,</span> <span class="n">ld</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">AA1</span>
<a name="ln-1346"></a><span class="c">!</span>
<a name="ln-1347"></a>      <span class="k">DATA </span><span class="n">C</span><span class="p">,</span><span class="n">EPS</span> <span class="o">/</span> <span class="mf">0.868589d0</span><span class="p">,</span> <span class="mf">0.001d0</span> <span class="o">/</span>
<a name="ln-1348"></a>
<a name="ln-1349"></a>      <span class="c">! FLOW:</span>
<a name="ln-1350"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-1351"></a>      <span class="n">ed</span> <span class="o">=</span> <span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Rough</span><span class="o">/</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-1352"></a>      <span class="n">ld</span> <span class="o">=</span> <span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">L</span><span class="o">/</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-1353"></a>      <span class="n">g</span>  <span class="o">=</span> <span class="mf">1.14d0</span> <span class="o">-</span> <span class="mf">0.868589d0</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
<a name="ln-1354"></a>      <span class="n">AA1</span> <span class="o">=</span> <span class="n">g</span>
<a name="ln-1355"></a>
<a name="ln-1356"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1357"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1358"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-1359"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1360"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-1361"></a>                  <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-1362"></a>        <span class="k">ELSE</span>
<a name="ln-1363"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-1364"></a>                  <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-1365"></a>        <span class="k">END IF</span>
<a name="ln-1366"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1367"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwi:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1368"></a>      <span class="k">ELSE</span>
<a name="ln-1369"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-1370"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1371"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-1372"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-1373"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1374"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1375"></a>                 <span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="p">)</span>
<a name="ln-1376"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-1377"></a>                 <span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-1378"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="o">-</span><span class="n">PDROP</span>
<a name="ln-1379"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.0d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-1380"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-1381"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-1382"></a>          <span class="k">ELSE</span>
<a name="ln-1383"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-1384"></a>                  <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-1385"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1386"></a>          <span class="k">END IF</span>
<a name="ln-1387"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="p">)</span>
<a name="ln-1388"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwl:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">CDM</span><span class="p">,</span><span class="n">RE</span>
<a name="ln-1389"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-1390"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1391"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-1392"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-1393"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-1394"></a>            <span class="k">DO</span>
<a name="ln-1395"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-1396"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-1397"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-1398"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-1399"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-1400"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-1401"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-1402"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-1403"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-1404"></a>          <span class="k">ELSE</span>
<a name="ln-1405"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-1406"></a>          <span class="k">END IF</span>
<a name="ln-1407"></a><span class="k">        ELSE</span>
<a name="ln-1408"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-1409"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-1410"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1411"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1412"></a>                 <span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="p">)</span>
<a name="ln-1413"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-1414"></a>                 <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-1415"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="n">PDROP</span>
<a name="ln-1416"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.0d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-1417"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-1418"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-1419"></a>          <span class="k">ELSE</span>
<a name="ln-1420"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-1421"></a>                  <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-1422"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-1423"></a>          <span class="k">END IF</span>
<a name="ln-1424"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="o">-</span><span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="p">)</span>
<a name="ln-1425"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwl:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">CDM</span><span class="p">,</span><span class="n">RE</span>
<a name="ln-1426"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-1427"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1428"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-1429"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-1430"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-1431"></a>            <span class="k">DO</span>
<a name="ln-1432"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-1433"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-1434"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-1435"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-1436"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span> <span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-1437"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-1438"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-1439"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-1440"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FTT</span>
<a name="ln-1441"></a>          <span class="k">ELSE</span>
<a name="ln-1442"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-1443"></a>          <span class="k">END IF</span>
<a name="ln-1444"></a><span class="k">        END IF</span>
<a name="ln-1445"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-1446"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-1447"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-1448"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-1449"></a>        <span class="k">ELSE</span>
<a name="ln-1450"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-1451"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">FT</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-1452"></a>        <span class="k">END IF</span>
<a name="ln-1453"></a><span class="k">      END IF</span>
<a name="ln-1454"></a><span class="c">!</span>
<a name="ln-1455"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1456"></a>
<a name="ln-1457"></a>      <span class="k">RETURN</span>
<a name="ln-1458"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEDWC</span>
<a name="ln-1459"></a>
<a name="ln-1460"></a>      <span class="k">SUBROUTINE </span><span class="n">AFESOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1461"></a>
<a name="ln-1462"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1463"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1464"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1465"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1466"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1467"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1468"></a>          <span class="c">!</span>
<a name="ln-1469"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1470"></a>
<a name="ln-1471"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1472"></a>          <span class="c">! This subroutine solves airflow for a Doorway airflow component using standard interface.</span>
<a name="ln-1473"></a>          <span class="c">! A doorway may have two-way airflows. Heights measured relative to the bottom of the door.</span>
<a name="ln-1474"></a>
<a name="ln-1475"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1476"></a>          <span class="c">! na</span>
<a name="ln-1477"></a>
<a name="ln-1478"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1479"></a>          <span class="c">! na</span>
<a name="ln-1480"></a>
<a name="ln-1481"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1482"></a>          <span class="c">! na</span>
<a name="ln-1483"></a>
<a name="ln-1484"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1485"></a>
<a name="ln-1486"></a>
<a name="ln-1487"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1488"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-1489"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1490"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1491"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1492"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1493"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1494"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1495"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1496"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1497"></a>
<a name="ln-1498"></a>
<a name="ln-1499"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1500"></a>          <span class="c">! na</span>
<a name="ln-1501"></a>
<a name="ln-1502"></a>
<a name="ln-1503"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-1504"></a>          <span class="c">! na</span>
<a name="ln-1505"></a>
<a name="ln-1506"></a>
<a name="ln-1507"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-1508"></a>          <span class="c">! na</span>
<a name="ln-1509"></a>
<a name="ln-1510"></a>
<a name="ln-1511"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1512"></a>          <span class="c">!     DPMID   - pressure drop at mid-height of doorway.</span>
<a name="ln-1513"></a>          <span class="c">!     DRHO    - difference in air densities between rooms.</span>
<a name="ln-1514"></a>          <span class="c">!     Y       - height of neutral plane rel. to bottom of door (m).</span>
<a name="ln-1515"></a>          <span class="c">!     F0      - flow factor at the bottom of the door.</span>
<a name="ln-1516"></a>          <span class="c">!     FH      - flow factor at the top of the door.</span>
<a name="ln-1517"></a>          <span class="c">!     DF0     - derivative factor at the bottom of the door.</span>
<a name="ln-1518"></a>          <span class="c">!     DFH     - derivative factor at the top of the door.</span>
<a name="ln-1519"></a><span class="c">!</span>
<a name="ln-1520"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">DPMID</span>
<a name="ln-1521"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">C</span><span class="p">,</span> <span class="n">DF0</span><span class="p">,</span> <span class="n">DFH</span><span class="p">,</span> <span class="n">DRHO</span><span class="p">,</span> <span class="n">GDRHO</span><span class="p">,</span> <span class="n">F0</span><span class="p">,</span> <span class="n">FH</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">SQRT2</span>
<a name="ln-1522"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-1523"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">FlowCoef</span><span class="p">,</span><span class="n">FlowExpo</span><span class="p">,</span><span class="n">MinRhoDiff</span><span class="p">,</span><span class="n">DischCoeff</span><span class="p">,</span><span class="n">Width</span><span class="p">,</span><span class="n">Height</span><span class="p">,</span><span class="n">OpenFactor</span>
<a name="ln-1524"></a><span class="c">!</span>
<a name="ln-1525"></a>      <span class="k">DATA </span><span class="n">SQRT2</span> <span class="o">/</span> <span class="mf">1.414214d0</span> <span class="o">/</span>
<a name="ln-1526"></a>
<a name="ln-1527"></a>      <span class="c">! FLOW:</span>
<a name="ln-1528"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-1529"></a>      <span class="n">MinRhoDiff</span> <span class="o">=</span> <span class="n">MultizoneCompSimpleOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">MinRhoDiff</span>
<a name="ln-1530"></a>      <span class="n">DischCoeff</span> <span class="o">=</span> <span class="n">MultizoneCompSimpleOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff</span>
<a name="ln-1531"></a>      <span class="n">Width</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">Width</span>
<a name="ln-1532"></a>      <span class="n">Height</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">Height</span>
<a name="ln-1533"></a>      <span class="n">FlowCoef</span> <span class="o">=</span> <span class="n">MultizoneCompSimpleOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="o">*</span><span class="mf">2.0d0</span><span class="o">*</span><span class="p">(</span><span class="n">Width</span><span class="o">+</span><span class="n">Height</span><span class="p">)</span>
<a name="ln-1534"></a>      <span class="n">FlowExpo</span> <span class="o">=</span> <span class="n">MultizoneCompSimpleOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-1535"></a>      <span class="n">OpenFactor</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">OpenFactor</span>
<a name="ln-1536"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">OpenFactor</span> <span class="o">&gt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1537"></a><span class="k">        </span><span class="n">Width</span> <span class="o">=</span> <span class="n">Width</span><span class="o">*</span><span class="n">OpenFactor</span>
<a name="ln-1538"></a>        <span class="k">If</span> <span class="p">(</span><span class="n">Surface</span><span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Tilt</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mi">9</span><span class="mf">0.d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1539"></a><span class="k">          </span><span class="n">Height</span> <span class="o">=</span> <span class="n">Height</span><span class="o">*</span><span class="n">Surface</span><span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">SinTilt</span>
<a name="ln-1540"></a>        <span class="k">End If</span>
<a name="ln-1541"></a><span class="k">      End If</span>
<a name="ln-1542"></a>
<a name="ln-1543"></a><span class="k">      IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1544"></a><span class="k">         </span><span class="n">FlowCoef</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1545"></a>      <span class="k">ELSE</span>
<a name="ln-1546"></a><span class="k">         </span><span class="n">FlowCoef</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-1547"></a>      <span class="k">END IF</span>
<a name="ln-1548"></a>
<a name="ln-1549"></a>      <span class="c">! Add window multiplier with window close</span>
<a name="ln-1550"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Multiplier</span> <span class="o">&gt;</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="n">FlowCoef</span><span class="o">=</span><span class="n">FlowCoef</span><span class="o">*</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Multiplier</span>
<a name="ln-1551"></a>      <span class="c">! Add window multiplier with window open</span>
<a name="ln-1552"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">OpenFactor</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1553"></a><span class="k">        If</span> <span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Multiplier</span> <span class="o">&gt;</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="n">Width</span><span class="o">=</span><span class="n">Width</span><span class="o">*</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Multiplier</span>
<a name="ln-1554"></a>      <span class="k">End If</span>
<a name="ln-1555"></a>
<a name="ln-1556"></a><span class="k">      </span><span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1557"></a>      <span class="n">DRHO</span> <span class="o">=</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-1558"></a>      <span class="n">GDRHO</span> <span class="o">=</span> <span class="mf">9.8d0</span><span class="o">*</span><span class="n">DRHO</span>
<a name="ln-1559"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">903</span><span class="p">)</span> <span class="s1">&#39; DOR:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DRHO</span><span class="p">),</span><span class="n">MinRhoDiff</span>
<a name="ln-1560"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">OpenFactor</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1561"></a><span class="k">        CALL </span><span class="n">GenericCrack</span><span class="p">(</span><span class="n">FlowCoef</span><span class="p">,</span><span class="n">FlowExpo</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1562"></a>        <span class="k">Return</span>
<a name="ln-1563"></a><span class="k">      end if</span>
<a name="ln-1564"></a><span class="k">      IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DRHO</span><span class="p">).</span><span class="n">LT</span><span class="p">.</span><span class="n">MinRhoDiff</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1565"></a><span class="k">        </span><span class="n">DPMID</span> <span class="o">=</span> <span class="n">PDROP</span><span class="o">-</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">Height</span><span class="o">*</span><span class="n">GDRHO</span>
<a name="ln-1566"></a>        <span class="c">! Initialization or identical temps: treat as one-way flow.</span>
<a name="ln-1567"></a>        <span class="k">CALL </span><span class="n">GenericCrack</span><span class="p">(</span><span class="n">FlowCoef</span><span class="p">,</span><span class="n">FlowExpo</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">DPMID</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1568"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="s1">&#39; Drs:&#39;</span><span class="p">,</span><span class="n">DPMID</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1569"></a>      <span class="k">ELSE</span>
<a name="ln-1570"></a>        <span class="c">! Possible two-way flow:</span>
<a name="ln-1571"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">PDROP</span><span class="o">/</span><span class="n">GDRHO</span>
<a name="ln-1572"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="s1">&#39; DrY:&#39;</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">GDRHO</span><span class="p">,</span><span class="n">Y</span>
<a name="ln-1573"></a>        <span class="c">! F0 = lower flow, FH = upper flow.</span>
<a name="ln-1574"></a>        <span class="n">C</span> <span class="o">=</span> <span class="n">SQRT2</span><span class="o">*</span><span class="n">Width</span><span class="o">*</span><span class="n">DischCoeff</span>
<a name="ln-1575"></a>        <span class="n">DF0</span> <span class="o">=</span> <span class="n">C</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">PDROP</span><span class="p">))</span><span class="o">/</span><span class="nb">ABS</span><span class="p">(</span><span class="n">GDRHO</span><span class="p">)</span>
<a name="ln-1576"></a><span class="c">!        F0 = 0.666667d0*C*SQRT(ABS(GDRHO*Y))*ABS(Y)</span>
<a name="ln-1577"></a>        <span class="n">F0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">GDRHO</span><span class="o">*</span><span class="n">Y</span><span class="p">))</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<a name="ln-1578"></a>        <span class="n">DFH</span> <span class="o">=</span> <span class="n">C</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">ABS</span><span class="p">((</span><span class="n">Height</span><span class="o">-</span><span class="n">Y</span><span class="p">)</span><span class="o">/</span><span class="n">GDRHO</span><span class="p">))</span>
<a name="ln-1579"></a><span class="c">!        FH = 0.666667d0*DFH*ABS(GDRHO*(Height-Y))</span>
<a name="ln-1580"></a>        <span class="n">FH</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0d0</span><span class="o">/</span><span class="mf">3.0d0</span><span class="p">)</span><span class="o">*</span><span class="n">DFH</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">GDRHO</span><span class="o">*</span><span class="p">(</span><span class="n">Height</span><span class="o">-</span><span class="n">Y</span><span class="p">))</span>
<a name="ln-1581"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="s1">&#39; DrF:&#39;</span><span class="p">,</span><span class="n">F0</span><span class="p">,</span><span class="n">DF0</span><span class="p">,</span><span class="n">FH</span><span class="p">,</span><span class="n">DFH</span>
<a name="ln-1582"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">Y</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1583"></a>          <span class="c">! One-way flow (negative).</span>
<a name="ln-1584"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DRHO</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1585"></a><span class="k">            </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FH</span><span class="o">-</span><span class="n">F0</span><span class="p">)</span>
<a name="ln-1586"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DFH</span><span class="o">-</span><span class="n">DF0</span><span class="p">)</span>
<a name="ln-1587"></a>          <span class="k">ELSE</span>
<a name="ln-1588"></a><span class="k">            </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FH</span><span class="o">-</span><span class="n">F0</span><span class="p">)</span>
<a name="ln-1589"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DFH</span><span class="o">-</span><span class="n">DF0</span><span class="p">)</span>
<a name="ln-1590"></a>          <span class="k">END IF</span>
<a name="ln-1591"></a><span class="k">          IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="s1">&#39; Dr1:&#39;</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1592"></a>        <span class="k">ELSE IF</span><span class="p">(</span><span class="n">Y</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="n">Height</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1593"></a>          <span class="c">! One-way flow (positive).</span>
<a name="ln-1594"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DRHO</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1595"></a><span class="k">            </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FH</span><span class="o">-</span><span class="n">F0</span><span class="p">)</span>
<a name="ln-1596"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DFH</span><span class="o">-</span><span class="n">DF0</span><span class="p">)</span>
<a name="ln-1597"></a>          <span class="k">ELSE</span>
<a name="ln-1598"></a><span class="k">            </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FH</span><span class="o">-</span><span class="n">F0</span><span class="p">)</span>
<a name="ln-1599"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DFH</span><span class="o">-</span><span class="n">DF0</span><span class="p">)</span>
<a name="ln-1600"></a>          <span class="k">END IF</span>
<a name="ln-1601"></a><span class="k">          IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="s1">&#39; Dr2:&#39;</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1602"></a>        <span class="k">ELSE</span>
<a name="ln-1603"></a>          <span class="c">! Two-way flow.</span>
<a name="ln-1604"></a>          <span class="n">NF</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-1605"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DRHO</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1606"></a><span class="k">            </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">FH</span>
<a name="ln-1607"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DFH</span>
<a name="ln-1608"></a>            <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span>  <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">F0</span>
<a name="ln-1609"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DF0</span>
<a name="ln-1610"></a>          <span class="k">ELSE</span>
<a name="ln-1611"></a><span class="k">            </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">FH</span>
<a name="ln-1612"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">DFH</span>
<a name="ln-1613"></a>            <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">F0</span>
<a name="ln-1614"></a>            <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">DF0</span>
<a name="ln-1615"></a>          <span class="k">END IF</span>
<a name="ln-1616"></a><span class="k">          IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="s1">&#39; Dr3:&#39;</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1617"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span> <span class="s1">&#39; Dr4:&#39;</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1618"></a>        <span class="n">ENDIF</span>
<a name="ln-1619"></a>      <span class="k">END IF</span>
<a name="ln-1620"></a><span class="k">  </span><span class="mi">900</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="mi">9</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1621"></a>  <span class="mi">903</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="mi">3</span><span class="n">I3</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1622"></a>
<a name="ln-1623"></a>      <span class="k">RETURN</span>
<a name="ln-1624"></a><span class="k">      END SUBROUTINE </span><span class="n">AFESOP</span>
<a name="ln-1625"></a>
<a name="ln-1626"></a>
<a name="ln-1627"></a>      <span class="k">SUBROUTINE </span><span class="n">AFECFR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1628"></a>
<a name="ln-1629"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1630"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1631"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1632"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1633"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1634"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1635"></a>          <span class="c">!</span>
<a name="ln-1636"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1637"></a>
<a name="ln-1638"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1639"></a>          <span class="c">! This subroutine solves airflow for a constant flow rate airflow component -- using standard interface.</span>
<a name="ln-1640"></a>
<a name="ln-1641"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1642"></a>          <span class="c">! na</span>
<a name="ln-1643"></a>
<a name="ln-1644"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1645"></a>          <span class="c">! na</span>
<a name="ln-1646"></a>
<a name="ln-1647"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1648"></a>          <span class="k">USE </span><span class="n">DataLoopNode</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">Node</span>
<a name="ln-1649"></a>          <span class="k">USE </span><span class="n">DataAirLoop</span><span class="p">,</span>  <span class="n">ONLY</span><span class="p">:</span> <span class="n">LoopSystemOnMassFlowrate</span><span class="p">,</span><span class="n">LoopSystemOffMassFlowrate</span><span class="p">,</span><span class="n">LoopFanOperationMode</span><span class="p">,</span><span class="n">LoopCompCycRatio</span>
<a name="ln-1650"></a>          <span class="k">USE </span><span class="n">DataHVACGlobals</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">FanType_SimpleOnOff</span><span class="p">,</span> <span class="n">FanType_SimpleConstVolume</span><span class="p">,</span> <span class="n">FanType_SimpleVAV</span>
<a name="ln-1651"></a>
<a name="ln-1652"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1653"></a>
<a name="ln-1654"></a>
<a name="ln-1655"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1656"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-1657"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1658"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1659"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1660"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1661"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1662"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1663"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1664"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1665"></a>
<a name="ln-1666"></a>
<a name="ln-1667"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1668"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">CycFanCycComp</span>    <span class="o">=</span> <span class="mi">1</span> <span class="c">! fan cycles with compressor operation</span>
<a name="ln-1669"></a>
<a name="ln-1670"></a>
<a name="ln-1671"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-1672"></a>          <span class="c">! na</span>
<a name="ln-1673"></a>
<a name="ln-1674"></a>
<a name="ln-1675"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-1676"></a>          <span class="c">! na</span>
<a name="ln-1677"></a>
<a name="ln-1678"></a>
<a name="ln-1679"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1680"></a>          <span class="kt">INTEGER </span><span class="n">CompNum</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="n">k1</span>
<a name="ln-1681"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SumTermFlow</span>  <span class="c">! Sum of all Terminal flows [kg/s]</span>
<a name="ln-1682"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SumFracSuppLeak</span>  <span class="c">! Sum of all supply leaks as a fraction of supply fan flow rate</span>
<a name="ln-1683"></a>          <span class="kt">Integer </span><span class="n">Node1</span><span class="p">,</span> <span class="n">Node2</span>
<a name="ln-1684"></a>
<a name="ln-1685"></a>      <span class="c">! FLOW:</span>
<a name="ln-1686"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-1687"></a>
<a name="ln-1688"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1689"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FanTypeNum</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="n">FanType_SimpleOnOff</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1690"></a><span class="k">        If</span> <span class="p">(</span><span class="n">LoopFanOperationMode</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="n">CycFanCycComp</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">LoopSystemOnMassFlowrate</span> <span class="p">.</span><span class="n">GT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1691"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">LoopSystemOnMassFlowrate</span>
<a name="ln-1692"></a>        <span class="k">else</span>
<a name="ln-1693"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">InletNode</span><span class="p">)%</span><span class="n">MassFlowrate</span><span class="o">*</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Ctrl</span>
<a name="ln-1694"></a>          <span class="k">If</span> <span class="p">(</span><span class="n">MultiSpeedHPIndicator</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">2</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1695"></a><span class="k">            </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">LoopSystemOnMassFlowrate</span><span class="o">*</span><span class="n">LoopCompCycRatio</span><span class="o">+</span><span class="n">LoopSystemOffMassFlowrate</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="n">LoopCompCycRatio</span><span class="p">)</span>
<a name="ln-1696"></a>          <span class="k">End If</span>
<a name="ln-1697"></a><span class="k">        End If</span>
<a name="ln-1698"></a><span class="k">      Else If</span> <span class="p">(</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FanTypeNum</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="n">FanType_SimpleConstVolume</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1699"></a><span class="k">        If</span> <span class="p">(</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowRate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1700"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowRate</span><span class="o">*</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Ctrl</span>
<a name="ln-1701"></a>        <span class="k">Else</span>
<a name="ln-1702"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">InletNode</span><span class="p">)%</span><span class="n">MassFlowrate</span><span class="o">*</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Ctrl</span>
<a name="ln-1703"></a>        <span class="k">End If</span>
<a name="ln-1704"></a><span class="k">        If</span> <span class="p">(</span><span class="n">MultiSpeedHPIndicator</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mi">2</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1705"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">LoopSystemOnMassFlowrate</span>
<a name="ln-1706"></a>        <span class="k">End If</span>
<a name="ln-1707"></a><span class="k">      Else If</span> <span class="p">(</span><span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FanTypeNum</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="n">FanType_SimpleVAV</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1708"></a>        <span class="c">! Check VAV termals with a damper</span>
<a name="ln-1709"></a>        <span class="n">SumTermFlow</span> <span class="o">=</span> <span class="mf">0.d0</span>
<a name="ln-1710"></a>        <span class="n">SumFracSuppLeak</span> <span class="o">=</span> <span class="mf">0.d0</span>
<a name="ln-1711"></a>        <span class="k">Do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-1712"></a>          <span class="k">If</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">k</span><span class="p">)%</span><span class="n">VAVTermDamper</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1713"></a><span class="k">            </span><span class="n">k1</span> <span class="o">=</span> <span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">k</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">))%</span><span class="n">EPlusNodeNum</span>
<a name="ln-1714"></a>            <span class="k">If</span> <span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">k1</span><span class="p">)%</span><span class="n">MassFlowRate</span> <span class="p">.</span><span class="n">GT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1715"></a><span class="k">              </span><span class="n">SumTermFlow</span> <span class="o">=</span> <span class="n">SumTermFlow</span> <span class="o">+</span> <span class="n">Node</span><span class="p">(</span><span class="n">k1</span><span class="p">)%</span><span class="n">MassFlowRate</span>
<a name="ln-1716"></a>            <span class="k">End If</span>
<a name="ln-1717"></a><span class="k">          End If</span>
<a name="ln-1718"></a><span class="k">          If</span> <span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">k</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">CompTypeNum</span> <span class="o">==</span> <span class="n">CompTypeNum_ELR</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1719"></a>            <span class="c">! Calculate supply leak sensible losses</span>
<a name="ln-1720"></a>            <span class="n">Node1</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">k</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1721"></a>            <span class="n">Node2</span> <span class="o">=</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">k</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1722"></a>            <span class="k">if</span> <span class="p">((</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">Node2</span><span class="p">)%</span><span class="n">EPlusZoneNum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">Node1</span><span class="p">)%</span><span class="n">EPlusNodeNum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="k">Then</span>
<a name="ln-1723"></a><span class="k">              </span><span class="n">SumFracSuppLeak</span> <span class="o">=</span> <span class="n">SumFracSuppLeak</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1724"></a>                <span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">k</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TypeNum</span><span class="p">)%</span><span class="n">ELR</span>
<a name="ln-1725"></a>            <span class="k">End If</span>
<a name="ln-1726"></a><span class="k">          End If</span>
<a name="ln-1727"></a><span class="k">        End Do</span>
<a name="ln-1728"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">SumTermFlow</span><span class="o">/</span><span class="p">(</span><span class="mf">1.d0</span><span class="o">-</span><span class="n">SumFracSuppLeak</span><span class="p">)</span>
<a name="ln-1729"></a>        <span class="n">VAVTerminalRatio</span> <span class="o">=</span> <span class="mf">0.d0</span>
<a name="ln-1730"></a>        <span class="k">If</span> <span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">GT</span><span class="p">.</span> <span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">MaxAirMassFlowRate</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-1731"></a><span class="k">          </span><span class="n">VAVTerminalRatio</span> <span class="o">=</span> <span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">MaxAirMassFlowRate</span><span class="o">/</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1732"></a>          <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">DisSysCompCVFData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">MaxAirMassFlowRate</span>
<a name="ln-1733"></a>        <span class="k">End If</span>
<a name="ln-1734"></a><span class="k">      End If</span>
<a name="ln-1735"></a><span class="k">      </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1736"></a>
<a name="ln-1737"></a>      <span class="k">RETURN</span>
<a name="ln-1738"></a><span class="k">      END SUBROUTINE </span><span class="n">AFECFR</span>
<a name="ln-1739"></a>
<a name="ln-1740"></a>
<a name="ln-1741"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEFAN</span><span class="p">(</span><span class="n">JA</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1742"></a>
<a name="ln-1743"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1744"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1745"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1746"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1747"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1748"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1749"></a>          <span class="c">!</span>
<a name="ln-1750"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1751"></a>
<a name="ln-1752"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1753"></a>          <span class="c">! This subroutine solves airflow for a detailed fan component -- using standard interface.</span>
<a name="ln-1754"></a>
<a name="ln-1755"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1756"></a>          <span class="c">! na</span>
<a name="ln-1757"></a>
<a name="ln-1758"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1759"></a>          <span class="c">! na</span>
<a name="ln-1760"></a>
<a name="ln-1761"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1762"></a>          <span class="c">! na</span>
<a name="ln-1763"></a>
<a name="ln-1764"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1765"></a>
<a name="ln-1766"></a>
<a name="ln-1767"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1768"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">JA</span>    <span class="c">! Component number</span>
<a name="ln-1769"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1770"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1771"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1772"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1773"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1774"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1775"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1776"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1777"></a>
<a name="ln-1778"></a>
<a name="ln-1779"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1780"></a>          <span class="c">! na</span>
<a name="ln-1781"></a>
<a name="ln-1782"></a>
<a name="ln-1783"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-1784"></a>          <span class="c">! na</span>
<a name="ln-1785"></a>
<a name="ln-1786"></a>
<a name="ln-1787"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-1788"></a>          <span class="c">! na</span>
<a name="ln-1789"></a>
<a name="ln-1790"></a>
<a name="ln-1791"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1792"></a>          <span class="c">!     PRISE   - pressure rise (negative of pressure drop) (Pa).</span>
<a name="ln-1793"></a><span class="c">!</span>
<a name="ln-1794"></a>         <span class="kt">INTEGER  </span><span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">L</span>
<a name="ln-1795"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">DPDF</span><span class="p">,</span> <span class="n">PRISE</span><span class="p">,</span> <span class="n">BX</span><span class="p">,</span> <span class="n">BY</span><span class="p">,</span> <span class="n">CX</span><span class="p">,</span> <span class="n">CY</span><span class="p">,</span> <span class="n">CCY</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">DY</span><span class="p">,</span> <span class="n">TOL</span>
<a name="ln-1796"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span><span class="p">,</span> <span class="n">NumCur</span>
<a name="ln-1797"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">FlowCoef</span><span class="p">,</span> <span class="n">FlowExpo</span>
<a name="ln-1798"></a>
<a name="ln-1799"></a>      <span class="k">DATA </span><span class="n">TOL</span> <span class="o">/</span> <span class="mf">0.00001d0</span> <span class="o">/</span>
<a name="ln-1800"></a>
<a name="ln-1801"></a>      <span class="c">! FLOW:</span>
<a name="ln-1802"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">JA</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-1803"></a>      <span class="n">NumCur</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">n</span>
<a name="ln-1804"></a>      <span class="n">FlowCoef</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span>
<a name="ln-1805"></a>      <span class="n">FlowExpo</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-1806"></a>
<a name="ln-1807"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1808"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1809"></a>        <span class="c">! Speed = 0; treat fan as resistance.</span>
<a name="ln-1810"></a>        <span class="k">CALL </span><span class="n">GenericCrack</span><span class="p">(</span><span class="n">FlowCoef</span><span class="p">,</span><span class="n">FlowExpo</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1811"></a>        <span class="k">RETURN</span>
<a name="ln-1812"></a><span class="k">      END IF</span>
<a name="ln-1813"></a>      <span class="c">! Pressure rise at reference fan speed.</span>
<a name="ln-1814"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TranRat</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1815"></a><span class="k">        </span><span class="n">PRISE</span> <span class="o">=</span> <span class="o">-</span><span class="n">PDROP</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">RhoAir</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">/</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-1816"></a>      <span class="k">ELSE</span>
<a name="ln-1817"></a><span class="k">        </span><span class="n">PRISE</span> <span class="o">=</span> <span class="o">-</span><span class="n">PDROP</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">RhoAir</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-1818"></a>                <span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TranRat</span><span class="o">*</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-1819"></a>      <span class="k">END IF</span>
<a name="ln-1820"></a><span class="k">      IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; fan:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">PRISE</span><span class="p">,</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TranRat</span>
<a name="ln-1821"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1822"></a>        <span class="c">! Initialization by linear approximation.</span>
<a name="ln-1823"></a>        <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Qfree</span><span class="o">*</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="n">PRISE</span><span class="o">/</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Pshut</span><span class="p">)</span>
<a name="ln-1824"></a>        <span class="n">DPDF</span> <span class="o">=</span> <span class="o">-</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Pshut</span><span class="o">/</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Qfree</span>
<a name="ln-1825"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; fni:&#39;</span><span class="p">,</span><span class="n">JA</span><span class="p">,</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Qfree</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1826"></a>                                               <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Pshut</span>
<a name="ln-1827"></a>      <span class="k">ELSE</span>
<a name="ln-1828"></a>        <span class="c">! Solution of the fan performance curve.</span>
<a name="ln-1829"></a>        <span class="c">! Determine curve fit range.</span>
<a name="ln-1830"></a>        <span class="n">J</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1831"></a>        <span class="n">K</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1832"></a>        <span class="n">BX</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<a name="ln-1833"></a>        <span class="n">BY</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">BX</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1834"></a>          <span class="n">BX</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="n">BX</span><span class="o">*</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">4</span><span class="p">)))</span><span class="o">-</span><span class="n">PRISE</span>
<a name="ln-1835"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">BY</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Out of range, too low in an AirflowNetwork detailed Fan&#39;</span><span class="p">)</span>
<a name="ln-1836"></a>
<a name="ln-1837"></a>        <span class="k">DO</span>
<a name="ln-1838"></a><span class="k">          </span><span class="n">DX</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-1839"></a>          <span class="n">DY</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">DX</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1840"></a>               <span class="n">DX</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="n">DX</span><span class="o">*</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">5</span><span class="p">)))</span><span class="o">-</span><span class="n">PRISE</span>
<a name="ln-1841"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; fp0:&#39;</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">BX</span><span class="p">,</span><span class="n">BY</span><span class="p">,</span><span class="n">DX</span><span class="p">,</span><span class="n">DY</span>
<a name="ln-1842"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">BY</span><span class="o">*</span><span class="n">DY</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-1843"></a><span class="k">          </span><span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1844"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">NumCur</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1845"></a>            <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Out of range, too high (FAN) in ADS simulation&#39;</span><span class="p">)</span>
<a name="ln-1846"></a>          <span class="n">K</span> <span class="o">=</span> <span class="n">K</span><span class="o">+</span><span class="mi">5</span>
<a name="ln-1847"></a>          <span class="n">BX</span> <span class="o">=</span> <span class="n">DX</span>
<a name="ln-1848"></a>          <span class="n">BY</span> <span class="o">=</span> <span class="n">DY</span>
<a name="ln-1849"></a>        <span class="k">END DO</span>
<a name="ln-1850"></a>        <span class="c">! Determine reference mass flow rate by false position method.</span>
<a name="ln-1851"></a>        <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1852"></a>        <span class="n">CY</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-1853"></a>   <span class="mi">40</span>     <span class="k">CONTINUE</span>
<a name="ln-1854"></a><span class="k">          </span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1855"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">100</span><span class="p">)</span> <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Too many iterations (FAN) in AirflowNtework simulation&#39;</span><span class="p">)</span>
<a name="ln-1856"></a>          <span class="n">CCY</span> <span class="o">=</span> <span class="n">CY</span>
<a name="ln-1857"></a>          <span class="n">CX</span> <span class="o">=</span> <span class="n">BX</span><span class="o">-</span><span class="n">BY</span><span class="o">*</span><span class="p">((</span><span class="n">DX</span><span class="o">-</span><span class="n">BX</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">DY</span><span class="o">-</span><span class="n">BY</span><span class="p">))</span>
<a name="ln-1858"></a>          <span class="n">CY</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">CX</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1859"></a>             <span class="n">CX</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="n">CX</span><span class="o">*</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">4</span><span class="p">)))</span><span class="o">-</span><span class="n">PRISE</span>
<a name="ln-1860"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">BY</span><span class="o">*</span><span class="n">CY</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">GOTO </span><span class="mi">90</span>
<a name="ln-1861"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">BY</span><span class="o">*</span><span class="n">CY</span> <span class="p">.</span><span class="n">GT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">GOTO </span><span class="mi">60</span>
<a name="ln-1862"></a>   <span class="mi">50</span>     <span class="n">DX</span> <span class="o">=</span> <span class="n">CX</span>
<a name="ln-1863"></a>          <span class="n">DY</span> <span class="o">=</span> <span class="n">CY</span>
<a name="ln-1864"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">CY</span><span class="o">*</span><span class="n">CCY</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="n">BY</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">BY</span>
<a name="ln-1865"></a>          <span class="n">GO</span> <span class="n">TO</span> <span class="mi">70</span>
<a name="ln-1866"></a>   <span class="mi">60</span>     <span class="n">BX</span> <span class="o">=</span> <span class="n">CX</span>
<a name="ln-1867"></a>          <span class="n">BY</span> <span class="o">=</span> <span class="n">CY</span>
<a name="ln-1868"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">CY</span><span class="o">*</span><span class="n">CCY</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="n">DY</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">DY</span>
<a name="ln-1869"></a>   <span class="mi">70</span>     <span class="k">CONTINUE</span>
<a name="ln-1870"></a><span class="k">          IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; fpi:&#39;</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">BX</span><span class="p">,</span><span class="n">CX</span><span class="p">,</span><span class="n">DX</span><span class="p">,</span><span class="n">BY</span><span class="p">,</span><span class="n">DY</span>
<a name="ln-1871"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">BX</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">TOL</span><span class="o">*</span><span class="n">CX</span><span class="p">)</span> <span class="n">GO</span> <span class="n">TO</span> <span class="mi">80</span>
<a name="ln-1872"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DX</span><span class="o">-</span><span class="n">BX</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">TOL</span><span class="p">)</span> <span class="n">GO</span> <span class="n">TO</span> <span class="mi">80</span>
<a name="ln-1873"></a>          <span class="n">GO</span> <span class="n">TO</span> <span class="mi">40</span>
<a name="ln-1874"></a>   <span class="mi">80</span>   <span class="n">CX</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="p">(</span><span class="n">BX</span><span class="o">+</span><span class="n">DX</span><span class="p">)</span>
<a name="ln-1875"></a>   <span class="mi">90</span>   <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CX</span>
<a name="ln-1876"></a>        <span class="n">DPDF</span> <span class="o">=</span> <span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">CX</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1877"></a>               <span class="n">CX</span><span class="o">*</span><span class="mf">3.0d0</span><span class="o">*</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Coeff</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-1878"></a>      <span class="k">END IF</span>
<a name="ln-1879"></a>      <span class="c">! Convert to flow at given speed.</span>
<a name="ln-1880"></a>      <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">RhoAir</span><span class="p">)</span><span class="o">*</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1881"></a>      <span class="c">! Set derivative w/r pressure drop (-).</span>
<a name="ln-1882"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="n">DisSysCompDetFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TranRat</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1883"></a><span class="k">        </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="n">DPDF</span>
<a name="ln-1884"></a>      <span class="k">ELSE</span>
<a name="ln-1885"></a><span class="k">        </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0d0</span><span class="o">/</span><span class="n">DPDF</span>
<a name="ln-1886"></a>      <span class="k">END IF</span>
<a name="ln-1887"></a><span class="k">  </span><span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="err">5</span><span class="n">E14</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1888"></a>
<a name="ln-1889"></a>  <span class="mi">999</span> <span class="k">RETURN</span>
<a name="ln-1890"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEFAN</span>
<a name="ln-1891"></a>
<a name="ln-1892"></a>      <span class="c">! The above subroutine is not used. Leave it for the time being and revise later.</span>
<a name="ln-1893"></a>
<a name="ln-1894"></a>      <span class="k">SUBROUTINE </span><span class="n">AFECPF</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1895"></a>
<a name="ln-1896"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1897"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1898"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1899"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1900"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1901"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1902"></a>          <span class="c">!</span>
<a name="ln-1903"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1904"></a>
<a name="ln-1905"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1906"></a>          <span class="c">! This subroutine solves airflow for a constant power simple fan component -- using standard interface.</span>
<a name="ln-1907"></a>
<a name="ln-1908"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1909"></a>          <span class="c">! na</span>
<a name="ln-1910"></a>
<a name="ln-1911"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1912"></a>          <span class="c">! na</span>
<a name="ln-1913"></a>
<a name="ln-1914"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1915"></a>          <span class="c">! na</span>
<a name="ln-1916"></a>
<a name="ln-1917"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1918"></a>
<a name="ln-1919"></a>
<a name="ln-1920"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1921"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-1922"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1923"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1924"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1925"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1926"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1927"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1928"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1929"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1930"></a>
<a name="ln-1931"></a>
<a name="ln-1932"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-1933"></a>          <span class="c">! na</span>
<a name="ln-1934"></a>
<a name="ln-1935"></a>
<a name="ln-1936"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-1937"></a>          <span class="c">! na</span>
<a name="ln-1938"></a>
<a name="ln-1939"></a>
<a name="ln-1940"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-1941"></a>          <span class="c">! na</span>
<a name="ln-1942"></a>
<a name="ln-1943"></a>
<a name="ln-1944"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-1945"></a>          <span class="c">! na</span>
<a name="ln-1946"></a>
<a name="ln-1947"></a>      <span class="c">! FLOW:</span>
<a name="ln-1948"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1949"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1950"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1951"></a>        <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1952"></a>      <span class="k">ELSE</span>
<a name="ln-1953"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-1954"></a>        <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-1955"></a>      <span class="k">END IF</span>
<a name="ln-1956"></a>
<a name="ln-1957"></a><span class="k">      RETURN</span>
<a name="ln-1958"></a><span class="k">      END SUBROUTINE </span><span class="n">AFECPF</span>
<a name="ln-1959"></a>
<a name="ln-1960"></a>
<a name="ln-1961"></a><span class="c">! Leave it for the time being and revise later. Or drop this component ???????????</span>
<a name="ln-1962"></a>
<a name="ln-1963"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEDMP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-1964"></a>
<a name="ln-1965"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-1966"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-1967"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-1968"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-1969"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-1970"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-1971"></a>          <span class="c">!</span>
<a name="ln-1972"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-1973"></a>
<a name="ln-1974"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-1975"></a>          <span class="c">! This subroutine solves airflow for a Controlled power law resistance airflow component (damper)</span>
<a name="ln-1976"></a>
<a name="ln-1977"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-1978"></a>          <span class="c">! na</span>
<a name="ln-1979"></a>
<a name="ln-1980"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-1981"></a>          <span class="c">! na</span>
<a name="ln-1982"></a>
<a name="ln-1983"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-1984"></a>          <span class="c">! na</span>
<a name="ln-1985"></a>
<a name="ln-1986"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-1987"></a>
<a name="ln-1988"></a>
<a name="ln-1989"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-1990"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-1991"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-1992"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-1993"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-1994"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-1995"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-1996"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-1997"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-1998"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-1999"></a>
<a name="ln-2000"></a>
<a name="ln-2001"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2002"></a>          <span class="c">! na</span>
<a name="ln-2003"></a>
<a name="ln-2004"></a>
<a name="ln-2005"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2006"></a>          <span class="c">! na</span>
<a name="ln-2007"></a>
<a name="ln-2008"></a>
<a name="ln-2009"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2010"></a>          <span class="c">! na</span>
<a name="ln-2011"></a>
<a name="ln-2012"></a>
<a name="ln-2013"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2014"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">C</span>
<a name="ln-2015"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-2016"></a>
<a name="ln-2017"></a>      <span class="c">! FLOW:</span>
<a name="ln-2018"></a>      <span class="c">! Get component number</span>
<a name="ln-2019"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2020"></a>
<a name="ln-2021"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2022"></a>      <span class="n">C</span> <span class="o">=</span> <span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2023"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowMin</span><span class="p">)</span> <span class="n">C</span> <span class="o">=</span> <span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowMin</span>
<a name="ln-2024"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowMax</span><span class="p">)</span> <span class="n">C</span> <span class="o">=</span> <span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowMax</span>
<a name="ln-2025"></a>      <span class="n">C</span> <span class="o">=</span> <span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="p">(</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-2026"></a>          <span class="p">(</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A2</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A3</span><span class="p">))</span>
<a name="ln-2027"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; Dmp:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">AFECTL</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowMin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2028"></a>                                      <span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowMax</span><span class="p">,</span><span class="n">C</span>
<a name="ln-2029"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="nb">ABS</span><span class="p">(</span><span class="n">PDROP</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LTP</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2030"></a><span class="c">!                              Laminar flow.</span>
<a name="ln-2031"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2032"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">C</span><span class="o">*</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamFlow</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2033"></a>        <span class="k">ELSE</span>
<a name="ln-2034"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">C</span><span class="o">*</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LamFlow</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2035"></a>        <span class="k">END IF</span>
<a name="ln-2036"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2037"></a>      <span class="k">ELSE</span>
<a name="ln-2038"></a><span class="c">!                              Turbulent flow.</span>
<a name="ln-2039"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2040"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">C</span><span class="o">*</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TurFlow</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="o">**</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-2041"></a>        <span class="k">ELSE</span>
<a name="ln-2042"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">TurFlow</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">**</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-2043"></a>        <span class="n">ENDIF</span>
<a name="ln-2044"></a>        <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">DisSysCompDamperData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-2045"></a>      <span class="k">END IF</span>
<a name="ln-2046"></a><span class="k">  </span><span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-2047"></a>
<a name="ln-2048"></a>      <span class="k">RETURN</span>
<a name="ln-2049"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEDMP</span>
<a name="ln-2050"></a>
<a name="ln-2051"></a>
<a name="ln-2052"></a>      <span class="k">SUBROUTINE </span><span class="n">AFESEL</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2053"></a>
<a name="ln-2054"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2055"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-2056"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-2057"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-2058"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-2059"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-2060"></a>          <span class="c">!</span>
<a name="ln-2061"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2062"></a>
<a name="ln-2063"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2064"></a>          <span class="c">! This subroutine solves airflow for a Surface effective leakage area component</span>
<a name="ln-2065"></a>
<a name="ln-2066"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2067"></a>          <span class="c">! na</span>
<a name="ln-2068"></a>
<a name="ln-2069"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2070"></a>          <span class="c">! na</span>
<a name="ln-2071"></a>
<a name="ln-2072"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2073"></a>          <span class="c">! na</span>
<a name="ln-2074"></a>
<a name="ln-2075"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2076"></a>
<a name="ln-2077"></a>
<a name="ln-2078"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2079"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-2080"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-2081"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-2082"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-2083"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-2084"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-2085"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-2086"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-2087"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-2088"></a>
<a name="ln-2089"></a>
<a name="ln-2090"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2091"></a>          <span class="c">! na</span>
<a name="ln-2092"></a>
<a name="ln-2093"></a>
<a name="ln-2094"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2095"></a>          <span class="c">! na</span>
<a name="ln-2096"></a>
<a name="ln-2097"></a>
<a name="ln-2098"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2099"></a>          <span class="c">! na</span>
<a name="ln-2100"></a>
<a name="ln-2101"></a>
<a name="ln-2102"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2103"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span>
<a name="ln-2104"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">FlowCoef</span><span class="p">,</span><span class="n">FlowExpo</span>
<a name="ln-2105"></a>         <span class="kt">INTEGER </span><span class="n">CompNum</span>
<a name="ln-2106"></a>
<a name="ln-2107"></a>      <span class="c">! FLOW:</span>
<a name="ln-2108"></a>      <span class="c">! Get component properties</span>
<a name="ln-2109"></a>      <span class="n">CompNum</span>  <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2110"></a>      <span class="n">FlowExpo</span> <span class="o">=</span> <span class="n">MultizoneSurfaceELAData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-2111"></a>      <span class="n">FlowCoef</span> <span class="o">=</span> <span class="n">MultizoneSurfaceELAData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">ELA</span><span class="o">*</span><span class="n">MultizoneSurfaceELAData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5d0</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-2112"></a>                 <span class="n">MultizoneSurfaceELAData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">RefDeltaP</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5d0</span><span class="o">-</span><span class="n">FlowExpo</span><span class="p">)</span>
<a name="ln-2113"></a>
<a name="ln-2114"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2115"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2116"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-2117"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2118"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2119"></a>        <span class="k">ELSE</span>
<a name="ln-2120"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2121"></a>        <span class="k">END IF</span>
<a name="ln-2122"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2123"></a>      <span class="k">ELSE</span>
<a name="ln-2124"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-2125"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2126"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-2127"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-2128"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2129"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2130"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-2131"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">MultizoneSurfaceELAData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2132"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span>
<a name="ln-2133"></a>          <span class="k">ELSE</span>
<a name="ln-2134"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">PDROP</span><span class="o">**</span><span class="n">FlowExpo</span><span class="p">)</span>
<a name="ln-2135"></a>          <span class="k">END IF</span>
<a name="ln-2136"></a><span class="k">        ELSE</span>
<a name="ln-2137"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-2138"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-2139"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2140"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2141"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-2142"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">FlowExpo</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2143"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span>
<a name="ln-2144"></a>          <span class="k">ELSE</span>
<a name="ln-2145"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">**</span><span class="n">FlowExpo</span>
<a name="ln-2146"></a>          <span class="k">END IF</span>
<a name="ln-2147"></a><span class="k">        END IF</span>
<a name="ln-2148"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-2149"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; plr: &#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">FT</span>
<a name="ln-2150"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2151"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2152"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-2153"></a>        <span class="k">ELSE</span>
<a name="ln-2154"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-2155"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span><span class="o">*</span><span class="n">FlowExpo</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-2156"></a>        <span class="k">END IF</span>
<a name="ln-2157"></a><span class="k">      END IF</span>
<a name="ln-2158"></a><span class="c">!</span>
<a name="ln-2159"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-2160"></a>
<a name="ln-2161"></a>      <span class="k">RETURN</span>
<a name="ln-2162"></a><span class="k">      END SUBROUTINE </span><span class="n">AFESEL</span>
<a name="ln-2163"></a>
<a name="ln-2164"></a>
<a name="ln-2165"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEELR</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2166"></a>
<a name="ln-2167"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2168"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-2169"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-2170"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-2171"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-2172"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-2173"></a>          <span class="c">!</span>
<a name="ln-2174"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2175"></a>
<a name="ln-2176"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2177"></a>          <span class="c">! This subroutine solves airflow for a Effective leakage ratio component</span>
<a name="ln-2178"></a>
<a name="ln-2179"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2180"></a>          <span class="c">! na</span>
<a name="ln-2181"></a>
<a name="ln-2182"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2183"></a>          <span class="c">! na</span>
<a name="ln-2184"></a>
<a name="ln-2185"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2186"></a>          <span class="c">! na</span>
<a name="ln-2187"></a>
<a name="ln-2188"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2189"></a>
<a name="ln-2190"></a>
<a name="ln-2191"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2192"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-2193"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-2194"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-2195"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-2196"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-2197"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-2198"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-2199"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-2200"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-2201"></a>
<a name="ln-2202"></a>
<a name="ln-2203"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2204"></a>          <span class="c">! na</span>
<a name="ln-2205"></a>
<a name="ln-2206"></a>
<a name="ln-2207"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2208"></a>          <span class="c">! na</span>
<a name="ln-2209"></a>
<a name="ln-2210"></a>
<a name="ln-2211"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2212"></a>          <span class="c">! na</span>
<a name="ln-2213"></a>
<a name="ln-2214"></a>
<a name="ln-2215"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2216"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span>
<a name="ln-2217"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">FlowCoef</span>
<a name="ln-2218"></a>         <span class="kt">INTEGER </span><span class="n">CompNum</span>
<a name="ln-2219"></a>
<a name="ln-2220"></a>      <span class="c">! FLOW:</span>
<a name="ln-2221"></a>      <span class="c">! Get component properties</span>
<a name="ln-2222"></a>      <span class="n">CompNum</span>  <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2223"></a>      <span class="n">FlowCoef</span> <span class="o">=</span> <span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">ELR</span><span class="o">*</span><span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowRate</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-2224"></a>                 <span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">RefPres</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span><span class="p">)</span>
<a name="ln-2225"></a>
<a name="ln-2226"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2227"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2228"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-2229"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2230"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2231"></a>        <span class="k">ELSE</span>
<a name="ln-2232"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2233"></a>        <span class="k">END IF</span>
<a name="ln-2234"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2235"></a>      <span class="k">ELSE</span>
<a name="ln-2236"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-2237"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2238"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-2239"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-2240"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2241"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2242"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-2243"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2244"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span>
<a name="ln-2245"></a>          <span class="k">ELSE</span>
<a name="ln-2246"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">PDROP</span><span class="o">**</span><span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span><span class="p">)</span>
<a name="ln-2247"></a>          <span class="k">END IF</span>
<a name="ln-2248"></a><span class="k">        ELSE</span>
<a name="ln-2249"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-2250"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-2251"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">FlowCoef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2252"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2253"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-2254"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2255"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span>
<a name="ln-2256"></a>          <span class="k">ELSE</span>
<a name="ln-2257"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FlowCoef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">**</span><span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-2258"></a>          <span class="k">END IF</span>
<a name="ln-2259"></a><span class="k">        END IF</span>
<a name="ln-2260"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-2261"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; plr: &#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">FT</span>
<a name="ln-2262"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2263"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2264"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-2265"></a>        <span class="k">ELSE</span>
<a name="ln-2266"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-2267"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span><span class="o">*</span><span class="n">DisSysCompELRData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-2268"></a>        <span class="k">END IF</span>
<a name="ln-2269"></a><span class="k">      END IF</span>
<a name="ln-2270"></a><span class="c">!</span>
<a name="ln-2271"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-2272"></a>
<a name="ln-2273"></a>      <span class="k">RETURN</span>
<a name="ln-2274"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEELR</span>
<a name="ln-2275"></a>
<a name="ln-2276"></a>
<a name="ln-2277"></a>      <span class="k">SUBROUTINE </span><span class="n">AFECPD</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2278"></a>
<a name="ln-2279"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2280"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-2281"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-2282"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-2283"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-2284"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-2285"></a>          <span class="c">!</span>
<a name="ln-2286"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2287"></a>
<a name="ln-2288"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2289"></a>          <span class="c">! This subroutine solves airflow for a Constant pressure drop component</span>
<a name="ln-2290"></a>
<a name="ln-2291"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2292"></a>          <span class="c">! na</span>
<a name="ln-2293"></a>
<a name="ln-2294"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2295"></a>          <span class="c">! na</span>
<a name="ln-2296"></a>
<a name="ln-2297"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2298"></a>          <span class="c">! na</span>
<a name="ln-2299"></a>
<a name="ln-2300"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2301"></a>
<a name="ln-2302"></a>
<a name="ln-2303"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2304"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-2305"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-2306"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-2307"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-2308"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-2309"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-2310"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-2311"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-2312"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-2313"></a>
<a name="ln-2314"></a>
<a name="ln-2315"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2316"></a>          <span class="c">! na</span>
<a name="ln-2317"></a>
<a name="ln-2318"></a>
<a name="ln-2319"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2320"></a>          <span class="c">! na</span>
<a name="ln-2321"></a>
<a name="ln-2322"></a>
<a name="ln-2323"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2324"></a>          <span class="c">! na</span>
<a name="ln-2325"></a>
<a name="ln-2326"></a>
<a name="ln-2327"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2328"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">Co</span>
<a name="ln-2329"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span><span class="p">,</span><span class="n">K</span>
<a name="ln-2330"></a>
<a name="ln-2331"></a>      <span class="c">! FLOW:</span>
<a name="ln-2332"></a>      <span class="c">! Get component properties</span>
<a name="ln-2333"></a>      <span class="c">! A  = Cross section area [m2]</span>
<a name="ln-2334"></a>      <span class="c">! DP = Pressure difference across the element [Pa]</span>
<a name="ln-2335"></a>      <span class="n">CompNum</span>  <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2336"></a>
<a name="ln-2337"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2338"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">PDROP</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2339"></a><span class="k">         </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">DisSysCompCPDData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">DisSysCompCPDData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DP</span><span class="o">**</span><span class="mf">0.5d0</span>
<a name="ln-2340"></a>         <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">DisSysCompCPDData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DP</span>
<a name="ln-2341"></a>      <span class="k">else</span>
<a name="ln-2342"></a><span class="k">         DO </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NetworkNumOfLinks</span>
<a name="ln-2343"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">k</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="n">N</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2344"></a><span class="k">               </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">AFLOW</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-2345"></a>               <span class="k">Exit</span>
<a name="ln-2346"></a><span class="k">            end if</span>
<a name="ln-2347"></a><span class="k">         end do</span>
<a name="ln-2348"></a><span class="k">         </span><span class="n">PDROP</span> <span class="o">=</span> <span class="n">DisSysCompCPDData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DP</span>
<a name="ln-2349"></a>         <span class="n">PZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">=</span> <span class="n">PZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span><span class="n">PDROP</span>
<a name="ln-2350"></a>         <span class="n">Co</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">DisSysCompCPDData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DP</span>
<a name="ln-2351"></a>         <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.d10</span>
<a name="ln-2352"></a>      <span class="k">end if</span>
<a name="ln-2353"></a>
<a name="ln-2354"></a><span class="k">      RETURN</span>
<a name="ln-2355"></a><span class="k">      END SUBROUTINE </span><span class="n">AFECPD</span>
<a name="ln-2356"></a>
<a name="ln-2357"></a>      <span class="k">SUBROUTINE </span><span class="n">AFECOI</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2358"></a>
<a name="ln-2359"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2360"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-2361"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-2362"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-2363"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-2364"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-2365"></a>          <span class="c">!</span>
<a name="ln-2366"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2367"></a>
<a name="ln-2368"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2369"></a>          <span class="c">! This subroutine solves airflow for a coil component</span>
<a name="ln-2370"></a>
<a name="ln-2371"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2372"></a>          <span class="c">! na</span>
<a name="ln-2373"></a>
<a name="ln-2374"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2375"></a>          <span class="c">! na</span>
<a name="ln-2376"></a>
<a name="ln-2377"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2378"></a>          <span class="c">! na</span>
<a name="ln-2379"></a>
<a name="ln-2380"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2381"></a>
<a name="ln-2382"></a>
<a name="ln-2383"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2384"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-2385"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-2386"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-2387"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-2388"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-2389"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-2390"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-2391"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-2392"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-2393"></a>
<a name="ln-2394"></a>
<a name="ln-2395"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2396"></a>          <span class="c">! na</span>
<a name="ln-2397"></a>
<a name="ln-2398"></a>
<a name="ln-2399"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2400"></a>          <span class="c">! na</span>
<a name="ln-2401"></a>
<a name="ln-2402"></a>
<a name="ln-2403"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2404"></a>          <span class="c">! na</span>
<a name="ln-2405"></a>
<a name="ln-2406"></a>
<a name="ln-2407"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2408"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">A0</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">EPS</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">FTT</span><span class="p">,</span> <span class="n">RE</span>
<a name="ln-2409"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-2410"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">ed</span><span class="p">,</span> <span class="n">ld</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">AA1</span><span class="p">,</span> <span class="n">rough</span><span class="p">,</span><span class="n">area</span><span class="p">,</span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">LamDynCoef</span><span class="p">,</span><span class="n">LamFriCoef</span><span class="p">,</span><span class="n">TurDynCoef</span>
<a name="ln-2411"></a>
<a name="ln-2412"></a>      <span class="k">DATA </span><span class="n">C</span><span class="p">,</span><span class="n">EPS</span> <span class="o">/</span> <span class="mf">0.868589d0</span><span class="p">,</span> <span class="mf">0.001d0</span> <span class="o">/</span>
<a name="ln-2413"></a>      <span class="k">DATA </span><span class="n">rough</span><span class="o">/</span><span class="mf">0.0001d0</span><span class="o">/</span>
<a name="ln-2414"></a>      <span class="k">DATA </span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">LamDynCoef</span><span class="p">,</span><span class="n">LamFriCoef</span><span class="p">,</span><span class="n">TurDynCoef</span><span class="o">/</span><span class="mi">12</span><span class="mf">8.0d0</span><span class="p">,</span><span class="mi">6</span><span class="mf">4.0d0</span><span class="p">,</span><span class="mf">0.0001d0</span><span class="p">,</span><span class="mf">0.0001d0</span><span class="o">/</span>
<a name="ln-2415"></a>
<a name="ln-2416"></a>      <span class="c">! FLOW:</span>
<a name="ln-2417"></a>      <span class="c">! Get component properties</span>
<a name="ln-2418"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2419"></a>      <span class="n">ed</span> <span class="o">=</span> <span class="n">Rough</span><span class="o">/</span><span class="n">DisSysCompDuctData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-2420"></a>      <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span>
<a name="ln-2421"></a>      <span class="n">ld</span> <span class="o">=</span> <span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">L</span><span class="o">/</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-2422"></a>      <span class="n">g</span>  <span class="o">=</span> <span class="mf">1.14d0</span> <span class="o">-</span> <span class="mf">0.868589d0</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
<a name="ln-2423"></a>      <span class="n">AA1</span> <span class="o">=</span> <span class="n">g</span>
<a name="ln-2424"></a>
<a name="ln-2425"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2426"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2427"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-2428"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2429"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2430"></a>        <span class="k">ELSE</span>
<a name="ln-2431"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2432"></a>        <span class="k">END IF</span>
<a name="ln-2433"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2434"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwi:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2435"></a>      <span class="k">ELSE</span>
<a name="ln-2436"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-2437"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2438"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-2439"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-2440"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2441"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2442"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2443"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="o">-</span><span class="n">PDROP</span>
<a name="ln-2444"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-2445"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-2446"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-2447"></a>          <span class="k">ELSE</span>
<a name="ln-2448"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2449"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2450"></a>          <span class="k">END IF</span>
<a name="ln-2451"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2452"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwl:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">CDM</span><span class="p">,</span><span class="n">RE</span>
<a name="ln-2453"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-2454"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2455"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span>
<a name="ln-2456"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2457"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2458"></a>            <span class="k">DO</span>
<a name="ln-2459"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2460"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-2461"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-2462"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2463"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2464"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2465"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-2466"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-2467"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2468"></a>          <span class="k">ELSE</span>
<a name="ln-2469"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2470"></a>          <span class="k">END IF</span>
<a name="ln-2471"></a><span class="k">        ELSE</span>
<a name="ln-2472"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-2473"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-2474"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2475"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2476"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2477"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="n">PDROP</span>
<a name="ln-2478"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-2479"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-2480"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-2481"></a>          <span class="k">ELSE</span>
<a name="ln-2482"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2483"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2484"></a>          <span class="k">END IF</span>
<a name="ln-2485"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="o">-</span><span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompCoilData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2486"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwl:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">CDM</span><span class="p">,</span><span class="n">RE</span>
<a name="ln-2487"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-2488"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2489"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span>
<a name="ln-2490"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2491"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2492"></a>            <span class="k">DO</span>
<a name="ln-2493"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2494"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-2495"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-2496"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2497"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2498"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2499"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-2500"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-2501"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FTT</span>
<a name="ln-2502"></a>          <span class="k">ELSE</span>
<a name="ln-2503"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2504"></a>          <span class="k">END IF</span>
<a name="ln-2505"></a><span class="k">        END IF</span>
<a name="ln-2506"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-2507"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2508"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2509"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-2510"></a>        <span class="k">ELSE</span>
<a name="ln-2511"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-2512"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">FT</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-2513"></a>        <span class="k">END IF</span>
<a name="ln-2514"></a><span class="k">      END IF</span>
<a name="ln-2515"></a><span class="c">!</span>
<a name="ln-2516"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-2517"></a>
<a name="ln-2518"></a>      <span class="k">RETURN</span>
<a name="ln-2519"></a><span class="k">      END SUBROUTINE </span><span class="n">AFECOI</span>
<a name="ln-2520"></a>
<a name="ln-2521"></a>      <span class="k">SUBROUTINE </span><span class="n">AFETMU</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2522"></a>
<a name="ln-2523"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2524"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-2525"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-2526"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-2527"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-2528"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-2529"></a>          <span class="c">!</span>
<a name="ln-2530"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2531"></a>
<a name="ln-2532"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2533"></a>          <span class="c">! This subroutine solves airflow for a terminal unit component</span>
<a name="ln-2534"></a>
<a name="ln-2535"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2536"></a>          <span class="c">! na</span>
<a name="ln-2537"></a>
<a name="ln-2538"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2539"></a>          <span class="c">! na</span>
<a name="ln-2540"></a>
<a name="ln-2541"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2542"></a>          <span class="k">USE </span><span class="n">DataLoopNode</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">Node</span>
<a name="ln-2543"></a>
<a name="ln-2544"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2545"></a>
<a name="ln-2546"></a>
<a name="ln-2547"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2548"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-2549"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-2550"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-2551"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-2552"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-2553"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-2554"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-2555"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-2556"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-2557"></a>
<a name="ln-2558"></a>
<a name="ln-2559"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2560"></a>          <span class="c">! na</span>
<a name="ln-2561"></a>
<a name="ln-2562"></a>
<a name="ln-2563"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2564"></a>          <span class="c">! na</span>
<a name="ln-2565"></a>
<a name="ln-2566"></a>
<a name="ln-2567"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2568"></a>          <span class="c">! na</span>
<a name="ln-2569"></a>
<a name="ln-2570"></a>
<a name="ln-2571"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2572"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">A0</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">EPS</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">FTT</span><span class="p">,</span> <span class="n">RE</span>
<a name="ln-2573"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-2574"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">ed</span><span class="p">,</span> <span class="n">ld</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">AA1</span><span class="p">,</span> <span class="n">rough</span><span class="p">,</span><span class="n">Area</span><span class="p">,</span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">LamDynCoef</span><span class="p">,</span><span class="n">LamFriCoef</span><span class="p">,</span><span class="n">TurDynCoef</span>
<a name="ln-2575"></a>
<a name="ln-2576"></a>      <span class="k">DATA </span><span class="n">C</span><span class="p">,</span><span class="n">EPS</span> <span class="o">/</span> <span class="mf">0.868589d0</span><span class="p">,</span> <span class="mf">0.001d0</span> <span class="o">/</span>
<a name="ln-2577"></a>      <span class="k">DATA </span><span class="n">rough</span><span class="o">/</span><span class="mf">0.0001d0</span><span class="o">/</span>
<a name="ln-2578"></a>      <span class="k">DATA </span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">LamDynCoef</span><span class="p">,</span><span class="n">LamFriCoef</span><span class="p">,</span><span class="n">TurDynCoef</span><span class="o">/</span><span class="mi">12</span><span class="mf">8.0d0</span><span class="p">,</span><span class="mi">6</span><span class="mf">4.0d0</span><span class="p">,</span><span class="mf">0.0001d0</span><span class="p">,</span><span class="mf">0.0001d0</span><span class="o">/</span>
<a name="ln-2579"></a>
<a name="ln-2580"></a>      <span class="c">! FLOW:</span>
<a name="ln-2581"></a>      <span class="c">! Get component properties</span>
<a name="ln-2582"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2583"></a>      <span class="n">ed</span> <span class="o">=</span> <span class="n">Rough</span><span class="o">/</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-2584"></a>      <span class="n">Area</span> <span class="o">=</span> <span class="p">(</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span>
<a name="ln-2585"></a>      <span class="n">ld</span> <span class="o">=</span> <span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">L</span><span class="o">/</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-2586"></a>      <span class="n">g</span>  <span class="o">=</span> <span class="mf">1.14d0</span> <span class="o">-</span> <span class="mf">0.868589d0</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
<a name="ln-2587"></a>      <span class="n">AA1</span> <span class="o">=</span> <span class="n">g</span>
<a name="ln-2588"></a>
<a name="ln-2589"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2590"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2591"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-2592"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2593"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2594"></a>        <span class="k">ELSE</span>
<a name="ln-2595"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2596"></a>        <span class="k">END IF</span>
<a name="ln-2597"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2598"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwi:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2599"></a>      <span class="k">ELSE</span>
<a name="ln-2600"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-2601"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2602"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-2603"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-2604"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2605"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2606"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2607"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="o">-</span><span class="n">PDROP</span>
<a name="ln-2608"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-2609"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-2610"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-2611"></a>          <span class="k">ELSE</span>
<a name="ln-2612"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2613"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2614"></a>          <span class="k">END IF</span>
<a name="ln-2615"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2616"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwl:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">CDM</span><span class="p">,</span><span class="n">RE</span>
<a name="ln-2617"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-2618"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2619"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span>
<a name="ln-2620"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2621"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2622"></a>            <span class="k">DO</span>
<a name="ln-2623"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2624"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-2625"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-2626"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2627"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2628"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2629"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-2630"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-2631"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2632"></a>          <span class="k">ELSE</span>
<a name="ln-2633"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2634"></a>          <span class="k">END IF</span>
<a name="ln-2635"></a><span class="k">        ELSE</span>
<a name="ln-2636"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-2637"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-2638"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2639"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2640"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2641"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="n">PDROP</span>
<a name="ln-2642"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-2643"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-2644"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-2645"></a>          <span class="k">ELSE</span>
<a name="ln-2646"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2647"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2648"></a>          <span class="k">END IF</span>
<a name="ln-2649"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="o">-</span><span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2650"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwl:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">CDM</span><span class="p">,</span><span class="n">RE</span>
<a name="ln-2651"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-2652"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2653"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span>
<a name="ln-2654"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2655"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2656"></a>            <span class="k">DO</span>
<a name="ln-2657"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2658"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-2659"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-2660"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2661"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2662"></a>              <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; dwt:&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">FTT</span><span class="p">,</span><span class="n">g</span>
<a name="ln-2663"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-2664"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-2665"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FTT</span>
<a name="ln-2666"></a>          <span class="k">ELSE</span>
<a name="ln-2667"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2668"></a>          <span class="k">END IF</span>
<a name="ln-2669"></a><span class="k">        END IF</span>
<a name="ln-2670"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-2671"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2672"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2673"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-2674"></a>        <span class="k">ELSE</span>
<a name="ln-2675"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-2676"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">FT</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-2677"></a>        <span class="k">END IF</span>
<a name="ln-2678"></a><span class="k">      END IF</span>
<a name="ln-2679"></a>      <span class="c">! If damper, setup the airflows from nodal values calculated from teminal</span>
<a name="ln-2680"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">VAVTermDamper</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-2681"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">DisSysCompTermUnitData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DamperInletNode</span><span class="p">)%</span><span class="n">MassFlowrate</span>
<a name="ln-2682"></a>        <span class="k">If</span> <span class="p">(</span><span class="n">VAVTerminalRatio</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mf">0.d0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-2683"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">VAVTerminalRatio</span>
<a name="ln-2684"></a>        <span class="k">End If</span>
<a name="ln-2685"></a><span class="k">        </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2686"></a>      <span class="k">End IF</span>
<a name="ln-2687"></a>
<a name="ln-2688"></a><span class="c">!</span>
<a name="ln-2689"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-2690"></a>
<a name="ln-2691"></a>      <span class="k">RETURN</span>
<a name="ln-2692"></a><span class="k">      END SUBROUTINE </span><span class="n">AFETMU</span>
<a name="ln-2693"></a>
<a name="ln-2694"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEEXF</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2695"></a><span class="c">!</span>
<a name="ln-2696"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2697"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-2698"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-2699"></a>          <span class="c">!       MODIFIED       Lixing Gu, 12/17/06</span>
<a name="ln-2700"></a>          <span class="c">!                      Revised for zone exhaust fan</span>
<a name="ln-2701"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2702"></a>
<a name="ln-2703"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2704"></a>          <span class="c">! This subroutine solves airflow for a surface crack component</span>
<a name="ln-2705"></a>
<a name="ln-2706"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2707"></a>          <span class="c">! na</span>
<a name="ln-2708"></a>
<a name="ln-2709"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2710"></a>          <span class="c">! na</span>
<a name="ln-2711"></a>
<a name="ln-2712"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2713"></a>          <span class="k">USE </span><span class="n">DataLoopNode</span><span class="p">,</span>    <span class="n">ONLY</span><span class="p">:</span> <span class="n">Node</span>
<a name="ln-2714"></a>          <span class="k">USE </span><span class="n">DataHVACGlobals</span><span class="p">,</span> <span class="n">ONLY</span><span class="p">:</span> <span class="n">VerySmallMassFlow</span>
<a name="ln-2715"></a>
<a name="ln-2716"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2717"></a>
<a name="ln-2718"></a>
<a name="ln-2719"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2720"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-2721"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-2722"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-2723"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-2724"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-2725"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-2726"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-2727"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-2728"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-2729"></a>
<a name="ln-2730"></a>
<a name="ln-2731"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2732"></a>          <span class="c">! na</span>
<a name="ln-2733"></a>
<a name="ln-2734"></a>
<a name="ln-2735"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2736"></a>          <span class="c">! na</span>
<a name="ln-2737"></a>
<a name="ln-2738"></a>
<a name="ln-2739"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2740"></a>          <span class="c">! na</span>
<a name="ln-2741"></a>
<a name="ln-2742"></a>
<a name="ln-2743"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2744"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span>
<a name="ln-2745"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">RhozNorm</span><span class="p">,</span> <span class="n">VisczNorm</span><span class="p">,</span> <span class="n">expn</span><span class="p">,</span> <span class="n">Ctl</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">Corr</span><span class="p">,</span> <span class="n">VisAve</span><span class="p">,</span> <span class="n">Tave</span><span class="p">,</span> <span class="n">RhoCor</span>
<a name="ln-2746"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span><span class="p">,</span><span class="n">InletNode</span>
<a name="ln-2747"></a>
<a name="ln-2748"></a>    <span class="c">! FLOW:</span>
<a name="ln-2749"></a>    <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2750"></a>    <span class="n">InletNode</span> <span class="o">=</span> <span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">InletNode</span>
<a name="ln-2751"></a>    <span class="k">If</span> <span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">InletNode</span><span class="p">)%</span><span class="n">MassFlowRate</span> <span class="o">&gt;</span> <span class="n">VerySmallMassFlow</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2752"></a>      <span class="c">! Treat the component as an exhaust fan</span>
<a name="ln-2753"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2754"></a>      <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">InletNode</span><span class="p">)%</span><span class="n">MassFlowRate</span>
<a name="ln-2755"></a>      <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-2756"></a>      <span class="k">RETURN</span>
<a name="ln-2757"></a><span class="k">    Else</span>
<a name="ln-2758"></a>      <span class="c">! Treat the component as a surface crack</span>
<a name="ln-2759"></a>      <span class="c">! Crack standard condition from given inputs</span>
<a name="ln-2760"></a>      <span class="n">Corr</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Factor</span>
<a name="ln-2761"></a>      <span class="n">RhozNorm</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardP</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2762"></a>                 <span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardT</span><span class="p">,</span><span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardW</span><span class="p">)</span>
<a name="ln-2763"></a>      <span class="n">VisczNorm</span> <span class="o">=</span> <span class="mf">1.71432d-5</span><span class="o">+</span><span class="mf">4.828d-8</span><span class="o">*</span><span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">StandardT</span>
<a name="ln-2764"></a>
<a name="ln-2765"></a>      <span class="n">expn</span> <span class="o">=</span> <span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-2766"></a>      <span class="n">VisAve</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-2767"></a>      <span class="n">Tave</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-2768"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2769"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Corr</span>
<a name="ln-2770"></a>      <span class="k">ELSE</span>
<a name="ln-2771"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">MultizoneCompExhaustFanData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Corr</span>
<a name="ln-2772"></a>      <span class="k">END IF</span>
<a name="ln-2773"></a>
<a name="ln-2774"></a><span class="k">      </span><span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2775"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2776"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-2777"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2778"></a><span class="k">          </span><span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-2779"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-2780"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2781"></a>        <span class="k">ELSE</span>
<a name="ln-2782"></a><span class="k">          </span><span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-2783"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-2784"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2785"></a>        <span class="k">END IF</span>
<a name="ln-2786"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2787"></a>      <span class="k">ELSE</span>
<a name="ln-2788"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-2789"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2790"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-2791"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-2792"></a>          <span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-2793"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-2794"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2795"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2796"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-2797"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2798"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2799"></a>          <span class="k">ELSE</span>
<a name="ln-2800"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">PDROP</span><span class="o">**</span><span class="n">expn</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2801"></a>          <span class="k">END IF</span>
<a name="ln-2802"></a><span class="k">        ELSE</span>
<a name="ln-2803"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-2804"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-2805"></a>          <span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-2806"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-2807"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2808"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2809"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-2810"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2811"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2812"></a>          <span class="k">ELSE</span>
<a name="ln-2813"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">**</span><span class="n">expn</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-2814"></a>          <span class="k">END IF</span>
<a name="ln-2815"></a><span class="k">        END IF</span>
<a name="ln-2816"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-2817"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; scr: &#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">FT</span>
<a name="ln-2818"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2819"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2820"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-2821"></a>        <span class="k">ELSE</span>
<a name="ln-2822"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-2823"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-2824"></a>        <span class="k">END IF</span>
<a name="ln-2825"></a><span class="k">      END IF</span>
<a name="ln-2826"></a><span class="k">    End If</span>
<a name="ln-2827"></a><span class="c">!</span>
<a name="ln-2828"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-2829"></a>      <span class="k">RETURN</span>
<a name="ln-2830"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEEXF</span>
<a name="ln-2831"></a>
<a name="ln-2832"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEHEX</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2833"></a>
<a name="ln-2834"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2835"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-2836"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-2837"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-2838"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-2839"></a>          <span class="c">!       MODIFIED       Lixing Gu, 1/18/09</span>
<a name="ln-2840"></a>          <span class="c">!</span>
<a name="ln-2841"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2842"></a>
<a name="ln-2843"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2844"></a>          <span class="c">! This subroutine solves airflow for a heat exchanger component</span>
<a name="ln-2845"></a>
<a name="ln-2846"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-2847"></a>          <span class="c">! na</span>
<a name="ln-2848"></a>
<a name="ln-2849"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-2850"></a>          <span class="c">! na</span>
<a name="ln-2851"></a>
<a name="ln-2852"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-2853"></a>          <span class="c">! na</span>
<a name="ln-2854"></a>
<a name="ln-2855"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-2856"></a>
<a name="ln-2857"></a>
<a name="ln-2858"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-2859"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-2860"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-2861"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-2862"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-2863"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-2864"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-2865"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-2866"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-2867"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-2868"></a>
<a name="ln-2869"></a>
<a name="ln-2870"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-2871"></a>          <span class="c">! na</span>
<a name="ln-2872"></a>
<a name="ln-2873"></a>
<a name="ln-2874"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-2875"></a>          <span class="c">! na</span>
<a name="ln-2876"></a>
<a name="ln-2877"></a>
<a name="ln-2878"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-2879"></a>          <span class="c">! na</span>
<a name="ln-2880"></a>
<a name="ln-2881"></a>
<a name="ln-2882"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-2883"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">A0</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">EPS</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span><span class="p">,</span> <span class="n">FTT</span><span class="p">,</span> <span class="n">RE</span>
<a name="ln-2884"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-2885"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">ed</span><span class="p">,</span> <span class="n">ld</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">AA1</span><span class="p">,</span> <span class="n">rough</span><span class="p">,</span><span class="n">area</span><span class="p">,</span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">LamDynCoef</span><span class="p">,</span><span class="n">LamFriCoef</span><span class="p">,</span><span class="n">TurDynCoef</span>
<a name="ln-2886"></a>
<a name="ln-2887"></a>      <span class="k">DATA </span><span class="n">C</span><span class="p">,</span><span class="n">EPS</span> <span class="o">/</span> <span class="mf">0.868589d0</span><span class="p">,</span> <span class="mf">0.001d0</span> <span class="o">/</span>
<a name="ln-2888"></a>      <span class="k">DATA </span><span class="n">rough</span><span class="o">/</span><span class="mf">0.0001d0</span><span class="o">/</span>
<a name="ln-2889"></a>      <span class="k">DATA </span><span class="n">InitLamCoef</span><span class="p">,</span><span class="n">LamDynCoef</span><span class="p">,</span><span class="n">LamFriCoef</span><span class="p">,</span><span class="n">TurDynCoef</span><span class="o">/</span><span class="mi">12</span><span class="mf">8.0d0</span><span class="p">,</span><span class="mi">6</span><span class="mf">4.0d0</span><span class="p">,</span><span class="mf">0.0001d0</span><span class="p">,</span><span class="mf">0.0001d0</span><span class="o">/</span>
<a name="ln-2890"></a>
<a name="ln-2891"></a>      <span class="c">! FLOW:</span>
<a name="ln-2892"></a>      <span class="c">! Get component properties</span>
<a name="ln-2893"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-2894"></a>      <span class="n">ed</span> <span class="o">=</span> <span class="n">Rough</span><span class="o">/</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-2895"></a>      <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span>
<a name="ln-2896"></a>      <span class="n">ld</span> <span class="o">=</span> <span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">L</span><span class="o">/</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-2897"></a>      <span class="n">g</span>  <span class="o">=</span> <span class="mf">1.14d0</span> <span class="o">-</span> <span class="mf">0.868589d0</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
<a name="ln-2898"></a>      <span class="n">AA1</span> <span class="o">=</span> <span class="n">g</span>
<a name="ln-2899"></a>
<a name="ln-2900"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2901"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2902"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-2903"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2904"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2905"></a>        <span class="k">ELSE</span>
<a name="ln-2906"></a><span class="k">          </span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">InitLamCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2907"></a>        <span class="k">END IF</span>
<a name="ln-2908"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2909"></a>      <span class="k">ELSE</span>
<a name="ln-2910"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-2911"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2912"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-2913"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-2914"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2915"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2916"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2917"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="o">-</span><span class="n">PDROP</span>
<a name="ln-2918"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-2919"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-2920"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-2921"></a>          <span class="k">ELSE</span>
<a name="ln-2922"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2923"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2924"></a>          <span class="k">END IF</span>
<a name="ln-2925"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2926"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-2927"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2928"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span>
<a name="ln-2929"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2930"></a>            <span class="k">DO</span>
<a name="ln-2931"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2932"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-2933"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-2934"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2935"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2936"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-2937"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-2938"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2939"></a>          <span class="k">ELSE</span>
<a name="ln-2940"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2941"></a>          <span class="k">END IF</span>
<a name="ln-2942"></a><span class="k">        ELSE</span>
<a name="ln-2943"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-2944"></a>          <span class="c">! Laminar flow coefficient !=0</span>
<a name="ln-2945"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LamFriCoef</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.001d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2946"></a><span class="k">            </span><span class="n">A2</span> <span class="o">=</span> <span class="n">LamFriCoef</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2947"></a>            <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2948"></a>            <span class="n">A0</span> <span class="o">=</span> <span class="n">PDROP</span>
<a name="ln-2949"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">A1</span><span class="o">-</span><span class="mf">4.d0</span><span class="o">*</span><span class="n">A2</span><span class="o">*</span><span class="n">A0</span><span class="p">)</span>
<a name="ln-2950"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">CDM</span><span class="o">-</span><span class="n">A1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">A2</span><span class="p">)</span>
<a name="ln-2951"></a>            <span class="n">CDM</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">CDM</span>
<a name="ln-2952"></a>          <span class="k">ELSE</span>
<a name="ln-2953"></a><span class="k">            </span><span class="n">CDM</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">LamDynCoef</span><span class="o">*</span><span class="n">ld</span><span class="p">)</span>
<a name="ln-2954"></a>            <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-2955"></a>          <span class="k">END IF</span>
<a name="ln-2956"></a><span class="k">          </span><span class="n">RE</span> <span class="o">=</span> <span class="o">-</span><span class="n">FL</span><span class="o">*</span><span class="n">DisSysCompHXData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span>
<a name="ln-2957"></a>          <span class="c">! Turbulent flow; test when Re&gt;10.</span>
<a name="ln-2958"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">RE</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="mf">0.d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2959"></a><span class="k">            </span><span class="n">S2</span> <span class="o">=</span> <span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span>
<a name="ln-2960"></a>            <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2961"></a>            <span class="k">DO</span>
<a name="ln-2962"></a><span class="k">              </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FTT</span>
<a name="ln-2963"></a>              <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.3d0</span><span class="o">*</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">FT</span><span class="o">*</span><span class="n">Rough</span><span class="p">)</span>
<a name="ln-2964"></a>              <span class="n">D</span> <span class="o">=</span> <span class="mf">1.0d0</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">B</span>
<a name="ln-2965"></a>              <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">AA1</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="nb">LOG</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="n">C</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">D</span><span class="p">)</span>
<a name="ln-2966"></a>              <span class="n">FTT</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">/</span> <span class="nb">SQRT</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="n">g</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">TurDynCoef</span><span class="p">)</span>
<a name="ln-2967"></a>              <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FTT</span><span class="o">-</span><span class="n">FT</span><span class="p">)</span><span class="o">/</span><span class="n">FTT</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="n">EPS</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-2968"></a><span class="k">            </span><span class="n">ENDDO</span>
<a name="ln-2969"></a>            <span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">FTT</span>
<a name="ln-2970"></a>          <span class="k">ELSE</span>
<a name="ln-2971"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2972"></a>          <span class="k">END IF</span>
<a name="ln-2973"></a><span class="k">        END IF</span>
<a name="ln-2974"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-2975"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2976"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-2977"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-2978"></a>        <span class="k">ELSE</span>
<a name="ln-2979"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-2980"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5d0</span><span class="o">*</span><span class="n">FT</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-2981"></a>        <span class="k">END IF</span>
<a name="ln-2982"></a><span class="k">      END IF</span>
<a name="ln-2983"></a>
<a name="ln-2984"></a><span class="k">      RETURN</span>
<a name="ln-2985"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEHEX</span>
<a name="ln-2986"></a>
<a name="ln-2987"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEHOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-2988"></a><span class="c">!</span>
<a name="ln-2989"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-2990"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-2991"></a>          <span class="c">!       DATE WRITTEN   Apr. 2009</span>
<a name="ln-2992"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2993"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-2994"></a>          <span class="c">!</span>
<a name="ln-2995"></a>          <span class="c">!       RE-ENGINEERED  na</span>
<a name="ln-2996"></a>
<a name="ln-2997"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-2998"></a>          <span class="c">! This subroutine solves airflow for a horizontal opening component. The subroutine was</span>
<a name="ln-2999"></a>          <span class="c">! developed based on the subroutine AFEPLR of AIRNET.</span>
<a name="ln-3000"></a>
<a name="ln-3001"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3002"></a>          <span class="c">! Combine forced and buyancy airflows together with a cap</span>
<a name="ln-3003"></a>
<a name="ln-3004"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3005"></a>          <span class="c">! Cooper, L., 1989, &quot;Calculation of the Flow Through a Horizontal Ceiling/Floor Vent,&quot;</span>
<a name="ln-3006"></a>          <span class="c">! NISTIR 89-4052, National Institute of Standards and Technology, Gaithersburg, MD</span>
<a name="ln-3007"></a>
<a name="ln-3008"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3009"></a>          <span class="c">! na</span>
<a name="ln-3010"></a>
<a name="ln-3011"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3012"></a>
<a name="ln-3013"></a>
<a name="ln-3014"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3015"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-3016"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-3017"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-3018"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">I</span>     <span class="c">! Linkage number</span>
<a name="ln-3019"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-3020"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-3021"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-3022"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-3023"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-3024"></a>
<a name="ln-3025"></a>
<a name="ln-3026"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3027"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265358979323846d0</span>
<a name="ln-3028"></a>
<a name="ln-3029"></a>
<a name="ln-3030"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3031"></a>          <span class="c">! na</span>
<a name="ln-3032"></a>
<a name="ln-3033"></a>
<a name="ln-3034"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3035"></a>          <span class="c">! na</span>
<a name="ln-3036"></a>
<a name="ln-3037"></a>
<a name="ln-3038"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3039"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">RhozAver</span><span class="p">,</span> <span class="n">expn</span><span class="p">,</span> <span class="n">coef</span>
<a name="ln-3040"></a>         <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-3041"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">Width</span>            <span class="c">! Opening width</span>
<a name="ln-3042"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">Height</span>           <span class="c">! Opening height</span>
<a name="ln-3043"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">Fact</span>             <span class="c">! Opening factor</span>
<a name="ln-3044"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">Slope</span>            <span class="c">! Opening slope</span>
<a name="ln-3045"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">DischCoeff</span>       <span class="c">! Discharge coefficient</span>
<a name="ln-3046"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">fma12</span>            <span class="c">! massflow in direction &quot;from-to&quot; [kg/s]</span>
<a name="ln-3047"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">fma21</span>            <span class="c">! massflow in direction &quot;to-from&quot; [kg/s]</span>
<a name="ln-3048"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">dp1fma12</span>         <span class="c">! derivative d fma12 / d Dp [kg/s/Pa]</span>
<a name="ln-3049"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">dp1fma21</span>         <span class="c">! derivative d fma21 / d Dp [kg/s/Pa]</span>
<a name="ln-3050"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">PurgedP</span>          <span class="c">! Purge pressure [Pa]</span>
<a name="ln-3051"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">BuoFlow</span>          <span class="c">! Buoyancy flow rate [Pa]</span>
<a name="ln-3052"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">BuoFlowMax</span>       <span class="c">! Maximum buoyancy flow rate [Pa]</span>
<a name="ln-3053"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">dPBuoFlow</span>        <span class="c">! Derivative of buoyancy flow rate [kg/s/Pa]</span>
<a name="ln-3054"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">DH</span>               <span class="c">! Hydraulic diameter [m]</span>
<a name="ln-3055"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">Cshape</span>           <span class="c">! Shape factor [dimensionless]</span>
<a name="ln-3056"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">OpenArea</span>         <span class="c">! Opening area [m2]</span>
<a name="ln-3057"></a>
<a name="ln-3058"></a>
<a name="ln-3059"></a>      <span class="c">! FLOW:</span>
<a name="ln-3060"></a>      <span class="c">! Get information on the horizontal opening</span>
<a name="ln-3061"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-3062"></a>      <span class="n">RhozAver</span> <span class="o">=</span> <span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-3063"></a>      <span class="n">Width</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Width</span>
<a name="ln-3064"></a>      <span class="n">Height</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">Height</span>
<a name="ln-3065"></a>      <span class="n">fact</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">OpenFactor</span>
<a name="ln-3066"></a>      <span class="n">expn</span> <span class="o">=</span> <span class="n">MultizoneCompHorOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-3067"></a>      <span class="n">coef</span> <span class="o">=</span> <span class="n">MultizoneCompHorOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span>
<a name="ln-3068"></a>      <span class="n">slope</span> <span class="o">=</span> <span class="n">MultizoneCompHorOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">slope</span>
<a name="ln-3069"></a>      <span class="n">DischCoeff</span> <span class="o">=</span> <span class="n">MultizoneCompHorOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff</span>
<a name="ln-3070"></a>      <span class="n">Cshape</span> <span class="o">=</span> <span class="mf">0.942d0</span><span class="o">*</span><span class="n">Width</span><span class="o">/</span><span class="n">Height</span>
<a name="ln-3071"></a>      <span class="n">OpenArea</span> <span class="o">=</span> <span class="n">Width</span><span class="o">*</span><span class="n">Height</span><span class="o">*</span><span class="n">fact</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">slope</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">+</span><span class="nb">cos</span><span class="p">(</span><span class="n">slope</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.0d0</span><span class="p">))</span>
<a name="ln-3072"></a>      <span class="n">DH</span> <span class="o">=</span> <span class="mf">4.0d0</span><span class="o">*</span><span class="p">(</span><span class="n">Width</span><span class="o">*</span><span class="n">Height</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="p">(</span><span class="n">Width</span><span class="o">+</span><span class="n">Height</span><span class="p">)</span><span class="o">*</span><span class="n">fact</span>
<a name="ln-3073"></a>
<a name="ln-3074"></a>      <span class="c">! Check which zone is higher</span>
<a name="ln-3075"></a>
<a name="ln-3076"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3077"></a><span class="k">        CALL </span><span class="n">GenericCrack</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">expn</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-3078"></a>        <span class="k">Return</span>
<a name="ln-3079"></a><span class="k">      end if</span>
<a name="ln-3080"></a>
<a name="ln-3081"></a>
<a name="ln-3082"></a><span class="k">      </span><span class="n">fma12</span>     <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3083"></a>      <span class="n">fma21</span>     <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3084"></a>      <span class="n">dp1fma12</span>  <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3085"></a>      <span class="n">dp1fma21</span>  <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3086"></a>      <span class="n">BuoFlow</span>   <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3087"></a>      <span class="n">dPBuoFlow</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3088"></a>
<a name="ln-3089"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="k">Then</span>
<a name="ln-3090"></a>      <span class="c">! Node N is upper zone</span>
<a name="ln-3091"></a>        <span class="k">If</span> <span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span> <span class="k">Then</span>
<a name="ln-3092"></a><span class="k">          </span><span class="n">BuoFlowMax</span> <span class="o">=</span> <span class="n">RhozAver</span><span class="o">*</span><span class="mf">0.055d0</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">9.81</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="n">DH</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="n">RhozAver</span><span class="p">)</span>
<a name="ln-3093"></a>          <span class="n">PurgedP</span> <span class="o">=</span> <span class="n">Cshape</span><span class="o">*</span><span class="n">Cshape</span><span class="o">*</span><span class="mf">9.81d0</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="n">DH</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="p">(</span><span class="n">OpenArea</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3094"></a>          <span class="k">If</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span> <span class="p">.</span><span class="n">LE</span><span class="p">.</span> <span class="n">PurgedP</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-3095"></a><span class="k">            </span><span class="n">BuoFlow</span> <span class="o">=</span> <span class="n">BuoFlowMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span><span class="o">/</span><span class="n">PurgedP</span><span class="p">)</span>
<a name="ln-3096"></a>            <span class="n">dPBuoFlow</span> <span class="o">=</span> <span class="n">BuoFlowMax</span><span class="o">/</span><span class="n">PurgedP</span>
<a name="ln-3097"></a>          <span class="k">End If</span>
<a name="ln-3098"></a><span class="k">        End If</span>
<a name="ln-3099"></a><span class="k">      Else</span>
<a name="ln-3100"></a>      <span class="c">! Node M is upper zone</span>
<a name="ln-3101"></a>        <span class="k">If</span> <span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span> <span class="k">Then</span>
<a name="ln-3102"></a><span class="k">          </span><span class="n">BuoFlowMax</span> <span class="o">=</span> <span class="n">RhozAver</span><span class="o">*</span><span class="mf">0.055d0</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">9.81d0</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="n">DH</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="n">RhozAver</span><span class="p">)</span>
<a name="ln-3103"></a>          <span class="n">PurgedP</span> <span class="o">=</span> <span class="n">Cshape</span><span class="o">*</span><span class="n">Cshape</span><span class="o">*</span><span class="mf">9.81d0</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="n">DH</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="p">(</span><span class="n">OpenArea</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3104"></a>          <span class="k">If</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span> <span class="p">.</span><span class="n">LE</span><span class="p">.</span> <span class="n">PurgedP</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-3105"></a><span class="k">            </span><span class="n">BuoFlow</span> <span class="o">=</span> <span class="n">BuoFlowMax</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span><span class="o">/</span><span class="n">PurgedP</span><span class="p">)</span>
<a name="ln-3106"></a>            <span class="n">dPBuoFlow</span> <span class="o">=</span> <span class="n">BuoFlowMax</span><span class="o">/</span><span class="n">PurgedP</span>
<a name="ln-3107"></a>          <span class="k">End If</span>
<a name="ln-3108"></a><span class="k">        End If</span>
<a name="ln-3109"></a><span class="k">      End If</span>
<a name="ln-3110"></a>
<a name="ln-3111"></a><span class="k">      IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3112"></a><span class="k">         </span><span class="n">fma12</span> <span class="o">=</span> <span class="n">BuoFlow</span>
<a name="ln-3113"></a>         <span class="n">fma21</span> <span class="o">=</span> <span class="n">BuoFlow</span>
<a name="ln-3114"></a>         <span class="n">dp1fma12</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3115"></a>         <span class="n">dp1fma21</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3116"></a>      <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3117"></a><span class="k">         </span><span class="n">fma12</span> <span class="o">=</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">OpenArea</span><span class="o">*</span><span class="n">fact</span><span class="o">*</span><span class="n">DischCoeff</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">PDROP</span><span class="o">/</span><span class="n">RhozAver</span><span class="p">)</span><span class="o">+</span><span class="n">BuoFlow</span>
<a name="ln-3118"></a>         <span class="n">dp1fma12</span> <span class="o">=</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">OpenArea</span><span class="o">*</span><span class="n">DischCoeff</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">PDROP</span><span class="o">*</span><span class="n">RhozAver</span><span class="p">)</span><span class="o">+</span><span class="n">dPBuoFlow</span>
<a name="ln-3119"></a>         <span class="k">If</span> <span class="p">(</span><span class="n">BuoFlow</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-3120"></a><span class="k">           </span><span class="n">fma21</span> <span class="o">=</span> <span class="n">BuoFlow</span>
<a name="ln-3121"></a>           <span class="n">dp1fma21</span> <span class="o">=</span> <span class="n">dPBuoFlow</span>
<a name="ln-3122"></a>         <span class="k">End If</span>
<a name="ln-3123"></a><span class="k">      ELSE</span> <span class="c">! PDROP.LT.0.0</span>
<a name="ln-3124"></a>         <span class="n">fma21</span> <span class="o">=</span> <span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">OpenArea</span><span class="o">*</span><span class="n">fact</span><span class="o">*</span><span class="n">DischCoeff</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span><span class="o">/</span><span class="n">RhozAver</span><span class="p">)</span><span class="o">+</span><span class="n">BuoFlow</span>
<a name="ln-3125"></a>         <span class="n">dp1fma21</span> <span class="o">=</span> <span class="o">-</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">OpenArea</span><span class="o">*</span><span class="n">DischCoeff</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">RhozAver</span><span class="p">)</span><span class="o">+</span><span class="n">dPBuoFlow</span>
<a name="ln-3126"></a>         <span class="k">If</span> <span class="p">(</span><span class="n">BuoFlow</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-3127"></a><span class="k">           </span><span class="n">fma12</span> <span class="o">=</span> <span class="n">BuoFlow</span>
<a name="ln-3128"></a>           <span class="n">dp1fma12</span> <span class="o">=</span> <span class="n">dPBuoFlow</span>
<a name="ln-3129"></a>         <span class="k">End If</span>
<a name="ln-3130"></a><span class="k">      END IF</span>
<a name="ln-3131"></a>
<a name="ln-3132"></a><span class="k">      </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fma12</span><span class="o">-</span><span class="n">fma21</span>
<a name="ln-3133"></a>      <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dp1fma12</span><span class="o">-</span><span class="n">dp1fma21</span>
<a name="ln-3134"></a>      <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3135"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">fma12</span> <span class="p">.</span><span class="n">NE</span><span class="p">.</span> <span class="mf">0.0d0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">fma21</span> <span class="p">.</span><span class="n">NE</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3136"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fma21</span>
<a name="ln-3137"></a>      <span class="k">End if</span>
<a name="ln-3138"></a><span class="k">      </span><span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3139"></a>
<a name="ln-3140"></a>      <span class="k">RETURN</span>
<a name="ln-3141"></a><span class="k">      END SUBROUTINE </span><span class="n">AFEHOP</span>
<a name="ln-3142"></a>
<a name="ln-3143"></a>      <span class="k">SUBROUTINE </span><span class="n">GenericCrack</span><span class="p">(</span><span class="n">Coef</span><span class="p">,</span><span class="n">Expn</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-3144"></a>
<a name="ln-3145"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3146"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-3147"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-3148"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-3149"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-3150"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-3151"></a>          <span class="c">!</span>
<a name="ln-3152"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised from AFEPLR developed by George Walton, NIST</span>
<a name="ln-3153"></a>
<a name="ln-3154"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3155"></a>          <span class="c">! This subroutine solves airflow for a power law component</span>
<a name="ln-3156"></a>
<a name="ln-3157"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3158"></a>          <span class="c">! Using Q=C(dP)^n</span>
<a name="ln-3159"></a>
<a name="ln-3160"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3161"></a>          <span class="c">! na</span>
<a name="ln-3162"></a>
<a name="ln-3163"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3164"></a>          <span class="c">! na</span>
<a name="ln-3165"></a>
<a name="ln-3166"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3167"></a>
<a name="ln-3168"></a>
<a name="ln-3169"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3170"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">Coef</span>     <span class="c">! Flow coefficient</span>
<a name="ln-3171"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">Expn</span>     <span class="c">! Flow exponent</span>
<a name="ln-3172"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-3173"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-3174"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-3175"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-3176"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-3177"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-3178"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-3179"></a>
<a name="ln-3180"></a>
<a name="ln-3181"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3182"></a>          <span class="c">! na</span>
<a name="ln-3183"></a>
<a name="ln-3184"></a>
<a name="ln-3185"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3186"></a>          <span class="c">! na</span>
<a name="ln-3187"></a>
<a name="ln-3188"></a>
<a name="ln-3189"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3190"></a>          <span class="c">! na</span>
<a name="ln-3191"></a>
<a name="ln-3192"></a>
<a name="ln-3193"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3194"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">CDM</span><span class="p">,</span> <span class="n">FL</span><span class="p">,</span> <span class="n">FT</span>
<a name="ln-3195"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>     <span class="n">RhozNorm</span><span class="p">,</span> <span class="n">VisczNorm</span><span class="p">,</span> <span class="n">Ctl</span><span class="p">,</span> <span class="n">VisAve</span><span class="p">,</span> <span class="n">Tave</span><span class="p">,</span> <span class="n">RhoCor</span>
<a name="ln-3196"></a>
<a name="ln-3197"></a>      <span class="c">! FLOW:</span>
<a name="ln-3198"></a>      <span class="c">! Calculate normal density and viscocity at Crack standard condition: T=20C, p=101325 Pa and 0 g/kg</span>
<a name="ln-3199"></a>      <span class="n">RhozNorm</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="mi">10132</span><span class="mf">5.0d0</span><span class="p">,</span><span class="mi">2</span><span class="mf">0.0d0</span><span class="p">,</span><span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-3200"></a>      <span class="n">VisczNorm</span> <span class="o">=</span> <span class="mf">1.71432d-5</span><span class="o">+</span><span class="mf">4.828d-8</span><span class="o">*</span><span class="mi">2</span><span class="mf">0.0d0</span>
<a name="ln-3201"></a>      <span class="n">VisAve</span> <span class="o">=</span> <span class="p">(</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-3202"></a>      <span class="n">Tave</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0d0</span>
<a name="ln-3203"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3204"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-3205"></a>      <span class="k">ELSE</span>
<a name="ln-3206"></a><span class="k">         </span><span class="n">coef</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">/</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<a name="ln-3207"></a>      <span class="k">END IF</span>
<a name="ln-3208"></a>
<a name="ln-3209"></a><span class="k">      </span><span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3210"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">LFLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3211"></a>        <span class="c">! Initialization by linear relation.</span>
<a name="ln-3212"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3213"></a><span class="k">          </span><span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-3214"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-3215"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3216"></a>        <span class="k">ELSE</span>
<a name="ln-3217"></a><span class="k">          </span><span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-3218"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-3219"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3220"></a>        <span class="k">END IF</span>
<a name="ln-3221"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-3222"></a>      <span class="k">ELSE</span>
<a name="ln-3223"></a>        <span class="c">! Standard calculation.</span>
<a name="ln-3224"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">PDROP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3225"></a>          <span class="c">! Flow in positive direction.</span>
<a name="ln-3226"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-3227"></a>          <span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-3228"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-3229"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3230"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-3231"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-3232"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3233"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3234"></a>          <span class="k">ELSE</span>
<a name="ln-3235"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">PDROP</span><span class="o">**</span><span class="n">expn</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3236"></a>          <span class="k">END IF</span>
<a name="ln-3237"></a><span class="k">        ELSE</span>
<a name="ln-3238"></a>          <span class="c">! Flow in negative direction.</span>
<a name="ln-3239"></a>          <span class="c">! Laminar flow.</span>
<a name="ln-3240"></a>          <span class="n">RhoCor</span> <span class="o">=</span> <span class="p">(</span><span class="n">TZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Tave</span><span class="o">+</span><span class="n">KelvinConv</span><span class="p">)</span>
<a name="ln-3241"></a>          <span class="n">ctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">RhozNorm</span><span class="o">/</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">RhoCor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">VisczNorm</span><span class="o">/</span><span class="n">VisAve</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">expn</span><span class="o">-</span><span class="mf">1.0d0</span><span class="p">)</span>
<a name="ln-3242"></a>          <span class="n">CDM</span> <span class="o">=</span> <span class="n">Coef</span><span class="o">*</span><span class="n">RHOZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="n">VISCZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3243"></a>          <span class="n">FL</span> <span class="o">=</span> <span class="n">CDM</span><span class="o">*</span><span class="n">PDROP</span>
<a name="ln-3244"></a>          <span class="c">! Turbulent flow.</span>
<a name="ln-3245"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">expn</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.5d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3246"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3247"></a>          <span class="k">ELSE</span>
<a name="ln-3248"></a><span class="k">            </span><span class="n">FT</span> <span class="o">=</span> <span class="o">-</span><span class="n">Coef</span><span class="o">*</span><span class="n">SQRTDZ</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">PDROP</span><span class="p">)</span><span class="o">**</span><span class="n">expn</span><span class="o">*</span><span class="n">ctl</span>
<a name="ln-3249"></a>          <span class="k">END IF</span>
<a name="ln-3250"></a><span class="k">        END IF</span>
<a name="ln-3251"></a>        <span class="c">! Select laminar or turbulent flow.</span>
<a name="ln-3252"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LIST</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="n">Unit21</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="s1">&#39; generic crack: &#39;</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">FT</span>
<a name="ln-3253"></a>        <span class="k">IF</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FL</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="nb">ABS</span><span class="p">(</span><span class="n">FT</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-3254"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FL</span>
<a name="ln-3255"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CDM</span>
<a name="ln-3256"></a>        <span class="k">ELSE</span>
<a name="ln-3257"></a><span class="k">          </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span>
<a name="ln-3258"></a>          <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">FT</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">PDROP</span>
<a name="ln-3259"></a>        <span class="k">END IF</span>
<a name="ln-3260"></a><span class="k">      END IF</span>
<a name="ln-3261"></a><span class="c">!</span>
<a name="ln-3262"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A5</span><span class="p">,</span><span class="mi">6</span><span class="n">X</span><span class="p">,</span><span class="err">4</span><span class="n">E16</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-3263"></a>      <span class="k">RETURN</span>
<a name="ln-3264"></a><span class="k">      END SUBROUTINE </span><span class="n">GenericCrack</span>
<a name="ln-3265"></a>
<a name="ln-3266"></a>
<a name="ln-3267"></a>      <span class="k">SUBROUTINE </span><span class="n">FACSKY</span><span class="p">(</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AL</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">NEQ</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span>
<a name="ln-3268"></a>
<a name="ln-3269"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3270"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-3271"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-3272"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-3273"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-3274"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-3275"></a>          <span class="c">!</span>
<a name="ln-3276"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised from FACSKY developed by George Walton, NIST</span>
<a name="ln-3277"></a>
<a name="ln-3278"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3279"></a>          <span class="c">! This subroutine performs L-U factorization of a skyline ordered matrix, [A]</span>
<a name="ln-3280"></a>          <span class="c">! The algorithm has been restructured for clarity.</span>
<a name="ln-3281"></a>          <span class="c">! Note dependence on compiler for optimizing the inner do loops.</span>
<a name="ln-3282"></a>
<a name="ln-3283"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3284"></a>          <span class="c">!     L-U factorization of a skyline ordered matrix, [A], used for</span>
<a name="ln-3285"></a>          <span class="c">!     solution of simultaneous linear algebraic equations [A] * X = B.</span>
<a name="ln-3286"></a>          <span class="c">!     No pivoting!  No scaling!  No warnings!!!</span>
<a name="ln-3287"></a>          <span class="c">!     Related routines:  SLVSKY, SETSKY, FILSKY.</span>
<a name="ln-3288"></a>
<a name="ln-3289"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3290"></a>          <span class="c">!     Algorithm is described in &quot;The Finite Element Method Displayed&quot;,</span>
<a name="ln-3291"></a>          <span class="c">!     by G. Dhatt and G. Touzot, John Wiley &amp; Sons, New York, 1984.</span>
<a name="ln-3292"></a>
<a name="ln-3293"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3294"></a>          <span class="c">! na</span>
<a name="ln-3295"></a>
<a name="ln-3296"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3297"></a>
<a name="ln-3298"></a>
<a name="ln-3299"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3300"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">! pointer to the top of column/row &quot;K&quot;</span>
<a name="ln-3301"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">NEQ</span>   <span class="c">! number of equations</span>
<a name="ln-3302"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">NSYM</span>  <span class="c">! symmetry:  0 = symmetric matrix, 1 = non-symmetric</span>
<a name="ln-3303"></a>          <span class="c">! noel, GNU says the AU is indexed above its upper bound</span>
<a name="ln-3304"></a>          <span class="c">!REAL(r64), INTENT(INOUT) :: AU(IK(NetworkNumOfNodes+1)-1) ! the upper triangle of [A] before and after factoring</span>
<a name="ln-3305"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AU</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c">! the upper triangle of [A] before and after factoring</span>
<a name="ln-3306"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AD</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">)</span>  <span class="c">! the main diagonal of [A] before and after factoring</span>
<a name="ln-3307"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AL</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">! the lower triangle of [A] before and after factoring</span>
<a name="ln-3308"></a>
<a name="ln-3309"></a>
<a name="ln-3310"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3311"></a>          <span class="c">! na</span>
<a name="ln-3312"></a>
<a name="ln-3313"></a>
<a name="ln-3314"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3315"></a>          <span class="c">! na</span>
<a name="ln-3316"></a>
<a name="ln-3317"></a>
<a name="ln-3318"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3319"></a>          <span class="c">! na</span>
<a name="ln-3320"></a>
<a name="ln-3321"></a>
<a name="ln-3322"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3323"></a>         <span class="kt">INTEGER  </span><span class="n">JHK</span><span class="p">,</span> <span class="n">JHK1</span><span class="p">,</span> <span class="n">LHK</span><span class="p">,</span> <span class="n">LHK1</span><span class="p">,</span> <span class="n">IMIN</span><span class="p">,</span> <span class="n">IMIN1</span>
<a name="ln-3324"></a>         <span class="kt">INTEGER  </span><span class="n">JHJ</span><span class="p">,</span> <span class="n">JHJ1</span><span class="p">,</span> <span class="n">IC</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span>
<a name="ln-3325"></a>         <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">SDOT</span><span class="p">,</span> <span class="n">SUMD</span>
<a name="ln-3326"></a>
<a name="ln-3327"></a>      <span class="c">! FLOW:</span>
<a name="ln-3328"></a>      <span class="n">AD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="n">AD</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3329"></a>      <span class="n">JHK</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3330"></a>      <span class="k">DO </span><span class="n">K</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NEQ</span>
<a name="ln-3331"></a>        <span class="n">SUMD</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3332"></a>        <span class="n">JHK1</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3333"></a>        <span class="n">LHK</span> <span class="o">=</span> <span class="n">JHK1</span><span class="o">-</span><span class="n">JHK</span>
<a name="ln-3334"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LHK</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3335"></a><span class="k">          </span><span class="n">LHK1</span> <span class="o">=</span> <span class="n">LHK</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3336"></a>          <span class="n">IMIN</span> <span class="o">=</span> <span class="n">K</span><span class="o">-</span><span class="n">LHK1</span>
<a name="ln-3337"></a>          <span class="n">IMIN1</span> <span class="o">=</span> <span class="n">IMIN</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3338"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">NSYM</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="n">AL</span><span class="p">(</span><span class="n">JHK</span><span class="p">)</span> <span class="o">=</span> <span class="n">AL</span><span class="p">(</span><span class="n">JHK</span><span class="p">)</span><span class="o">*</span><span class="n">AD</span><span class="p">(</span><span class="n">IMIN1</span><span class="p">)</span>
<a name="ln-3339"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">LHK1</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3340"></a><span class="k">            </span><span class="n">JHJ</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">IMIN</span><span class="p">)</span>
<a name="ln-3341"></a>            <span class="k">IF</span><span class="p">(</span><span class="n">NSYM</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3342"></a><span class="k">              DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">LHK1</span>
<a name="ln-3343"></a>                <span class="n">JHJ1</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">IMIN</span><span class="o">+</span><span class="n">J</span><span class="p">)</span>
<a name="ln-3344"></a>                <span class="n">IC</span> <span class="o">=</span> <span class="nb">MIN</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">JHJ1</span><span class="o">-</span><span class="n">JHJ</span><span class="p">)</span>
<a name="ln-3345"></a>                <span class="k">IF</span><span class="p">(</span><span class="n">IC</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3346"></a><span class="k">                  </span><span class="n">SDOT</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3347"></a>                  <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">IC</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3348"></a>                    <span class="n">SDOT</span> <span class="o">=</span> <span class="n">SDOT</span><span class="o">+</span><span class="n">AU</span><span class="p">(</span><span class="n">JHJ1</span><span class="o">-</span><span class="n">IC</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="n">IC</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3349"></a>                  <span class="k">END DO</span>
<a name="ln-3350"></a><span class="k">                  </span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">SDOT</span>
<a name="ln-3351"></a>                <span class="k">END IF</span>
<a name="ln-3352"></a><span class="k">                </span><span class="n">JHJ</span> <span class="o">=</span> <span class="n">JHJ1</span>
<a name="ln-3353"></a>              <span class="k">END DO</span>
<a name="ln-3354"></a><span class="k">            ELSE</span>
<a name="ln-3355"></a><span class="k">              DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">LHK1</span>
<a name="ln-3356"></a>                <span class="n">JHJ1</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">IMIN</span><span class="o">+</span><span class="n">J</span><span class="p">)</span>
<a name="ln-3357"></a>                <span class="n">IC</span> <span class="o">=</span> <span class="nb">MIN</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">JHJ1</span><span class="o">-</span><span class="n">JHJ</span><span class="p">)</span>
<a name="ln-3358"></a>                <span class="n">SDOT</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3359"></a>                <span class="k">IF</span><span class="p">(</span><span class="n">IC</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3360"></a><span class="k">                  DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">IC</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3361"></a>                    <span class="n">SDOT</span> <span class="o">=</span> <span class="n">SDOT</span><span class="o">+</span><span class="n">AL</span><span class="p">(</span><span class="n">JHJ1</span><span class="o">-</span><span class="n">IC</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="n">IC</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3362"></a>                  <span class="k">END DO</span>
<a name="ln-3363"></a><span class="k">                  </span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">SDOT</span>
<a name="ln-3364"></a>                  <span class="n">SDOT</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3365"></a>                  <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">IC</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3366"></a>                    <span class="n">SDOT</span> <span class="o">=</span> <span class="n">SDOT</span><span class="o">+</span><span class="n">AU</span><span class="p">(</span><span class="n">JHJ1</span><span class="o">-</span><span class="n">IC</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">AL</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="o">-</span><span class="n">IC</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3367"></a>                  <span class="k">END DO</span>
<a name="ln-3368"></a><span class="k">                END IF</span>
<a name="ln-3369"></a><span class="k">                </span><span class="n">AL</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">AL</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">SDOT</span><span class="p">)</span><span class="o">*</span><span class="n">AD</span><span class="p">(</span><span class="n">IMIN1</span><span class="o">+</span><span class="n">J</span><span class="p">)</span>
<a name="ln-3370"></a>                <span class="n">JHJ</span> <span class="o">=</span> <span class="n">JHJ1</span>
<a name="ln-3371"></a>              <span class="k">END DO</span>
<a name="ln-3372"></a><span class="k">            END IF</span>
<a name="ln-3373"></a><span class="c">!</span>
<a name="ln-3374"></a>          <span class="k">END IF</span>
<a name="ln-3375"></a><span class="k">          IF</span><span class="p">(</span><span class="n">NSYM</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3376"></a><span class="k">            DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">LHK1</span>
<a name="ln-3377"></a>              <span class="n">T1</span> <span class="o">=</span> <span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3378"></a>              <span class="n">T2</span> <span class="o">=</span> <span class="n">T1</span><span class="o">*</span><span class="n">AD</span><span class="p">(</span><span class="n">IMIN1</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3379"></a>              <span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">T2</span>
<a name="ln-3380"></a>              <span class="n">SUMD</span> <span class="o">=</span> <span class="n">SUMD</span><span class="o">+</span><span class="n">T1</span><span class="o">*</span><span class="n">T2</span>
<a name="ln-3381"></a>            <span class="k">END DO</span>
<a name="ln-3382"></a><span class="k">          ELSE</span>
<a name="ln-3383"></a><span class="k">            DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">LHK1</span>
<a name="ln-3384"></a>              <span class="n">SUMD</span> <span class="o">=</span> <span class="n">SUMD</span><span class="o">+</span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">AL</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3385"></a>            <span class="k">END DO</span>
<a name="ln-3386"></a><span class="k">          END IF</span>
<a name="ln-3387"></a><span class="k">        END IF</span>
<a name="ln-3388"></a><span class="k">        If</span> <span class="p">(</span><span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">-</span><span class="n">SUMD</span> <span class="p">.</span><span class="n">EQ</span><span class="p">.</span> <span class="mf">0.d0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-3389"></a><span class="k">          CALL </span><span class="n">ShowSevereError</span><span class="p">(</span><span class="s1">&#39;AirflowNetworkSolver: L-U factorization in Subroutine FACSKY.&#39;</span><span class="p">)</span>
<a name="ln-3390"></a>          <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;The denominator used in L-U factorizationis equal to 0.0 at node = &#39;</span> <span class="p">&amp;</span>
<a name="ln-3391"></a>                                <span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">K</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a name="ln-3392"></a>          <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;One possible cause is that this node may not be connected directly, or indirectly via airflow &#39;</span> <span class="p">&amp;</span>
<a name="ln-3393"></a>                                <span class="o">//</span><span class="s1">&#39;network connections &#39;</span><span class="p">)</span>
<a name="ln-3394"></a>          <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;(e.g., AirflowNetwork:Multizone:SurfaceCrack, AirflowNetwork:Multizone:Component:&#39;</span> <span class="p">&amp;</span>
<a name="ln-3395"></a>                                 <span class="o">//</span> <span class="s1">&#39;SimpleOpening, etc.), to an external&#39;</span><span class="p">)</span>
<a name="ln-3396"></a>          <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;node (AirflowNetwork:MultiZone:Surface).&#39;</span><span class="p">)</span>
<a name="ln-3397"></a>          <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;Please send your input file and weather file to EnergyPlus support/development team&#39;</span> <span class="p">&amp;</span>
<a name="ln-3398"></a>                                 <span class="o">//</span><span class="s1">&#39; for further investigation.&#39;</span><span class="p">)</span>
<a name="ln-3399"></a>          <span class="k">CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Preceding condition causes termination.&#39;</span><span class="p">)</span>
<a name="ln-3400"></a>        <span class="k">End If</span>
<a name="ln-3401"></a><span class="k">        </span><span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0d0</span><span class="o">/</span><span class="p">(</span><span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">-</span><span class="n">SUMD</span><span class="p">)</span>
<a name="ln-3402"></a>        <span class="n">JHK</span> <span class="o">=</span> <span class="n">JHK1</span>
<a name="ln-3403"></a>      <span class="k">END DO</span>
<a name="ln-3404"></a><span class="c">!</span>
<a name="ln-3405"></a>      <span class="k">RETURN</span>
<a name="ln-3406"></a><span class="k">      END SUBROUTINE </span><span class="n">FACSKY</span>
<a name="ln-3407"></a>
<a name="ln-3408"></a>
<a name="ln-3409"></a>      <span class="k">SUBROUTINE </span><span class="n">SLVSKY</span><span class="p">(</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">AL</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">NEQ</span><span class="p">,</span><span class="n">NSYM</span><span class="p">)</span>
<a name="ln-3410"></a>
<a name="ln-3411"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3412"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-3413"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-3414"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-3415"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-3416"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-3417"></a>          <span class="c">!</span>
<a name="ln-3418"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised from CLVSKY developed by George Walton, NIST</span>
<a name="ln-3419"></a>
<a name="ln-3420"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3421"></a>          <span class="c">! This subroutine solves simultaneous linear algebraic equations [A] * X = B</span>
<a name="ln-3422"></a>          <span class="c">! using L-U factored skyline form of [A] from &quot;FACSKY&quot;</span>
<a name="ln-3423"></a>
<a name="ln-3424"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3425"></a>          <span class="c">! na</span>
<a name="ln-3426"></a>
<a name="ln-3427"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3428"></a>          <span class="c">! na</span>
<a name="ln-3429"></a>
<a name="ln-3430"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3431"></a>          <span class="c">! na</span>
<a name="ln-3432"></a>
<a name="ln-3433"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3434"></a>
<a name="ln-3435"></a>
<a name="ln-3436"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3437"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">! pointer to the top of column/row &quot;K&quot;</span>
<a name="ln-3438"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">NEQ</span>   <span class="c">! number of equations</span>
<a name="ln-3439"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">NSYM</span>  <span class="c">! symmetry:  0 = symmetric matrix, 1 = non-symmetric</span>
<a name="ln-3440"></a>          <span class="c">! noel, GNU says the AU is indexed above its upper bound</span>
<a name="ln-3441"></a>          <span class="c">!REAL(r64), INTENT(INOUT) :: AU(IK(NetworkNumOfNodes+1)-1) ! the upper triangle of [A] before and after factoring</span>
<a name="ln-3442"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AU</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c">! the upper triangle of [A] before and after factoring</span>
<a name="ln-3443"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AD</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">)</span>  <span class="c">! the main diagonal of [A] before and after factoring</span>
<a name="ln-3444"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AL</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">! the lower triangle of [A] before and after factoring</span>
<a name="ln-3445"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">B</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">)</span> <span class="c">! &quot;B&quot; vector (input); &quot;X&quot; vector (output).</span>
<a name="ln-3446"></a>
<a name="ln-3447"></a>
<a name="ln-3448"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3449"></a>          <span class="c">! na</span>
<a name="ln-3450"></a>
<a name="ln-3451"></a>
<a name="ln-3452"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3453"></a>          <span class="c">! na</span>
<a name="ln-3454"></a>
<a name="ln-3455"></a>
<a name="ln-3456"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3457"></a>          <span class="c">! na</span>
<a name="ln-3458"></a>
<a name="ln-3459"></a>
<a name="ln-3460"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3461"></a>
<a name="ln-3462"></a>      <span class="kt">INTEGER  </span><span class="n">I</span><span class="p">,</span> <span class="n">JHK</span><span class="p">,</span> <span class="n">JHK1</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">LHK</span>
<a name="ln-3463"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="n">SDOT</span><span class="p">,</span> <span class="n">T1</span>
<a name="ln-3464"></a>
<a name="ln-3465"></a>      <span class="c">! FLOW:</span>
<a name="ln-3466"></a>      <span class="n">JHK</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3467"></a>      <span class="k">DO </span><span class="n">K</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NEQ</span>
<a name="ln-3468"></a>        <span class="n">JHK1</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3469"></a>        <span class="n">LHK</span> <span class="o">=</span> <span class="n">JHK1</span><span class="o">-</span><span class="n">JHK</span>
<a name="ln-3470"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">LHK</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">CYCLE</span>
<a name="ln-3471"></a><span class="k">        </span><span class="n">SDOT</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3472"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">NSYM</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3473"></a><span class="k">          DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">LHK</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3474"></a>            <span class="n">SDOT</span> <span class="o">=</span> <span class="n">SDOT</span><span class="o">+</span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="n">LHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3475"></a>          <span class="k">END DO</span>
<a name="ln-3476"></a><span class="k">        ELSE</span>
<a name="ln-3477"></a><span class="k">          DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">LHK</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3478"></a>            <span class="n">SDOT</span> <span class="o">=</span> <span class="n">SDOT</span><span class="o">+</span><span class="n">AL</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="n">LHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<a name="ln-3479"></a>          <span class="k">END DO</span>
<a name="ln-3480"></a><span class="k">        </span><span class="n">ENDIF</span>
<a name="ln-3481"></a>        <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">-</span><span class="n">SDOT</span>
<a name="ln-3482"></a>        <span class="n">JHK</span> <span class="o">=</span> <span class="n">JHK1</span>
<a name="ln-3483"></a>      <span class="k">END DO</span>
<a name="ln-3484"></a><span class="c">!</span>
<a name="ln-3485"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">NSYM</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3486"></a><span class="k">        DO </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NEQ</span>
<a name="ln-3487"></a>          <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">*</span><span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<a name="ln-3488"></a>        <span class="k">END DO</span>
<a name="ln-3489"></a><span class="k">      END IF</span>
<a name="ln-3490"></a><span class="c">!</span>
<a name="ln-3491"></a>      <span class="n">K</span> <span class="o">=</span> <span class="n">NEQ</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-3492"></a>      <span class="n">JHK1</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<a name="ln-3493"></a>      <span class="k">DO WHILE</span> <span class="p">(</span><span class="n">K</span> <span class="p">.</span><span class="n">NE</span><span class="p">.</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-3494"></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">K</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3495"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">NSYM</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">*</span><span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<a name="ln-3496"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">K</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-3497"></a><span class="c">!        IF(K.EQ.1) RETURN</span>
<a name="ln-3498"></a>        <span class="n">JHK</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<a name="ln-3499"></a>        <span class="n">T1</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<a name="ln-3500"></a>        <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">JHK1</span><span class="o">-</span><span class="n">JHK</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3501"></a>          <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="n">JHK1</span><span class="o">+</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="n">JHK1</span><span class="o">+</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">AU</span><span class="p">(</span><span class="n">JHK</span><span class="o">+</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">T1</span>
<a name="ln-3502"></a>        <span class="k">END DO</span>
<a name="ln-3503"></a><span class="k">        </span><span class="n">JHK1</span> <span class="o">=</span> <span class="n">JHK</span>
<a name="ln-3504"></a>      <span class="k">END DO</span>
<a name="ln-3505"></a>
<a name="ln-3506"></a><span class="k">      RETURN</span>
<a name="ln-3507"></a><span class="k">      END SUBROUTINE </span><span class="n">SLVSKY</span>
<a name="ln-3508"></a>
<a name="ln-3509"></a>
<a name="ln-3510"></a>      <span class="k">SUBROUTINE </span><span class="n">FILSKY</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">LM</span><span class="p">,</span><span class="n">IK</span><span class="p">,</span><span class="n">AU</span><span class="p">,</span><span class="n">AD</span><span class="p">,</span><span class="n">FLAG</span><span class="p">)</span>
<a name="ln-3511"></a>
<a name="ln-3512"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3513"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-3514"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-3515"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-3516"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-3517"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-3518"></a>          <span class="c">!</span>
<a name="ln-3519"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised from FILSKY developed by George Walton, NIST</span>
<a name="ln-3520"></a>
<a name="ln-3521"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3522"></a>          <span class="c">! This subroutine adds element array &quot;X&quot; to the sparse skyline matrix [A]</span>
<a name="ln-3523"></a>
<a name="ln-3524"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3525"></a>          <span class="c">! na</span>
<a name="ln-3526"></a>
<a name="ln-3527"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3528"></a>          <span class="c">! na</span>
<a name="ln-3529"></a>
<a name="ln-3530"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3531"></a>          <span class="c">! na</span>
<a name="ln-3532"></a>
<a name="ln-3533"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3534"></a>
<a name="ln-3535"></a>
<a name="ln-3536"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3537"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LM</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! location matrix</span>
<a name="ln-3538"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">! pointer to the top of column/row &quot;K&quot;</span>
<a name="ln-3539"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">FLAG</span>  <span class="c">! mode of operation</span>
<a name="ln-3540"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c">! element array (row-wise sequence)</span>
<a name="ln-3541"></a>          <span class="c">! noel, GNU says the AU is indexed above its upper bound</span>
<a name="ln-3542"></a>          <span class="c">!REAL(r64), INTENT(INOUT) :: AU(IK(NetworkNumOfNodes+1)-1) ! the upper triangle of [A] before and after factoring</span>
<a name="ln-3543"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AU</span><span class="p">(</span><span class="n">IK</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c">! the upper triangle of [A] before and after factoring</span>
<a name="ln-3544"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">AD</span><span class="p">(</span><span class="n">NetworkNumOfNodes</span><span class="p">)</span>  <span class="c">! the main diagonal of [A] before and after factoring</span>
<a name="ln-3545"></a>
<a name="ln-3546"></a>
<a name="ln-3547"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3548"></a>          <span class="c">! na</span>
<a name="ln-3549"></a>
<a name="ln-3550"></a>
<a name="ln-3551"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3552"></a>          <span class="c">! na</span>
<a name="ln-3553"></a>
<a name="ln-3554"></a>
<a name="ln-3555"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3556"></a>          <span class="c">! na</span>
<a name="ln-3557"></a>
<a name="ln-3558"></a>
<a name="ln-3559"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3560"></a>         <span class="kt">INTEGER  </span><span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">L</span>
<a name="ln-3561"></a>
<a name="ln-3562"></a>      <span class="c">! FLOW:</span>
<a name="ln-3563"></a>      <span class="c">! K = row number, L = column number.</span>
<a name="ln-3564"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">FLAG</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3565"></a><span class="k">        </span><span class="n">K</span> <span class="o">=</span> <span class="n">LM</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3566"></a>        <span class="n">L</span> <span class="o">=</span> <span class="n">LM</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3567"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">FLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3568"></a><span class="k">          </span><span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">=</span> <span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">+</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3569"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">K</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">L</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3570"></a><span class="k">            </span><span class="n">J</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">L</span><span class="o">+</span><span class="n">K</span>
<a name="ln-3571"></a>            <span class="n">AU</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">AU</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3572"></a>          <span class="k">ELSE</span>
<a name="ln-3573"></a><span class="k">            </span><span class="n">J</span> <span class="o">=</span> <span class="n">IK</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">K</span><span class="o">+</span><span class="n">L</span>
<a name="ln-3574"></a>            <span class="n">AU</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">AU</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-3575"></a>          <span class="k">END IF</span>
<a name="ln-3576"></a><span class="k">          </span><span class="n">AD</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">AD</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">+</span><span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-3577"></a>        <span class="k">ELSE IF</span><span class="p">(</span><span class="n">FLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3578"></a><span class="k">          </span><span class="n">AD</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">=</span> <span class="n">AD</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">+</span><span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-3579"></a>        <span class="k">ELSE IF</span><span class="p">(</span><span class="n">FLAG</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3580"></a><span class="k">          </span><span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">=</span> <span class="n">AD</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">+</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3581"></a>        <span class="k">END IF</span>
<a name="ln-3582"></a><span class="k">      END IF</span>
<a name="ln-3583"></a><span class="c">!</span>
<a name="ln-3584"></a>      <span class="k">RETURN</span>
<a name="ln-3585"></a><span class="k">      END SUBROUTINE </span><span class="n">FILSKY</span>
<a name="ln-3586"></a>
<a name="ln-3587"></a>
<a name="ln-3588"></a>      <span class="k">SUBROUTINE </span><span class="n">DUMPVD</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">UOUT</span><span class="p">)</span>
<a name="ln-3589"></a>
<a name="ln-3590"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3591"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-3592"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-3593"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-3594"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-3595"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-3596"></a>          <span class="c">!</span>
<a name="ln-3597"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised from DUMPVD developed by George Walton, NIST</span>
<a name="ln-3598"></a>
<a name="ln-3599"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3600"></a>          <span class="c">! This subroutine prints the contents of the REAL(r64) &quot;V&quot; vector</span>
<a name="ln-3601"></a>
<a name="ln-3602"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3603"></a>          <span class="c">! na</span>
<a name="ln-3604"></a>
<a name="ln-3605"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3606"></a>          <span class="c">! na</span>
<a name="ln-3607"></a>
<a name="ln-3608"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3609"></a>          <span class="c">! na</span>
<a name="ln-3610"></a>
<a name="ln-3611"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3612"></a>
<a name="ln-3613"></a>
<a name="ln-3614"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3615"></a>          <span class="kt">CHARACTER</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">S</span>  <span class="c">! Description</span>
<a name="ln-3616"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">V</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="c">! Output values</span>
<a name="ln-3617"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>  <span class="c">! Array size</span>
<a name="ln-3618"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">UOUT</span> <span class="c">! Output file unit</span>
<a name="ln-3619"></a>
<a name="ln-3620"></a>
<a name="ln-3621"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3622"></a>          <span class="c">! na</span>
<a name="ln-3623"></a>
<a name="ln-3624"></a>
<a name="ln-3625"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3626"></a>          <span class="c">! na</span>
<a name="ln-3627"></a>
<a name="ln-3628"></a>
<a name="ln-3629"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3630"></a>          <span class="c">! na</span>
<a name="ln-3631"></a>
<a name="ln-3632"></a>
<a name="ln-3633"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3634"></a>          <span class="kt">INTEGER </span><span class="n">I</span>
<a name="ln-3635"></a>
<a name="ln-3636"></a>      <span class="c">! FLOW:</span>
<a name="ln-3637"></a>      <span class="c">! Write values for debug</span>
<a name="ln-3638"></a>      <span class="k">WRITE</span><span class="p">(</span><span class="n">UOUT</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="n">S</span>
<a name="ln-3639"></a>      <span class="k">WRITE</span><span class="p">(</span><span class="n">UOUT</span><span class="p">,</span><span class="mi">902</span><span class="p">)</span> <span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="ln-3640"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
<a name="ln-3641"></a>  <span class="mi">902</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="err">5</span><span class="n">E15</span><span class="p">.</span><span class="mi">07</span><span class="p">)</span>
<a name="ln-3642"></a><span class="c">!</span>
<a name="ln-3643"></a>      <span class="k">RETURN</span>
<a name="ln-3644"></a><span class="k">      END SUBROUTINE </span><span class="n">DUMPVD</span>
<a name="ln-3645"></a>
<a name="ln-3646"></a>
<a name="ln-3647"></a>      <span class="k">SUBROUTINE </span><span class="n">DUMPVR</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">UOUT</span><span class="p">)</span>
<a name="ln-3648"></a>
<a name="ln-3649"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3650"></a>          <span class="c">!       AUTHOR         George Walton</span>
<a name="ln-3651"></a>          <span class="c">!       DATE WRITTEN   Extracted from AIRNET</span>
<a name="ln-3652"></a>          <span class="c">!       MODIFIED       Lixing Gu, 2/1/04</span>
<a name="ln-3653"></a>          <span class="c">!                      Revised the subroutine to meet E+ needs</span>
<a name="ln-3654"></a>          <span class="c">!       MODIFIED       Lixing Gu, 6/8/05</span>
<a name="ln-3655"></a>          <span class="c">!</span>
<a name="ln-3656"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised from DUMPVR developed by George Walton, NIST</span>
<a name="ln-3657"></a>
<a name="ln-3658"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3659"></a>          <span class="c">! This subroutine prints the contents of the REAL(r64) &quot;V&quot; vector</span>
<a name="ln-3660"></a>
<a name="ln-3661"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3662"></a>          <span class="c">! na</span>
<a name="ln-3663"></a>
<a name="ln-3664"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3665"></a>          <span class="c">! na</span>
<a name="ln-3666"></a>
<a name="ln-3667"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3668"></a>          <span class="c">! na</span>
<a name="ln-3669"></a>
<a name="ln-3670"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3671"></a>
<a name="ln-3672"></a>
<a name="ln-3673"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3674"></a>          <span class="kt">CHARACTER</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">S</span>  <span class="c">! Description</span>
<a name="ln-3675"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">V</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="c">! Output values</span>
<a name="ln-3676"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>  <span class="c">! Array size</span>
<a name="ln-3677"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">UOUT</span> <span class="c">! Output file unit</span>
<a name="ln-3678"></a>
<a name="ln-3679"></a>
<a name="ln-3680"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3681"></a>          <span class="c">! na</span>
<a name="ln-3682"></a>
<a name="ln-3683"></a>
<a name="ln-3684"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3685"></a>          <span class="c">! na</span>
<a name="ln-3686"></a>
<a name="ln-3687"></a>
<a name="ln-3688"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3689"></a>          <span class="c">! na</span>
<a name="ln-3690"></a>
<a name="ln-3691"></a>
<a name="ln-3692"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3693"></a>          <span class="kt">INTEGER </span><span class="n">I</span>
<a name="ln-3694"></a>
<a name="ln-3695"></a>      <span class="c">! FLOW:</span>
<a name="ln-3696"></a>      <span class="k">WRITE</span><span class="p">(</span><span class="n">UOUT</span><span class="p">,</span><span class="mi">901</span><span class="p">)</span> <span class="n">S</span>
<a name="ln-3697"></a>      <span class="k">WRITE</span><span class="p">(</span><span class="n">UOUT</span><span class="p">,</span><span class="mi">902</span><span class="p">)</span> <span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="ln-3698"></a>  <span class="mi">901</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
<a name="ln-3699"></a>  <span class="mi">902</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="err">5</span><span class="n">E15</span><span class="p">.</span><span class="mi">07</span><span class="p">)</span>
<a name="ln-3700"></a><span class="c">!</span>
<a name="ln-3701"></a>      <span class="k">RETURN</span>
<a name="ln-3702"></a><span class="k">      END SUBROUTINE </span><span class="n">DUMPVR</span>
<a name="ln-3703"></a>
<a name="ln-3704"></a>
<a name="ln-3705"></a>      <span class="k">SUBROUTINE </span><span class="n">AFEDOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">LFLAG</span><span class="p">,</span><span class="n">PDROP</span><span class="p">,</span><span class="n">IL</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">DF</span><span class="p">,</span><span class="n">NF</span><span class="p">)</span>
<a name="ln-3706"></a>
<a name="ln-3707"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-3708"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-3709"></a>          <span class="c">!       DATE WRITTEN   Oct. 2005</span>
<a name="ln-3710"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-3711"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised based on a vertical large opening subroutine from COMIS</span>
<a name="ln-3712"></a>
<a name="ln-3713"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-3714"></a>          <span class="c">! This subroutine simulates airflow and pressure of a detailed large opening component.</span>
<a name="ln-3715"></a>
<a name="ln-3716"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-3717"></a>          <span class="c">! Purpose:  This routine calculates the massflow and its derivative</span>
<a name="ln-3718"></a>          <span class="c">!       through a large opening in both flow directions. As input</span>
<a name="ln-3719"></a>          <span class="c">!       the density profiles RhoProfF/T are required aswell as the</span>
<a name="ln-3720"></a>          <span class="c">!       effective pressure difference profile DpProfNew, which is the</span>
<a name="ln-3721"></a>          <span class="c">!       sum of the stack pressure difference profile DpProf and the</span>
<a name="ln-3722"></a>          <span class="c">!       difference of the actual pressures at reference height. The</span>
<a name="ln-3723"></a>          <span class="c">!       profiles are calculated in the routine PresProfile.</span>
<a name="ln-3724"></a>          <span class="c">!       The massflow and its derivative are calculated for each</span>
<a name="ln-3725"></a>          <span class="c">!       interval representing a step of the pressure difference</span>
<a name="ln-3726"></a>          <span class="c">!       profile. The total flow and derivative are obtained by</span>
<a name="ln-3727"></a>          <span class="c">!       summation over the whole opening.</span>
<a name="ln-3728"></a>          <span class="c">!       The calculation is split into different cases representing</span>
<a name="ln-3729"></a>          <span class="c">!       different situations of the opening:</span>
<a name="ln-3730"></a>          <span class="c">!       - closed opening (opening factor = 0): summation of top and</span>
<a name="ln-3731"></a>          <span class="c">!         bottom crack (crack length = lwmax) plus &quot;integration&quot; over</span>
<a name="ln-3732"></a>          <span class="c">!         a vertically distributed crack of length (2*lhmax+lextra).</span>
<a name="ln-3733"></a>          <span class="c">!       - type 1: normal rectangular opening: &quot;integration&quot; over NrInt</span>
<a name="ln-3734"></a>          <span class="c">!         openings with width actlw and height actlh/NrInt</span>
<a name="ln-3735"></a>          <span class="c">!       - type 2: horizontally pivoted window: flow direction assumed</span>
<a name="ln-3736"></a>          <span class="c">!         strictly perpendicular to the plane of the opening</span>
<a name="ln-3737"></a>          <span class="c">!         -&gt; &quot;integration&quot; over normal rectangular openings at top</span>
<a name="ln-3738"></a>          <span class="c">!         and bottom of LO plus a rectangular opening in series with two</span>
<a name="ln-3739"></a>          <span class="c">!         triangular openings in the middle of the LO (most general</span>
<a name="ln-3740"></a>          <span class="c">!         situation). The geometry is defined by the input parameters</span>
<a name="ln-3741"></a>          <span class="c">!         actlw(=lwmax), actlh, axisheight, opening angle.</span>
<a name="ln-3742"></a>          <span class="c">!       Assuming the massflow perpendicular to the opening plane in all</span>
<a name="ln-3743"></a>          <span class="c">!       cases the ownheightfactor has no influence on the massflow.</span>
<a name="ln-3744"></a>
<a name="ln-3745"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-3746"></a>          <span class="c">! Helmut E. Feustel and Alison Rayner-Hooson, &quot;COMIS Fundamentals,&quot; LBL-28560,</span>
<a name="ln-3747"></a>          <span class="c">! Lawrence Berkeley National Laboratory, Berkeley, CA, May 1990</span>
<a name="ln-3748"></a>
<a name="ln-3749"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-3750"></a>          <span class="c">! na</span>
<a name="ln-3751"></a>
<a name="ln-3752"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-3753"></a>
<a name="ln-3754"></a>
<a name="ln-3755"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-3756"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">J</span>     <span class="c">! Component number</span>
<a name="ln-3757"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">LFLAG</span> <span class="c">! Initialization flag.If = 1, use laminar relationship</span>
<a name="ln-3758"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">PDROP</span> <span class="c">! Total pressure drop across a component (P1 - P2) [Pa]</span>
<a name="ln-3759"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">IL</span>    <span class="c">! Linkage number</span>
<a name="ln-3760"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">N</span>     <span class="c">! Node 1 number</span>
<a name="ln-3761"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">M</span>     <span class="c">! Node 2 number</span>
<a name="ln-3762"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">NF</span>    <span class="c">! Number of flows, either 1 or 2</span>
<a name="ln-3763"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! Airflow through the component [kg/s]</span>
<a name="ln-3764"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Partial derivative:  DF/DP</span>
<a name="ln-3765"></a>
<a name="ln-3766"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-3767"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">RealMax</span><span class="o">=</span><span class="mf">0.1d+37</span>
<a name="ln-3768"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">RealMin</span><span class="o">=</span><span class="mi">1</span><span class="n">d</span><span class="o">-</span><span class="mi">37</span>
<a name="ln-3769"></a>
<a name="ln-3770"></a>
<a name="ln-3771"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-3772"></a>          <span class="c">! na</span>
<a name="ln-3773"></a>
<a name="ln-3774"></a>
<a name="ln-3775"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-3776"></a>          <span class="c">! na</span>
<a name="ln-3777"></a>
<a name="ln-3778"></a>
<a name="ln-3779"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-3780"></a>      <span class="kt">INTEGER  </span><span class="n">CompNum</span>
<a name="ln-3781"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Width</span><span class="p">,</span><span class="n">Height</span>
<a name="ln-3782"></a>
<a name="ln-3783"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="n">fma12</span>    <span class="c">! massflow in direction &quot;from-to&quot; [kg/s]</span>
<a name="ln-3784"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="n">fma21</span>    <span class="c">! massflow in direction &quot;to-from&quot; [kg/s]</span>
<a name="ln-3785"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="n">dp1fma12</span> <span class="c">! derivative d fma12 / d Dp [kg/s/Pa]</span>
<a name="ln-3786"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="n">dp1fma21</span> <span class="c">! derivative d fma21 / d Dp [kg/s/Pa]</span>
<a name="ln-3787"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span>  <span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Differential pressure profile for Large Openings, taking into account fixed</span>
<a name="ln-3788"></a>                                           <span class="c">! pressures and actual zone pressures at reference height</span>
<a name="ln-3789"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">fact</span> <span class="c">! Actual opening factor</span>
<a name="ln-3790"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">DifLim</span> <span class="c">! Limit for the pressure difference where laminarization takes place [Pa]</span>
<a name="ln-3791"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Cfact</span><span class="p">,</span><span class="n">FvVeloc</span>
<a name="ln-3792"></a>
<a name="ln-3793"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">ActLh</span><span class="p">,</span><span class="n">ActLw</span><span class="p">,</span><span class="n">Lextra</span><span class="p">,</span><span class="n">Axishght</span><span class="p">,</span><span class="n">ActCD</span><span class="p">,</span><span class="n">Cs</span><span class="p">,</span><span class="n">expn</span><span class="p">,</span><span class="k">Type</span>
<a name="ln-3794"></a><span class="k">      </span><span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Interval</span><span class="p">,</span><span class="n">fmasum</span><span class="p">,</span><span class="n">dfmasum</span><span class="p">,</span><span class="n">Prefact</span><span class="p">,</span><span class="n">EvalHghts</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3795"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">h2</span><span class="p">,</span><span class="n">h4</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">rholink</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span>
<a name="ln-3796"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">DpZeroOffset</span><span class="p">,</span><span class="n">area</span><span class="p">,</span><span class="n">WFact</span><span class="p">,</span><span class="n">HFact</span>
<a name="ln-3797"></a>      <span class="kt">INTEGER </span><span class="n">i</span><span class="p">,</span><span class="nb">Loc</span><span class="p">,</span><span class="n">iNum</span>
<a name="ln-3798"></a>
<a name="ln-3799"></a>      <span class="c">! FLOW:</span>
<a name="ln-3800"></a>      <span class="c">! Get component properties</span>
<a name="ln-3801"></a>      <span class="n">DifLim</span> <span class="o">=</span> <span class="mf">1.0d-4</span>
<a name="ln-3802"></a>      <span class="n">CompNum</span> <span class="o">=</span> <span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">TypeNum</span>
<a name="ln-3803"></a>      <span class="n">Width</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Width</span>
<a name="ln-3804"></a>      <span class="n">Height</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Height</span>
<a name="ln-3805"></a>      <span class="n">fact</span> <span class="o">=</span> <span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">OpenFactor</span>
<a name="ln-3806"></a>      <span class="nb">Loc</span> <span class="o">=</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">DetOpenNum</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-3807"></a>      <span class="n">iNum</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">NumFac</span>
<a name="ln-3808"></a>      <span class="n">ActCD</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3809"></a>
<a name="ln-3810"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">iNum</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3811"></a><span class="k">        if</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3812"></a><span class="k">          </span><span class="n">WFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3813"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3814"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3815"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac1</span><span class="p">)</span>
<a name="ln-3816"></a>          <span class="n">HFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3817"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3818"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3819"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac1</span><span class="p">)</span>
<a name="ln-3820"></a>          <span class="n">CFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3821"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3822"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3823"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff1</span><span class="p">)</span>
<a name="ln-3824"></a>        <span class="k">Else</span>
<a name="ln-3825"></a><span class="k">          CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Open Factor is above the maximum input range for opening factors in &#39;</span> <span class="p">&amp;</span>
<a name="ln-3826"></a>                              <span class="o">//</span><span class="s1">&#39;AirflowNetwork:MultiZone:Component:DetailedOpening = &#39;</span> <span class="p">&amp;</span>
<a name="ln-3827"></a>                                   <span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">))</span>
<a name="ln-3828"></a>        <span class="k">End if</span>
<a name="ln-3829"></a><span class="k">      end if</span>
<a name="ln-3830"></a>
<a name="ln-3831"></a><span class="k">      if</span> <span class="p">(</span><span class="n">iNum</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3832"></a><span class="k">        if</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3833"></a><span class="k">          </span><span class="n">WFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3834"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3835"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3836"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac1</span><span class="p">)</span>
<a name="ln-3837"></a>          <span class="n">HFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3838"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3839"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3840"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac1</span><span class="p">)</span>
<a name="ln-3841"></a>          <span class="n">CFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3842"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3843"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3844"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff1</span><span class="p">)</span>
<a name="ln-3845"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3846"></a><span class="k">          </span><span class="n">WFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac2</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3847"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3848"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3849"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac2</span><span class="p">)</span>
<a name="ln-3850"></a>          <span class="n">HFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac2</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3851"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3852"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3853"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac2</span><span class="p">)</span>
<a name="ln-3854"></a>          <span class="n">CFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff2</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3855"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3856"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3857"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff2</span><span class="p">)</span>
<a name="ln-3858"></a>        <span class="k">Else</span>
<a name="ln-3859"></a><span class="k">          CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Open Factor is above the maximum input range for opening factors in &#39;</span> <span class="p">&amp;</span>
<a name="ln-3860"></a>                              <span class="o">//</span><span class="s1">&#39;AirflowNetwork:MultiZone:Component:DetailedOpening = &#39;</span> <span class="p">&amp;</span>
<a name="ln-3861"></a>                                   <span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">))</span>
<a name="ln-3862"></a>        <span class="k">end if</span>
<a name="ln-3863"></a><span class="k">      end if</span>
<a name="ln-3864"></a>
<a name="ln-3865"></a><span class="k">      if</span> <span class="p">(</span><span class="n">iNum</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3866"></a><span class="k">        if</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3867"></a><span class="k">          </span><span class="n">WFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3868"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3869"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3870"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac1</span><span class="p">)</span>
<a name="ln-3871"></a>          <span class="n">HFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3872"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3873"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3874"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac1</span><span class="p">)</span>
<a name="ln-3875"></a>          <span class="n">CFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff1</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3876"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3877"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac1</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3878"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff2</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff1</span><span class="p">)</span>
<a name="ln-3879"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3880"></a><span class="k">          </span><span class="n">WFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac2</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3881"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3882"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3883"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac2</span><span class="p">)</span>
<a name="ln-3884"></a>          <span class="n">HFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac2</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3885"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3886"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3887"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac2</span><span class="p">)</span>
<a name="ln-3888"></a>          <span class="n">CFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff2</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3889"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3890"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac2</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3891"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff3</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff2</span><span class="p">)</span>
<a name="ln-3892"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3893"></a><span class="k">          </span><span class="n">WFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac3</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3894"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3895"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac4</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3896"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac4</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthFac3</span><span class="p">)</span>
<a name="ln-3897"></a>          <span class="n">HFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac3</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3898"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3899"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac4</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3900"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac4</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightFac3</span><span class="p">)</span>
<a name="ln-3901"></a>          <span class="n">CFact</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff3</span><span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-3902"></a>           <span class="p">(</span><span class="n">fact</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-3903"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac4</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">OpenFac3</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-3904"></a>           <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff4</span><span class="o">-</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">DischCoeff3</span><span class="p">)</span>
<a name="ln-3905"></a>        <span class="k">Else</span>
<a name="ln-3906"></a><span class="k">          CALL </span><span class="n">ShowFatalError</span><span class="p">(</span><span class="s1">&#39;Open Factor is above the maximum input range for opening factors in &#39;</span> <span class="p">&amp;</span>
<a name="ln-3907"></a>                              <span class="o">//</span><span class="s1">&#39;AirflowNetwork:MultiZone:Component:DetailedOpening = &#39;</span> <span class="p">&amp;</span>
<a name="ln-3908"></a>                                   <span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">))</span>
<a name="ln-3909"></a>        <span class="k">end if</span>
<a name="ln-3910"></a><span class="k">      end if</span>
<a name="ln-3911"></a>
<a name="ln-3912"></a>      <span class="c">! calculate DpProfNew</span>
<a name="ln-3913"></a>      <span class="k">Do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-3914"></a>        <span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">PDROP</span><span class="o">+</span><span class="n">DpProf</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">DpL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">iL</span><span class="p">)</span>
<a name="ln-3915"></a>      <span class="k">End Do</span>
<a name="ln-3916"></a>
<a name="ln-3917"></a>      <span class="c">! Get opening data based on the opening factor</span>
<a name="ln-3918"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3919"></a><span class="k">        </span><span class="n">ActLw</span><span class="o">=</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Width</span>
<a name="ln-3920"></a>        <span class="n">ActLh</span><span class="o">=</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Height</span>
<a name="ln-3921"></a>        <span class="n">Cfact</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-3922"></a>      <span class="k">else</span>
<a name="ln-3923"></a><span class="k">        </span><span class="n">ActLw</span><span class="o">=</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Width</span><span class="o">*</span><span class="n">Wfact</span>
<a name="ln-3924"></a>        <span class="n">ActLh</span><span class="o">=</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Height</span><span class="o">*</span><span class="n">HFact</span>
<a name="ln-3925"></a>        <span class="n">ActCD</span><span class="o">=</span><span class="n">CFact</span>
<a name="ln-3926"></a>      <span class="k">end if</span>
<a name="ln-3927"></a>
<a name="ln-3928"></a><span class="k">      </span><span class="n">Cs</span><span class="o">=</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowCoef</span>
<a name="ln-3929"></a>      <span class="n">Expn</span><span class="o">=</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">FlowExpo</span>
<a name="ln-3930"></a>      <span class="k">Type</span><span class="o">=</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LVOType</span>
<a name="ln-3931"></a>      <span class="k">IF</span> <span class="p">(</span><span class="k">Type</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3932"></a><span class="k">        </span><span class="n">Lextra</span><span class="o">=</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LVOValue</span>
<a name="ln-3933"></a>        <span class="n">AxisHght</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3934"></a>      <span class="k">ELSE IF</span> <span class="p">(</span><span class="k">Type</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3935"></a><span class="k">        </span><span class="n">Lextra</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3936"></a>        <span class="n">AxisHght</span><span class="o">=</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">LVOValue</span>
<a name="ln-3937"></a>        <span class="n">ActLw</span><span class="o">=</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Width</span>
<a name="ln-3938"></a>        <span class="n">ActLh</span><span class="o">=</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Height</span>
<a name="ln-3939"></a>      <span class="n">ENDIF</span>
<a name="ln-3940"></a>
<a name="ln-3941"></a>      <span class="c">! Add window multiplier with window close</span>
<a name="ln-3942"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Multiplier</span> <span class="o">&gt;</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="n">Cs</span><span class="o">=</span><span class="n">Cs</span><span class="o">*</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Multiplier</span>
<a name="ln-3943"></a>      <span class="c">! Add window multiplier with window open</span>
<a name="ln-3944"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3945"></a><span class="k">        If</span> <span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Multiplier</span> <span class="o">&gt;</span> <span class="mf">1.0d0</span><span class="p">)</span> <span class="n">ActLw</span><span class="o">=</span><span class="n">ActLw</span><span class="o">*</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">IL</span><span class="p">)%</span><span class="n">Multiplier</span>
<a name="ln-3946"></a>      <span class="k">End If</span>
<a name="ln-3947"></a>
<a name="ln-3948"></a>      <span class="c">! Add recurring warnings</span>
<a name="ln-3949"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">fact</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3950"></a><span class="k">        If</span> <span class="p">(</span><span class="n">ActLw</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-3951"></a><span class="k">          </span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthErrCount</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthErrCount</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3952"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthErrCount</span><span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3953"></a><span class="k">            CALL </span><span class="n">ShowWarningError</span><span class="p">(</span><span class="s1">&#39;The actual width of the AirflowNetwork:MultiZone:Component:DetailedOpening of &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3954"></a>              <span class="nb">TRIM</span><span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; is 0.&#39;</span><span class="p">)</span>
<a name="ln-3955"></a>            <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;The actual width is set to 1.0E-6 m.&#39;</span><span class="p">)</span>
<a name="ln-3956"></a>            <span class="k">CALL </span><span class="n">ShowContinueErrorTimeStamp</span><span class="p">(</span><span class="s1">&#39; Occurrence info: &#39;</span><span class="p">)</span>
<a name="ln-3957"></a>          <span class="k">else</span>
<a name="ln-3958"></a><span class="k">            CALL </span><span class="n">ShowRecurringWarningErrorAtEnd</span><span class="p">(</span><span class="s1">&#39;The actual width of the &#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-3959"></a>              <span class="s1">&#39;AirflowNetwork:MultiZone:Component:DetailedOpening of &#39;</span> <span class="p">&amp;</span>
<a name="ln-3960"></a>              <span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; is 0 error continues.&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3961"></a>              <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">WidthErrIndex</span><span class="p">,</span> <span class="n">ActLw</span><span class="p">,</span><span class="n">ActLw</span><span class="p">)</span>
<a name="ln-3962"></a>          <span class="k">end if</span>
<a name="ln-3963"></a><span class="k">          </span><span class="n">ActLw</span> <span class="o">=</span> <span class="mf">1.0d-6</span>
<a name="ln-3964"></a>        <span class="k">End If</span>
<a name="ln-3965"></a><span class="k">        If</span> <span class="p">(</span><span class="n">ActLh</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">Then</span>
<a name="ln-3966"></a><span class="k">          </span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightErrCount</span> <span class="o">=</span> <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightErrCount</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3967"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightErrCount</span><span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3968"></a><span class="k">            CALL </span><span class="n">ShowWarningError</span><span class="p">(</span><span class="s1">&#39;The actual height of the AirflowNetwork:MultiZone:Component:DetailedOpening of &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3969"></a>              <span class="nb">TRIM</span><span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; is 0.&#39;</span><span class="p">)</span>
<a name="ln-3970"></a>            <span class="k">CALL </span><span class="n">ShowContinueError</span><span class="p">(</span><span class="s1">&#39;The actual height is set to 1.0E-6 m.&#39;</span><span class="p">)</span>
<a name="ln-3971"></a>            <span class="k">CALL </span><span class="n">ShowContinueErrorTimeStamp</span><span class="p">(</span><span class="s1">&#39; Occurrence info: &#39;</span><span class="p">)</span>
<a name="ln-3972"></a>          <span class="k">else</span>
<a name="ln-3973"></a><span class="k">            CALL </span><span class="n">ShowRecurringWarningErrorAtEnd</span><span class="p">(</span><span class="s1">&#39;The actual width of the &#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-3974"></a>              <span class="s1">&#39;AirflowNetwork:MultiZone:Component:DetailedOpening of &#39;</span> <span class="p">&amp;</span>
<a name="ln-3975"></a>              <span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; is 0 error continues.&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3976"></a>              <span class="n">MultizoneCompDetOpeningData</span><span class="p">(</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">HeightErrIndex</span><span class="p">,</span> <span class="n">ActLh</span><span class="p">,</span><span class="n">ActLh</span><span class="p">)</span>
<a name="ln-3977"></a>          <span class="k">end if</span>
<a name="ln-3978"></a><span class="k">          </span><span class="n">ActLh</span> <span class="o">=</span> <span class="mf">1.0d-6</span>
<a name="ln-3979"></a>        <span class="k">End If</span>
<a name="ln-3980"></a><span class="k">      End If</span>
<a name="ln-3981"></a>      <span class="c">! Initialization:</span>
<a name="ln-3982"></a>      <span class="n">NF</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3983"></a>      <span class="n">Interval</span><span class="o">=</span><span class="n">ActLh</span><span class="o">/</span><span class="n">NrInt</span>
<a name="ln-3984"></a>      <span class="n">fma12</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3985"></a>      <span class="n">fma21</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3986"></a>      <span class="n">dp1fma12</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3987"></a>      <span class="n">dp1fma21</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-3988"></a>
<a name="ln-3989"></a>      <span class="c">! Closed LO</span>
<a name="ln-3990"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Cfact</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3991"></a><span class="k">        </span><span class="n">DpZeroOffset</span><span class="o">=</span><span class="n">DifLim</span>
<a name="ln-3992"></a>        <span class="c">! bottom crack</span>
<a name="ln-3993"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3994"></a><span class="k">          IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-3995"></a><span class="k">            </span><span class="n">dfmasum</span><span class="o">=</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="o">**</span><span class="n">expn</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-3996"></a>            <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-3997"></a>          <span class="k">ELSE</span>
<a name="ln-3998"></a><span class="k">            </span><span class="n">fmasum</span><span class="o">=</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="n">expn</span>
<a name="ln-3999"></a>            <span class="n">dfmasum</span><span class="o">=</span><span class="n">fmasum</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4000"></a>          <span class="n">ENDIF</span>
<a name="ln-4001"></a>          <span class="n">fma12</span><span class="o">=</span><span class="n">fma12</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4002"></a>          <span class="n">dp1fma12</span><span class="o">=</span><span class="n">dp1fma12</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4003"></a>        <span class="k">ELSE</span>
<a name="ln-4004"></a><span class="k">          IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4005"></a><span class="k">            </span><span class="n">dfmasum</span><span class="o">=-</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="o">**</span><span class="n">expn</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-4006"></a>            <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4007"></a>          <span class="k">ELSE</span>
<a name="ln-4008"></a><span class="k">            </span><span class="n">fmasum</span><span class="o">=</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="n">expn</span>
<a name="ln-4009"></a>            <span class="n">dfmasum</span><span class="o">=</span><span class="n">fmasum</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4010"></a>          <span class="n">ENDIF</span>
<a name="ln-4011"></a>          <span class="n">fma21</span><span class="o">=</span><span class="n">fma21</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4012"></a>          <span class="n">dp1fma21</span><span class="o">=</span><span class="n">dp1fma21</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4013"></a>        <span class="n">ENDIF</span>
<a name="ln-4014"></a>        <span class="c">! top crack</span>
<a name="ln-4015"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4016"></a><span class="k">          IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4017"></a><span class="k">            </span><span class="n">dfmasum</span><span class="o">=</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="o">**</span><span class="n">expn</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-4018"></a>            <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4019"></a>          <span class="k">ELSE</span>
<a name="ln-4020"></a><span class="k">            </span><span class="n">fmasum</span><span class="o">=</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="n">expn</span>
<a name="ln-4021"></a>            <span class="n">dfmasum</span><span class="o">=</span><span class="n">fmasum</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4022"></a>          <span class="n">ENDIF</span>
<a name="ln-4023"></a>          <span class="n">fma12</span><span class="o">=</span><span class="n">fma12</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4024"></a>          <span class="n">dp1fma12</span><span class="o">=</span><span class="n">dp1fma12</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4025"></a>        <span class="k">ELSE</span>
<a name="ln-4026"></a><span class="k">          IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4027"></a><span class="k">            </span><span class="n">dfmasum</span><span class="o">=-</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="o">**</span><span class="n">expn</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-4028"></a>            <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4029"></a>          <span class="k">ELSE</span>
<a name="ln-4030"></a><span class="k">            </span><span class="n">fmasum</span><span class="o">=</span><span class="n">Cs</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="n">expn</span>
<a name="ln-4031"></a>            <span class="n">dfmasum</span><span class="o">=</span><span class="n">fmasum</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4032"></a>          <span class="n">ENDIF</span>
<a name="ln-4033"></a>          <span class="n">fma21</span><span class="o">=</span><span class="n">fma21</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4034"></a>          <span class="n">dp1fma21</span><span class="o">=</span><span class="n">dp1fma21</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4035"></a>        <span class="n">ENDIF</span>
<a name="ln-4036"></a>        <span class="c">! side and extra cracks</span>
<a name="ln-4037"></a>        <span class="n">Prefact</span><span class="o">=</span><span class="n">Interval</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">lextra</span><span class="o">/</span><span class="n">ActLh</span><span class="p">)</span><span class="o">*</span><span class="n">Cs</span>
<a name="ln-4038"></a>        <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4039"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4040"></a><span class="k">            IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4041"></a><span class="k">              </span><span class="n">dfmasum</span><span class="o">=</span><span class="n">Prefact</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="o">**</span><span class="n">expn</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-4042"></a>              <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4043"></a>            <span class="k">ELSE</span>
<a name="ln-4044"></a><span class="k">              </span><span class="n">fmasum</span><span class="o">=</span><span class="n">Prefact</span><span class="o">*</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">**</span><span class="n">expn</span>
<a name="ln-4045"></a>              <span class="n">dfmasum</span><span class="o">=</span><span class="n">fmasum</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4046"></a>            <span class="n">ENDIF</span>
<a name="ln-4047"></a>            <span class="n">fma12</span><span class="o">=</span><span class="n">fma12</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4048"></a>            <span class="n">dp1fma12</span><span class="o">=</span><span class="n">dp1fma12</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4049"></a>          <span class="k">ELSE</span>
<a name="ln-4050"></a><span class="k">            IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4051"></a><span class="k">              </span><span class="n">dfmasum</span><span class="o">=-</span><span class="n">Prefact</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="o">**</span><span class="n">expn</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-4052"></a>              <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4053"></a>            <span class="k">ELSE</span>
<a name="ln-4054"></a><span class="k">              </span><span class="n">fmasum</span><span class="o">=</span><span class="n">Prefact</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">**</span><span class="n">expn</span>
<a name="ln-4055"></a>              <span class="n">dfmasum</span><span class="o">=</span><span class="n">fmasum</span><span class="o">*</span><span class="n">expn</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4056"></a>            <span class="n">ENDIF</span>
<a name="ln-4057"></a>            <span class="n">fma21</span><span class="o">=</span><span class="n">fma21</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4058"></a>            <span class="n">dp1fma21</span><span class="o">=</span><span class="n">dp1fma21</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4059"></a>          <span class="n">ENDIF</span>
<a name="ln-4060"></a>        <span class="n">ENDDO</span>
<a name="ln-4061"></a>      <span class="n">ENDIF</span>
<a name="ln-4062"></a>
<a name="ln-4063"></a>      <span class="c">! Open LO, type 1</span>
<a name="ln-4064"></a>      <span class="k">IF</span> <span class="p">((</span><span class="n">Cfact</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="k">type</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span>  <span class="k">THEN</span>
<a name="ln-4065"></a><span class="k">        </span><span class="n">DpZeroOffset</span><span class="o">=</span><span class="n">DifLim</span><span class="o">*</span><span class="mi">1</span><span class="n">d</span><span class="o">-</span><span class="mi">3</span>
<a name="ln-4066"></a>        <span class="n">Prefact</span><span class="o">=</span><span class="n">ActLw</span><span class="o">*</span><span class="n">ActCd</span><span class="o">*</span><span class="n">Interval</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0d0</span><span class="p">)</span>
<a name="ln-4067"></a>        <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4068"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4069"></a><span class="k">            IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4070"></a><span class="k">              </span><span class="n">dfmasum</span><span class="o">=</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">RhoProfF</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="p">)</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-4071"></a>              <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4072"></a>            <span class="k">ELSE</span>
<a name="ln-4073"></a><span class="k">              </span><span class="n">fmasum</span><span class="o">=</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">RhoProfF</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4074"></a>              <span class="n">dfmasum</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">fmasum</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4075"></a>            <span class="n">ENDIF</span>
<a name="ln-4076"></a>            <span class="n">fma12</span><span class="o">=</span><span class="n">fma12</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4077"></a>            <span class="n">dp1fma12</span><span class="o">=</span><span class="n">dp1fma12</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4078"></a>          <span class="k">ELSE</span>
<a name="ln-4079"></a><span class="k">            IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4080"></a><span class="k">              </span><span class="n">dfmasum</span><span class="o">=-</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">RhoProfT</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">DpZeroOffset</span><span class="p">)</span><span class="o">/</span><span class="n">DpZeroOffset</span>
<a name="ln-4081"></a>              <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4082"></a>            <span class="k">ELSE</span>
<a name="ln-4083"></a><span class="k">              </span><span class="n">fmasum</span><span class="o">=</span><span class="nb">SQRT</span><span class="p">(</span><span class="o">-</span><span class="n">RhoProfT</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4084"></a>              <span class="n">dfmasum</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">fmasum</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4085"></a>            <span class="n">ENDIF</span>
<a name="ln-4086"></a>            <span class="n">fma21</span><span class="o">=</span><span class="n">fma21</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4087"></a>            <span class="n">dp1fma21</span><span class="o">=</span><span class="n">dp1fma21</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4088"></a>          <span class="n">ENDIF</span>
<a name="ln-4089"></a>        <span class="n">ENDDO</span>
<a name="ln-4090"></a>
<a name="ln-4091"></a>        <span class="n">fma12</span><span class="o">=</span><span class="n">prefact</span><span class="o">*</span><span class="n">fma12</span>
<a name="ln-4092"></a>        <span class="n">fma21</span><span class="o">=</span><span class="n">prefact</span><span class="o">*</span><span class="n">fma21</span>
<a name="ln-4093"></a>        <span class="n">dp1fma12</span><span class="o">=</span><span class="n">prefact</span><span class="o">*</span><span class="n">dp1fma12</span>
<a name="ln-4094"></a>        <span class="n">dp1fma21</span><span class="o">=</span><span class="n">prefact</span><span class="o">*</span><span class="n">dp1fma21</span>
<a name="ln-4095"></a>
<a name="ln-4096"></a>      <span class="n">ENDIF</span>
<a name="ln-4097"></a>
<a name="ln-4098"></a>      <span class="c">! Open LO, type 2</span>
<a name="ln-4099"></a>      <span class="k">IF</span> <span class="p">((</span><span class="n">Cfact</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="k">type</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span>  <span class="k">THEN</span>
<a name="ln-4100"></a>        <span class="c">! Initialization</span>
<a name="ln-4101"></a>        <span class="n">DpZeroOffset</span><span class="o">=</span><span class="n">DifLim</span><span class="o">*</span><span class="mi">1</span><span class="n">d</span><span class="o">-</span><span class="mi">3</span>
<a name="ln-4102"></a>        <span class="c">! New definition for opening factors for LVO type 2: opening angle = 90 degrees --&gt; opening factor = 1.0</span>
<a name="ln-4103"></a>        <span class="c">! should be PIOvr2 in below?</span>
<a name="ln-4104"></a>        <span class="n">alpha</span><span class="o">=</span><span class="n">fact</span><span class="o">*</span><span class="mf">3.14159d0</span><span class="o">/</span><span class="mf">2.d0</span>
<a name="ln-4105"></a>        <span class="n">h2</span><span class="o">=</span><span class="n">Axishght</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0d0</span><span class="o">-</span><span class="nb">COS</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
<a name="ln-4106"></a>        <span class="n">h4</span><span class="o">=</span><span class="n">Axishght</span><span class="o">+</span><span class="p">(</span><span class="n">ActLh</span><span class="o">-</span><span class="n">Axishght</span><span class="p">)</span><span class="o">*</span><span class="nb">COS</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
<a name="ln-4107"></a>        <span class="n">EvalHghts</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4108"></a>        <span class="n">EvalHghts</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">ActLh</span>
<a name="ln-4109"></a>        <span class="c">! New definition for opening factors for LVO type 2: pening angle = 90 degrees --&gt; opening factor = 1.0</span>
<a name="ln-4110"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">fact</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mf">1.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4111"></a><span class="k">          </span><span class="n">h2</span><span class="o">=</span><span class="n">Axishght</span>
<a name="ln-4112"></a>          <span class="n">h4</span><span class="o">=</span><span class="n">Axishght</span>
<a name="ln-4113"></a>        <span class="n">ENDIF</span>
<a name="ln-4114"></a>
<a name="ln-4115"></a>        <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4116"></a>          <span class="n">EvalHghts</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">Interval</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mf">1.5d0</span><span class="p">)</span>
<a name="ln-4117"></a>        <span class="n">ENDDO</span>
<a name="ln-4118"></a>
<a name="ln-4119"></a>        <span class="c">! Calculation of massflow and its derivative</span>
<a name="ln-4120"></a>        <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4121"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4122"></a><span class="k">            </span><span class="n">rholink</span><span class="o">=</span><span class="n">RhoProfF</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4123"></a>          <span class="k">ELSE</span>
<a name="ln-4124"></a><span class="k">            </span><span class="n">rholink</span><span class="o">=</span><span class="n">RhoProfT</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4125"></a>          <span class="n">ENDIF</span>
<a name="ln-4126"></a>
<a name="ln-4127"></a>          <span class="k">IF</span> <span class="p">((</span><span class="n">EvalHghts</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="n">h2</span><span class="p">).</span><span class="nb">OR</span><span class="p">.(</span><span class="n">EvalHghts</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="n">h4</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-4128"></a><span class="k">            IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4129"></a><span class="k">              </span><span class="n">dfmasum</span><span class="o">=</span><span class="n">ActCd</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">Interval</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rholink</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-4130"></a>              <span class="n">DpZeroOffset</span><span class="p">)</span><span class="o">/</span><span class="n">DpZeroOffset</span><span class="o">*</span><span class="nb">DSIGN</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">,</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4131"></a>              <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4132"></a>            <span class="k">ELSE</span>
<a name="ln-4133"></a><span class="k">              </span><span class="n">fmasum</span><span class="o">=</span><span class="n">ActCd</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">Interval</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rholink</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-4134"></a>              <span class="n">dfmasum</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">fmasum</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4135"></a>            <span class="n">ENDIF</span>
<a name="ln-4136"></a>          <span class="k">ELSE</span>
<a name="ln-4137"></a>            <span class="c">! triangular opening at the side of LO</span>
<a name="ln-4138"></a>            <span class="n">c1</span><span class="o">=</span><span class="n">ActCd</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">Interval</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rholink</span><span class="p">)</span>
<a name="ln-4139"></a>            <span class="n">c2</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ActCd</span><span class="o">*</span><span class="nb">ABS</span><span class="p">((</span><span class="n">Axishght</span><span class="o">-</span><span class="n">Evalhghts</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="o">*</span><span class="nb">TAN</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-4140"></a>              <span class="n">Interval</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">2.0d0</span><span class="o">*</span><span class="n">rholink</span><span class="p">)</span>
<a name="ln-4141"></a>            <span class="k">IF</span> <span class="p">((</span><span class="n">c1</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="n">c2</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-4142"></a><span class="k">              IF</span> <span class="p">(</span><span class="nb">Abs</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">DpZeroOffset</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4143"></a><span class="k">                </span><span class="n">dfmasum</span><span class="o">=</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">DpZeroOffset</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c1</span><span class="o">/</span><span class="n">c1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">c2</span><span class="o">/</span><span class="n">c2</span><span class="p">))</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-4144"></a>                        <span class="n">DpZeroOffset</span><span class="o">*</span><span class="nb">DSIGN</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">,</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4145"></a>                <span class="n">fmasum</span><span class="o">=</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dfmasum</span>
<a name="ln-4146"></a>              <span class="k">ELSE</span>
<a name="ln-4147"></a><span class="k">                </span><span class="n">fmasum</span><span class="o">=</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c1</span><span class="o">/</span><span class="n">c1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">c2</span><span class="o">/</span><span class="n">c2</span><span class="p">))</span>
<a name="ln-4148"></a>                <span class="n">dfmasum</span><span class="o">=</span><span class="mf">0.5d0</span><span class="o">*</span><span class="n">fmasum</span><span class="o">/</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4149"></a>              <span class="n">ENDIF</span>
<a name="ln-4150"></a>            <span class="k">ELSE</span>
<a name="ln-4151"></a><span class="k">              </span><span class="n">fmasum</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4152"></a>              <span class="n">dfmasum</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4153"></a>            <span class="n">ENDIF</span>
<a name="ln-4154"></a>          <span class="n">ENDIF</span>
<a name="ln-4155"></a>
<a name="ln-4156"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4157"></a><span class="k">            </span><span class="n">fma12</span><span class="o">=</span><span class="n">fma12</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4158"></a>            <span class="n">dp1fma12</span><span class="o">=</span><span class="n">dp1fma12</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4159"></a>          <span class="k">ELSE</span>
<a name="ln-4160"></a><span class="k">            </span><span class="n">fma21</span><span class="o">=</span><span class="n">fma21</span><span class="o">+</span><span class="n">fmasum</span>
<a name="ln-4161"></a>            <span class="n">dp1fma21</span><span class="o">=</span><span class="n">dp1fma21</span><span class="o">+</span><span class="n">dfmasum</span>
<a name="ln-4162"></a>          <span class="n">ENDIF</span>
<a name="ln-4163"></a>        <span class="n">ENDDO</span>
<a name="ln-4164"></a>
<a name="ln-4165"></a>      <span class="n">ENDIF</span>
<a name="ln-4166"></a>
<a name="ln-4167"></a>      <span class="c">! Calculate some velocity in the large opening</span>
<a name="ln-4168"></a>      <span class="n">area</span><span class="o">=</span><span class="n">ActLh</span><span class="o">*</span><span class="n">ActLw</span><span class="o">*</span><span class="n">actCD</span>
<a name="ln-4169"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">area</span><span class="p">.</span><span class="n">gt</span><span class="p">.(</span><span class="n">cs</span><span class="o">+</span><span class="n">RealMin</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4170"></a><span class="k">        if</span> <span class="p">(</span><span class="n">area</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">RealMin</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4171"></a><span class="k">          </span><span class="n">FvVeloc</span><span class="o">=</span><span class="p">(</span><span class="n">fma21</span><span class="o">+</span><span class="n">fma12</span><span class="p">)</span><span class="o">/</span><span class="n">area</span>
<a name="ln-4172"></a>        <span class="k">else</span>
<a name="ln-4173"></a><span class="k">          </span><span class="n">FvVeloc</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4174"></a>        <span class="k">end if</span>
<a name="ln-4175"></a><span class="k">      else</span>
<a name="ln-4176"></a>        <span class="c">! here the average velocity over the full area, may blow half in half out.</span>
<a name="ln-4177"></a>        <span class="c">! velocity= Fva/Nett area=Fma/Rho/(Cm/( (2**N)* sqrt(1.2) ) )</span>
<a name="ln-4178"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">cs</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4179"></a>          <span class="c">! get the average Rho for this closed window</span>
<a name="ln-4180"></a>          <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4181"></a>            <span class="n">rholink</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4182"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">DpProfNew</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4183"></a><span class="k">              </span><span class="n">rholink</span><span class="o">=</span><span class="n">RhoProfF</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4184"></a>            <span class="k">ELSE</span>
<a name="ln-4185"></a><span class="k">              </span><span class="n">rholink</span><span class="o">=</span><span class="n">RhoProfT</span><span class="p">(</span><span class="nb">Loc</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4186"></a>            <span class="n">ENDIF</span>
<a name="ln-4187"></a>            <span class="n">rholink</span><span class="o">=</span><span class="n">rholink</span><span class="o">/</span><span class="n">nrInt</span>
<a name="ln-4188"></a>            <span class="n">rholink</span><span class="o">=</span><span class="mf">1.2d0</span>
<a name="ln-4189"></a>          <span class="k">END DO</span>
<a name="ln-4190"></a><span class="k">          </span><span class="n">FvVeloc</span><span class="o">=</span><span class="p">(</span><span class="n">Fma21</span><span class="o">+</span><span class="n">fma12</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">**</span><span class="n">ExpN</span><span class="p">)</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="mf">1.2d0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rhoLink</span><span class="o">*</span><span class="n">Cs</span><span class="p">)</span>
<a name="ln-4191"></a>        <span class="k">else</span>
<a name="ln-4192"></a><span class="k">          </span><span class="n">FvVeloc</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4193"></a>        <span class="k">end if</span>
<a name="ln-4194"></a><span class="k">      end if</span>
<a name="ln-4195"></a>
<a name="ln-4196"></a>      <span class="c">! Output mass flow rates and associated derivatives</span>
<a name="ln-4197"></a>      <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fma12</span><span class="o">-</span><span class="n">fma21</span>
<a name="ln-4198"></a>      <span class="n">DF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dp1fma12</span><span class="o">-</span><span class="n">dp1fma21</span>
<a name="ln-4199"></a>      <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4200"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">fma12</span> <span class="p">.</span><span class="n">NE</span><span class="p">.</span> <span class="mf">0.0d0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">fma21</span> <span class="p">.</span><span class="n">NE</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4201"></a><span class="k">        </span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fma21</span>
<a name="ln-4202"></a>      <span class="k">End if</span>
<a name="ln-4203"></a><span class="k">      </span><span class="n">DF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0d0</span>
<a name="ln-4204"></a>
<a name="ln-4205"></a>      <span class="k">RETURN</span>
<a name="ln-4206"></a><span class="k">    END SUBROUTINE </span><span class="n">AFEDOP</span>
<a name="ln-4207"></a>
<a name="ln-4208"></a>    <span class="k">SUBROUTINE </span><span class="n">PresProfile</span><span class="p">(</span><span class="n">il</span><span class="p">,</span><span class="n">Pprof</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="n">DpF</span><span class="p">,</span><span class="n">DpT</span><span class="p">,</span><span class="n">BetaF</span><span class="p">,</span><span class="n">BetaT</span><span class="p">,</span><span class="n">RhoStF</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4209"></a>            <span class="n">RhoStT</span><span class="p">,</span><span class="n">From</span><span class="p">,</span><span class="n">To</span><span class="p">,</span><span class="n">ActLh</span><span class="p">,</span><span class="n">OwnHeightFactor</span><span class="p">)</span>
<a name="ln-4210"></a>
<a name="ln-4211"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-4212"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-4213"></a>          <span class="c">!       DATE WRITTEN   Oct. 2005</span>
<a name="ln-4214"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-4215"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised based on PresProfile subroutine from COMIS</span>
<a name="ln-4216"></a>
<a name="ln-4217"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-4218"></a>          <span class="c">! This subroutine calculates for a large opening profiles of stack pressure difference and</span>
<a name="ln-4219"></a>          <span class="c">! densities in the zones linked by the a detailed opening cmponent.</span>
<a name="ln-4220"></a>
<a name="ln-4221"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-4222"></a>          <span class="c">! The profiles are obtained in the following</span>
<a name="ln-4223"></a>          <span class="c">! way:    - the opening is divided into NrInt vertical intervals</span>
<a name="ln-4224"></a>          <span class="c">!         - the stack pressure difference and densities in From-</span>
<a name="ln-4225"></a>          <span class="c">!           and To-zone are calculated at the centre of each</span>
<a name="ln-4226"></a>          <span class="c">!           interval aswell as at the top and bottom of the LO</span>
<a name="ln-4227"></a>          <span class="c">!          - these values are stored in the (NrInt+2)-dimensional</span>
<a name="ln-4228"></a>          <span class="c">!             arrays DpProf, RhoProfF, RhoProfT.</span>
<a name="ln-4229"></a>          <span class="c">! The calculation of stack pressure and density in the two zones</span>
<a name="ln-4230"></a>          <span class="c">! is based on the arrays DpF/T, RhoStF/T, BetaF/T. These arrays</span>
<a name="ln-4231"></a>          <span class="c">! are calculated in the COMIS routine Lclimb. They contain the</span>
<a name="ln-4232"></a>          <span class="c">! values of stack pressure and density at the startheight of the</span>
<a name="ln-4233"></a>          <span class="c">! opening and at startheights of all layers lying inside the</span>
<a name="ln-4234"></a>          <span class="c">! opening, and the density gradients across the layers.</span>
<a name="ln-4235"></a>          <span class="c">! The effective startheight zl(1/2) in the From/To zone and the</span>
<a name="ln-4236"></a>          <span class="c">! effective length actLh of the LO take into account the</span>
<a name="ln-4237"></a>          <span class="c">! startheightfactor, heightfactor and ownheightfactor. Thus for</span>
<a name="ln-4238"></a>          <span class="c">! slanted windows the range of the profiles is the vertical</span>
<a name="ln-4239"></a>          <span class="c">! projection of the actual opening.</span>
<a name="ln-4240"></a>
<a name="ln-4241"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-4242"></a>          <span class="c">! Helmut E. Feustel and Alison Rayner-Hooson, &quot;COMIS Fundamentals,&quot; LBL-28560,</span>
<a name="ln-4243"></a>          <span class="c">! Lawrence Berkeley National Laboratory, Berkeley, CA, May 1990</span>
<a name="ln-4244"></a>
<a name="ln-4245"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-4246"></a>          <span class="c">! na</span>
<a name="ln-4247"></a>
<a name="ln-4248"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-4249"></a>
<a name="ln-4250"></a>
<a name="ln-4251"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-4252"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">IL</span>       <span class="c">! Linkage number</span>
<a name="ln-4253"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">Pprof</span>    <span class="c">! Opening number</span>
<a name="ln-4254"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">G</span>        <span class="c">! gravitation field strength [N/kg]</span>
<a name="ln-4255"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DpF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Stack pressures at start heights of Layers</span>
<a name="ln-4256"></a>                                                 <span class="c">! in the FROM zone (starting at linkheight) [Pa]</span>
<a name="ln-4257"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DpT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Stack pressures at start heights of Layers</span>
<a name="ln-4258"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">BetaF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Density gradients in the FROM zone (starting at linkheight) [Kg/m3/m]</span>
<a name="ln-4259"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">BetaT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Density gradients in the TO zone (starting at linkheight) [Kg/m3/m]</span>
<a name="ln-4260"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">RhoStF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Density at the start heights of Layers in the FROM zone</span>
<a name="ln-4261"></a>                                            <span class="c">! (starting at linkheight) [Kg/m3]</span>
<a name="ln-4262"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">RhoStT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Density at the start heights of Layers in the TO zone</span>
<a name="ln-4263"></a>                                            <span class="c">! (starting at linkheight) [Kg/m3]</span>
<a name="ln-4264"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">ActLh</span>    <span class="c">! Actual height of opening [m]</span>
<a name="ln-4265"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">OwnHeightFactor</span> <span class="c">! Cosine of deviation angle of the opening plane from the vertical direction</span>
<a name="ln-4266"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">From</span>     <span class="c">! Number of FROM zone</span>
<a name="ln-4267"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">To</span>       <span class="c">! Number of To zone</span>
<a name="ln-4268"></a>
<a name="ln-4269"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-4270"></a>          <span class="c">! na</span>
<a name="ln-4271"></a>
<a name="ln-4272"></a>
<a name="ln-4273"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-4274"></a>          <span class="c">! na</span>
<a name="ln-4275"></a>
<a name="ln-4276"></a>
<a name="ln-4277"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-4278"></a>          <span class="c">! na</span>
<a name="ln-4279"></a>
<a name="ln-4280"></a>
<a name="ln-4281"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-4282"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">zF</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">zT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Startheights of layers in FROM-, TO-zone</span>
<a name="ln-4283"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">zStF</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">zStT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Startheights of layers within the LO, starting with the actual startheight of the LO.</span>
<a name="ln-4284"></a>                           <span class="c">! The values in the arrays DpF, DpT, BetaF, BetaT, RhoStF, RhoStT are calculated at these heights.</span>
<a name="ln-4285"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">hghtsFR</span><span class="p">,</span> <span class="n">hghtsTR</span>
<a name="ln-4286"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">hghtsF</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="n">hghtsT</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="c">! Heights of evaluation points for pressure and density profiles</span>
<a name="ln-4287"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Interval</span> <span class="c">! Distance between two evaluation points</span>
<a name="ln-4288"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">delzF</span><span class="p">,</span><span class="n">delzT</span> <span class="c">! Interval between actual evaluation point and startheight of actual layer in FROM-, TO-zone</span>
<a name="ln-4289"></a>      <span class="kt">INTEGER </span><span class="n">AnzLayF</span><span class="p">,</span><span class="n">AnzLayT</span> <span class="c">! Number of layers in FROM-, TO-zone</span>
<a name="ln-4290"></a>      <span class="kt">INTEGER </span><span class="n">lF</span><span class="p">,</span><span class="n">lT</span> <span class="c">! Actual index for DpF/T, BetaF/T, RhoStF/T, zStF/T</span>
<a name="ln-4291"></a>      <span class="kt">INTEGER </span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span>
<a name="ln-4292"></a>
<a name="ln-4293"></a>
<a name="ln-4294"></a>      <span class="c">! FLOW:</span>
<a name="ln-4295"></a>      <span class="c">! Initialization</span>
<a name="ln-4296"></a>      <span class="n">delzF</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4297"></a>      <span class="n">delzT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4298"></a>      <span class="n">Interval</span><span class="o">=</span><span class="n">ActLh</span><span class="o">*</span><span class="n">OwnHeightFactor</span><span class="o">/</span><span class="n">NrInt</span>
<a name="ln-4299"></a>
<a name="ln-4300"></a>      <span class="k">DO </span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NrInt</span>
<a name="ln-4301"></a>        <span class="n">hghtsF</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">Interval</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mf">0.5d0</span><span class="p">)</span>
<a name="ln-4302"></a>        <span class="n">hghtsT</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">Interval</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mf">0.5d0</span><span class="p">)</span>
<a name="ln-4303"></a>      <span class="k">END DO</span>
<a name="ln-4304"></a><span class="k">      </span><span class="n">hghtsF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4305"></a>      <span class="n">hghtsT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4306"></a>      <span class="n">hghtsF</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ActLh</span><span class="o">*</span><span class="n">OwnHeightFactor</span>
<a name="ln-4307"></a>      <span class="n">hghtsT</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">ActLh</span><span class="o">*</span><span class="n">OwnHeightFactor</span>
<a name="ln-4308"></a>
<a name="ln-4309"></a>      <span class="n">lF</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4310"></a>      <span class="n">lT</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4311"></a>      <span class="k">If</span> <span class="p">(</span><span class="n">From</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4312"></a><span class="k">        </span><span class="n">AnzLayF</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4313"></a>      <span class="k">Else</span>
<a name="ln-4314"></a><span class="k">        </span><span class="n">AnzLayF</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4315"></a>      <span class="k">End if</span>
<a name="ln-4316"></a><span class="k">      If</span> <span class="p">(</span><span class="n">To</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4317"></a><span class="k">        </span><span class="n">AnzLayT</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4318"></a>      <span class="k">Else</span>
<a name="ln-4319"></a><span class="k">        </span><span class="n">AnzLayT</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4320"></a>      <span class="k">End if</span>
<a name="ln-4321"></a>
<a name="ln-4322"></a><span class="k">      IF</span> <span class="p">(</span><span class="n">AnzLayF</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4323"></a><span class="k">        DO </span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">AnzLayF</span>
<a name="ln-4324"></a>          <span class="n">zF</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4325"></a>          <span class="k">If</span> <span class="p">(</span><span class="n">hghtsF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">zF</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="n">hghtsF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4326"></a>        <span class="n">ENDDO</span>
<a name="ln-4327"></a>      <span class="n">ENDIF</span>
<a name="ln-4328"></a>
<a name="ln-4329"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">AnzLayT</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4330"></a><span class="k">        DO </span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">AnzLayT</span>
<a name="ln-4331"></a>          <span class="n">zT</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4332"></a>          <span class="k">If</span> <span class="p">(</span><span class="n">hghtsT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">zT</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">=</span><span class="n">hghtsT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4333"></a>        <span class="n">ENDDO</span>
<a name="ln-4334"></a>      <span class="n">ENDIF</span>
<a name="ln-4335"></a>
<a name="ln-4336"></a>      <span class="n">zStF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4337"></a>      <span class="n">i</span><span class="o">=</span><span class="mi">2</span>
<a name="ln-4338"></a>      <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4339"></a>
<a name="ln-4340"></a>      <span class="k">DO WHILE</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">AnzLayF</span><span class="p">)</span>
<a name="ln-4341"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">zF</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">zStF</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">Exit</span>
<a name="ln-4342"></a><span class="k">        </span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4343"></a>      <span class="k">END DO</span>
<a name="ln-4344"></a>
<a name="ln-4345"></a><span class="k">      DO WHILE</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">AnzLayF</span><span class="p">)</span>
<a name="ln-4346"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">zF</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">hghtsF</span><span class="p">(</span><span class="n">NrInt</span><span class="p">))</span> <span class="k">EXIT</span>
<a name="ln-4347"></a><span class="k">        </span><span class="n">zStF</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">zF</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation zStF(i) @ i&gt;2 and zF(k) @ k&gt;2</span>
<a name="ln-4348"></a>        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4349"></a>        <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4350"></a>      <span class="k">END DO</span>
<a name="ln-4351"></a>
<a name="ln-4352"></a><span class="k">      </span><span class="n">zStF</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ActLh</span><span class="o">*</span><span class="n">OwnHeightFactor</span> <span class="c">!Objexx:BoundsViolation zStF(i) @ i&gt;2</span>
<a name="ln-4353"></a>      <span class="n">zStT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4354"></a>      <span class="n">i</span><span class="o">=</span><span class="mi">2</span>
<a name="ln-4355"></a>      <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4356"></a>
<a name="ln-4357"></a>      <span class="k">DO WHILE</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">AnzLayT</span><span class="p">)</span>
<a name="ln-4358"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">zT</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">zStT</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">EXIT</span>
<a name="ln-4359"></a><span class="k">        </span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4360"></a>      <span class="k">END DO</span>
<a name="ln-4361"></a>
<a name="ln-4362"></a><span class="k">      DO WHILE</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">AnzLayT</span><span class="p">)</span>
<a name="ln-4363"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">zT</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">hghtsT</span><span class="p">(</span><span class="n">NrInt</span><span class="p">))</span> <span class="k">EXIT</span> <span class="c">!Objexx:BoundsViolation zT(k) @ k&gt;2</span>
<a name="ln-4364"></a>        <span class="n">zStT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">zT</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation zStF(i) @ i&gt;2 and zT(k) @ k&gt;2</span>
<a name="ln-4365"></a>        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4366"></a>        <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4367"></a>      <span class="k">END DO</span>
<a name="ln-4368"></a>
<a name="ln-4369"></a><span class="k">      </span><span class="n">zStT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">il</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">ActLh</span><span class="o">*</span><span class="n">OwnHeightFactor</span> <span class="c">!Objexx:BoundsViolation zStT(i) @ i&gt;2</span>
<a name="ln-4370"></a>
<a name="ln-4371"></a>      <span class="c">! Calculation of DpProf, RhoProfF, RhoProfT</span>
<a name="ln-4372"></a>      <span class="k">DO </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-4373"></a>        <span class="n">hghtsFR</span><span class="o">=</span><span class="n">hghtsF</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4374"></a>        <span class="n">hghtsTR</span><span class="o">=</span><span class="n">hghtsT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-4375"></a>
<a name="ln-4376"></a>        <span class="k">DO</span>
<a name="ln-4377"></a><span class="k">          IF</span> <span class="p">(</span><span class="n">hghtsFR</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">zStF</span><span class="p">(</span><span class="n">lF</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-4378"></a><span class="k">            IF</span> <span class="p">(</span><span class="n">lF</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mi">2</span><span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-4379"></a><span class="k">            </span><span class="n">lF</span><span class="o">=</span><span class="n">lF</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4380"></a>          <span class="k">END IF</span>
<a name="ln-4381"></a><span class="k">          IF</span> <span class="p">(</span><span class="n">hghtsFR</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">zStF</span><span class="p">(</span><span class="n">lF</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">Exit</span>
<a name="ln-4382"></a><span class="k">        END DO</span>
<a name="ln-4383"></a>
<a name="ln-4384"></a><span class="k">        DO</span>
<a name="ln-4385"></a><span class="k">          IF</span> <span class="p">(</span><span class="n">hghtsTR</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">zStT</span><span class="p">(</span><span class="n">lT</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-4386"></a><span class="k">            </span><span class="n">lT</span><span class="o">=</span><span class="n">lT</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4387"></a>          <span class="k">END IF</span>
<a name="ln-4388"></a><span class="k">          IF</span> <span class="p">(</span><span class="n">hghtsTR</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">zStT</span><span class="p">(</span><span class="n">lT</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">Exit</span>
<a name="ln-4389"></a><span class="k">        END DO</span>
<a name="ln-4390"></a>
<a name="ln-4391"></a><span class="k">        </span><span class="n">delzF</span><span class="o">=</span><span class="n">hghtsF</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">zStF</span><span class="p">(</span><span class="n">lF</span><span class="p">)</span>
<a name="ln-4392"></a>        <span class="n">delzT</span><span class="o">=</span><span class="n">hghtsT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">zStT</span><span class="p">(</span><span class="n">lT</span><span class="p">)</span>
<a name="ln-4393"></a>
<a name="ln-4394"></a>        <span class="n">RhoProfF</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">Pprof</span><span class="p">)</span><span class="o">=</span><span class="n">RhoStF</span><span class="p">(</span><span class="n">lF</span><span class="p">)</span><span class="o">+</span><span class="n">BetaF</span><span class="p">(</span><span class="n">lF</span><span class="p">)</span><span class="o">*</span><span class="n">delzF</span>
<a name="ln-4395"></a>        <span class="n">RhoProfT</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">Pprof</span><span class="p">)</span><span class="o">=</span><span class="n">RhoStT</span><span class="p">(</span><span class="n">lT</span><span class="p">)</span><span class="o">+</span><span class="n">BetaT</span><span class="p">(</span><span class="n">lT</span><span class="p">)</span><span class="o">*</span><span class="n">delzT</span>
<a name="ln-4396"></a>
<a name="ln-4397"></a>        <span class="n">DpProf</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">Pprof</span><span class="p">)</span><span class="o">=</span><span class="n">DpF</span><span class="p">(</span><span class="n">lF</span><span class="p">)</span><span class="o">-</span><span class="n">DpT</span><span class="p">(</span><span class="n">lT</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-4398"></a>            <span class="o">-</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">RhoStF</span><span class="p">(</span><span class="n">lF</span><span class="p">)</span><span class="o">*</span><span class="n">delzF</span><span class="o">+</span><span class="n">BetaF</span><span class="p">(</span><span class="n">lF</span><span class="p">)</span><span class="o">*</span><span class="n">delzF</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0d0</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-4399"></a>            <span class="o">+</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">RhoStT</span><span class="p">(</span><span class="n">lT</span><span class="p">)</span><span class="o">*</span><span class="n">delzT</span><span class="o">+</span><span class="n">BetaT</span><span class="p">(</span><span class="n">lT</span><span class="p">)</span><span class="o">*</span><span class="n">delzT</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0d0</span><span class="p">)</span>
<a name="ln-4400"></a>      <span class="k">END DO</span>
<a name="ln-4401"></a>
<a name="ln-4402"></a><span class="k">      RETURN</span>
<a name="ln-4403"></a><span class="k">    END SUBROUTINE </span><span class="n">PresProfile</span>
<a name="ln-4404"></a>
<a name="ln-4405"></a>    <span class="k">SUBROUTINE </span><span class="n">PStack</span>
<a name="ln-4406"></a>
<a name="ln-4407"></a>          <span class="c">! SUBROUTINE INFORMATION:</span>
<a name="ln-4408"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-4409"></a>          <span class="c">!       DATE WRITTEN   Oct. 2005</span>
<a name="ln-4410"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-4411"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised based on PresProfile subroutine from COMIS</span>
<a name="ln-4412"></a>
<a name="ln-4413"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-4414"></a>          <span class="c">! This subroutine calculates the stack pressures for a link between two zones</span>
<a name="ln-4415"></a>
<a name="ln-4416"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-4417"></a>          <span class="c">! na</span>
<a name="ln-4418"></a>
<a name="ln-4419"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-4420"></a>          <span class="c">! Helmut E. Feustel and Alison Rayner-Hooson, &quot;COMIS Fundamentals,&quot; LBL-28560,</span>
<a name="ln-4421"></a>          <span class="c">! Lawrence Berkeley National Laboratory, Berkeley, CA, May 1990</span>
<a name="ln-4422"></a>
<a name="ln-4423"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-4424"></a>          <span class="c">! na</span>
<a name="ln-4425"></a>
<a name="ln-4426"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-4427"></a>
<a name="ln-4428"></a>
<a name="ln-4429"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-4430"></a>          <span class="c">! na</span>
<a name="ln-4431"></a>
<a name="ln-4432"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-4433"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265358979323846d0</span>
<a name="ln-4434"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">PARAMETER</span> <span class="kd">::</span> <span class="n">PSea</span><span class="o">=</span><span class="mi">10132</span><span class="mf">5.0d0</span>
<a name="ln-4435"></a>
<a name="ln-4436"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-4437"></a>          <span class="c">! na</span>
<a name="ln-4438"></a>
<a name="ln-4439"></a>
<a name="ln-4440"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-4441"></a>          <span class="c">! na</span>
<a name="ln-4442"></a>
<a name="ln-4443"></a>
<a name="ln-4444"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-4445"></a><span class="c">!      REAL(r64) RhoOut ! air density outside [kg/m3]</span>
<a name="ln-4446"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">G</span> <span class="c">! gravity field strength [N/kg]</span>
<a name="ln-4447"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">RhoL1</span><span class="p">,</span><span class="n">RhoL2</span> <span class="c">! Air density [kg/m3]</span>
<a name="ln-4448"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Pbz</span> <span class="c">! Pbarom at entrance level [Pa]</span>
<a name="ln-4449"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">RhoDrL</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">NumOfLinksMultiZone</span><span class="p">)</span> <span class="c">! dry air density on both sides of the link [kg/m3]</span>
<a name="ln-4450"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">TempL1</span><span class="p">,</span><span class="n">TempL2</span> <span class="c">! Temp in From and To zone at link level [C]</span>
<a name="ln-4451"></a><span class="c">!      REAL(r64) Tout ! outside temperature [C]</span>
<a name="ln-4452"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Xhl1</span><span class="p">,</span><span class="n">Xhl2</span> <span class="c">! Humidity in From and To zone at link level [kg/kg]</span>
<a name="ln-4453"></a><span class="c">!      REAL(r64) Xhout ! outside humidity [kg/kg]</span>
<a name="ln-4454"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Hfl</span><span class="p">(</span><span class="n">NumOfLinksMultiZone</span><span class="p">)</span> <span class="c">! Own height factor for large (slanted) openings</span>
<a name="ln-4455"></a>      <span class="kt">INTEGER </span><span class="n">Nl</span> <span class="c">! number of links</span>
<a name="ln-4456"></a>
<a name="ln-4457"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">DpF</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">DpP</span><span class="p">,</span><span class="n">DpT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4458"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">H</span>
<a name="ln-4459"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">RhoStF</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">RhoStT</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">RhoDrDummi</span>
<a name="ln-4460"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">BetaStF</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">BetaStT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4461"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">HSt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4462"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">TzFrom</span><span class="p">,</span><span class="n">XhzFrom</span>
<a name="ln-4463"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">TzTo</span><span class="p">,</span> <span class="n">XhzTo</span>
<a name="ln-4464"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">ActLh</span><span class="p">,</span><span class="n">ActLOwnh</span>
<a name="ln-4465"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Pref</span>
<a name="ln-4466"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">PzFrom</span><span class="p">,</span><span class="n">PzTo</span>
<a name="ln-4467"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">RhoLd</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">RhoStd</span>
<a name="ln-4468"></a>      <span class="kt">INTEGER </span><span class="n">From</span><span class="p">,</span><span class="n">To</span><span class="p">,</span><span class="n">Fromz</span><span class="p">,</span><span class="n">Toz</span><span class="p">,</span><span class="n">Ltyp</span>
<a name="ln-4469"></a>      <span class="kt">INTEGER </span><span class="n">I</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">Pprof</span>
<a name="ln-4470"></a>      <span class="kt">INTEGER </span><span class="n">ilayptr</span><span class="p">,</span><span class="n">OpenNum</span>
<a name="ln-4471"></a>
<a name="ln-4472"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">RhoREF</span><span class="p">,</span> <span class="n">CONV</span>
<a name="ln-4473"></a>
<a name="ln-4474"></a>      <span class="c">! FLOW:</span>
<a name="ln-4475"></a>      <span class="n">RhoREF</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Psea</span><span class="p">,</span><span class="n">OutDryBulbTemp</span><span class="p">,</span><span class="n">OutHumRat</span><span class="p">)</span>
<a name="ln-4476"></a>
<a name="ln-4477"></a>      <span class="n">CONV</span><span class="o">=</span><span class="n">Latitude</span><span class="o">*</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="mi">36</span><span class="mf">0.d0</span>
<a name="ln-4478"></a>      <span class="n">G</span><span class="o">=</span><span class="mf">9.780373d0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.d0</span><span class="o">+</span><span class="p">.</span><span class="mi">0052891</span><span class="n">d0</span><span class="o">*</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="n">CONV</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">.</span><span class="mi">0000059</span><span class="n">d0</span><span class="o">*</span><span class="p">(</span><span class="nb">SIN</span><span class="p">(</span><span class="mf">2.d0</span><span class="o">*</span><span class="n">CONV</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4479"></a>
<a name="ln-4480"></a>      <span class="n">Hfl</span> <span class="o">=</span> <span class="mf">1.0d0</span>
<a name="ln-4481"></a>      <span class="n">Pbz</span> <span class="o">=</span> <span class="n">OutBaroPress</span>
<a name="ln-4482"></a>      <span class="n">Nl</span> <span class="o">=</span> <span class="n">NumOfLinksMultiZone</span>
<a name="ln-4483"></a>      <span class="n">OpenNum</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4484"></a>      <span class="n">RhoLd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">1.2d0</span>
<a name="ln-4485"></a>      <span class="n">RhoLd</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mf">1.2d0</span>
<a name="ln-4486"></a>      <span class="n">RhoStd</span><span class="o">=</span><span class="mf">1.2d0</span>
<a name="ln-4487"></a>
<a name="ln-4488"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nl</span>
<a name="ln-4489"></a>        <span class="c">! Check surface tilt</span>
<a name="ln-4490"></a>        <span class="k">If</span> <span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">DetOpenNum</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-4491"></a>            <span class="n">Surface</span><span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">Tilt</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mi">90</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4492"></a><span class="k">          </span><span class="n">Hfl</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">SurfNum</span><span class="p">)%</span><span class="n">SinTilt</span>
<a name="ln-4493"></a>        <span class="k">End If</span>
<a name="ln-4494"></a>        <span class="c">! Initialisation</span>
<a name="ln-4495"></a>        <span class="n">From</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4496"></a>        <span class="n">To</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeNums</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4497"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">From</span><span class="p">)%</span><span class="n">EPlusZoneNum</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">To</span><span class="p">)%</span><span class="n">EPlusZoneNum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4498"></a><span class="k">          </span><span class="n">LL</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4499"></a>        <span class="k">else if</span><span class="p">(</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">From</span><span class="p">)%</span><span class="n">EPlusZoneNum</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">To</span><span class="p">)%</span><span class="n">EPlusZoneNum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4500"></a><span class="k">          </span><span class="n">LL</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4501"></a>        <span class="k">else</span>
<a name="ln-4502"></a><span class="k">          </span><span class="n">LL</span><span class="o">=</span><span class="mi">3</span>
<a name="ln-4503"></a>        <span class="k">End if</span>
<a name="ln-4504"></a>
<a name="ln-4505"></a><span class="k">        </span><span class="n">Ltyp</span><span class="o">=</span><span class="n">AirflowNetworkCompData</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">CompNum</span><span class="p">)%</span><span class="n">CompTypeNum</span>
<a name="ln-4506"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">Ltyp</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="n">CompTypeNum_DOP</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4507"></a><span class="k">          </span><span class="n">ActLh</span><span class="o">=</span><span class="n">MultizoneSurfaceData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">Height</span>
<a name="ln-4508"></a>          <span class="n">ActLOwnh</span><span class="o">=</span><span class="n">ActLh</span><span class="o">*</span><span class="mf">1.0d0</span>
<a name="ln-4509"></a>        <span class="k">ELSE</span>
<a name="ln-4510"></a><span class="k">          </span><span class="n">ActLh</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4511"></a>          <span class="n">ActLOwnh</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4512"></a>        <span class="n">ENDIF</span>
<a name="ln-4513"></a>
<a name="ln-4514"></a>        <span class="n">TempL1</span><span class="o">=</span><span class="n">Tz</span><span class="p">(</span><span class="n">From</span><span class="p">)</span>
<a name="ln-4515"></a>        <span class="n">XhL1</span><span class="o">=</span><span class="n">Wz</span><span class="p">(</span><span class="n">From</span><span class="p">)</span>
<a name="ln-4516"></a>        <span class="n">TzFrom</span><span class="o">=</span><span class="n">Tz</span><span class="p">(</span><span class="n">From</span><span class="p">)</span>
<a name="ln-4517"></a>        <span class="n">XhzFrom</span><span class="o">=</span><span class="n">Wz</span><span class="p">(</span><span class="n">From</span><span class="p">)</span>
<a name="ln-4518"></a>        <span class="n">RhoL1</span><span class="o">=</span><span class="n">RhoZ</span><span class="p">(</span><span class="n">From</span><span class="p">)</span>
<a name="ln-4519"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">LL</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">LL</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4520"></a><span class="k">          </span><span class="n">PzFrom</span><span class="o">=</span><span class="n">Pz</span><span class="p">(</span><span class="n">From</span><span class="p">)</span>
<a name="ln-4521"></a>        <span class="k">ELSE</span>
<a name="ln-4522"></a><span class="k">          </span><span class="n">PzFrom</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4523"></a>          <span class="n">From</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4524"></a>        <span class="n">ENDIF</span>
<a name="ln-4525"></a>
<a name="ln-4526"></a>        <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4527"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">from</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4528"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">ilayptr</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4529"></a><span class="k">          </span><span class="n">Fromz</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4530"></a>        <span class="k">ELSE</span>
<a name="ln-4531"></a><span class="k">          </span><span class="n">Fromz</span><span class="o">=</span><span class="n">From</span>
<a name="ln-4532"></a>        <span class="n">ENDIF</span>
<a name="ln-4533"></a>
<a name="ln-4534"></a>        <span class="n">TempL2</span><span class="o">=</span><span class="n">Tz</span><span class="p">(</span><span class="n">To</span><span class="p">)</span>
<a name="ln-4535"></a>        <span class="n">XhL2</span><span class="o">=</span><span class="n">Wz</span><span class="p">(</span><span class="n">To</span><span class="p">)</span>
<a name="ln-4536"></a>        <span class="n">TzTo</span><span class="o">=</span><span class="n">Tz</span><span class="p">(</span><span class="n">To</span><span class="p">)</span>
<a name="ln-4537"></a>        <span class="n">XhzTo</span><span class="o">=</span><span class="n">Wz</span><span class="p">(</span><span class="n">To</span><span class="p">)</span>
<a name="ln-4538"></a>        <span class="n">RhoL2</span><span class="o">=</span><span class="n">RhoZ</span><span class="p">(</span><span class="n">To</span><span class="p">)</span>
<a name="ln-4539"></a>
<a name="ln-4540"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">LL</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4541"></a><span class="k">          </span><span class="n">PzTo</span><span class="o">=</span><span class="n">Pz</span><span class="p">(</span><span class="n">To</span><span class="p">)</span>
<a name="ln-4542"></a>        <span class="k">ELSE</span>
<a name="ln-4543"></a><span class="k">          </span><span class="n">PzTo</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4544"></a>          <span class="n">To</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4545"></a>        <span class="n">ENDIF</span>
<a name="ln-4546"></a>        <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4547"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">To</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4548"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">ilayptr</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4549"></a><span class="k">          </span><span class="n">Toz</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4550"></a>        <span class="k">ELSE</span>
<a name="ln-4551"></a><span class="k">          </span><span class="n">Toz</span><span class="o">=</span><span class="n">To</span>
<a name="ln-4552"></a>        <span class="n">ENDIF</span>
<a name="ln-4553"></a>
<a name="ln-4554"></a>        <span class="c">! RhoDrL is Rho at link level without pollutant but with humidity</span>
<a name="ln-4555"></a>        <span class="n">RhoDrL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">OutBaroPress</span><span class="o">+</span><span class="n">PzFrom</span><span class="p">,</span><span class="n">TempL1</span><span class="p">,</span><span class="n">XhL1</span><span class="p">)</span>
<a name="ln-4556"></a>        <span class="n">RhoDrL</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">OutBaroPress</span><span class="o">+</span><span class="n">PzTo</span><span class="p">,</span><span class="n">TempL2</span><span class="p">,</span><span class="n">XhL2</span><span class="p">)</span>
<a name="ln-4557"></a>
<a name="ln-4558"></a>        <span class="c">! End initialisation</span>
<a name="ln-4559"></a>
<a name="ln-4560"></a>        <span class="c">! calculate DpF the difference between Pz and P at Node 1 height</span>
<a name="ln-4561"></a>        <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4562"></a>        <span class="k">If</span> <span class="p">(</span><span class="n">fromz</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4563"></a>        <span class="n">J</span><span class="o">=</span><span class="n">ilayptr</span>
<a name="ln-4564"></a>        <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4565"></a>        <span class="k">CALL </span><span class="n">LClimb</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">Rhold</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">TempL1</span><span class="p">,</span><span class="n">XhL1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4566"></a>                   <span class="n">DpF</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">Toz</span><span class="p">,</span><span class="n">PzTo</span><span class="p">,</span><span class="n">Pbz</span><span class="p">,</span><span class="n">RhoDrL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">))</span>
<a name="ln-4567"></a>        <span class="n">RhoL1</span><span class="o">=</span><span class="n">Rhold</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4568"></a>        <span class="c">! For large openings calculate the stack pressure difference profile and the</span>
<a name="ln-4569"></a>        <span class="c">! density profile within the the top- and the bottom- height of the large opening</span>
<a name="ln-4570"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">ActLOwnh</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4571"></a><span class="k">          </span><span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4572"></a>          <span class="n">RhoStF</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">RhoL1</span>
<a name="ln-4573"></a>          <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4574"></a>          <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4575"></a>          <span class="k">If</span> <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4576"></a>
<a name="ln-4577"></a>          <span class="c">! Search for the first startheight of a layer which is within the top- and the</span>
<a name="ln-4578"></a>          <span class="c">! bottom- height of the large opening.</span>
<a name="ln-4579"></a>          <span class="k">Do</span>
<a name="ln-4580"></a><span class="k">            </span><span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4581"></a>            <span class="k">If</span> <span class="p">(</span><span class="n">Fromz</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-4582"></a>            <span class="k">IF</span> <span class="p">((</span><span class="n">J</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">).</span><span class="nb">OR</span><span class="p">.(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> <span class="k">Exit</span>
<a name="ln-4583"></a><span class="k">            </span><span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="o">+</span><span class="mi">9</span>
<a name="ln-4584"></a>            <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4585"></a>            <span class="k">If</span> <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4586"></a>          <span class="k">End Do</span>
<a name="ln-4587"></a>
<a name="ln-4588"></a>          <span class="c">! Calculate Rho and stack pressure for every StartHeight of a layer which is</span>
<a name="ln-4589"></a>          <span class="c">! within the top- and the bottom-height of the  large opening.</span>
<a name="ln-4590"></a>          <span class="k">Do</span>
<a name="ln-4591"></a><span class="k">            </span><span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4592"></a>            <span class="k">If</span> <span class="p">(</span><span class="n">Fromz</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-4593"></a>            <span class="k">IF</span> <span class="p">((</span><span class="n">J</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">).</span><span class="nb">OR</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-4594"></a>               <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GE</span><span class="p">.(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ActLOwnh</span><span class="p">)))</span> <span class="k">Exit</span> <span class="c">!Objexx:BoundsViolation HSt(k) @ k&gt;2</span>
<a name="ln-4595"></a>            <span class="n">T</span><span class="o">=</span><span class="n">TzFrom</span>
<a name="ln-4596"></a>            <span class="n">X</span><span class="o">=</span><span class="n">XhzFrom</span>
<a name="ln-4597"></a>            <span class="k">CALL </span><span class="n">LClimb</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">RhoStd</span><span class="p">,</span><span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">DpF</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">Fromz</span><span class="p">,</span><span class="n">PzFrom</span><span class="p">,</span><span class="n">Pbz</span><span class="p">,</span><span class="n">RhoDrDummi</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation HSt(k) and DpF(k) @ k&gt;2</span>
<a name="ln-4598"></a>            <span class="n">RhoStF</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">Rhostd</span> <span class="c">!Objexx:BoundsViolation RhoStF(k) @ k&gt;2</span>
<a name="ln-4599"></a>            <span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="o">+</span><span class="mi">9</span>
<a name="ln-4600"></a>            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span> <span class="c">!Objexx k&gt;2 now</span>
<a name="ln-4601"></a>            <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Objexx:BoundsViolation @ k&gt;2</span>
<a name="ln-4602"></a>            <span class="k">If</span> <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation @ k&gt;2</span>
<a name="ln-4603"></a>          <span class="k">End Do</span>
<a name="ln-4604"></a>          <span class="c">! Stack pressure difference and rho for top-height of the large opening</span>
<a name="ln-4605"></a>          <span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ActLOwnh</span> <span class="c">!Objexx:BoundsViolation k&gt;2 poss</span>
<a name="ln-4606"></a>          <span class="n">T</span><span class="o">=</span><span class="n">TzFrom</span>
<a name="ln-4607"></a>          <span class="n">X</span><span class="o">=</span><span class="n">XhzFrom</span>
<a name="ln-4608"></a>          <span class="k">CALL </span><span class="n">LClimb</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">RhoStd</span><span class="p">,</span><span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">DpF</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">Fromz</span><span class="p">,</span><span class="n">PzFrom</span><span class="p">,</span><span class="n">Pbz</span><span class="p">,</span><span class="n">RhoDrDummi</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation k&gt;2 poss</span>
<a name="ln-4609"></a>          <span class="n">RhoStF</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">RhoStd</span> <span class="c">!Objexx:BoundsViolation k &gt;= 3 poss</span>
<a name="ln-4610"></a>
<a name="ln-4611"></a>          <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4612"></a>            <span class="n">BetaStF</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">RhoStF</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">RhoStF</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">HSt</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">HSt</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
<a name="ln-4613"></a>          <span class="k">END DO</span>
<a name="ln-4614"></a><span class="k">        </span><span class="n">ENDIF</span>
<a name="ln-4615"></a>
<a name="ln-4616"></a>        <span class="c">! repeat procedure for the &quot;To&quot; node, DpT</span>
<a name="ln-4617"></a>        <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4618"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">Toz</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4619"></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">ilayptr</span>
<a name="ln-4620"></a>        <span class="c">! Calculate Rho at link height only if we have large openings or layered zones.</span>
<a name="ln-4621"></a>        <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-4622"></a>        <span class="k">CALL </span><span class="n">LClimb</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">RhoLd</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">TempL2</span><span class="p">,</span><span class="n">XhL2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4623"></a>                   <span class="n">DpT</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">Toz</span><span class="p">,</span><span class="n">PzTo</span><span class="p">,</span><span class="n">Pbz</span><span class="p">,</span><span class="n">RhoDrL</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">))</span>
<a name="ln-4624"></a>        <span class="n">RhoL2</span><span class="o">=</span><span class="n">RhoLd</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4625"></a>
<a name="ln-4626"></a>        <span class="c">! For large openings calculate the stack pressure difference profile and the</span>
<a name="ln-4627"></a>        <span class="c">! density profile within the the top- and the bottom- height of the large opening</span>
<a name="ln-4628"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">ActLOwnh</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4629"></a><span class="k">          </span><span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4630"></a>          <span class="n">RhoStT</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">RhoL2</span>
<a name="ln-4631"></a>          <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4632"></a>          <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4633"></a>          <span class="k">If</span> <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4634"></a>          <span class="k">Do</span>
<a name="ln-4635"></a><span class="k">            </span><span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4636"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">Toz</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-4637"></a>            <span class="k">IF</span> <span class="p">((</span><span class="n">J</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">).</span><span class="nb">OR</span><span class="p">.(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="k">Exit</span>
<a name="ln-4638"></a><span class="k">            </span><span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="o">+</span><span class="mi">9</span>
<a name="ln-4639"></a>            <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4640"></a>            <span class="k">If</span> <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4641"></a>          <span class="k">End Do</span>
<a name="ln-4642"></a>          <span class="c">! Calculate Rho and stack pressure for every StartHeight of a layer which is</span>
<a name="ln-4643"></a>          <span class="c">! within the top- and the bottom-height of the  large opening.</span>
<a name="ln-4644"></a>          <span class="k">Do</span>
<a name="ln-4645"></a><span class="k">            </span><span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4646"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">Toz</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-4647"></a>            <span class="k">IF</span> <span class="p">((</span><span class="n">J</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">).</span><span class="nb">OR</span><span class="p">.</span> <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">GE</span><span class="p">.(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">ActLOwnh</span><span class="p">)))</span> <span class="k">Exit</span> <span class="c">!Objexx:BoundsViolation Hst(k) @ k&gt;2</span>
<a name="ln-4648"></a>            <span class="n">T</span><span class="o">=</span><span class="n">TzTo</span>
<a name="ln-4649"></a>            <span class="n">X</span><span class="o">=</span><span class="n">XhzTo</span>
<a name="ln-4650"></a>            <span class="k">CALL </span><span class="n">LClimb</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">RhoStd</span><span class="p">,</span><span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">DpT</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">Toz</span><span class="p">,</span><span class="n">PzTo</span><span class="p">,</span><span class="n">Pbz</span><span class="p">,</span><span class="n">RhoDrDummi</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation HSt(k) and DpT(k) @ k&gt;2</span>
<a name="ln-4651"></a>            <span class="n">RhoStT</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">RhoStd</span> <span class="c">!Objexx:BoundsViolation RhoStT(k) @ k&gt;2</span>
<a name="ln-4652"></a>            <span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="o">+</span><span class="mi">9</span>
<a name="ln-4653"></a>            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span> <span class="c">!Objexx k&gt;2 now</span>
<a name="ln-4654"></a>            <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0d0</span> <span class="c">!Objexx:BoundsViolation @ k&gt;2</span>
<a name="ln-4655"></a>            <span class="k">If</span> <span class="p">(</span><span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Hst</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation @ k&gt;2</span>
<a name="ln-4656"></a>          <span class="k">End Do</span>
<a name="ln-4657"></a>          <span class="c">! Stack pressure difference and rho for top-height of the large opening</span>
<a name="ln-4658"></a>          <span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">ActLOwnh</span> <span class="c">!Objexx:BoundsViolation k&gt;2 poss</span>
<a name="ln-4659"></a>          <span class="n">T</span><span class="o">=</span><span class="n">TzTo</span>
<a name="ln-4660"></a>          <span class="n">X</span><span class="o">=</span><span class="n">XhzTo</span>
<a name="ln-4661"></a>          <span class="k">CALL </span><span class="n">LClimb</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">RhoStd</span><span class="p">,</span><span class="n">HSt</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">DpT</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">Toz</span><span class="p">,</span><span class="n">PzTo</span><span class="p">,</span><span class="n">Pbz</span><span class="p">,</span><span class="n">RhoDrDummi</span><span class="p">)</span> <span class="c">!Objexx:BoundsViolation k&gt;2 poss</span>
<a name="ln-4662"></a>          <span class="n">RhoStT</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="n">RhoStd</span> <span class="c">!Objexx:BoundsViolation k&gt;2 poss</span>
<a name="ln-4663"></a>
<a name="ln-4664"></a>          <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4665"></a>            <span class="n">BetaStT</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">RhoStT</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">RhoStT</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">HSt</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">HSt</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
<a name="ln-4666"></a>          <span class="k">END DO</span>
<a name="ln-4667"></a><span class="k">        </span><span class="n">ENDIF</span>
<a name="ln-4668"></a>
<a name="ln-4669"></a>        <span class="c">! CALCULATE STACK PRESSURE FOR THE PATH ITSELF for different flow directions</span>
<a name="ln-4670"></a>        <span class="n">H</span><span class="o">=</span><span class="kt">REAL</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">r64</span><span class="p">)</span> <span class="o">-</span>   <span class="p">&amp;</span>
<a name="ln-4671"></a>                <span class="kt">REAL</span><span class="p">(</span><span class="n">AirflowNetworkLinkageData</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">NodeHeights</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">r64</span><span class="p">)</span>
<a name="ln-4672"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">LL</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">LL</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">3</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">LL</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4673"></a><span class="k">          </span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="o">-</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">From</span><span class="p">)%</span><span class="n">NodeHeight</span>
<a name="ln-4674"></a>        <span class="n">ENDIF</span>
<a name="ln-4675"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">LL</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4676"></a><span class="k">          </span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="o">+</span><span class="n">AirflowNetworkNodeData</span><span class="p">(</span><span class="n">To</span><span class="p">)%</span><span class="n">NodeHeight</span>
<a name="ln-4677"></a>        <span class="n">ENDIF</span>
<a name="ln-4678"></a>
<a name="ln-4679"></a>        <span class="c">! IF AIR FLOWS from &quot;From&quot; to &quot;To&quot;</span>
<a name="ln-4680"></a>        <span class="n">Pref</span><span class="o">=</span><span class="n">Pbz</span><span class="o">+</span><span class="n">Pzfrom</span><span class="o">+</span><span class="n">DpF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4681"></a>        <span class="n">DpP</span><span class="o">=</span><span class="n">psz</span><span class="p">(</span><span class="n">Pref</span><span class="p">,</span><span class="n">RhoLd</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mf">0.0d0</span><span class="p">,</span><span class="mf">0.0d0</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">G</span><span class="p">)</span>
<a name="ln-4682"></a>        <span class="n">DpL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">DpF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">DpT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">DpP</span><span class="p">)</span>
<a name="ln-4683"></a>
<a name="ln-4684"></a>        <span class="c">! IF AIR FLOWS from &quot;To&quot; to &quot;From&quot;</span>
<a name="ln-4685"></a>        <span class="n">Pref</span><span class="o">=</span><span class="n">Pbz</span><span class="o">+</span><span class="n">Pzto</span><span class="o">+</span><span class="n">DpT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-4686"></a>        <span class="n">DpP</span><span class="o">=-</span><span class="n">psz</span><span class="p">(</span><span class="n">Pref</span><span class="p">,</span><span class="n">RhoLd</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="mf">0.0d0</span><span class="p">,</span><span class="mf">0.0d0</span><span class="p">,</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">G</span><span class="p">)</span>
<a name="ln-4687"></a>        <span class="n">DpL</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">DpF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">DpT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">DpP</span><span class="p">)</span>
<a name="ln-4688"></a>
<a name="ln-4689"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">Ltyp</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="n">CompTypeNum_DOP</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4690"></a><span class="k">          </span><span class="n">Pprof</span><span class="o">=</span><span class="n">OpenNum</span><span class="o">*</span><span class="p">(</span><span class="n">NrInt</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4691"></a>          <span class="k">CALL </span><span class="n">PresProfile</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">Pprof</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="n">DpF</span><span class="p">,</span><span class="n">DpT</span><span class="p">,</span><span class="n">BetaStF</span><span class="p">,</span><span class="n">BetaStT</span><span class="p">,</span><span class="n">RhoStF</span><span class="p">,</span><span class="n">RhoStT</span><span class="p">,</span><span class="n">from</span><span class="p">,</span><span class="n">To</span><span class="p">,</span><span class="n">ActLh</span><span class="p">,</span><span class="n">Hfl</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-4692"></a>          <span class="n">OpenNum</span> <span class="o">=</span> <span class="n">OpenNum</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-4693"></a>        <span class="n">ENDIF</span>
<a name="ln-4694"></a>
<a name="ln-4695"></a>      <span class="k">END DO</span>
<a name="ln-4696"></a>
<a name="ln-4697"></a><span class="k">      RETURN</span>
<a name="ln-4698"></a>
<a name="ln-4699"></a><span class="k">    END SUBROUTINE </span><span class="n">PStack</span>
<a name="ln-4700"></a>
<a name="ln-4701"></a>     <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="k">FUNCTION </span><span class="n">psz</span><span class="p">(</span><span class="n">Pz0</span><span class="p">,</span><span class="n">Rho0</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>
<a name="ln-4702"></a>
<a name="ln-4703"></a>          <span class="c">! FUNCTION INFORMATION:</span>
<a name="ln-4704"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-4705"></a>          <span class="c">!       DATE WRITTEN   Oct. 2005</span>
<a name="ln-4706"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-4707"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised based on psz function from COMIS</span>
<a name="ln-4708"></a>
<a name="ln-4709"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-4710"></a>          <span class="c">! This function determines the pressure due to buoyancy in a stratified density environment</span>
<a name="ln-4711"></a>
<a name="ln-4712"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-4713"></a>          <span class="c">! na</span>
<a name="ln-4714"></a>
<a name="ln-4715"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-4716"></a>          <span class="c">! na</span>
<a name="ln-4717"></a>
<a name="ln-4718"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-4719"></a>          <span class="c">! na</span>
<a name="ln-4720"></a>
<a name="ln-4721"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-4722"></a>
<a name="ln-4723"></a>
<a name="ln-4724"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-4725"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">Pz0</span>   <span class="c">! Pressure at altitude z0 [Pa]</span>
<a name="ln-4726"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">Rho0</span>  <span class="c">! density at altitude z0 [kg/m3]</span>
<a name="ln-4727"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">beta</span>  <span class="c">! density gradient [kg/m4]</span>
<a name="ln-4728"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">z0</span>    <span class="c">! reference altitude [m]</span>
<a name="ln-4729"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">z</span>     <span class="c">! altitude[m]</span>
<a name="ln-4730"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">g</span>     <span class="c">! gravity field strength [N/kg]</span>
<a name="ln-4731"></a>
<a name="ln-4732"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-4733"></a>          <span class="c">! na</span>
<a name="ln-4734"></a>
<a name="ln-4735"></a>
<a name="ln-4736"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-4737"></a>          <span class="c">! na</span>
<a name="ln-4738"></a>
<a name="ln-4739"></a>
<a name="ln-4740"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-4741"></a>          <span class="c">! na</span>
<a name="ln-4742"></a>
<a name="ln-4743"></a>
<a name="ln-4744"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-4745"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">dz</span><span class="p">,</span><span class="n">rho</span>
<a name="ln-4746"></a>
<a name="ln-4747"></a>      <span class="c">! FLOW:</span>
<a name="ln-4748"></a>      <span class="n">dz</span><span class="o">=</span><span class="n">z</span><span class="o">-</span><span class="n">z0</span>
<a name="ln-4749"></a>      <span class="n">rho</span><span class="o">=</span><span class="p">(</span><span class="n">Rho0</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="n">dz</span><span class="o">/</span><span class="mf">2.0d0</span><span class="p">)</span>
<a name="ln-4750"></a>      <span class="n">Psz</span><span class="o">=-</span><span class="n">Pz0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.d0</span><span class="o">-</span><span class="nb">EXP</span><span class="p">(</span><span class="o">-</span><span class="n">dz</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">g</span><span class="o">/</span><span class="n">Pz0</span><span class="p">))</span> <span class="c">! Differential pressure from z to z0 [Pa]</span>
<a name="ln-4751"></a>
<a name="ln-4752"></a>      <span class="k">RETURN</span>
<a name="ln-4753"></a><span class="k">      END FUNCTION </span><span class="n">psz</span>
<a name="ln-4754"></a>
<a name="ln-4755"></a>      <span class="k">SUBROUTINE </span><span class="n">LClimb</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">Rho</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Dp</span><span class="p">,</span><span class="n">zone</span><span class="p">,</span><span class="n">Pz</span><span class="p">,</span><span class="n">Pbz</span><span class="p">,</span><span class="n">RhoDr</span><span class="p">)</span>
<a name="ln-4756"></a>
<a name="ln-4757"></a>          <span class="c">! FUNCTION INFORMATION:</span>
<a name="ln-4758"></a>          <span class="c">!       AUTHOR         Lixing Gu</span>
<a name="ln-4759"></a>          <span class="c">!       DATE WRITTEN   Oct. 2005</span>
<a name="ln-4760"></a>          <span class="c">!       MODIFIED       na</span>
<a name="ln-4761"></a>          <span class="c">!       RE-ENGINEERED  This subroutine is revised based on subroutine IClimb from COMIS</span>
<a name="ln-4762"></a>
<a name="ln-4763"></a>          <span class="c">! PURPOSE OF THIS SUBROUTINE:</span>
<a name="ln-4764"></a>          <span class="c">! This function the differential pressure from the reflevel in a zone To Z, the level of a link</span>
<a name="ln-4765"></a>
<a name="ln-4766"></a>          <span class="c">! METHODOLOGY EMPLOYED:</span>
<a name="ln-4767"></a>          <span class="c">! na</span>
<a name="ln-4768"></a>
<a name="ln-4769"></a>          <span class="c">! REFERENCES:</span>
<a name="ln-4770"></a>          <span class="c">! na</span>
<a name="ln-4771"></a>
<a name="ln-4772"></a>          <span class="c">! USE STATEMENTS:</span>
<a name="ln-4773"></a>          <span class="c">! na</span>
<a name="ln-4774"></a>
<a name="ln-4775"></a>          <span class="k">IMPLICIT NONE</span>    <span class="c">! Enforce explicit typing of all variables in this routine</span>
<a name="ln-4776"></a>
<a name="ln-4777"></a>
<a name="ln-4778"></a>          <span class="c">! SUBROUTINE ARGUMENT DEFINITIONS:</span>
<a name="ln-4779"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">g</span>     <span class="c">! gravity field strength [N/kg]</span>
<a name="ln-4780"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">Rho</span>   <span class="c">! Density link level (initialized with rho zone) [kg/m3]</span>
<a name="ln-4781"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">Z</span>     <span class="c">! Height of the link above the zone reference [m]</span>
<a name="ln-4782"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">T</span>     <span class="c">! temperature at link level [C]</span>
<a name="ln-4783"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">X</span>     <span class="c">! absolute humidity at link level [kg/kg]</span>
<a name="ln-4784"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">Dp</span>    <span class="c">! Stackpressure to the linklevel [Pa]</span>
<a name="ln-4785"></a>          <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">zone</span>  <span class="c">! Zone number</span>
<a name="ln-4786"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">Pz</span>    <span class="c">! Zone Pressure (reflevel) [Pa]</span>
<a name="ln-4787"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">Pbz</span>   <span class="c">! Barometric pressure at entrance level [Pa]</span>
<a name="ln-4788"></a>          <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">RhoDr</span> <span class="c">! Air density of dry air on the link level used</span>
<a name="ln-4789"></a>                                                    <span class="c">! for the concentration routine [kg/m3]</span>
<a name="ln-4790"></a>
<a name="ln-4791"></a>          <span class="c">! SUBROUTINE PARAMETER DEFINITIONS:</span>
<a name="ln-4792"></a>          <span class="c">! na</span>
<a name="ln-4793"></a>
<a name="ln-4794"></a>
<a name="ln-4795"></a>          <span class="c">! INTERFACE BLOCK SPECIFICATIONS</span>
<a name="ln-4796"></a>          <span class="c">! na</span>
<a name="ln-4797"></a>
<a name="ln-4798"></a>
<a name="ln-4799"></a>          <span class="c">! DERIVED TYPE DEFINITIONS</span>
<a name="ln-4800"></a>          <span class="c">! na</span>
<a name="ln-4801"></a>
<a name="ln-4802"></a>
<a name="ln-4803"></a>          <span class="c">! SUBROUTINE LOCAL VARIABLE DECLARATIONS:</span>
<a name="ln-4804"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">H</span>         <span class="c">! Start Height of the layer</span>
<a name="ln-4805"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">BetaT</span>     <span class="c">! Temperature gradient of this layer</span>
<a name="ln-4806"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">BetaXfct</span>  <span class="c">! Humidity gradient factor of this layer</span>
<a name="ln-4807"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">BetaCfct</span>  <span class="c">! Concentration 1 gradient factor of this layer</span>
<a name="ln-4808"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">X0</span>
<a name="ln-4809"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">P</span><span class="p">,</span><span class="n">Htop</span><span class="p">,</span><span class="n">Hbot</span>
<a name="ln-4810"></a>      <span class="kt">REAL</span><span class="p">(</span><span class="n">r64</span><span class="p">)</span> <span class="n">Rho0</span><span class="p">,</span><span class="n">Rho1</span><span class="p">,</span><span class="n">Betarho</span>
<a name="ln-4811"></a>      <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">L</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4812"></a>      <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">ilayptr</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-4813"></a>
<a name="ln-4814"></a>      <span class="c">! FLOW:</span>
<a name="ln-4815"></a>      <span class="n">Dp</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4816"></a>      <span class="n">Rho0</span><span class="o">=</span><span class="n">Rho</span>
<a name="ln-4817"></a>      <span class="n">x0</span><span class="o">=</span><span class="n">x</span>
<a name="ln-4818"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">Z</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4819"></a>        <span class="c">! initialize start values</span>
<a name="ln-4820"></a>        <span class="n">H</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4821"></a>        <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4822"></a>        <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4823"></a>        <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4824"></a>        <span class="n">BetaRho</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4825"></a>        <span class="n">Hbot</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4826"></a>
<a name="ln-4827"></a>        <span class="k">DO WHILE</span> <span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-4828"></a>          <span class="c">! loop until H&gt;0 ; The start of the layer is above 0</span>
<a name="ln-4829"></a>          <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4830"></a>          <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4831"></a>          <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4832"></a>          <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="o">+</span><span class="mi">9</span>
<a name="ln-4833"></a>          <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4834"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">zone</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-4835"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4836"></a><span class="k">            </span><span class="n">H</span><span class="o">=</span><span class="n">Z</span><span class="o">+</span><span class="mf">1.0d0</span>
<a name="ln-4837"></a>          <span class="k">ELSE</span>
<a name="ln-4838"></a><span class="k">            </span><span class="n">H</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4839"></a>          <span class="n">ENDIF</span>
<a name="ln-4840"></a>        <span class="k">END DO</span>
<a name="ln-4841"></a>
<a name="ln-4842"></a>        <span class="c">! The link is in this layer also if it is on the top of it.</span>
<a name="ln-4843"></a>
<a name="ln-4844"></a>        <span class="k">DO</span>
<a name="ln-4845"></a><span class="k">          IF</span> <span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="n">Z</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4846"></a>            <span class="c">! the link ends in this layer , we reached the final Dp and BetaRho</span>
<a name="ln-4847"></a>            <span class="n">Htop</span><span class="o">=</span><span class="n">Z</span>
<a name="ln-4848"></a>            <span class="n">P</span><span class="o">=</span><span class="n">Pz</span><span class="o">+</span><span class="n">Dp</span>
<a name="ln-4849"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">Htop</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="n">Hbot</span><span class="p">)</span><span class="k">THEN</span>
<a name="ln-4850"></a><span class="k">              </span><span class="n">Rho0</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4851"></a>              <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">Htop</span><span class="o">-</span><span class="n">Hbot</span><span class="p">)</span><span class="o">*</span><span class="n">BetaT</span>
<a name="ln-4852"></a>              <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">+</span><span class="p">(</span><span class="n">Htop</span><span class="o">-</span><span class="n">Hbot</span><span class="p">)</span><span class="o">*</span><span class="n">BetaXfct</span><span class="o">*</span><span class="n">X0</span>
<a name="ln-4853"></a>              <span class="n">Rho1</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4854"></a>              <span class="n">BetaRho</span><span class="o">=</span><span class="p">(</span><span class="n">Rho1</span><span class="o">-</span><span class="n">Rho0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Htop</span><span class="o">-</span><span class="n">Hbot</span><span class="p">)</span>
<a name="ln-4855"></a>              <span class="n">Dp</span><span class="o">=</span><span class="n">Dp</span><span class="o">+</span><span class="n">psz</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">Rho0</span><span class="p">,</span><span class="n">BetaRho</span><span class="p">,</span><span class="n">Hbot</span><span class="p">,</span><span class="n">Htop</span><span class="p">,</span><span class="n">G</span><span class="p">)</span>
<a name="ln-4856"></a>            <span class="n">ENDIF</span>
<a name="ln-4857"></a>            <span class="n">Rhodr</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4858"></a>            <span class="n">Rho</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4859"></a>            <span class="k">RETURN</span>
<a name="ln-4860"></a>
<a name="ln-4861"></a><span class="k">          ELSE</span>
<a name="ln-4862"></a>            <span class="c">! bottom of the layer is below Z  (Z above ref)</span>
<a name="ln-4863"></a>            <span class="n">Htop</span><span class="o">=</span><span class="n">H</span>
<a name="ln-4864"></a>            <span class="c">! P is the pressure up to the start height of the layer we just reached</span>
<a name="ln-4865"></a>            <span class="n">P</span><span class="o">=</span><span class="n">Pz</span><span class="o">+</span><span class="n">dp</span>
<a name="ln-4866"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">Htop</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="n">Hbot</span><span class="p">)</span><span class="k">THEN</span>
<a name="ln-4867"></a><span class="k">              </span><span class="n">Rho0</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4868"></a>              <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">Htop</span><span class="o">-</span><span class="n">Hbot</span><span class="p">)</span><span class="o">*</span><span class="n">BetaT</span>
<a name="ln-4869"></a>              <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">+</span><span class="p">(</span><span class="n">Htop</span><span class="o">-</span><span class="n">Hbot</span><span class="p">)</span><span class="o">*</span><span class="n">BetaXfct</span><span class="o">*</span><span class="n">X0</span>
<a name="ln-4870"></a>              <span class="n">Rho1</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4871"></a>              <span class="n">BetaRho</span><span class="o">=</span><span class="p">(</span><span class="n">Rho1</span><span class="o">-</span><span class="n">Rho0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Htop</span><span class="o">-</span><span class="n">Hbot</span><span class="p">)</span>
<a name="ln-4872"></a>              <span class="n">Dp</span><span class="o">=</span><span class="n">Dp</span><span class="o">+</span><span class="n">psz</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">Rho0</span><span class="p">,</span><span class="n">BetaRho</span><span class="p">,</span><span class="n">Hbot</span><span class="p">,</span><span class="n">Htop</span><span class="p">,</span><span class="n">G</span><span class="p">)</span>
<a name="ln-4873"></a>            <span class="n">ENDIF</span>
<a name="ln-4874"></a>
<a name="ln-4875"></a>            <span class="n">Rhodr</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4876"></a>            <span class="n">Rho</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4877"></a>
<a name="ln-4878"></a>            <span class="c">! place current values Hbot and Beta&#39;s</span>
<a name="ln-4879"></a>            <span class="n">Hbot</span><span class="o">=</span><span class="n">H</span>
<a name="ln-4880"></a>            <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4881"></a>            <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4882"></a>            <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4883"></a>            <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="o">+</span><span class="mi">9</span>
<a name="ln-4884"></a>            <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4885"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">zone</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">9</span>
<a name="ln-4886"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4887"></a><span class="k">              </span><span class="n">H</span><span class="o">=</span><span class="n">Z</span><span class="o">+</span><span class="mf">1.0d0</span>
<a name="ln-4888"></a>            <span class="k">ELSE</span>
<a name="ln-4889"></a><span class="k">              </span><span class="n">H</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4890"></a>            <span class="n">ENDIF</span>
<a name="ln-4891"></a>          <span class="n">ENDIF</span>
<a name="ln-4892"></a>        <span class="k">END DO</span>
<a name="ln-4893"></a>
<a name="ln-4894"></a><span class="k">      ELSE</span>
<a name="ln-4895"></a>        <span class="c">! This is the ELSE for negative linkheights Z below the refplane</span>
<a name="ln-4896"></a>        <span class="n">H</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4897"></a>        <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4898"></a>        <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4899"></a>        <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4900"></a>        <span class="n">BetaRho</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4901"></a>        <span class="n">Htop</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4902"></a>        <span class="k">DO WHILE</span> <span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">0.0d0</span><span class="p">)</span>
<a name="ln-4903"></a>          <span class="c">! loop until H&lt;0 ; The start of the layer is below the zone refplane</span>
<a name="ln-4904"></a>          <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="o">-</span><span class="mi">9</span>
<a name="ln-4905"></a>          <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4906"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">zone</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4907"></a>          <span class="k">IF</span> <span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4908"></a>            <span class="c">! with H=Z (negative) this loop will exit, no data for interval Z-refplane</span>
<a name="ln-4909"></a>            <span class="n">H</span><span class="o">=</span><span class="n">Z</span>
<a name="ln-4910"></a>            <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4911"></a>            <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4912"></a>            <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4913"></a>            <span class="n">BetaRho</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4914"></a>          <span class="k">ELSE</span>
<a name="ln-4915"></a><span class="k">            </span><span class="n">H</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4916"></a>            <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4917"></a>            <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4918"></a>            <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4919"></a>          <span class="n">ENDIF</span>
<a name="ln-4920"></a>        <span class="k">END DO</span>
<a name="ln-4921"></a>
<a name="ln-4922"></a>        <span class="c">! The link is in this layer also if it is on the bottom of it.</span>
<a name="ln-4923"></a>        <span class="k">DO</span>
<a name="ln-4924"></a><span class="k">          IF</span> <span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">Z</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4925"></a><span class="k">            </span><span class="n">Hbot</span><span class="o">=</span><span class="n">Z</span>
<a name="ln-4926"></a>            <span class="n">P</span><span class="o">=</span><span class="n">Pz</span><span class="o">+</span><span class="n">dp</span>
<a name="ln-4927"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">Htop</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="n">Hbot</span><span class="p">)</span><span class="k">THEN</span>
<a name="ln-4928"></a><span class="k">              </span><span class="n">Rho1</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4929"></a>              <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">Hbot</span><span class="o">-</span><span class="n">Htop</span><span class="p">)</span><span class="o">*</span><span class="n">BetaT</span>
<a name="ln-4930"></a>              <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">+</span><span class="p">(</span><span class="n">Hbot</span><span class="o">-</span><span class="n">Htop</span><span class="p">)</span><span class="o">*</span><span class="n">BetaXfct</span><span class="o">*</span><span class="n">X0</span>
<a name="ln-4931"></a>              <span class="n">Rho0</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4932"></a>              <span class="n">BetaRho</span><span class="o">=</span><span class="p">(</span><span class="n">Rho1</span><span class="o">-</span><span class="n">Rho0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Htop</span><span class="o">-</span><span class="n">Hbot</span><span class="p">)</span>
<a name="ln-4933"></a>              <span class="n">Dp</span><span class="o">=</span><span class="n">Dp</span><span class="o">-</span><span class="n">psz</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">Rho0</span><span class="p">,</span><span class="n">BetaRho</span><span class="p">,</span><span class="n">Hbot</span><span class="p">,</span><span class="n">Htop</span><span class="p">,</span><span class="n">G</span><span class="p">)</span>
<a name="ln-4934"></a>            <span class="n">ENDIF</span>
<a name="ln-4935"></a>            <span class="n">Rhodr</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4936"></a>            <span class="n">Rho</span> <span class="o">=</span>  <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4937"></a>            <span class="k">RETURN</span>
<a name="ln-4938"></a><span class="k">          ELSE</span>
<a name="ln-4939"></a>            <span class="c">! bottom of the layer is below Z  (Z below ref)</span>
<a name="ln-4940"></a>            <span class="n">Hbot</span><span class="o">=</span><span class="n">H</span>
<a name="ln-4941"></a>            <span class="n">P</span><span class="o">=</span><span class="n">Pz</span><span class="o">+</span><span class="n">dp</span>
<a name="ln-4942"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">Htop</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="n">Hbot</span><span class="p">)</span><span class="k">THEN</span>
<a name="ln-4943"></a><span class="k">              </span><span class="n">Rho1</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4944"></a>              <span class="c">! T,X,C calculated for the lower height</span>
<a name="ln-4945"></a>              <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">Hbot</span><span class="o">-</span><span class="n">Htop</span><span class="p">)</span><span class="o">*</span><span class="n">BetaT</span>
<a name="ln-4946"></a>              <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">+</span><span class="p">(</span><span class="n">Hbot</span><span class="o">-</span><span class="n">Htop</span><span class="p">)</span><span class="o">*</span><span class="n">BetaXfct</span><span class="o">*</span><span class="n">X0</span>
<a name="ln-4947"></a>              <span class="n">Rho0</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4948"></a>              <span class="n">BetaRho</span><span class="o">=</span><span class="p">(</span><span class="n">Rho1</span><span class="o">-</span><span class="n">Rho0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">htop</span><span class="o">-</span><span class="n">hbot</span><span class="p">)</span>
<a name="ln-4949"></a>              <span class="n">Dp</span><span class="o">=</span><span class="n">Dp</span><span class="o">-</span><span class="n">psz</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">Rho0</span><span class="p">,</span><span class="n">BetaRho</span><span class="p">,</span><span class="n">Hbot</span><span class="p">,</span><span class="n">Htop</span><span class="p">,</span><span class="n">G</span><span class="p">)</span>
<a name="ln-4950"></a>            <span class="n">ENDIF</span>
<a name="ln-4951"></a>            <span class="n">Rhodr</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4952"></a>            <span class="n">Rho</span> <span class="o">=</span> <span class="n">PsyRhoAirFnPbTdbW</span><span class="p">(</span><span class="n">Pbz</span><span class="o">+</span><span class="n">pz</span><span class="o">+</span><span class="n">dp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-4953"></a>
<a name="ln-4954"></a>            <span class="c">! place current values Hbot and Beta&#39;s</span>
<a name="ln-4955"></a>            <span class="n">Htop</span><span class="o">=</span><span class="n">H</span>
<a name="ln-4956"></a>            <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="o">-</span><span class="mi">9</span>
<a name="ln-4957"></a>            <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4958"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">zone</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="n">ilayptr</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4959"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">ilayptr</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-4960"></a><span class="k">              </span><span class="n">H</span><span class="o">=</span><span class="n">Z</span><span class="o">-</span><span class="mf">1.0d0</span>
<a name="ln-4961"></a>              <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4962"></a>              <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4963"></a>              <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4964"></a>            <span class="k">ELSE</span>
<a name="ln-4965"></a><span class="k">              </span><span class="n">H</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4966"></a>              <span class="n">BetaT</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4967"></a>              <span class="n">BetaXfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4968"></a>              <span class="n">BetaCfct</span><span class="o">=</span><span class="mf">0.0d0</span>
<a name="ln-4969"></a>            <span class="n">ENDIF</span>
<a name="ln-4970"></a>          <span class="n">ENDIF</span>
<a name="ln-4971"></a>        <span class="c">! ENDIF H&lt;Z</span>
<a name="ln-4972"></a>        <span class="k">END DO</span>
<a name="ln-4973"></a><span class="k">      </span><span class="n">ENDIF</span>
<a name="ln-4974"></a>
<a name="ln-4975"></a>      <span class="k">RETURN</span>
<a name="ln-4976"></a>
<a name="ln-4977"></a><span class="k">      END SUBROUTINE </span><span class="n">LClimb</span>
<a name="ln-4978"></a>
<a name="ln-4979"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4980"></a><span class="c">!     NOTICE</span>
<a name="ln-4981"></a><span class="c">!</span>
<a name="ln-4982"></a><span class="c">!     Copyright © 1996-2013 The Board of Trustees of the University of Illinois</span>
<a name="ln-4983"></a><span class="c">!     and The Regents of the University of California through Ernest Orlando Lawrence</span>
<a name="ln-4984"></a><span class="c">!     Berkeley National Laboratory.  All rights reserved.</span>
<a name="ln-4985"></a><span class="c">!</span>
<a name="ln-4986"></a><span class="c">!     Portions of the EnergyPlus software package have been developed and copyrighted</span>
<a name="ln-4987"></a><span class="c">!     by other individuals, companies and institutions.  These portions have been</span>
<a name="ln-4988"></a><span class="c">!     incorporated into the EnergyPlus software package under license.   For a complete</span>
<a name="ln-4989"></a><span class="c">!     list of contributors, see &quot;Notice&quot; located in EnergyPlus.f90.</span>
<a name="ln-4990"></a><span class="c">!</span>
<a name="ln-4991"></a><span class="c">!     NOTICE: The U.S. Government is granted for itself and others acting on its</span>
<a name="ln-4992"></a><span class="c">!     behalf a paid-up, nonexclusive, irrevocable, worldwide license in this data to</span>
<a name="ln-4993"></a><span class="c">!     reproduce, prepare derivative works, and perform publicly and display publicly.</span>
<a name="ln-4994"></a><span class="c">!     Beginning five (5) years after permission to assert copyright is granted,</span>
<a name="ln-4995"></a><span class="c">!     subject to two possible five year renewals, the U.S. Government is granted for</span>
<a name="ln-4996"></a><span class="c">!     itself and others acting on its behalf a paid-up, non-exclusive, irrevocable</span>
<a name="ln-4997"></a><span class="c">!     worldwide license in this data to reproduce, prepare derivative works,</span>
<a name="ln-4998"></a><span class="c">!     distribute copies to the public, perform publicly and display publicly, and to</span>
<a name="ln-4999"></a><span class="c">!     permit others to do so.</span>
<a name="ln-5000"></a><span class="c">!</span>
<a name="ln-5001"></a><span class="c">!     TRADEMARKS: EnergyPlus is a trademark of the US Department of Energy.</span>
<a name="ln-5002"></a><span class="c">!</span>
<a name="ln-5003"></a>
<a name="ln-5004"></a><span class="k">END MODULE </span><span class="n">AirflowNetworkSolver</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>


<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">

      <a class="list-group-item" href="../sourcefile/airflownetworkbalancemanager.f90.html">AirflowNetworkBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/airflownetworksolver.f90.html">AirflowNetworkSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiator.f90.html">BaseboardRadiator.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorelectric.f90.html">BaseboardRadiatorElectric.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorsteam.f90.html">BaseboardRadiatorSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/baseboardradiatorwater.f90.html">BaseboardRadiatorWater.f90</a>

      <a class="list-group-item" href="../sourcefile/branchinputmanager.f90.html">BranchInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/branchnodeconnections.f90.html">BranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/conductiontransferfunctioncalc.f90.html">ConductionTransferFunctionCalc.f90</a>

      <a class="list-group-item" href="../sourcefile/cooltower.f90.html">CoolTower.f90</a>

      <a class="list-group-item" href="../sourcefile/costestimatemanager.f90.html">CostEstimateManager.f90</a>

      <a class="list-group-item" href="../sourcefile/curvemanager.f90.html">CurveManager.f90</a>

      <a class="list-group-item" href="../sourcefile/cvfonlyroutines.f90.html">CVFOnlyRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairflownetwork.f90.html">DataAirflowNetwork.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairloop.f90.html">DataAirLoop.f90</a>

      <a class="list-group-item" href="../sourcefile/dataairsystems.f90.html">DataAirSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchairloopplant.f90.html">DataBranchAirLoopPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/databranchnodeconnections.f90.html">DataBranchNodeConnections.f90</a>

      <a class="list-group-item" href="../sourcefile/databsdfwindow.f90.html">DataBSDFWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/datacomplexfenestration.f90.html">DataComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/datacontaminantbalance.f90.html">DataContaminantBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconvergparams.f90.html">DataConvergParams.f90</a>

      <a class="list-group-item" href="../sourcefile/dataconversions.f90.html">DataConversions.f90</a>

      <a class="list-group-item" href="../sourcefile/datacostestimate.f90.html">DataCostEstimate.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylighting.f90.html">DataDaylighting.f90</a>

      <a class="list-group-item" href="../sourcefile/datadaylightingdevices.f90.html">DataDaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/datadefineequip.f90.html">Datadefineequip.f90</a>

      <a class="list-group-item" href="../sourcefile/datadelight.f90.html">DataDElight.f90</a>

      <a class="list-group-item" href="../sourcefile/dataenvironment.f90.html">DataEnvironment.f90</a>

      <a class="list-group-item" href="../sourcefile/dataequivalentlayerwindow.f90.html">DataEquivalentLayerWindow.f90</a>

      <a class="list-group-item" href="../sourcefile/dataerrortracking.f90.html">DataErrorTracking.f90</a>

      <a class="list-group-item" href="../sourcefile/datagenerators.f90.html">DataGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobalconstants.f90.html">DataGlobalConstants.f90</a>

      <a class="list-group-item" href="../sourcefile/dataglobals.f90.html">DataGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalance.f90.html">DataHeatBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalfansys.f90.html">DataHeatBalFanSys.f90</a>

      <a class="list-group-item" href="../sourcefile/dataheatbalsurface.f90.html">DataHeatBalSurface.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvaccontrollers.f90.html">DataHVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/datahvacglobals.f90.html">DataHVACGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datainterfaces.f90.html">DataInterfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/dataipshortcuts.f90.html">DataIPShortCuts.f90</a>

      <a class="list-group-item" href="../sourcefile/dataloopnode.f90.html">DataLoopNode.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalance.f90.html">DataMoistureBalance.f90</a>

      <a class="list-group-item" href="../sourcefile/datamoisturebalanceempd.f90.html">DataMoistureBalanceEMPD.f90</a>

      <a class="list-group-item" href="../sourcefile/dataoutputs.f90.html">DataOutputs.f90</a>

      <a class="list-group-item" href="../sourcefile/dataphotovoltaics.f90.html">DataPhotovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplant.f90.html">DataPlant.f90</a>

      <a class="list-group-item" href="../sourcefile/dataplantpipingsystems.f90.html">DataPlantPipingSystems.f90</a>

      <a class="list-group-item" href="../sourcefile/dataprecisionglobals.f90.html">DataPrecisionGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datareportingflags.f90.html">DataReportingFlags.f90</a>

      <a class="list-group-item" href="../sourcefile/dataroomair.f90.html">DataRoomAir.f90</a>

      <a class="list-group-item" href="../sourcefile/datarootfinder.f90.html">DataRootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/dataruntimelanguage.f90.html">DataRuntimeLanguage.f90</a>

      <a class="list-group-item" href="../sourcefile/datashadowingcombinations.f90.html">DataShadowingCombinations.f90</a>

      <a class="list-group-item" href="../sourcefile/datasizing.f90.html">DataSizing.f90</a>

      <a class="list-group-item" href="../sourcefile/datastringglobals.f90.html">DataStringGlobals.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacecolors.f90.html">DataSurfaceColors.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfacelists.f90.html">DataSurfaceLists.f90</a>

      <a class="list-group-item" href="../sourcefile/datasurfaces.f90.html">DataSurfaces.f90</a>

      <a class="list-group-item" href="../sourcefile/datasystemvariables.f90.html">DataSystemVariables.f90</a>

      <a class="list-group-item" href="../sourcefile/datatimings.f90.html">DataTimings.f90</a>

      <a class="list-group-item" href="../sourcefile/dataucsdshareddata.f90.html">DataUCSDSharedData.f90</a>

      <a class="list-group-item" href="../sourcefile/datavectortypes.f90.html">DataVectorTypes.f90</a>

      <a class="list-group-item" href="../sourcefile/dataviewfactorinformation.f90.html">DataViewFactorInformation.f90</a>

      <a class="list-group-item" href="../sourcefile/datawater.f90.html">DataWater.f90</a>

      <a class="list-group-item" href="../sourcefile/datazonecontrols.f90.html">DataZoneControls.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneenergydemands.f90.html">DataZoneEnergyDemands.f90</a>

      <a class="list-group-item" href="../sourcefile/datazoneequipment.f90.html">DataZoneEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingdevices.f90.html">DaylightingDevices.f90</a>

      <a class="list-group-item" href="../sourcefile/daylightingmanager.f90.html">DaylightingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf.f90.html">DElightManagerF.f90</a>

      <a class="list-group-item" href="../sourcefile/delightmanagerf_no.f90.html">DElightManagerF_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/demandmanager.f90.html">DemandManager.f90</a>

      <a class="list-group-item" href="../sourcefile/desiccantdehumidifiers.f90.html">DesiccantDehumidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/directair.f90.html">DirectAir.f90</a>

      <a class="list-group-item" href="../sourcefile/displayroutines.f90.html">DisplayRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/dxcoil.f90.html">DXCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/earthtube.f90.html">EarthTube.f90</a>

      <a class="list-group-item" href="../sourcefile/economiclifecyclecost.f90.html">EconomicLifeCycleCost.f90</a>

      <a class="list-group-item" href="../sourcefile/economictariff.f90.html">EconomicTariff.f90</a>

      <a class="list-group-item" href="../sourcefile/ecoroof.f90.html">EcoRoof.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowergenerators.f90.html">ElectricPowerGenerators.f90</a>

      <a class="list-group-item" href="../sourcefile/electricpowermanager.f90.html">ElectricPowerManager.f90</a>

      <a class="list-group-item" href="../sourcefile/emsmanager.f90.html">EMSManager.f90</a>

      <a class="list-group-item" href="../sourcefile/energyplus.f90.html">EnergyPlus.f90</a>

      <a class="list-group-item" href="../sourcefile/exteriorenergyusemanager.f90.html">ExteriorEnergyUseManager.f90</a>

      <a class="list-group-item" href="../sourcefile/externalinterface_no.f90.html">ExternalInterface_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/fancoilunits.f90.html">FanCoilUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/faultsmanager.f90.html">FaultsManager.f90</a>

      <a class="list-group-item" href="../sourcefile/fluidproperties.f90.html">FluidProperties.f90</a>

      <a class="list-group-item" href="../sourcefile/general.f90.html">General.f90</a>

      <a class="list-group-item" href="../sourcefile/generalroutines.f90.html">GeneralRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/globalnames.f90.html">GlobalNames.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceairmanager.f90.html">HeatBalanceAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceconvectioncoeffs.f90.html">HeatBalanceConvectionCoeffs.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancehamtmanager.f90.html">HeatBalanceHAMTManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceinternalheatgains.f90.html">HeatBalanceInternalHeatGains.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalanceintradexchange.f90.html">HeatBalanceIntRadExchange.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemanager.f90.html">HeatBalanceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancemovableinsulation.f90.html">HeatBalanceMovableInsulation.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalancesurfacemanager.f90.html">HeatBalanceSurfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatbalfinitedifferencemanager.f90.html">HeatBalFiniteDifferenceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/heatrecovery.f90.html">HeatRecovery.f90</a>

      <a class="list-group-item" href="../sourcefile/humidifiers.f90.html">Humidifiers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccontrollers.f90.html">HVACControllers.f90</a>

      <a class="list-group-item" href="../sourcefile/hvaccooledbeam.f90.html">HVACCooledBeam.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdualductsystem.f90.html">HVACDualDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacduct.f90.html">HVACDuct.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacdxsystem.f90.html">HVACDXSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacevapcomponent.f90.html">HVACEvapComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfancomponent.f90.html">HVACFanComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacfurnace.f90.html">HVACFurnace.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacheatingcoils.f90.html">HVACHeatingCoils.f90</a>

      <a class="list-group-item" href="../sourcefile/hvachxassistedcoolingcoil.f90.html">HVACHXAssistedCoolingCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacinterfacemanager.f90.html">HVACInterfaceManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmanager.f90.html">HVACManager.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmixercomponent.f90.html">HVACMixerComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacmultispeedheatpump.f90.html">HVACMultiSpeedHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductinduc.f90.html">HVACSingleDuctInduc.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsingleductsystem.f90.html">HVACSingleDuctSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsplittercomponent.f90.html">HVACSplitterComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacstandaloneerv.f90.html">HVACStandAloneERV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacsteamcoilcomponent.f90.html">HVACSteamCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvactranspiredcollector.f90.html">HVACTranspiredCollector.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarybypassvav.f90.html">HVACUnitaryBypassVAV.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacunitarysystem.f90.html">HVACUnitarySystem.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacvariablerefrigerantflow.f90.html">HVACVariableRefrigerantFlow.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatercoilcomponent.f90.html">HVACWaterCoilComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoair.f90.html">HVACWatertoAir.f90</a>

      <a class="list-group-item" href="../sourcefile/hvacwatertoairmultispeedhp.f90.html">HVACWatertoAirMultiSpeedHP.f90</a>

      <a class="list-group-item" href="../sourcefile/inputprocessor.f90.html">InputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/matrixdatamanager.f90.html">MatrixDataManager.f90</a>

      <a class="list-group-item" href="../sourcefile/mixedair.f90.html">MixedAir.f90</a>

      <a class="list-group-item" href="../sourcefile/moisturebalanceempdmanager.f90.html">MoistureBalanceEMPDManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nodeinputmanager.f90.html">NodeInputManager.f90</a>

      <a class="list-group-item" href="../sourcefile/nonzoneequipmentmanager.f90.html">NonZoneEquipmentManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outairnodemanager.f90.html">OutAirNodeManager.f90</a>

      <a class="list-group-item" href="../sourcefile/outdoorairunit.f90.html">OutdoorAirUnit.f90</a>

      <a class="list-group-item" href="../sourcefile/outputprocessor.f90.html">OutputProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreportpredefined.f90.html">OutputReportPredefined.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreports.f90.html">OutputReports.f90</a>

      <a class="list-group-item" href="../sourcefile/outputreporttabular.f90.html">OutputReportTabular.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedterminalheatpump.f90.html">PackagedTerminalHeatPump.f90</a>

      <a class="list-group-item" href="../sourcefile/packagedthermalstoragecoil.f90.html">PackagedThermalStorageCoil.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaics.f90.html">Photovoltaics.f90</a>

      <a class="list-group-item" href="../sourcefile/photovoltaicthermalcollectors.f90.html">PhotovoltaicThermalCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantabsorptionchillers.f90.html">PlantAbsorptionChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilers.f90.html">PlantBoilers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantboilerssteam.f90.html">PlantBoilersSteam.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcentralgshp.f90.html">PlantCentralGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantchillers.f90.html">PlantChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondloopoperation.f90.html">PlantCondLoopOperation.f90</a>

      <a class="list-group-item" href="../sourcefile/plantcondlooptowers.f90.html">PlantCondLoopTowers.f90</a>

      <a class="list-group-item" href="../sourcefile/planteirchillers.f90.html">PlantEIRChillers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantevapfluidcoolers.f90.html">PlantEvapFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantexhaustabsorptionchiller.f90.html">PlantExhaustAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantfluidcoolers.f90.html">PlantFluidCoolers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgasabsorptionchiller.f90.html">PlantGasAbsorptionChiller.f90</a>

      <a class="list-group-item" href="../sourcefile/plantgroundheatexchangers.f90.html">PlantGroundHeatExchangers.f90</a>

      <a class="list-group-item" href="../sourcefile/plantheatexchanger.f90.html">PlantHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/planticethermalstorage.f90.html">PlantIceThermalStorage.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloadprofile.f90.html">PlantLoadProfile.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopequipment.f90.html">PlantLoopEquipment.f90</a>

      <a class="list-group-item" href="../sourcefile/plantloopsolver.f90.html">PlantLoopSolver.f90</a>

      <a class="list-group-item" href="../sourcefile/plantmanager.f90.html">PlantManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantoutsideenergysources.f90.html">PlantOutsideEnergySources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipeheattransfer.f90.html">PlantPipeHeatTransfer.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipes.f90.html">PlantPipes.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpipingsystemmanager.f90.html">PlantPipingSystemManager.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpondgroundheatexchanger.f90.html">PlantPondGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpressuresystem.f90.html">PlantPressureSystem.f90</a>

      <a class="list-group-item" href="../sourcefile/plantpumps.f90.html">PlantPumps.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsolarcollectors.f90.html">PlantSolarCollectors.f90</a>

      <a class="list-group-item" href="../sourcefile/plantsurfacegroundheatexchanger.f90.html">PlantSurfaceGroundHeatExchanger.f90</a>

      <a class="list-group-item" href="../sourcefile/plantutilities.f90.html">PlantUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/plantvalves.f90.html">PlantValves.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatersources.f90.html">PlantWaterSources.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwaterthermaltank.f90.html">PlantWaterThermalTank.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwatertowatergshp.f90.html">PlantWatertoWaterGSHP.f90</a>

      <a class="list-group-item" href="../sourcefile/plantwateruse.f90.html">PlantWaterUse.f90</a>

      <a class="list-group-item" href="../sourcefile/pollutionanalysismodule.f90.html">PollutionAnalysisModule.f90</a>

      <a class="list-group-item" href="../sourcefile/poweredinductionunits.f90.html">PoweredInductionUnits.f90</a>

      <a class="list-group-item" href="../sourcefile/psychroutines.f90.html">PsychRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/purchasedairmanager.f90.html">Purchasedairmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemhightemp.f90.html">RadiantSystemHighTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/radiantsystemlowtemp.f90.html">RadiantSystemLowTemp.f90</a>

      <a class="list-group-item" href="../sourcefile/refrigeratedcase.f90.html">RefrigeratedCase.f90</a>

      <a class="list-group-item" href="../sourcefile/reportsizingmanager.f90.html">ReportSizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/returnairpath.f90.html">ReturnAirPath.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmanager.f90.html">RoomAirManager.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelcrossvent.f90.html">RoomAirModelCrossVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodeldisplacementvent.f90.html">RoomAirModelDisplacementVent.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelmundt.f90.html">RoomAirModelMundt.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelufad.f90.html">RoomAirModelUFAD.f90</a>

      <a class="list-group-item" href="../sourcefile/roomairmodelusertemppattern.f90.html">RoomAirModelUserTempPattern.f90</a>

      <a class="list-group-item" href="../sourcefile/rootfinder.f90.html">RootFinder.f90</a>

      <a class="list-group-item" href="../sourcefile/runtimelanguageprocessor.f90.html">RuntimeLanguageProcessor.f90</a>

      <a class="list-group-item" href="../sourcefile/schedulemanager.f90.html">ScheduleManager.f90</a>

      <a class="list-group-item" href="../sourcefile/setpointmanager.f90.html">SetPointManager.f90</a>

      <a class="list-group-item" href="../sourcefile/simairservingzones.f90.html">SimAirServingZones.f90</a>

      <a class="list-group-item" href="../sourcefile/simulationmanager.f90.html">SimulationManager.f90</a>

      <a class="list-group-item" href="../sourcefile/sizingmanager.f90.html">SizingManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarreflectionmanager.f90.html">SolarReflectionManager.f90</a>

      <a class="list-group-item" href="../sourcefile/solarshading.f90.html">SolarShading.f90</a>

      <a class="list-group-item" href="../sourcefile/sortandstringutilities.f90.html">SortAndStringUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlite3.c.html">sqlite3.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitecroutines.c.html">SQLiteCRoutines.c</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines.f90.html">SQLiteFortranRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/sqlitefortranroutines_no.f90.html">SQLiteFortranRoutines_NO.f90</a>

      <a class="list-group-item" href="../sourcefile/standardratings.f90.html">StandardRatings.f90</a>

      <a class="list-group-item" href="../sourcefile/surfacegeometry.f90.html">SurfaceGeometry.f90</a>

      <a class="list-group-item" href="../sourcefile/systemavailabilitymanager.f90.html">SystemAvailabilityManager.f90</a>

      <a class="list-group-item" href="../sourcefile/systemreports.f90.html">SystemReports.f90</a>

      <a class="list-group-item" href="../sourcefile/tarcogcomplexfenestration.f90.html">TarcogComplexFenestration.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalchimney.f90.html">ThermalChimney.f90</a>

      <a class="list-group-item" href="../sourcefile/thermalcomfort.f90.html">ThermalComfort.f90</a>

      <a class="list-group-item" href="../sourcefile/unitheater.f90.html">UnitHeater.f90</a>

      <a class="list-group-item" href="../sourcefile/unitventilator.f90.html">UnitVentilator.f90</a>

      <a class="list-group-item" href="../sourcefile/userdefinedcomponents.f90.html">UserDefinedComponents.f90</a>

      <a class="list-group-item" href="../sourcefile/utilityroutines.f90.html">UtilityRoutines.f90</a>

      <a class="list-group-item" href="../sourcefile/vectorutilities.f90.html">VectorUtilities.f90</a>

      <a class="list-group-item" href="../sourcefile/ventilatedslab.f90.html">VentilatedSlab.f90</a>

      <a class="list-group-item" href="../sourcefile/watermanager.f90.html">WaterManager.f90</a>

      <a class="list-group-item" href="../sourcefile/weathermanager.f90.html">WeatherManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowac.f90.html">WindowAC.f90</a>

      <a class="list-group-item" href="../sourcefile/windowcomplexmanager.f90.html">WindowComplexManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windowequivalentlayer.f90.html">WindowEquivalentLayer.f90</a>

      <a class="list-group-item" href="../sourcefile/windowmanager.f90.html">WindowManager.f90</a>

      <a class="list-group-item" href="../sourcefile/windturbine.f90.html">WindTurbine.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneairloopequipmentmanager.f90.html">Zoneairloopequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zonecontaminantpredictorcorrector.f90.html">ZoneContaminantPredictorCorrector.f90</a>

      <a class="list-group-item" href="../sourcefile/zonedehumidifier.f90.html">ZoneDehumidifier.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneequipmentmanager.f90.html">Zoneequipmentmanager.f90</a>

      <a class="list-group-item" href="../sourcefile/zoneplenumcomponent.f90.html">ZonePlenumComponent.f90</a>

      <a class="list-group-item" href="../sourcefile/zonetemppredictorcorrector.f90.html">ZoneTempPredictorCorrector.f90</a>

    </div>
  </div>
</div>


  </section>

    <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by
            <a href="https://github.com/cmacmackin/ford">FORD</a>

          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> EnergyPlusFortran</p></div>
      </div>
      <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': {
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>
